(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["devise-wysiwyg"],{"0538":function(t,e,n){"use strict";var r=n("1c0b"),o=n("861d"),i=[].slice,s={},a=function(t,e,n){if(!(e in s)){for(var r=[],o=0;o<e;o++)r[o]="a["+o+"]";s[e]=Function("C,a","return new C("+r.join(",")+")")}return s[e](t,n)};t.exports=Function.bind||function(t){var e=r(this),n=i.call(arguments,1),s=function(){var r=n.concat(i.call(arguments));return this instanceof s?a(e,r.length,r):e.apply(t,r)};return o(e.prototype)&&(s.prototype=e.prototype),s}},"073e":function(t,e,n){"use strict";var r=n("5dbe"),o=i(Error);function i(t){return e.displayName=t.displayName||t.name,e;function e(e){return e&&(e=r.apply(null,arguments)),new t(e)}}t.exports=o,o.eval=i(EvalError),o.range=i(RangeError),o.reference=i(ReferenceError),o.syntax=i(SyntaxError),o.type=i(TypeError),o.uri=i(URIError),o.create=i},"131a":function(t,e,n){var r=n("23e7"),o=n("d2bb");r({target:"Object",stat:!0},{setPrototypeOf:o})},2969:function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"dvs-bg-white dvs-rounded dvs-relative"},[n("editor-menu-bar",{attrs:{editor:t.editor},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.commands,o=e.isActive;return[n("div",{staticClass:"dvs-bg-gray-400 dvs-flex dvs-flex-wrap dvs-items-center dvs-rounded dvs-rounded-b-none"},[n("div",{staticClass:"wysiwyg-editor-button",class:{"dvs-bg-gray-500":o.bold()},on:{click:r.bold}},[n("bold-icon")],1),n("div",{staticClass:"wysiwyg-editor-button",class:{"dvs-bg-gray-500":o.italic()},on:{click:r.italic}},[n("italic-icon")],1),n("div",{staticClass:"wysiwyg-editor-button",class:{"dvs-bg-gray-500":o.strike()},on:{click:r.strike}},[n("strike-icon")],1),n("div",{staticClass:"wysiwyg-editor-button",class:{"dvs-bg-gray-500":o.underline()},on:{click:r.underline}},[n("underline-icon")],1),n("div",{staticClass:"wysiwyg-editor-button",class:{"dvs-bg-gray-500":o.superscript()},on:{click:r.superscript}},[n("sup",[t._v("2")])]),n("div",{staticClass:"wysiwyg-editor-button",class:{"dvs-bg-gray-500":o.underline()},on:{click:function(e){return t.launchMediaManager(r.image)}}},[n("image-icon")],1),n("div",{staticClass:"wysiwyg-editor-button",class:{"dvs-bg-gray-500":o.paragraph()},on:{click:r.paragraph}},[t._v(" P ")]),n("div",{staticClass:"wysiwyg-editor-button",class:{"dvs-bg-gray-500":o.heading({level:1})},on:{click:function(t){return r.heading({level:1})}}},[t._v(" H1 ")]),n("div",{staticClass:"wysiwyg-editor-button",class:{"dvs-bg-gray-500":o.heading({level:2})},on:{click:function(t){return r.heading({level:2})}}},[t._v(" H2 ")]),n("div",{staticClass:"wysiwyg-editor-button",class:{"dvs-bg-gray-500":o.heading({level:3})},on:{click:function(t){return r.heading({level:3})}}},[t._v(" H3 ")]),n("editor-menu-bubble",{staticClass:"menububble",attrs:{editor:t.editor},on:{hide:t.hideLinkMenu},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.commands,o=e.isActive,i=e.getMarkAttrs,s=e.menu;return[n("div",{staticClass:"menububble",class:{"is-active":s.isActive},style:"left: "+s.left+"px; bottom: "+s.bottom+"px;"},[t.linkMenuIsActive?n("form",{staticClass:"menububble__form dvs-bg-admin-bg dvs-text-admin-fg dvs-absolute dvs-p-4 dvs-rounded-sm dvs-shadow dvs-mt-2 dvs-z-10",on:{submit:function(e){return e.preventDefault(),t.setLinkUrl(r.link,t.linkUrl,t.linkTarget)}}},[n("fieldset",{staticClass:"dvs-fieldset"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.linkUrl,expression:"linkUrl"}],ref:"linkInput",staticClass:"menububble__input dvs-mr-2",attrs:{type:"text",placeholder:"https://"},domProps:{value:t.linkUrl},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"esc",27,e.key,["Esc","Escape"])?null:t.$emit("hide")},input:function(e){e.target.composing||(t.linkUrl=e.target.value)}}}),n("select",{directives:[{name:"model",rawName:"v-model",value:t.linkTarget,expression:"linkTarget"}],staticClass:"mt-2",on:{change:function(e){var n=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.linkTarget=e.target.multiple?n:n[0]}}},[n("option",{attrs:{value:"_self"}},[t._v("Same Window")]),n("option",{attrs:{value:"_blank"}},[t._v("New Tab / Window")]),n("option",{attrs:{value:"_parent"}},[t._v("Parent")]),n("option",{attrs:{value:"_top"}},[t._v("Top")])]),n("div",{staticClass:"dvs-flex"},[n("button",{staticClass:"menububble__button dvs-btn dvs-btn-secondary dvs-btn-sm dvs-mt-2",attrs:{type:"button"},on:{click:function(e){return t.setLinkUrl(r.link,t.linkUrl,t.linkTarget)}}},[t._v(" Done ")]),n("button",{staticClass:"menububble__button dvs-btn dvs-btn-primary dvs-btn-sm dvs-mt-2",attrs:{type:"button"},on:{click:function(e){return t.setLinkUrl(r.link,null,null)}}},[t._v(" Remove ")])])])]):t._e(),n("div",{staticClass:"wysiwyg-editor-button",class:{"dvs-bg-gray-500":o.underline()},on:{click:function(e){t.showLinkMenu(i("link"))}}},[n("link-icon")],1)])]}}],null,!0)}),n("div",{staticClass:"wysiwyg-editor-button",class:{"dvs-bg-gray-500":o.bullet_list()},on:{click:r.bullet_list}},[n("menu-icon")],1),n("div",{staticClass:"wysiwyg-editor-button",class:{"dvs-bg-gray-500":o.ordered_list()},on:{click:r.ordered_list}},[n("list-icon")],1),n("div",{staticClass:"dvs-p-2 dvs-text-2xl dvs-font-bold dvs-font-display wysiwyg-editor-button",class:{"dvs-bg-gray-500":o.blockquote()},staticStyle:{"line-height":"0.5","font-family":"Verdana"},on:{click:r.blockquote}},[t._v(' " ')]),n("div",[n("div",{staticClass:"wysiwyg-editor-button",class:{"is-active":o.textcolor({color:"red"})},on:{click:function(e){t.showTextColorPicker=!0}}},[n("type-icon")],1),t.showTextColorPicker?n("div",{staticClass:"dvs-absolute dvs-z-10 dvs-top-0 dvs--mt-8 dvs-bg-gray-300 dvs-p-4 dvs-rounded dvs-shadow-lg"},[n("color-picker",{staticClass:"dvs-mb-2",on:{cancel:function(e){t.showTextColorPicker=!1}},model:{value:t.textColor,callback:function(e){t.textColor=e},expression:"textColor"}}),n("div",{staticClass:"dvs-flex dvs-items-stretch"},[n("div",{staticClass:"dvs-btn dvs-bg-black dvs-text-gray-300 dvs-mr-2",on:{click:function(e){return t.applyTextColor(r)}}},[t._v(" Apply ")]),n("div",{staticClass:"dvs-btn dvs-border-black dvs-text-black dvs-border-2",on:{click:function(e){t.showTextColorPicker=!1}}},[t._v(" Cancel ")])])],1):t._e()]),n("div",{staticClass:"wysiwyg-editor-button",class:{"is-active":o.alignment({textAlign:"left"})},on:{click:function(t){return r.alignment({textAlign:"left"})}}},[n("align-left-icon")],1),n("div",{staticClass:"wysiwyg-editor-button",class:{"is-active":o.alignment({textAlign:"center"})},on:{click:function(t){return r.alignment({textAlign:"center"})}}},[n("align-center-icon")],1),n("div",{staticClass:"wysiwyg-editor-button",class:{"is-active":o.alignment({textAlign:"center"})},on:{click:function(t){return r.alignment({textAlign:"right"})}}},[n("align-right-icon")],1),n("div",{staticClass:"wysiwyg-editor-button",on:{click:r.horizontal_rule}},[n("minus-icon")],1),n("div",{staticClass:"wysiwyg-editor-button",on:{click:r.undo}},[n("corner-up-left-icon")],1),n("div",{staticClass:"wysiwyg-editor-button",on:{click:r.redo}},[n("corner-up-right-icon")],1),n("div",{staticClass:"wysiwyg-editor-button",on:{click:function(t){return r.createTable({rowsCount:3,colsCount:3,withHeaderRow:!1})}}},[n("table-icon")],1),n("div",{staticClass:"wysiwyg-editor-button",class:{"dvs-bg-gray-500":t.showSource},on:{click:function(e){t.showSource=!t.showSource}}},[n("code-icon")],1),o.table()?n("span",{staticClass:"dvs-bg-gray-500dvs-flex dvs-items-center"},[n("span",{staticClass:"dvs-text-2xs dvs-uppercase dvs-px-2 dvs-text-gray-800"},[t._v("Table Controls")]),n("div",{staticClass:"wysiwyg-editor-button",on:{click:r.deleteTable}},[n("delete-table-icon")],1),n("div",{staticClass:"wysiwyg-editor-button",on:{click:r.addColumnBefore}},[n("add-col-before-icon")],1),n("div",{staticClass:"wysiwyg-editor-button",on:{click:r.addColumnAfter}},[n("add-col-after-icon")],1),n("div",{staticClass:"wysiwyg-editor-button",on:{click:r.deleteColumn}},[n("delete-col-icon")],1),n("div",{staticClass:"wysiwyg-editor-button",on:{click:r.addRowBefore}},[n("add-row-before-icon")],1),n("div",{staticClass:"wysiwyg-editor-button",on:{click:r.addRowAfter}},[n("add-row-after-icon")],1),n("div",{staticClass:"wysiwyg-editor-button",on:{click:r.deleteRow}},[n("delete-row-icon")],1),n("div",{staticClass:"wysiwyg-editor-button",on:{click:r.toggleCellMerge}},[n("combine-cells-icon")],1)]):t._e()],1)]}}])}),n("editor-floating-menu",{attrs:{editor:t.editor},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.commands,o=e.isActive,i=e.menu;return[n("div",{staticClass:"editor__floating-menu dvs-bg-gray-400 dvs-flex dvs-flex-wrap dvs-items-center dvs-rounded dvs-rounded-b-none",class:{"is-active":i.isActive},style:"top: "+i.top+"px"},[n("div",{staticClass:"wysiwyg-editor-button",class:{"dvs-bg-gray-500":o.underline()},on:{click:function(e){return t.launchMediaManager(r.image)}}},[n("image-icon")],1),n("div",{staticClass:"wysiwyg-editor-button",class:{"dvs-bg-gray-500":o.paragraph()},on:{click:r.paragraph}},[t._v(" P ")]),n("div",{staticClass:"wysiwyg-editor-button",class:{"dvs-bg-gray-500":o.heading({level:1})},on:{click:function(t){return r.heading({level:1})}}},[t._v(" H1 ")]),n("div",{staticClass:"wysiwyg-editor-button",class:{"dvs-bg-gray-500":o.heading({level:2})},on:{click:function(t){return r.heading({level:2})}}},[t._v(" H2 ")]),n("div",{staticClass:"wysiwyg-editor-button",class:{"dvs-bg-gray-500":o.heading({level:3})},on:{click:function(t){return r.heading({level:3})}}},[t._v(" H3 ")]),n("div",{staticClass:"wysiwyg-editor-button",class:{"dvs-bg-gray-500":o.bullet_list()},on:{click:r.bullet_list}},[n("menu-icon")],1),n("div",{staticClass:"wysiwyg-editor-button",class:{"dvs-bg-gray-500":o.ordered_list()},on:{click:r.ordered_list}},[n("list-icon")],1),n("div",{staticClass:"dvs-p-2 dvs-text-2xl dvs-font-bold dvs-font-display wysiwyg-editor-button",class:{"dvs-bg-gray-500":o.blockquote()},staticStyle:{"line-height":"0.5"},on:{click:r.blockquote}},[t._v(' " ')]),n("div",{staticClass:"wysiwyg-editor-button",on:{click:function(t){return r.createTable({rowsCount:3,colsCount:3,withHeaderRow:!1})}}},[n("table-icon")],1)])]}}])}),t.showSource?t._e():n("editor-content",{staticClass:"dvs-overflow-y-scroll",staticStyle:{"max-height":"50vh"},attrs:{editor:t.editor}}),t.showSource?n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.localValue,expression:"localValue"}],staticClass:"dvs-h-full dvs-p-8 dvs-w-full dvs-font-mono dvs-text-sm dvs-text-gray-800",staticStyle:{height:"300px"},domProps:{value:t.localValue},on:{keyup:t.updateSource,input:function(e){e.target.composing||(t.localValue=e.target.value)}}}):t._e(),null!==t.imageToManage?n("div",{staticClass:"dvs-absolute dvs-absolute-center dvs-shadow-lg dvs-p-8 dvs-rounded dvs-z-50 dvs-bg-white"},[n("h4",{staticClass:"dvs-pb-4"},[t._v("Image Positioning:")]),n("div",{staticClass:"dvs-flex dvs-mb-4"},[n("div",{staticClass:"dvs-btn dvs-mr-2 dvs-btn-primary dvs-btn-sm",on:{click:function(e){return t.setImageFloat("left")}}},[t._v(" Float Left ")]),n("div",{staticClass:"dvs-btn dvs-mr-2 dvs-btn-primary dvs-btn-sm",on:{click:function(e){return t.setImageFloat("")}}},[t._v(" No Float ")]),n("div",{staticClass:"dvs-btn dvs-mr-2 dvs-btn-primary dvs-btn-sm",on:{click:function(e){return t.setImageFloat("right")}}},[t._v(" Float Right ")])]),n("div",{staticClass:"dvs-mb-4"},[n("fieldset",{staticClass:"dvs-fieldset"},[n("label",[t._v("Margin")]),n("input",{ref:"marginsetting",attrs:{type:"number",min:"0",max:"200"},on:{keyup:t.setImageMargin}})])]),n("div",{staticClass:"dvs-pb-8"},[n("fieldset",{staticClass:"dvs-fieldset"},[n("div",{staticClass:"dvs-btn dvs-btn-primary",on:{click:t.doneEditingImageStyles}},[t._v("Done")])])]),n("h4",{staticClass:"dvs-pb-4"},[t._v("Remove Image:")]),n("div",[n("fieldset",{staticClass:"dvs-fieldset"},[n("div",{staticClass:"dvs-btn dvs-btn-primary",on:{click:t.removeImage}},[t._v("Remove Image")])])])]):t._e(),null!==t.imageToManage?n("div",{staticClass:"dvs-blocker dvs-z-20",on:{click:function(e){t.imageToManage=null}}}):t._e()],1)},o=[],i=(n("99af"),n("d3b7"),n("53ca"));function s(t){this.content=t}s.prototype={constructor:s,find:function(t){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===t)return e;return-1},get:function(t){var e=this.find(t);return-1==e?void 0:this.content[e+1]},update:function(t,e,n){var r=n&&n!=t?this.remove(n):this,o=r.find(t),i=r.content.slice();return-1==o?i.push(n||t,e):(i[o+1]=e,n&&(i[o]=n)),new s(i)},remove:function(t){var e=this.find(t);if(-1==e)return this;var n=this.content.slice();return n.splice(e,2),new s(n)},addToStart:function(t,e){return new s([t,e].concat(this.remove(t).content))},addToEnd:function(t,e){var n=this.remove(t).content.slice();return n.push(t,e),new s(n)},addBefore:function(t,e,n){var r=this.remove(e),o=r.content.slice(),i=r.find(t);return o.splice(-1==i?o.length:i,0,e,n),new s(o)},forEach:function(t){for(var e=0;e<this.content.length;e+=2)t(this.content[e],this.content[e+1])},prepend:function(t){return t=s.from(t),t.size?new s(t.content.concat(this.subtract(t).content)):this},append:function(t){return t=s.from(t),t.size?new s(this.subtract(t).content.concat(t.content)):this},subtract:function(t){var e=this;t=s.from(t);for(var n=0;n<t.content.length;n+=2)e=e.remove(t.content[n]);return e},get size(){return this.content.length>>1}},s.from=function(t){if(t instanceof s)return t;var e=[];if(t)for(var n in t)e.push(n,t[n]);return new s(e)};var a=s,c=a;function h(t,e,n){for(var r=0;;r++){if(r==t.childCount||r==e.childCount)return t.childCount==e.childCount?null:n;var o=t.child(r),i=e.child(r);if(o!=i){if(!o.sameMarkup(i))return n;if(o.isText&&o.text!=i.text){for(var s=0;o.text[s]==i.text[s];s++)n++;return n}if(o.content.size||i.content.size){var a=h(o.content,i.content,n+1);if(null!=a)return a}n+=o.nodeSize}else n+=o.nodeSize}}function p(t,e,n,r){for(var o=t.childCount,i=e.childCount;;){if(0==o||0==i)return o==i?null:{a:n,b:r};var s=t.child(--o),a=e.child(--i),c=s.nodeSize;if(s!=a){if(!s.sameMarkup(a))return{a:n,b:r};if(s.isText&&s.text!=a.text){var h=0,l=Math.min(s.text.length,a.text.length);while(h<l&&s.text[s.text.length-h-1]==a.text[a.text.length-h-1])h++,n--,r--;return{a:n,b:r}}if(s.content.size||a.content.size){var u=p(s.content,a.content,n-1,r-1);if(u)return u}n-=c,r-=c}else n-=c,r-=c}}var l=function(t,e){if(this.content=t,this.size=e||0,null==e)for(var n=0;n<t.length;n++)this.size+=t[n].nodeSize},u={firstChild:{configurable:!0},lastChild:{configurable:!0},childCount:{configurable:!0}};l.prototype.nodesBetween=function(t,e,n,r,o){void 0===r&&(r=0);for(var i=0,s=0;s<e;i++){var a=this.content[i],c=s+a.nodeSize;if(c>t&&!1!==n(a,r+s,o,i)&&a.content.size){var h=s+1;a.nodesBetween(Math.max(0,t-h),Math.min(a.content.size,e-h),n,r+h)}s=c}},l.prototype.descendants=function(t){this.nodesBetween(0,this.size,t)},l.prototype.textBetween=function(t,e,n,r){var o="",i=!0;return this.nodesBetween(t,e,(function(s,a){s.isText?(o+=s.text.slice(Math.max(t,a)-a,e-a),i=!n):s.isLeaf&&r?(o+=r,i=!n):!i&&s.isBlock&&(o+=n,i=!0)}),0),o},l.prototype.append=function(t){if(!t.size)return this;if(!this.size)return t;var e=this.lastChild,n=t.firstChild,r=this.content.slice(),o=0;for(e.isText&&e.sameMarkup(n)&&(r[r.length-1]=e.withText(e.text+n.text),o=1);o<t.content.length;o++)r.push(t.content[o]);return new l(r,this.size+t.size)},l.prototype.cut=function(t,e){if(null==e&&(e=this.size),0==t&&e==this.size)return this;var n=[],r=0;if(e>t)for(var o=0,i=0;i<e;o++){var s=this.content[o],a=i+s.nodeSize;a>t&&((i<t||a>e)&&(s=s.isText?s.cut(Math.max(0,t-i),Math.min(s.text.length,e-i)):s.cut(Math.max(0,t-i-1),Math.min(s.content.size,e-i-1))),n.push(s),r+=s.nodeSize),i=a}return new l(n,r)},l.prototype.cutByIndex=function(t,e){return t==e?l.empty:0==t&&e==this.content.length?this:new l(this.content.slice(t,e))},l.prototype.replaceChild=function(t,e){var n=this.content[t];if(n==e)return this;var r=this.content.slice(),o=this.size+e.nodeSize-n.nodeSize;return r[t]=e,new l(r,o)},l.prototype.addToStart=function(t){return new l([t].concat(this.content),this.size+t.nodeSize)},l.prototype.addToEnd=function(t){return new l(this.content.concat(t),this.size+t.nodeSize)},l.prototype.eq=function(t){if(this.content.length!=t.content.length)return!1;for(var e=0;e<this.content.length;e++)if(!this.content[e].eq(t.content[e]))return!1;return!0},u.firstChild.get=function(){return this.content.length?this.content[0]:null},u.lastChild.get=function(){return this.content.length?this.content[this.content.length-1]:null},u.childCount.get=function(){return this.content.length},l.prototype.child=function(t){var e=this.content[t];if(!e)throw new RangeError("Index "+t+" out of range for "+this);return e},l.prototype.maybeChild=function(t){return this.content[t]},l.prototype.forEach=function(t){for(var e=0,n=0;e<this.content.length;e++){var r=this.content[e];t(r,n,e),n+=r.nodeSize}},l.prototype.findDiffStart=function(t,e){return void 0===e&&(e=0),h(this,t,e)},l.prototype.findDiffEnd=function(t,e,n){return void 0===e&&(e=this.size),void 0===n&&(n=t.size),p(this,t,e,n)},l.prototype.findIndex=function(t,e){if(void 0===e&&(e=-1),0==t)return d(0,t);if(t==this.size)return d(this.content.length,t);if(t>this.size||t<0)throw new RangeError("Position "+t+" outside of fragment ("+this+")");for(var n=0,r=0;;n++){var o=this.child(n),i=r+o.nodeSize;if(i>=t)return i==t||e>0?d(n+1,i):d(n,r);r=i}},l.prototype.toString=function(){return"<"+this.toStringInner()+">"},l.prototype.toStringInner=function(){return this.content.join(", ")},l.prototype.toJSON=function(){return this.content.length?this.content.map((function(t){return t.toJSON()})):null},l.fromJSON=function(t,e){if(!e)return l.empty;if(!Array.isArray(e))throw new RangeError("Invalid input for Fragment.fromJSON");return new l(e.map(t.nodeFromJSON))},l.fromArray=function(t){if(!t.length)return l.empty;for(var e,n=0,r=0;r<t.length;r++){var o=t[r];n+=o.nodeSize,r&&o.isText&&t[r-1].sameMarkup(o)?(e||(e=t.slice(0,r)),e[e.length-1]=o.withText(e[e.length-1].text+o.text)):e&&e.push(o)}return new l(e||t,n)},l.from=function(t){if(!t)return l.empty;if(t instanceof l)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new l([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))},Object.defineProperties(l.prototype,u);var f={index:0,offset:0};function d(t,e){return f.index=t,f.offset=e,f}function m(t,e){if(t===e)return!0;if(!t||"object"!=typeof t||!e||"object"!=typeof e)return!1;var n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(var r=0;r<t.length;r++)if(!m(t[r],e[r]))return!1}else{for(var o in t)if(!(o in e)||!m(t[o],e[o]))return!1;for(var i in e)if(!(i in t))return!1}return!0}l.empty=new l([],0);var v=function(t,e){this.type=t,this.attrs=e};function g(t){var e=Error.call(this,t);return e.__proto__=g.prototype,e}v.prototype.addToSet=function(t){for(var e,n=!1,r=0;r<t.length;r++){var o=t[r];if(this.eq(o))return t;if(this.type.excludes(o.type))e||(e=t.slice(0,r));else{if(o.type.excludes(this.type))return t;!n&&o.type.rank>this.type.rank&&(e||(e=t.slice(0,r)),e.push(this),n=!0),e&&e.push(o)}}return e||(e=t.slice()),n||e.push(this),e},v.prototype.removeFromSet=function(t){for(var e=0;e<t.length;e++)if(this.eq(t[e]))return t.slice(0,e).concat(t.slice(e+1));return t},v.prototype.isInSet=function(t){for(var e=0;e<t.length;e++)if(this.eq(t[e]))return!0;return!1},v.prototype.eq=function(t){return this==t||this.type==t.type&&m(this.attrs,t.attrs)},v.prototype.toJSON=function(){var t={type:this.type.name};for(var e in this.attrs){t.attrs=this.attrs;break}return t},v.fromJSON=function(t,e){if(!e)throw new RangeError("Invalid input for Mark.fromJSON");var n=t.marks[e.type];if(!n)throw new RangeError("There is no mark type "+e.type+" in this schema");return n.create(e.attrs)},v.sameSet=function(t,e){if(t==e)return!0;if(t.length!=e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].eq(e[n]))return!1;return!0},v.setFrom=function(t){if(!t||0==t.length)return v.none;if(t instanceof v)return[t];var e=t.slice();return e.sort((function(t,e){return t.type.rank-e.type.rank})),e},v.none=[],g.prototype=Object.create(Error.prototype),g.prototype.constructor=g,g.prototype.name="ReplaceError";var y=function(t,e,n){this.content=t,this.openStart=e,this.openEnd=n},w={size:{configurable:!0}};function x(t,e,n){var r=t.findIndex(e),o=r.index,i=r.offset,s=t.maybeChild(o),a=t.findIndex(n),c=a.index,h=a.offset;if(i==e||s.isText){if(h!=n&&!t.child(c).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(o!=c)throw new RangeError("Removing non-flat range");return t.replaceChild(o,s.copy(x(s.content,e-i-1,n-i-1)))}function b(t,e,n,r){var o=t.findIndex(e),i=o.index,s=o.offset,a=t.maybeChild(i);if(s==e||a.isText)return r&&!r.canReplace(i,i,n)?null:t.cut(0,e).append(n).append(t.cut(e));var c=b(a.content,e-s-1,n);return c&&t.replaceChild(i,a.copy(c))}function k(t,e,n){if(n.openStart>t.depth)throw new g("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new g("Inconsistent open depths");return S(t,e,n,0)}function S(t,e,n,r){var o=t.index(r),i=t.node(r);if(o==e.index(r)&&r<t.depth-n.openStart){var s=S(t,e,n,r+1);return i.copy(i.content.replaceChild(o,s))}if(n.content.size){if(n.openStart||n.openEnd||t.depth!=r||e.depth!=r){var a=D(n,t),c=a.start,h=a.end;return T(i,E(t,c,h,e,r))}var p=t.parent,l=p.content;return T(p,l.cut(0,t.parentOffset).append(n.content).append(l.cut(e.parentOffset)))}return T(i,A(t,e,r))}function O(t,e){if(!e.type.compatibleContent(t.type))throw new g("Cannot join "+e.type.name+" onto "+t.type.name)}function C(t,e,n){var r=t.node(n);return O(r,e.node(n)),r}function M(t,e){var n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function N(t,e,n,r){var o=(e||t).node(n),i=0,s=e?e.index(n):o.childCount;t&&(i=t.index(n),t.depth>n?i++:t.textOffset&&(M(t.nodeAfter,r),i++));for(var a=i;a<s;a++)M(o.child(a),r);e&&e.depth==n&&e.textOffset&&M(e.nodeBefore,r)}function T(t,e){if(!t.type.validContent(e))throw new g("Invalid content for node "+t.type.name);return t.copy(e)}function E(t,e,n,r,o){var i=t.depth>o&&C(t,e,o+1),s=r.depth>o&&C(n,r,o+1),a=[];return N(null,t,o,a),i&&s&&e.index(o)==n.index(o)?(O(i,s),M(T(i,E(t,e,n,r,o+1)),a)):(i&&M(T(i,A(t,e,o+1)),a),N(e,n,o,a),s&&M(T(s,A(n,r,o+1)),a)),N(r,null,o,a),new l(a)}function A(t,e,n){var r=[];if(N(null,t,n,r),t.depth>n){var o=C(t,e,n+1);M(T(o,A(t,e,n+1)),r)}return N(e,null,n,r),new l(r)}function D(t,e){for(var n=e.depth-t.openStart,r=e.node(n),o=r.copy(t.content),i=n-1;i>=0;i--)o=e.node(i).copy(l.from(o));return{start:o.resolveNoCache(t.openStart+n),end:o.resolveNoCache(o.content.size-t.openEnd-n)}}w.size.get=function(){return this.content.size-this.openStart-this.openEnd},y.prototype.insertAt=function(t,e){var n=b(this.content,t+this.openStart,e,null);return n&&new y(n,this.openStart,this.openEnd)},y.prototype.removeBetween=function(t,e){return new y(x(this.content,t+this.openStart,e+this.openStart),this.openStart,this.openEnd)},y.prototype.eq=function(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd},y.prototype.toString=function(){return this.content+"("+this.openStart+","+this.openEnd+")"},y.prototype.toJSON=function(){if(!this.content.size)return null;var t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t},y.fromJSON=function(t,e){if(!e)return y.empty;var n=e.openStart||0,r=e.openEnd||0;if("number"!=typeof n||"number"!=typeof r)throw new RangeError("Invalid input for Slice.fromJSON");return new y(l.fromJSON(t,e.content),e.openStart||0,e.openEnd||0)},y.maxOpen=function(t,e){void 0===e&&(e=!0);for(var n=0,r=0,o=t.firstChild;o&&!o.isLeaf&&(e||!o.type.spec.isolating);o=o.firstChild)n++;for(var i=t.lastChild;i&&!i.isLeaf&&(e||!i.type.spec.isolating);i=i.lastChild)r++;return new y(t,n,r)},Object.defineProperties(y.prototype,w),y.empty=new y(l.empty,0,0);var R=function(t,e,n){this.pos=t,this.path=e,this.depth=e.length/3-1,this.parentOffset=n},z={parent:{configurable:!0},doc:{configurable:!0},textOffset:{configurable:!0},nodeAfter:{configurable:!0},nodeBefore:{configurable:!0}};R.prototype.resolveDepth=function(t){return null==t?this.depth:t<0?this.depth+t:t},z.parent.get=function(){return this.node(this.depth)},z.doc.get=function(){return this.node(0)},R.prototype.node=function(t){return this.path[3*this.resolveDepth(t)]},R.prototype.index=function(t){return this.path[3*this.resolveDepth(t)+1]},R.prototype.indexAfter=function(t){return t=this.resolveDepth(t),this.index(t)+(t!=this.depth||this.textOffset?1:0)},R.prototype.start=function(t){return t=this.resolveDepth(t),0==t?0:this.path[3*t-1]+1},R.prototype.end=function(t){return t=this.resolveDepth(t),this.start(t)+this.node(t).content.size},R.prototype.before=function(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position before the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]},R.prototype.after=function(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position after the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]+this.path[3*t].nodeSize},z.textOffset.get=function(){return this.pos-this.path[this.path.length-1]},z.nodeAfter.get=function(){var t=this.parent,e=this.index(this.depth);if(e==t.childCount)return null;var n=this.pos-this.path[this.path.length-1],r=t.child(e);return n?t.child(e).cut(n):r},z.nodeBefore.get=function(){var t=this.index(this.depth),e=this.pos-this.path[this.path.length-1];return e?this.parent.child(t).cut(0,e):0==t?null:this.parent.child(t-1)},R.prototype.marks=function(){var t=this.parent,e=this.index();if(0==t.content.size)return v.none;if(this.textOffset)return t.child(e).marks;var n=t.maybeChild(e-1),r=t.maybeChild(e);if(!n){var o=n;n=r,r=o}for(var i=n.marks,s=0;s<i.length;s++)!1!==i[s].type.spec.inclusive||r&&i[s].isInSet(r.marks)||(i=i[s--].removeFromSet(i));return i},R.prototype.marksAcross=function(t){var e=this.parent.maybeChild(this.index());if(!e||!e.isInline)return null;for(var n=e.marks,r=t.parent.maybeChild(t.index()),o=0;o<n.length;o++)!1!==n[o].type.spec.inclusive||r&&n[o].isInSet(r.marks)||(n=n[o--].removeFromSet(n));return n},R.prototype.sharedDepth=function(t){for(var e=this.depth;e>0;e--)if(this.start(e)<=t&&this.end(e)>=t)return e;return 0},R.prototype.blockRange=function(t,e){if(void 0===t&&(t=this),t.pos<this.pos)return t.blockRange(this);for(var n=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);n>=0;n--)if(t.pos<=this.end(n)&&(!e||e(this.node(n))))return new B(this,t,n)},R.prototype.sameParent=function(t){return this.pos-this.parentOffset==t.pos-t.parentOffset},R.prototype.max=function(t){return t.pos>this.pos?t:this},R.prototype.min=function(t){return t.pos<this.pos?t:this},R.prototype.toString=function(){for(var t="",e=1;e<=this.depth;e++)t+=(t?"/":"")+this.node(e).type.name+"_"+this.index(e-1);return t+":"+this.parentOffset},R.resolve=function(t,e){if(!(e>=0&&e<=t.content.size))throw new RangeError("Position "+e+" out of range");for(var n=[],r=0,o=e,i=t;;){var s=i.content.findIndex(o),a=s.index,c=s.offset,h=o-c;if(n.push(i,a,r+c),!h)break;if(i=i.child(a),i.isText)break;o=h-1,r+=c+1}return new R(e,n,o)},R.resolveCached=function(t,e){for(var n=0;n<I.length;n++){var r=I[n];if(r.pos==e&&r.doc==t)return r}var o=I[P]=R.resolve(t,e);return P=(P+1)%F,o},Object.defineProperties(R.prototype,z);var I=[],P=0,F=12,B=function(t,e,n){this.$from=t,this.$to=e,this.depth=n},$={start:{configurable:!0},end:{configurable:!0},parent:{configurable:!0},startIndex:{configurable:!0},endIndex:{configurable:!0}};$.start.get=function(){return this.$from.before(this.depth+1)},$.end.get=function(){return this.$to.after(this.depth+1)},$.parent.get=function(){return this.$from.node(this.depth)},$.startIndex.get=function(){return this.$from.index(this.depth)},$.endIndex.get=function(){return this.$to.indexAfter(this.depth)},Object.defineProperties(B.prototype,$);var _=Object.create(null),j=function(t,e,n,r){this.type=t,this.attrs=e,this.content=n||l.empty,this.marks=r||v.none},J={nodeSize:{configurable:!0},childCount:{configurable:!0},textContent:{configurable:!0},firstChild:{configurable:!0},lastChild:{configurable:!0},isBlock:{configurable:!0},isTextblock:{configurable:!0},inlineContent:{configurable:!0},isInline:{configurable:!0},isText:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};J.nodeSize.get=function(){return this.isLeaf?1:2+this.content.size},J.childCount.get=function(){return this.content.childCount},j.prototype.child=function(t){return this.content.child(t)},j.prototype.maybeChild=function(t){return this.content.maybeChild(t)},j.prototype.forEach=function(t){this.content.forEach(t)},j.prototype.nodesBetween=function(t,e,n,r){void 0===r&&(r=0),this.content.nodesBetween(t,e,n,r,this)},j.prototype.descendants=function(t){this.nodesBetween(0,this.content.size,t)},J.textContent.get=function(){return this.textBetween(0,this.content.size,"")},j.prototype.textBetween=function(t,e,n,r){return this.content.textBetween(t,e,n,r)},J.firstChild.get=function(){return this.content.firstChild},J.lastChild.get=function(){return this.content.lastChild},j.prototype.eq=function(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)},j.prototype.sameMarkup=function(t){return this.hasMarkup(t.type,t.attrs,t.marks)},j.prototype.hasMarkup=function(t,e,n){return this.type==t&&m(this.attrs,e||t.defaultAttrs||_)&&v.sameSet(this.marks,n||v.none)},j.prototype.copy=function(t){return void 0===t&&(t=null),t==this.content?this:new this.constructor(this.type,this.attrs,t,this.marks)},j.prototype.mark=function(t){return t==this.marks?this:new this.constructor(this.type,this.attrs,this.content,t)},j.prototype.cut=function(t,e){return 0==t&&e==this.content.size?this:this.copy(this.content.cut(t,e))},j.prototype.slice=function(t,e,n){if(void 0===e&&(e=this.content.size),void 0===n&&(n=!1),t==e)return y.empty;var r=this.resolve(t),o=this.resolve(e),i=n?0:r.sharedDepth(e),s=r.start(i),a=r.node(i),c=a.content.cut(r.pos-s,o.pos-s);return new y(c,r.depth-i,o.depth-i)},j.prototype.replace=function(t,e,n){return k(this.resolve(t),this.resolve(e),n)},j.prototype.nodeAt=function(t){for(var e=this;;){var n=e.content.findIndex(t),r=n.index,o=n.offset;if(e=e.maybeChild(r),!e)return null;if(o==t||e.isText)return e;t-=o+1}},j.prototype.childAfter=function(t){var e=this.content.findIndex(t),n=e.index,r=e.offset;return{node:this.content.maybeChild(n),index:n,offset:r}},j.prototype.childBefore=function(t){if(0==t)return{node:null,index:0,offset:0};var e=this.content.findIndex(t),n=e.index,r=e.offset;if(r<t)return{node:this.content.child(n),index:n,offset:r};var o=this.content.child(n-1);return{node:o,index:n-1,offset:r-o.nodeSize}},j.prototype.resolve=function(t){return R.resolveCached(this,t)},j.prototype.resolveNoCache=function(t){return R.resolve(this,t)},j.prototype.rangeHasMark=function(t,e,n){var r=!1;return e>t&&this.nodesBetween(t,e,(function(t){return n.isInSet(t.marks)&&(r=!0),!r})),r},J.isBlock.get=function(){return this.type.isBlock},J.isTextblock.get=function(){return this.type.isTextblock},J.inlineContent.get=function(){return this.type.inlineContent},J.isInline.get=function(){return this.type.isInline},J.isText.get=function(){return this.type.isText},J.isLeaf.get=function(){return this.type.isLeaf},J.isAtom.get=function(){return this.type.isAtom},j.prototype.toString=function(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);var t=this.type.name;return this.content.size&&(t+="("+this.content.toStringInner()+")"),V(this.marks,t)},j.prototype.contentMatchAt=function(t){var e=this.type.contentMatch.matchFragment(this.content,0,t);if(!e)throw new Error("Called contentMatchAt on a node with invalid content");return e},j.prototype.canReplace=function(t,e,n,r,o){void 0===n&&(n=l.empty),void 0===r&&(r=0),void 0===o&&(o=n.childCount);var i=this.contentMatchAt(t).matchFragment(n,r,o),s=i&&i.matchFragment(this.content,e);if(!s||!s.validEnd)return!1;for(var a=r;a<o;a++)if(!this.type.allowsMarks(n.child(a).marks))return!1;return!0},j.prototype.canReplaceWith=function(t,e,n,r){if(r&&!this.type.allowsMarks(r))return!1;var o=this.contentMatchAt(t).matchType(n),i=o&&o.matchFragment(this.content,e);return!!i&&i.validEnd},j.prototype.canAppend=function(t){return t.content.size?this.canReplace(this.childCount,this.childCount,t.content):this.type.compatibleContent(t.type)},j.prototype.check=function(){if(!this.type.validContent(this.content))throw new RangeError("Invalid content for node "+this.type.name+": "+this.content.toString().slice(0,50));this.content.forEach((function(t){return t.check()}))},j.prototype.toJSON=function(){var t={type:this.type.name};for(var e in this.attrs){t.attrs=this.attrs;break}return this.content.size&&(t.content=this.content.toJSON()),this.marks.length&&(t.marks=this.marks.map((function(t){return t.toJSON()}))),t},j.fromJSON=function(t,e){if(!e)throw new RangeError("Invalid input for Node.fromJSON");var n=null;if(e.marks){if(!Array.isArray(e.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=e.marks.map(t.markFromJSON)}if("text"==e.type){if("string"!=typeof e.text)throw new RangeError("Invalid text node in JSON");return t.text(e.text,n)}var r=l.fromJSON(t,e.content);return t.nodeType(e.type).create(e.attrs,r,n)},Object.defineProperties(j.prototype,J);var L=function(t){function e(e,n,r,o){if(t.call(this,e,n,null,o),!r)throw new RangeError("Empty text nodes are not allowed");this.text=r}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={textContent:{configurable:!0},nodeSize:{configurable:!0}};return e.prototype.toString=function(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):V(this.marks,JSON.stringify(this.text))},n.textContent.get=function(){return this.text},e.prototype.textBetween=function(t,e){return this.text.slice(t,e)},n.nodeSize.get=function(){return this.text.length},e.prototype.mark=function(t){return t==this.marks?this:new e(this.type,this.attrs,this.text,t)},e.prototype.withText=function(t){return t==this.text?this:new e(this.type,this.attrs,t,this.marks)},e.prototype.cut=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=this.text.length),0==t&&e==this.text.length?this:this.withText(this.text.slice(t,e))},e.prototype.eq=function(t){return this.sameMarkup(t)&&this.text==t.text},e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.text=this.text,e},Object.defineProperties(e.prototype,n),e}(j);function V(t,e){for(var n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}var q=function(t){this.validEnd=t,this.next=[],this.wrapCache=[]},W={inlineContent:{configurable:!0},defaultType:{configurable:!0},edgeCount:{configurable:!0}};q.parse=function(t,e){var n=new H(t,e);if(null==n.next)return q.empty;var r=U(n);n.next&&n.err("Unexpected trailing text");var o=ot(et(r));return it(o,n),o},q.prototype.matchType=function(t){for(var e=0;e<this.next.length;e+=2)if(this.next[e]==t)return this.next[e+1];return null},q.prototype.matchFragment=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=t.childCount);for(var r=this,o=e;r&&o<n;o++)r=r.matchType(t.child(o).type);return r},W.inlineContent.get=function(){var t=this.next[0];return!!t&&t.isInline},W.defaultType.get=function(){for(var t=0;t<this.next.length;t+=2){var e=this.next[t];if(!e.isText&&!e.hasRequiredAttrs())return e}},q.prototype.compatible=function(t){for(var e=0;e<this.next.length;e+=2)for(var n=0;n<t.next.length;n+=2)if(this.next[e]==t.next[n])return!0;return!1},q.prototype.fillBefore=function(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=0);var r=[this];function o(i,s){var a=i.matchFragment(t,n);if(a&&(!e||a.validEnd))return l.from(s.map((function(t){return t.createAndFill()})));for(var c=0;c<i.next.length;c+=2){var h=i.next[c],p=i.next[c+1];if(!h.isText&&!h.hasRequiredAttrs()&&-1==r.indexOf(p)){r.push(p);var u=o(p,s.concat(h));if(u)return u}}}return o(this,[])},q.prototype.findWrapping=function(t){for(var e=0;e<this.wrapCache.length;e+=2)if(this.wrapCache[e]==t)return this.wrapCache[e+1];var n=this.computeWrapping(t);return this.wrapCache.push(t,n),n},q.prototype.computeWrapping=function(t){var e=Object.create(null),n=[{match:this,type:null,via:null}];while(n.length){var r=n.shift(),o=r.match;if(o.matchType(t)){for(var i=[],s=r;s.type;s=s.via)i.push(s.type);return i.reverse()}for(var a=0;a<o.next.length;a+=2){var c=o.next[a];c.isLeaf||c.hasRequiredAttrs()||c.name in e||r.type&&!o.next[a+1].validEnd||(n.push({match:c.contentMatch,type:c,via:r}),e[c.name]=!0)}}},W.edgeCount.get=function(){return this.next.length>>1},q.prototype.edge=function(t){var e=t<<1;if(e>=this.next.length)throw new RangeError("There's no "+t+"th edge in this content match");return{type:this.next[e],next:this.next[e+1]}},q.prototype.toString=function(){var t=[];function e(n){t.push(n);for(var r=1;r<n.next.length;r+=2)-1==t.indexOf(n.next[r])&&e(n.next[r])}return e(this),t.map((function(e,n){for(var r=n+(e.validEnd?"*":" ")+" ",o=0;o<e.next.length;o+=2)r+=(o?", ":"")+e.next[o].name+"->"+t.indexOf(e.next[o+1]);return r})).join("\n")},Object.defineProperties(q.prototype,W),q.empty=new q(!0);var H=function(t,e){this.string=t,this.nodeTypes=e,this.inline=null,this.pos=0,this.tokens=t.split(/\s*(?=\b|\W|$)/),""==this.tokens[this.tokens.length-1]&&this.tokens.pop(),""==this.tokens[0]&&this.tokens.unshift()},K={next:{configurable:!0}};function U(t){var e=[];do{e.push(G(t))}while(t.eat("|"));return 1==e.length?e[0]:{type:"choice",exprs:e}}function G(t){var e=[];do{e.push(X(t))}while(t.next&&")"!=t.next&&"|"!=t.next);return 1==e.length?e[0]:{type:"seq",exprs:e}}function X(t){for(var e=tt(t);;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else{if(!t.eat("{"))break;e=Z(t,e)}return e}function Y(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");var e=Number(t.next);return t.pos++,e}function Z(t,e){var n=Y(t),r=n;return t.eat(",")&&(r="}"!=t.next?Y(t):-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:e}}function Q(t,e){var n=t.nodeTypes,r=n[e];if(r)return[r];var o=[];for(var i in n){var s=n[i];s.groups.indexOf(e)>-1&&o.push(s)}return 0==o.length&&t.err("No node type or group '"+e+"' found"),o}function tt(t){if(t.eat("(")){var e=U(t);return t.eat(")")||t.err("Missing closing paren"),e}if(!/\W/.test(t.next)){var n=Q(t,t.next).map((function(e){return null==t.inline?t.inline=e.isInline:t.inline!=e.isInline&&t.err("Mixing inline and block content"),{type:"name",value:e}}));return t.pos++,1==n.length?n[0]:{type:"choice",exprs:n}}t.err("Unexpected token '"+t.next+"'")}function et(t){var e=[[]];return o(i(t,0),n()),e;function n(){return e.push([])-1}function r(t,n,r){var o={term:r,to:n};return e[t].push(o),o}function o(t,e){t.forEach((function(t){return t.to=e}))}function i(t,e){if("choice"==t.type)return t.exprs.reduce((function(t,n){return t.concat(i(n,e))}),[]);if("seq"==t.type)for(var s=0;;s++){var a=i(t.exprs[s],e);if(s==t.exprs.length-1)return a;o(a,e=n())}else{if("star"==t.type){var c=n();return r(e,c),o(i(t.expr,c),c),[r(c)]}if("plus"==t.type){var h=n();return o(i(t.expr,e),h),o(i(t.expr,h),h),[r(h)]}if("opt"==t.type)return[r(e)].concat(i(t.expr,e));if("range"==t.type){for(var p=e,l=0;l<t.min;l++){var u=n();o(i(t.expr,p),u),p=u}if(-1==t.max)o(i(t.expr,p),p);else for(var f=t.min;f<t.max;f++){var d=n();r(p,d),o(i(t.expr,p),d),p=d}return[r(p)]}if("name"==t.type)return[r(e,null,t.value)]}}}function nt(t,e){return e-t}function rt(t,e){var n=[];return r(e),n.sort(nt);function r(e){var o=t[e];if(1==o.length&&!o[0].term)return r(o[0].to);n.push(e);for(var i=0;i<o.length;i++){var s=o[i],a=s.term,c=s.to;a||-1!=n.indexOf(c)||r(c)}}}function ot(t){var e=Object.create(null);return n(rt(t,0));function n(r){var o=[];r.forEach((function(e){t[e].forEach((function(e){var n=e.term,r=e.to;if(n){var i=o.indexOf(n),s=i>-1&&o[i+1];rt(t,r).forEach((function(t){s||o.push(n,s=[]),-1==s.indexOf(t)&&s.push(t)}))}}))}));for(var i=e[r.join(",")]=new q(r.indexOf(t.length-1)>-1),s=0;s<o.length;s+=2){var a=o[s+1].sort(nt);i.next.push(o[s],e[a.join(",")]||n(a))}return i}}function it(t,e){for(var n=0,r=[t];n<r.length;n++){for(var o=r[n],i=!o.validEnd,s=[],a=0;a<o.next.length;a+=2){var c=o.next[a],h=o.next[a+1];s.push(c.name),!i||c.isText||c.hasRequiredAttrs()||(i=!1),-1==r.indexOf(h)&&r.push(h)}i&&e.err("Only non-generatable nodes ("+s.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function st(t){var e=Object.create(null);for(var n in t){var r=t[n];if(!r.hasDefault)return null;e[n]=r.default}return e}function at(t,e){var n=Object.create(null);for(var r in t){var o=e&&e[r];if(void 0===o){var i=t[r];if(!i.hasDefault)throw new RangeError("No value supplied for attribute "+r);o=i.default}n[r]=o}return n}function ct(t){var e=Object.create(null);if(t)for(var n in t)e[n]=new lt(t[n]);return e}K.next.get=function(){return this.tokens[this.pos]},H.prototype.eat=function(t){return this.next==t&&(this.pos++||!0)},H.prototype.err=function(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")},Object.defineProperties(H.prototype,K);var ht=function(t,e,n){this.name=t,this.schema=e,this.spec=n,this.groups=n.group?n.group.split(" "):[],this.attrs=ct(n.attrs),this.defaultAttrs=st(this.attrs),this.contentMatch=null,this.markSet=null,this.inlineContent=null,this.isBlock=!(n.inline||"text"==t),this.isText="text"==t},pt={isInline:{configurable:!0},isTextblock:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};pt.isInline.get=function(){return!this.isBlock},pt.isTextblock.get=function(){return this.isBlock&&this.inlineContent},pt.isLeaf.get=function(){return this.contentMatch==q.empty},pt.isAtom.get=function(){return this.isLeaf||this.spec.atom},ht.prototype.hasRequiredAttrs=function(){for(var t in this.attrs)if(this.attrs[t].isRequired)return!0;return!1},ht.prototype.compatibleContent=function(t){return this==t||this.contentMatch.compatible(t.contentMatch)},ht.prototype.computeAttrs=function(t){return!t&&this.defaultAttrs?this.defaultAttrs:at(this.attrs,t)},ht.prototype.create=function(t,e,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new j(this,this.computeAttrs(t),l.from(e),v.setFrom(n))},ht.prototype.createChecked=function(t,e,n){if(e=l.from(e),!this.validContent(e))throw new RangeError("Invalid content for node "+this.name);return new j(this,this.computeAttrs(t),e,v.setFrom(n))},ht.prototype.createAndFill=function(t,e,n){if(t=this.computeAttrs(t),e=l.from(e),e.size){var r=this.contentMatch.fillBefore(e);if(!r)return null;e=r.append(e)}var o=this.contentMatch.matchFragment(e).fillBefore(l.empty,!0);return o?new j(this,t,e.append(o),v.setFrom(n)):null},ht.prototype.validContent=function(t){var e=this.contentMatch.matchFragment(t);if(!e||!e.validEnd)return!1;for(var n=0;n<t.childCount;n++)if(!this.allowsMarks(t.child(n).marks))return!1;return!0},ht.prototype.allowsMarkType=function(t){return null==this.markSet||this.markSet.indexOf(t)>-1},ht.prototype.allowsMarks=function(t){if(null==this.markSet)return!0;for(var e=0;e<t.length;e++)if(!this.allowsMarkType(t[e].type))return!1;return!0},ht.prototype.allowedMarks=function(t){if(null==this.markSet)return t;for(var e,n=0;n<t.length;n++)this.allowsMarkType(t[n].type)?e&&e.push(t[n]):e||(e=t.slice(0,n));return e?e.length?e:v.empty:t},ht.compile=function(t,e){var n=Object.create(null);t.forEach((function(t,r){return n[t]=new ht(t,e,r)}));var r=e.spec.topNode||"doc";if(!n[r])throw new RangeError("Schema is missing its top node type ('"+r+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(var o in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n},Object.defineProperties(ht.prototype,pt);var lt=function(t){this.hasDefault=Object.prototype.hasOwnProperty.call(t,"default"),this.default=t.default},ut={isRequired:{configurable:!0}};ut.isRequired.get=function(){return!this.hasDefault},Object.defineProperties(lt.prototype,ut);var ft=function(t,e,n,r){this.name=t,this.schema=n,this.spec=r,this.attrs=ct(r.attrs),this.rank=e,this.excluded=null;var o=st(this.attrs);this.instance=o&&new v(this,o)};ft.prototype.create=function(t){return!t&&this.instance?this.instance:new v(this,at(this.attrs,t))},ft.compile=function(t,e){var n=Object.create(null),r=0;return t.forEach((function(t,o){return n[t]=new ft(t,r++,e,o)})),n},ft.prototype.removeFromSet=function(t){for(var e=0;e<t.length;e++)if(t[e].type==this)return t.slice(0,e).concat(t.slice(e+1));return t},ft.prototype.isInSet=function(t){for(var e=0;e<t.length;e++)if(t[e].type==this)return t[e]},ft.prototype.excludes=function(t){return this.excluded.indexOf(t)>-1};var dt=function(t){for(var e in this.spec={},t)this.spec[e]=t[e];this.spec.nodes=c.from(t.nodes),this.spec.marks=c.from(t.marks),this.nodes=ht.compile(this.spec.nodes,this),this.marks=ft.compile(this.spec.marks,this);var n=Object.create(null);for(var r in this.nodes){if(r in this.marks)throw new RangeError(r+" can not be both a node and a mark");var o=this.nodes[r],i=o.spec.content||"",s=o.spec.marks;o.contentMatch=n[i]||(n[i]=q.parse(i,this.nodes)),o.inlineContent=o.contentMatch.inlineContent,o.markSet="_"==s?null:s?mt(this,s.split(" ")):""!=s&&o.inlineContent?null:[]}for(var a in this.marks){var h=this.marks[a],p=h.spec.excludes;h.excluded=null==p?[h]:""==p?[]:mt(this,p.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached=Object.create(null),this.cached.wrappings=Object.create(null)};function mt(t,e){for(var n=[],r=0;r<e.length;r++){var o=e[r],i=t.marks[o],s=i;if(i)n.push(i);else for(var a in t.marks){var c=t.marks[a];("_"==o||c.spec.group&&c.spec.group.split(" ").indexOf(o)>-1)&&n.push(s=c)}if(!s)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return n}dt.prototype.node=function(t,e,n,r){if("string"==typeof t)t=this.nodeType(t);else{if(!(t instanceof ht))throw new RangeError("Invalid node type: "+t);if(t.schema!=this)throw new RangeError("Node type from different schema used ("+t.name+")")}return t.createChecked(e,n,r)},dt.prototype.text=function(t,e){var n=this.nodes.text;return new L(n,n.defaultAttrs,t,v.setFrom(e))},dt.prototype.mark=function(t,e){return"string"==typeof t&&(t=this.marks[t]),t.create(e)},dt.prototype.nodeFromJSON=function(t){return j.fromJSON(this,t)},dt.prototype.markFromJSON=function(t){return v.fromJSON(this,t)},dt.prototype.nodeType=function(t){var e=this.nodes[t];if(!e)throw new RangeError("Unknown node type: "+t);return e};var vt=function(t,e){var n=this;this.schema=t,this.rules=e,this.tags=[],this.styles=[],e.forEach((function(t){t.tag?n.tags.push(t):t.style&&n.styles.push(t)})),this.normalizeLists=!this.tags.some((function(e){if(!/^(ul|ol)\b/.test(e.tag)||!e.node)return!1;var n=t.nodes[e.node];return n.contentMatch.matchType(n)}))};vt.prototype.parse=function(t,e){void 0===e&&(e={});var n=new Ct(this,e,!1);return n.addAll(t,null,e.from,e.to),n.finish()},vt.prototype.parseSlice=function(t,e){void 0===e&&(e={});var n=new Ct(this,e,!0);return n.addAll(t,null,e.from,e.to),y.maxOpen(n.finish())},vt.prototype.matchTag=function(t,e){for(var n=0;n<this.tags.length;n++){var r=this.tags[n];if(Tt(t,r.tag)&&(void 0===r.namespace||t.namespaceURI==r.namespace)&&(!r.context||e.matchesContext(r.context))){if(r.getAttrs){var o=r.getAttrs(t);if(!1===o)continue;r.attrs=o}return r}}},vt.prototype.matchStyle=function(t,e,n){for(var r=0;r<this.styles.length;r++){var o=this.styles[r];if(!(0!=o.style.indexOf(t)||o.context&&!n.matchesContext(o.context)||o.style.length>t.length&&(61!=o.style.charCodeAt(t.length)||o.style.slice(t.length+1)!=e))){if(o.getAttrs){var i=o.getAttrs(e);if(!1===i)continue;o.attrs=i}return o}}},vt.schemaRules=function(t){var e=[];function n(t){for(var n=null==t.priority?50:t.priority,r=0;r<e.length;r++){var o=e[r],i=null==o.priority?50:o.priority;if(i<n)break}e.splice(r,0,t)}var r=function(e){var r=t.marks[e].spec.parseDOM;r&&r.forEach((function(t){n(t=At(t)),t.mark=e}))};for(var o in t.marks)r(o);var i=function(e){var r=t.nodes[s].spec.parseDOM;r&&r.forEach((function(t){n(t=At(t)),t.node=s}))};for(var s in t.nodes)i();return e},vt.fromSchema=function(t){return t.cached.domParser||(t.cached.domParser=new vt(t,vt.schemaRules(t)))};var gt={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},yt={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},wt={ol:!0,ul:!0},xt=1,bt=2,kt=4;function St(t){return(t?xt:0)|("full"===t?bt:0)}var Ot=function(t,e,n,r,o,i,s){this.type=t,this.attrs=e,this.solid=o,this.match=i||(s&kt?null:t.contentMatch),this.options=s,this.content=[],this.marks=n,this.activeMarks=v.none,this.pendingMarks=r};Ot.prototype.findWrapping=function(t){if(!this.match){if(!this.type)return[];var e=this.type.contentMatch.fillBefore(l.from(t));if(!e){var n,r=this.type.contentMatch;return(n=r.findWrapping(t.type))?(this.match=r,n):null}this.match=this.type.contentMatch.matchFragment(e)}return this.match.findWrapping(t.type)},Ot.prototype.finish=function(t){if(!(this.options&xt)){var e,n=this.content[this.content.length-1];n&&n.isText&&(e=/[ \t\r\n\u000c]+$/.exec(n.text))&&(n.text.length==e[0].length?this.content.pop():this.content[this.content.length-1]=n.withText(n.text.slice(0,n.text.length-e[0].length)))}var r=l.from(this.content);return!t&&this.match&&(r=r.append(this.match.fillBefore(l.empty,!0))),this.type?this.type.create(this.attrs,r,this.marks):r},Ot.prototype.applyPending=function(t){for(var e=0,n=this.pendingMarks;e<n.length;e++){var r=n[e];(this.type?this.type.allowsMarkType(r.type):Dt(r.type,t))&&!r.isInSet(this.activeMarks)&&(this.activeMarks=r.addToSet(this.activeMarks),this.pendingMarks=r.removeFromSet(this.pendingMarks))}};var Ct=function(t,e,n){this.parser=t,this.options=e,this.isOpen=n;var r,o=e.topNode,i=St(e.preserveWhitespace)|(n?kt:0);r=o?new Ot(o.type,o.attrs,v.none,v.none,!0,e.topMatch||o.type.contentMatch,i):new Ot(n?null:t.schema.topNodeType,null,v.none,v.none,!0,null,i),this.nodes=[r],this.open=0,this.find=e.findPositions,this.needsBlock=!1},Mt={top:{configurable:!0},currentPos:{configurable:!0}};function Nt(t){for(var e=t.firstChild,n=null;e;e=e.nextSibling){var r=1==e.nodeType?e.nodeName.toLowerCase():null;r&&wt.hasOwnProperty(r)&&n?(n.appendChild(e),e=n):"li"==r?n=e:r&&(n=null)}}function Tt(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function Et(t){var e,n=/\s*([\w-]+)\s*:\s*([^;]+)/g,r=[];while(e=n.exec(t))r.push(e[1],e[2].trim());return r}function At(t){var e={};for(var n in t)e[n]=t[n];return e}function Dt(t,e){var n=e.schema.nodes,r=function(r){var o=n[r];if(o.allowsMarkType(t)){var i=[],s=function(t){i.push(t);for(var n=0;n<t.edgeCount;n++){var r=t.edge(n),o=r.type,a=r.next;if(o==e)return!0;if(i.indexOf(a)<0&&s(a))return!0}};return s(o.contentMatch)?{v:!0}:void 0}};for(var o in n){var i=r(o);if(i)return i.v}}Mt.top.get=function(){return this.nodes[this.open]},Ct.prototype.addDOM=function(t){if(3==t.nodeType)this.addTextNode(t);else if(1==t.nodeType){var e=t.getAttribute("style"),n=e?this.readStyles(Et(e)):null,r=this.top;if(null!=n)for(var o=0;o<n.length;o++)this.addPendingMark(n[o]);if(this.addElement(t),null!=n)for(var i=0;i<n.length;i++)this.removePendingMark(n[i],r)}},Ct.prototype.addTextNode=function(t){var e=t.nodeValue,n=this.top;if((n.type?n.type.inlineContent:n.content.length&&n.content[0].isInline)||/[^ \t\r\n\u000c]/.test(e)){if(n.options&xt)n.options&bt||(e=e.replace(/\r?\n|\r/g," "));else if(e=e.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(e)&&this.open==this.nodes.length-1){var r=n.content[n.content.length-1],o=t.previousSibling;(!r||o&&"BR"==o.nodeName||r.isText&&/[ \t\r\n\u000c]$/.test(r.text))&&(e=e.slice(1))}e&&this.insertNode(this.parser.schema.text(e)),this.findInText(t)}else this.findInside(t)},Ct.prototype.addElement=function(t){var e=t.nodeName.toLowerCase();wt.hasOwnProperty(e)&&this.normalizeLists&&Nt(t);var n=this.options.ruleFromNode&&this.options.ruleFromNode(t)||this.parser.matchTag(t,this);if(n?n.ignore:yt.hasOwnProperty(e))this.findInside(t);else if(!n||n.skip||n.closeParent){n&&n.closeParent?this.open=Math.max(0,this.open-1):n&&n.skip.nodeType&&(t=n.skip);var r,o=this.top,i=this.needsBlock;if(gt.hasOwnProperty(e))r=!0,o.type||(this.needsBlock=!0);else if(!t.firstChild)return void this.leafFallback(t);this.addAll(t),r&&this.sync(o),this.needsBlock=i}else this.addElementByRule(t,n)},Ct.prototype.leafFallback=function(t){"BR"==t.nodeName&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(t.ownerDocument.createTextNode("\n"))},Ct.prototype.readStyles=function(t){for(var e=v.none,n=0;n<t.length;n+=2){var r=this.parser.matchStyle(t[n],t[n+1],this);if(r){if(r.ignore)return null;e=this.parser.schema.marks[r.mark].create(r.attrs).addToSet(e)}}return e},Ct.prototype.addElementByRule=function(t,e){var n,r,o,i,s=this;e.node?(r=this.parser.schema.nodes[e.node],r.isLeaf?this.insertNode(r.create(e.attrs))||this.leafFallback(t):n=this.enter(r,e.attrs,e.preserveWhitespace)):(o=this.parser.schema.marks[e.mark],i=o.create(e.attrs),this.addPendingMark(i));var a=this.top;if(r&&r.isLeaf)this.findInside(t);else if(e.getContent)this.findInside(t),e.getContent(t,this.parser.schema).forEach((function(t){return s.insertNode(t)}));else{var c=e.contentElement;"string"==typeof c?c=t.querySelector(c):"function"==typeof c&&(c=c(t)),c||(c=t),this.findAround(t,c,!0),this.addAll(c,n)}n&&(this.sync(a),this.open--),i&&this.removePendingMark(i,a)},Ct.prototype.addAll=function(t,e,n,r){for(var o=n||0,i=n?t.childNodes[n]:t.firstChild,s=null==r?null:t.childNodes[r];i!=s;i=i.nextSibling,++o)this.findAtPoint(t,o),this.addDOM(i),e&&gt.hasOwnProperty(i.nodeName.toLowerCase())&&this.sync(e);this.findAtPoint(t,o)},Ct.prototype.findPlace=function(t){for(var e,n,r=this.open;r>=0;r--){var o=this.nodes[r],i=o.findWrapping(t);if(i&&(!e||e.length>i.length)&&(e=i,n=o,!i.length))break;if(o.solid)break}if(!e)return!1;this.sync(n);for(var s=0;s<e.length;s++)this.enterInner(e[s],null,!1);return!0},Ct.prototype.insertNode=function(t){if(t.isInline&&this.needsBlock&&!this.top.type){var e=this.textblockFromContext();e&&this.enterInner(e)}if(this.findPlace(t)){this.closeExtra();var n=this.top;n.applyPending(t.type),n.match&&(n.match=n.match.matchType(t.type));for(var r=n.activeMarks,o=0;o<t.marks.length;o++)n.type&&!n.type.allowsMarkType(t.marks[o].type)||(r=t.marks[o].addToSet(r));return n.content.push(t.mark(r)),!0}return!1},Ct.prototype.enter=function(t,e,n){var r=this.findPlace(t.create(e));return r&&this.enterInner(t,e,!0,n),r},Ct.prototype.enterInner=function(t,e,n,r){this.closeExtra();var o=this.top;o.applyPending(t),o.match=o.match&&o.match.matchType(t,e);var i=null==r?o.options&~kt:St(r);o.options&kt&&0==o.content.length&&(i|=kt),this.nodes.push(new Ot(t,e,o.activeMarks,o.pendingMarks,n,null,i)),this.open++},Ct.prototype.closeExtra=function(t){var e=this.nodes.length-1;if(e>this.open){for(;e>this.open;e--)this.nodes[e-1].content.push(this.nodes[e].finish(t));this.nodes.length=this.open+1}},Ct.prototype.finish=function(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)},Ct.prototype.sync=function(t){for(var e=this.open;e>=0;e--)if(this.nodes[e]==t)return void(this.open=e)},Mt.currentPos.get=function(){this.closeExtra();for(var t=0,e=this.open;e>=0;e--){for(var n=this.nodes[e].content,r=n.length-1;r>=0;r--)t+=n[r].nodeSize;e&&t++}return t},Ct.prototype.findAtPoint=function(t,e){if(this.find)for(var n=0;n<this.find.length;n++)this.find[n].node==t&&this.find[n].offset==e&&(this.find[n].pos=this.currentPos)},Ct.prototype.findInside=function(t){if(this.find)for(var e=0;e<this.find.length;e++)null==this.find[e].pos&&1==t.nodeType&&t.contains(this.find[e].node)&&(this.find[e].pos=this.currentPos)},Ct.prototype.findAround=function(t,e,n){if(t!=e&&this.find)for(var r=0;r<this.find.length;r++)if(null==this.find[r].pos&&1==t.nodeType&&t.contains(this.find[r].node)){var o=e.compareDocumentPosition(this.find[r].node);o&(n?2:4)&&(this.find[r].pos=this.currentPos)}},Ct.prototype.findInText=function(t){if(this.find)for(var e=0;e<this.find.length;e++)this.find[e].node==t&&(this.find[e].pos=this.currentPos-(t.nodeValue.length-this.find[e].offset))},Ct.prototype.matchesContext=function(t){var e=this;if(t.indexOf("|")>-1)return t.split(/\s*\|\s*/).some(this.matchesContext,this);var n=t.split("/"),r=this.options.context,o=!this.isOpen&&(!r||r.parent.type==this.nodes[0].type),i=-(r?r.depth+1:0)+(o?0:1),s=function(t,a){for(;t>=0;t--){var c=n[t];if(""==c){if(t==n.length-1||0==t)continue;for(;a>=i;a--)if(s(t-1,a))return!0;return!1}var h=a>0||0==a&&o?e.nodes[a].type:r&&a>=i?r.node(a-i).type:null;if(!h||h.name!=c&&-1==h.groups.indexOf(c))return!1;a--}return!0};return s(n.length-1,this.open)},Ct.prototype.textblockFromContext=function(){var t=this.options.context;if(t)for(var e=t.depth;e>=0;e--){var n=t.node(e).contentMatchAt(t.indexAfter(e)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(var r in this.parser.schema.nodes){var o=this.parser.schema.nodes[r];if(o.isTextblock&&o.defaultAttrs)return o}},Ct.prototype.addPendingMark=function(t){this.top.pendingMarks=t.addToSet(this.top.pendingMarks)},Ct.prototype.removePendingMark=function(t,e){for(var n=this.open;n>=0;n--){var r=this.nodes[n],o=r.pendingMarks.lastIndexOf(t);if(o>-1?r.pendingMarks=t.removeFromSet(r.pendingMarks):r.activeMarks=t.removeFromSet(r.activeMarks),r==e)break}},Object.defineProperties(Ct.prototype,Mt);var Rt=function(t,e){this.nodes=t||{},this.marks=e||{}};function zt(t){var e={};for(var n in t){var r=t[n].spec.toDOM;r&&(e[n]=r)}return e}function It(t){return t.document||window.document}function Pt(t,e,n){for(var r=0;;r++){if(r==t.childCount||r==e.childCount)return t.childCount==e.childCount?null:n;var o=t.child(r),i=e.child(r);if(o!=i){if(!o.sameMarkup(i))return n;if(o.isText&&o.text!=i.text){for(var s=0;o.text[s]==i.text[s];s++)n++;return n}if(o.content.size||i.content.size){var a=Pt(o.content,i.content,n+1);if(null!=a)return a}n+=o.nodeSize}else n+=o.nodeSize}}function Ft(t,e,n,r){for(var o=t.childCount,i=e.childCount;;){if(0==o||0==i)return o==i?null:{a:n,b:r};var s=t.child(--o),a=e.child(--i),c=s.nodeSize;if(s!=a){if(!s.sameMarkup(a))return{a:n,b:r};if(s.isText&&s.text!=a.text){var h=0,p=Math.min(s.text.length,a.text.length);while(h<p&&s.text[s.text.length-h-1]==a.text[a.text.length-h-1])h++,n--,r--;return{a:n,b:r}}if(s.content.size||a.content.size){var l=Ft(s.content,a.content,n-1,r-1);if(l)return l}n-=c,r-=c}else n-=c,r-=c}}Rt.prototype.serializeFragment=function(t,e,n){var r=this;void 0===e&&(e={}),n||(n=It(e).createDocumentFragment());var o=n,i=null;return t.forEach((function(t){if(i||t.marks.length){i||(i=[]);var n=0,s=0;while(n<i.length&&s<t.marks.length){var a=t.marks[s];if(r.marks[a.type.name]){if(!a.eq(i[n])||!1===a.type.spec.spanning)break;n+=2,s++}else s++}while(n<i.length)o=i.pop(),i.pop();while(s<t.marks.length){var c=t.marks[s++],h=r.serializeMark(c,t.isInline,e);h&&(i.push(c,o),o.appendChild(h.dom),o=h.contentDOM||h.dom)}}o.appendChild(r.serializeNode(t,e))})),n},Rt.prototype.serializeNode=function(t,e){void 0===e&&(e={});var n=Rt.renderSpec(It(e),this.nodes[t.type.name](t)),r=n.dom,o=n.contentDOM;if(o){if(t.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");e.onContent?e.onContent(t,o,e):this.serializeFragment(t.content,e,o)}return r},Rt.prototype.serializeNodeAndMarks=function(t,e){void 0===e&&(e={});for(var n=this.serializeNode(t,e),r=t.marks.length-1;r>=0;r--){var o=this.serializeMark(t.marks[r],t.isInline,e);o&&((o.contentDOM||o.dom).appendChild(n),n=o.dom)}return n},Rt.prototype.serializeMark=function(t,e,n){void 0===n&&(n={});var r=this.marks[t.type.name];return r&&Rt.renderSpec(It(n),r(t,e))},Rt.renderSpec=function(t,e,n){if(void 0===n&&(n=null),"string"==typeof e)return{dom:t.createTextNode(e)};if(null!=e.nodeType)return{dom:e};var r=e[0],o=r.indexOf(" ");o>0&&(n=r.slice(0,o),r=r.slice(o+1));var i=null,s=n?t.createElementNS(n,r):t.createElement(r),a=e[1],c=1;if(a&&"object"==typeof a&&null==a.nodeType&&!Array.isArray(a))for(var h in c=2,a)if(null!=a[h]){var p=h.indexOf(" ");p>0?s.setAttributeNS(h.slice(0,p),h.slice(p+1),a[h]):s.setAttribute(h,a[h])}for(var l=c;l<e.length;l++){var u=e[l];if(0===u){if(l<e.length-1||l>c)throw new RangeError("Content hole must be the only child of its parent node");return{dom:s,contentDOM:s}}var f=Rt.renderSpec(t,u,n),d=f.dom,m=f.contentDOM;if(s.appendChild(d),m){if(i)throw new RangeError("Multiple content holes");i=m}}return{dom:s,contentDOM:i}},Rt.fromSchema=function(t){return t.cached.domSerializer||(t.cached.domSerializer=new Rt(this.nodesFromSchema(t),this.marksFromSchema(t)))},Rt.nodesFromSchema=function(t){var e=zt(t.nodes);return e.text||(e.text=function(t){return t.text}),e},Rt.marksFromSchema=function(t){return zt(t.marks)};var Bt=function(t,e){if(this.content=t,this.size=e||0,null==e)for(var n=0;n<t.length;n++)this.size+=t[n].nodeSize},$t={firstChild:{configurable:!0},lastChild:{configurable:!0},childCount:{configurable:!0}};Bt.prototype.nodesBetween=function(t,e,n,r,o){void 0===r&&(r=0);for(var i=0,s=0;s<e;i++){var a=this.content[i],c=s+a.nodeSize;if(c>t&&!1!==n(a,r+s,o,i)&&a.content.size){var h=s+1;a.nodesBetween(Math.max(0,t-h),Math.min(a.content.size,e-h),n,r+h)}s=c}},Bt.prototype.descendants=function(t){this.nodesBetween(0,this.size,t)},Bt.prototype.textBetween=function(t,e,n,r){var o="",i=!0;return this.nodesBetween(t,e,(function(s,a){s.isText?(o+=s.text.slice(Math.max(t,a)-a,e-a),i=!n):s.isLeaf&&r?(o+=r,i=!n):!i&&s.isBlock&&(o+=n,i=!0)}),0),o},Bt.prototype.append=function(t){if(!t.size)return this;if(!this.size)return t;var e=this.lastChild,n=t.firstChild,r=this.content.slice(),o=0;for(e.isText&&e.sameMarkup(n)&&(r[r.length-1]=e.withText(e.text+n.text),o=1);o<t.content.length;o++)r.push(t.content[o]);return new Bt(r,this.size+t.size)},Bt.prototype.cut=function(t,e){if(null==e&&(e=this.size),0==t&&e==this.size)return this;var n=[],r=0;if(e>t)for(var o=0,i=0;i<e;o++){var s=this.content[o],a=i+s.nodeSize;a>t&&((i<t||a>e)&&(s=s.isText?s.cut(Math.max(0,t-i),Math.min(s.text.length,e-i)):s.cut(Math.max(0,t-i-1),Math.min(s.content.size,e-i-1))),n.push(s),r+=s.nodeSize),i=a}return new Bt(n,r)},Bt.prototype.cutByIndex=function(t,e){return t==e?Bt.empty:0==t&&e==this.content.length?this:new Bt(this.content.slice(t,e))},Bt.prototype.replaceChild=function(t,e){var n=this.content[t];if(n==e)return this;var r=this.content.slice(),o=this.size+e.nodeSize-n.nodeSize;return r[t]=e,new Bt(r,o)},Bt.prototype.addToStart=function(t){return new Bt([t].concat(this.content),this.size+t.nodeSize)},Bt.prototype.addToEnd=function(t){return new Bt(this.content.concat(t),this.size+t.nodeSize)},Bt.prototype.eq=function(t){if(this.content.length!=t.content.length)return!1;for(var e=0;e<this.content.length;e++)if(!this.content[e].eq(t.content[e]))return!1;return!0},$t.firstChild.get=function(){return this.content.length?this.content[0]:null},$t.lastChild.get=function(){return this.content.length?this.content[this.content.length-1]:null},$t.childCount.get=function(){return this.content.length},Bt.prototype.child=function(t){var e=this.content[t];if(!e)throw new RangeError("Index "+t+" out of range for "+this);return e},Bt.prototype.maybeChild=function(t){return this.content[t]},Bt.prototype.forEach=function(t){for(var e=0,n=0;e<this.content.length;e++){var r=this.content[e];t(r,n,e),n+=r.nodeSize}},Bt.prototype.findDiffStart=function(t,e){return void 0===e&&(e=0),Pt(this,t,e)},Bt.prototype.findDiffEnd=function(t,e,n){return void 0===e&&(e=this.size),void 0===n&&(n=t.size),Ft(this,t,e,n)},Bt.prototype.findIndex=function(t,e){if(void 0===e&&(e=-1),0==t)return jt(0,t);if(t==this.size)return jt(this.content.length,t);if(t>this.size||t<0)throw new RangeError("Position "+t+" outside of fragment ("+this+")");for(var n=0,r=0;;n++){var o=this.child(n),i=r+o.nodeSize;if(i>=t)return i==t||e>0?jt(n+1,i):jt(n,r);r=i}},Bt.prototype.toString=function(){return"<"+this.toStringInner()+">"},Bt.prototype.toStringInner=function(){return this.content.join(", ")},Bt.prototype.toJSON=function(){return this.content.length?this.content.map((function(t){return t.toJSON()})):null},Bt.fromJSON=function(t,e){if(!e)return Bt.empty;if(!Array.isArray(e))throw new RangeError("Invalid input for Fragment.fromJSON");return new Bt(e.map(t.nodeFromJSON))},Bt.fromArray=function(t){if(!t.length)return Bt.empty;for(var e,n=0,r=0;r<t.length;r++){var o=t[r];n+=o.nodeSize,r&&o.isText&&t[r-1].sameMarkup(o)?(e||(e=t.slice(0,r)),e[e.length-1]=o.withText(e[e.length-1].text+o.text)):e&&e.push(o)}return new Bt(e||t,n)},Bt.from=function(t){if(!t)return Bt.empty;if(t instanceof Bt)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new Bt([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))},Object.defineProperties(Bt.prototype,$t);var _t={index:0,offset:0};function jt(t,e){return _t.index=t,_t.offset=e,_t}function Jt(t,e){if(t===e)return!0;if(!t||"object"!=typeof t||!e||"object"!=typeof e)return!1;var n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(var r=0;r<t.length;r++)if(!Jt(t[r],e[r]))return!1}else{for(var o in t)if(!(o in e)||!Jt(t[o],e[o]))return!1;for(var i in e)if(!(i in t))return!1}return!0}Bt.empty=new Bt([],0);var Lt=function(t,e){this.type=t,this.attrs=e};function Vt(t){var e=Error.call(this,t);return e.__proto__=Vt.prototype,e}Lt.prototype.addToSet=function(t){for(var e,n=!1,r=0;r<t.length;r++){var o=t[r];if(this.eq(o))return t;if(this.type.excludes(o.type))e||(e=t.slice(0,r));else{if(o.type.excludes(this.type))return t;!n&&o.type.rank>this.type.rank&&(e||(e=t.slice(0,r)),e.push(this),n=!0),e&&e.push(o)}}return e||(e=t.slice()),n||e.push(this),e},Lt.prototype.removeFromSet=function(t){for(var e=0;e<t.length;e++)if(this.eq(t[e]))return t.slice(0,e).concat(t.slice(e+1));return t},Lt.prototype.isInSet=function(t){for(var e=0;e<t.length;e++)if(this.eq(t[e]))return!0;return!1},Lt.prototype.eq=function(t){return this==t||this.type==t.type&&Jt(this.attrs,t.attrs)},Lt.prototype.toJSON=function(){var t={type:this.type.name};for(var e in this.attrs){t.attrs=this.attrs;break}return t},Lt.fromJSON=function(t,e){if(!e)throw new RangeError("Invalid input for Mark.fromJSON");var n=t.marks[e.type];if(!n)throw new RangeError("There is no mark type "+e.type+" in this schema");return n.create(e.attrs)},Lt.sameSet=function(t,e){if(t==e)return!0;if(t.length!=e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].eq(e[n]))return!1;return!0},Lt.setFrom=function(t){if(!t||0==t.length)return Lt.none;if(t instanceof Lt)return[t];var e=t.slice();return e.sort((function(t,e){return t.type.rank-e.type.rank})),e},Lt.none=[],Vt.prototype=Object.create(Error.prototype),Vt.prototype.constructor=Vt,Vt.prototype.name="ReplaceError";var qt=function(t,e,n){this.content=t,this.openStart=e,this.openEnd=n},Wt={size:{configurable:!0}};function Ht(t,e,n){var r=t.findIndex(e),o=r.index,i=r.offset,s=t.maybeChild(o),a=t.findIndex(n),c=a.index,h=a.offset;if(i==e||s.isText){if(h!=n&&!t.child(c).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(o!=c)throw new RangeError("Removing non-flat range");return t.replaceChild(o,s.copy(Ht(s.content,e-i-1,n-i-1)))}function Kt(t,e,n,r){var o=t.findIndex(e),i=o.index,s=o.offset,a=t.maybeChild(i);if(s==e||a.isText)return r&&!r.canReplace(i,i,n)?null:t.cut(0,e).append(n).append(t.cut(e));var c=Kt(a.content,e-s-1,n);return c&&t.replaceChild(i,a.copy(c))}function Ut(t,e,n){if(n.openStart>t.depth)throw new Vt("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new Vt("Inconsistent open depths");return Gt(t,e,n,0)}function Gt(t,e,n,r){var o=t.index(r),i=t.node(r);if(o==e.index(r)&&r<t.depth-n.openStart){var s=Gt(t,e,n,r+1);return i.copy(i.content.replaceChild(o,s))}if(n.content.size){if(n.openStart||n.openEnd||t.depth!=r||e.depth!=r){var a=re(n,t),c=a.start,h=a.end;return te(i,ee(t,c,h,e,r))}var p=t.parent,l=p.content;return te(p,l.cut(0,t.parentOffset).append(n.content).append(l.cut(e.parentOffset)))}return te(i,ne(t,e,r))}function Xt(t,e){if(!e.type.compatibleContent(t.type))throw new Vt("Cannot join "+e.type.name+" onto "+t.type.name)}function Yt(t,e,n){var r=t.node(n);return Xt(r,e.node(n)),r}function Zt(t,e){var n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function Qt(t,e,n,r){var o=(e||t).node(n),i=0,s=e?e.index(n):o.childCount;t&&(i=t.index(n),t.depth>n?i++:t.textOffset&&(Zt(t.nodeAfter,r),i++));for(var a=i;a<s;a++)Zt(o.child(a),r);e&&e.depth==n&&e.textOffset&&Zt(e.nodeBefore,r)}function te(t,e){if(!t.type.validContent(e))throw new Vt("Invalid content for node "+t.type.name);return t.copy(e)}function ee(t,e,n,r,o){var i=t.depth>o&&Yt(t,e,o+1),s=r.depth>o&&Yt(n,r,o+1),a=[];return Qt(null,t,o,a),i&&s&&e.index(o)==n.index(o)?(Xt(i,s),Zt(te(i,ee(t,e,n,r,o+1)),a)):(i&&Zt(te(i,ne(t,e,o+1)),a),Qt(e,n,o,a),s&&Zt(te(s,ne(n,r,o+1)),a)),Qt(r,null,o,a),new Bt(a)}function ne(t,e,n){var r=[];if(Qt(null,t,n,r),t.depth>n){var o=Yt(t,e,n+1);Zt(te(o,ne(t,e,n+1)),r)}return Qt(e,null,n,r),new Bt(r)}function re(t,e){for(var n=e.depth-t.openStart,r=e.node(n),o=r.copy(t.content),i=n-1;i>=0;i--)o=e.node(i).copy(Bt.from(o));return{start:o.resolveNoCache(t.openStart+n),end:o.resolveNoCache(o.content.size-t.openEnd-n)}}Wt.size.get=function(){return this.content.size-this.openStart-this.openEnd},qt.prototype.insertAt=function(t,e){var n=Kt(this.content,t+this.openStart,e,null);return n&&new qt(n,this.openStart,this.openEnd)},qt.prototype.removeBetween=function(t,e){return new qt(Ht(this.content,t+this.openStart,e+this.openStart),this.openStart,this.openEnd)},qt.prototype.eq=function(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd},qt.prototype.toString=function(){return this.content+"("+this.openStart+","+this.openEnd+")"},qt.prototype.toJSON=function(){if(!this.content.size)return null;var t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t},qt.fromJSON=function(t,e){if(!e)return qt.empty;var n=e.openStart||0,r=e.openEnd||0;if("number"!=typeof n||"number"!=typeof r)throw new RangeError("Invalid input for Slice.fromJSON");return new qt(Bt.fromJSON(t,e.content),e.openStart||0,e.openEnd||0)},qt.maxOpen=function(t,e){void 0===e&&(e=!0);for(var n=0,r=0,o=t.firstChild;o&&!o.isLeaf&&(e||!o.type.spec.isolating);o=o.firstChild)n++;for(var i=t.lastChild;i&&!i.isLeaf&&(e||!i.type.spec.isolating);i=i.lastChild)r++;return new qt(t,n,r)},Object.defineProperties(qt.prototype,Wt),qt.empty=new qt(Bt.empty,0,0);var oe=function(t,e,n){this.pos=t,this.path=e,this.depth=e.length/3-1,this.parentOffset=n},ie={parent:{configurable:!0},doc:{configurable:!0},textOffset:{configurable:!0},nodeAfter:{configurable:!0},nodeBefore:{configurable:!0}};oe.prototype.resolveDepth=function(t){return null==t?this.depth:t<0?this.depth+t:t},ie.parent.get=function(){return this.node(this.depth)},ie.doc.get=function(){return this.node(0)},oe.prototype.node=function(t){return this.path[3*this.resolveDepth(t)]},oe.prototype.index=function(t){return this.path[3*this.resolveDepth(t)+1]},oe.prototype.indexAfter=function(t){return t=this.resolveDepth(t),this.index(t)+(t!=this.depth||this.textOffset?1:0)},oe.prototype.start=function(t){return t=this.resolveDepth(t),0==t?0:this.path[3*t-1]+1},oe.prototype.end=function(t){return t=this.resolveDepth(t),this.start(t)+this.node(t).content.size},oe.prototype.before=function(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position before the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]},oe.prototype.after=function(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position after the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]+this.path[3*t].nodeSize},ie.textOffset.get=function(){return this.pos-this.path[this.path.length-1]},ie.nodeAfter.get=function(){var t=this.parent,e=this.index(this.depth);if(e==t.childCount)return null;var n=this.pos-this.path[this.path.length-1],r=t.child(e);return n?t.child(e).cut(n):r},ie.nodeBefore.get=function(){var t=this.index(this.depth),e=this.pos-this.path[this.path.length-1];return e?this.parent.child(t).cut(0,e):0==t?null:this.parent.child(t-1)},oe.prototype.marks=function(){var t=this.parent,e=this.index();if(0==t.content.size)return Lt.none;if(this.textOffset)return t.child(e).marks;var n=t.maybeChild(e-1),r=t.maybeChild(e);if(!n){var o=n;n=r,r=o}for(var i=n.marks,s=0;s<i.length;s++)!1!==i[s].type.spec.inclusive||r&&i[s].isInSet(r.marks)||(i=i[s--].removeFromSet(i));return i},oe.prototype.marksAcross=function(t){var e=this.parent.maybeChild(this.index());if(!e||!e.isInline)return null;for(var n=e.marks,r=t.parent.maybeChild(t.index()),o=0;o<n.length;o++)!1!==n[o].type.spec.inclusive||r&&n[o].isInSet(r.marks)||(n=n[o--].removeFromSet(n));return n},oe.prototype.sharedDepth=function(t){for(var e=this.depth;e>0;e--)if(this.start(e)<=t&&this.end(e)>=t)return e;return 0},oe.prototype.blockRange=function(t,e){if(void 0===t&&(t=this),t.pos<this.pos)return t.blockRange(this);for(var n=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);n>=0;n--)if(t.pos<=this.end(n)&&(!e||e(this.node(n))))return new he(this,t,n)},oe.prototype.sameParent=function(t){return this.pos-this.parentOffset==t.pos-t.parentOffset},oe.prototype.max=function(t){return t.pos>this.pos?t:this},oe.prototype.min=function(t){return t.pos<this.pos?t:this},oe.prototype.toString=function(){for(var t="",e=1;e<=this.depth;e++)t+=(t?"/":"")+this.node(e).type.name+"_"+this.index(e-1);return t+":"+this.parentOffset},oe.resolve=function(t,e){if(!(e>=0&&e<=t.content.size))throw new RangeError("Position "+e+" out of range");for(var n=[],r=0,o=e,i=t;;){var s=i.content.findIndex(o),a=s.index,c=s.offset,h=o-c;if(n.push(i,a,r+c),!h)break;if(i=i.child(a),i.isText)break;o=h-1,r+=c+1}return new oe(e,n,o)},oe.resolveCached=function(t,e){for(var n=0;n<se.length;n++){var r=se[n];if(r.pos==e&&r.doc==t)return r}var o=se[ae]=oe.resolve(t,e);return ae=(ae+1)%ce,o},Object.defineProperties(oe.prototype,ie);var se=[],ae=0,ce=12,he=function(t,e,n){this.$from=t,this.$to=e,this.depth=n},pe={start:{configurable:!0},end:{configurable:!0},parent:{configurable:!0},startIndex:{configurable:!0},endIndex:{configurable:!0}};pe.start.get=function(){return this.$from.before(this.depth+1)},pe.end.get=function(){return this.$to.after(this.depth+1)},pe.parent.get=function(){return this.$from.node(this.depth)},pe.startIndex.get=function(){return this.$from.index(this.depth)},pe.endIndex.get=function(){return this.$to.indexAfter(this.depth)},Object.defineProperties(he.prototype,pe);var le=Object.create(null),ue=function(t,e,n,r){this.type=t,this.attrs=e,this.content=n||Bt.empty,this.marks=r||Lt.none},fe={nodeSize:{configurable:!0},childCount:{configurable:!0},textContent:{configurable:!0},firstChild:{configurable:!0},lastChild:{configurable:!0},isBlock:{configurable:!0},isTextblock:{configurable:!0},inlineContent:{configurable:!0},isInline:{configurable:!0},isText:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};fe.nodeSize.get=function(){return this.isLeaf?1:2+this.content.size},fe.childCount.get=function(){return this.content.childCount},ue.prototype.child=function(t){return this.content.child(t)},ue.prototype.maybeChild=function(t){return this.content.maybeChild(t)},ue.prototype.forEach=function(t){this.content.forEach(t)},ue.prototype.nodesBetween=function(t,e,n,r){void 0===r&&(r=0),this.content.nodesBetween(t,e,n,r,this)},ue.prototype.descendants=function(t){this.nodesBetween(0,this.content.size,t)},fe.textContent.get=function(){return this.textBetween(0,this.content.size,"")},ue.prototype.textBetween=function(t,e,n,r){return this.content.textBetween(t,e,n,r)},fe.firstChild.get=function(){return this.content.firstChild},fe.lastChild.get=function(){return this.content.lastChild},ue.prototype.eq=function(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)},ue.prototype.sameMarkup=function(t){return this.hasMarkup(t.type,t.attrs,t.marks)},ue.prototype.hasMarkup=function(t,e,n){return this.type==t&&Jt(this.attrs,e||t.defaultAttrs||le)&&Lt.sameSet(this.marks,n||Lt.none)},ue.prototype.copy=function(t){return void 0===t&&(t=null),t==this.content?this:new this.constructor(this.type,this.attrs,t,this.marks)},ue.prototype.mark=function(t){return t==this.marks?this:new this.constructor(this.type,this.attrs,this.content,t)},ue.prototype.cut=function(t,e){return 0==t&&e==this.content.size?this:this.copy(this.content.cut(t,e))},ue.prototype.slice=function(t,e,n){if(void 0===e&&(e=this.content.size),void 0===n&&(n=!1),t==e)return qt.empty;var r=this.resolve(t),o=this.resolve(e),i=n?0:r.sharedDepth(e),s=r.start(i),a=r.node(i),c=a.content.cut(r.pos-s,o.pos-s);return new qt(c,r.depth-i,o.depth-i)},ue.prototype.replace=function(t,e,n){return Ut(this.resolve(t),this.resolve(e),n)},ue.prototype.nodeAt=function(t){for(var e=this;;){var n=e.content.findIndex(t),r=n.index,o=n.offset;if(e=e.maybeChild(r),!e)return null;if(o==t||e.isText)return e;t-=o+1}},ue.prototype.childAfter=function(t){var e=this.content.findIndex(t),n=e.index,r=e.offset;return{node:this.content.maybeChild(n),index:n,offset:r}},ue.prototype.childBefore=function(t){if(0==t)return{node:null,index:0,offset:0};var e=this.content.findIndex(t),n=e.index,r=e.offset;if(r<t)return{node:this.content.child(n),index:n,offset:r};var o=this.content.child(n-1);return{node:o,index:n-1,offset:r-o.nodeSize}},ue.prototype.resolve=function(t){return oe.resolveCached(this,t)},ue.prototype.resolveNoCache=function(t){return oe.resolve(this,t)},ue.prototype.rangeHasMark=function(t,e,n){var r=!1;return e>t&&this.nodesBetween(t,e,(function(t){return n.isInSet(t.marks)&&(r=!0),!r})),r},fe.isBlock.get=function(){return this.type.isBlock},fe.isTextblock.get=function(){return this.type.isTextblock},fe.inlineContent.get=function(){return this.type.inlineContent},fe.isInline.get=function(){return this.type.isInline},fe.isText.get=function(){return this.type.isText},fe.isLeaf.get=function(){return this.type.isLeaf},fe.isAtom.get=function(){return this.type.isAtom},ue.prototype.toString=function(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);var t=this.type.name;return this.content.size&&(t+="("+this.content.toStringInner()+")"),me(this.marks,t)},ue.prototype.contentMatchAt=function(t){var e=this.type.contentMatch.matchFragment(this.content,0,t);if(!e)throw new Error("Called contentMatchAt on a node with invalid content");return e},ue.prototype.canReplace=function(t,e,n,r,o){void 0===n&&(n=Bt.empty),void 0===r&&(r=0),void 0===o&&(o=n.childCount);var i=this.contentMatchAt(t).matchFragment(n,r,o),s=i&&i.matchFragment(this.content,e);if(!s||!s.validEnd)return!1;for(var a=r;a<o;a++)if(!this.type.allowsMarks(n.child(a).marks))return!1;return!0},ue.prototype.canReplaceWith=function(t,e,n,r){if(r&&!this.type.allowsMarks(r))return!1;var o=this.contentMatchAt(t).matchType(n),i=o&&o.matchFragment(this.content,e);return!!i&&i.validEnd},ue.prototype.canAppend=function(t){return t.content.size?this.canReplace(this.childCount,this.childCount,t.content):this.type.compatibleContent(t.type)},ue.prototype.check=function(){if(!this.type.validContent(this.content))throw new RangeError("Invalid content for node "+this.type.name+": "+this.content.toString().slice(0,50));this.content.forEach((function(t){return t.check()}))},ue.prototype.toJSON=function(){var t={type:this.type.name};for(var e in this.attrs){t.attrs=this.attrs;break}return this.content.size&&(t.content=this.content.toJSON()),this.marks.length&&(t.marks=this.marks.map((function(t){return t.toJSON()}))),t},ue.fromJSON=function(t,e){if(!e)throw new RangeError("Invalid input for Node.fromJSON");var n=null;if(e.marks){if(!Array.isArray(e.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=e.marks.map(t.markFromJSON)}if("text"==e.type){if("string"!=typeof e.text)throw new RangeError("Invalid text node in JSON");return t.text(e.text,n)}var r=Bt.fromJSON(t,e.content);return t.nodeType(e.type).create(e.attrs,r,n)},Object.defineProperties(ue.prototype,fe);var de=function(t){function e(e,n,r,o){if(t.call(this,e,n,null,o),!r)throw new RangeError("Empty text nodes are not allowed");this.text=r}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={textContent:{configurable:!0},nodeSize:{configurable:!0}};return e.prototype.toString=function(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):me(this.marks,JSON.stringify(this.text))},n.textContent.get=function(){return this.text},e.prototype.textBetween=function(t,e){return this.text.slice(t,e)},n.nodeSize.get=function(){return this.text.length},e.prototype.mark=function(t){return t==this.marks?this:new e(this.type,this.attrs,this.text,t)},e.prototype.withText=function(t){return t==this.text?this:new e(this.type,this.attrs,t,this.marks)},e.prototype.cut=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=this.text.length),0==t&&e==this.text.length?this:this.withText(this.text.slice(t,e))},e.prototype.eq=function(t){return this.sameMarkup(t)&&this.text==t.text},e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.text=this.text,e},Object.defineProperties(e.prototype,n),e}(ue);function me(t,e){for(var n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}var ve=function(t){this.validEnd=t,this.next=[],this.wrapCache=[]},ge={inlineContent:{configurable:!0},defaultType:{configurable:!0},edgeCount:{configurable:!0}};ve.parse=function(t,e){var n=new ye(t,e);if(null==n.next)return ve.empty;var r=xe(n);n.next&&n.err("Unexpected trailing text");var o=Ae(Ne(r));return De(o,n),o},ve.prototype.matchType=function(t){for(var e=0;e<this.next.length;e+=2)if(this.next[e]==t)return this.next[e+1];return null},ve.prototype.matchFragment=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=t.childCount);for(var r=this,o=e;r&&o<n;o++)r=r.matchType(t.child(o).type);return r},ge.inlineContent.get=function(){var t=this.next[0];return!!t&&t.isInline},ge.defaultType.get=function(){for(var t=0;t<this.next.length;t+=2){var e=this.next[t];if(!e.isText&&!e.hasRequiredAttrs())return e}},ve.prototype.compatible=function(t){for(var e=0;e<this.next.length;e+=2)for(var n=0;n<t.next.length;n+=2)if(this.next[e]==t.next[n])return!0;return!1},ve.prototype.fillBefore=function(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=0);var r=[this];function o(i,s){var a=i.matchFragment(t,n);if(a&&(!e||a.validEnd))return Bt.from(s.map((function(t){return t.createAndFill()})));for(var c=0;c<i.next.length;c+=2){var h=i.next[c],p=i.next[c+1];if(!h.isText&&!h.hasRequiredAttrs()&&-1==r.indexOf(p)){r.push(p);var l=o(p,s.concat(h));if(l)return l}}}return o(this,[])},ve.prototype.findWrapping=function(t){for(var e=0;e<this.wrapCache.length;e+=2)if(this.wrapCache[e]==t)return this.wrapCache[e+1];var n=this.computeWrapping(t);return this.wrapCache.push(t,n),n},ve.prototype.computeWrapping=function(t){var e=Object.create(null),n=[{match:this,type:null,via:null}];while(n.length){var r=n.shift(),o=r.match;if(o.matchType(t)){for(var i=[],s=r;s.type;s=s.via)i.push(s.type);return i.reverse()}for(var a=0;a<o.next.length;a+=2){var c=o.next[a];c.isLeaf||c.hasRequiredAttrs()||c.name in e||r.type&&!o.next[a+1].validEnd||(n.push({match:c.contentMatch,type:c,via:r}),e[c.name]=!0)}}},ge.edgeCount.get=function(){return this.next.length>>1},ve.prototype.edge=function(t){var e=t<<1;if(e>=this.next.length)throw new RangeError("There's no "+t+"th edge in this content match");return{type:this.next[e],next:this.next[e+1]}},ve.prototype.toString=function(){var t=[];function e(n){t.push(n);for(var r=1;r<n.next.length;r+=2)-1==t.indexOf(n.next[r])&&e(n.next[r])}return e(this),t.map((function(e,n){for(var r=n+(e.validEnd?"*":" ")+" ",o=0;o<e.next.length;o+=2)r+=(o?", ":"")+e.next[o].name+"->"+t.indexOf(e.next[o+1]);return r})).join("\n")},Object.defineProperties(ve.prototype,ge),ve.empty=new ve(!0);var ye=function(t,e){this.string=t,this.nodeTypes=e,this.inline=null,this.pos=0,this.tokens=t.split(/\s*(?=\b|\W|$)/),""==this.tokens[this.tokens.length-1]&&this.tokens.pop(),""==this.tokens[0]&&this.tokens.unshift()},we={next:{configurable:!0}};function xe(t){var e=[];do{e.push(be(t))}while(t.eat("|"));return 1==e.length?e[0]:{type:"choice",exprs:e}}function be(t){var e=[];do{e.push(ke(t))}while(t.next&&")"!=t.next&&"|"!=t.next);return 1==e.length?e[0]:{type:"seq",exprs:e}}function ke(t){for(var e=Me(t);;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else{if(!t.eat("{"))break;e=Oe(t,e)}return e}function Se(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");var e=Number(t.next);return t.pos++,e}function Oe(t,e){var n=Se(t),r=n;return t.eat(",")&&(r="}"!=t.next?Se(t):-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:e}}function Ce(t,e){var n=t.nodeTypes,r=n[e];if(r)return[r];var o=[];for(var i in n){var s=n[i];s.groups.indexOf(e)>-1&&o.push(s)}return 0==o.length&&t.err("No node type or group '"+e+"' found"),o}function Me(t){if(t.eat("(")){var e=xe(t);return t.eat(")")||t.err("Missing closing paren"),e}if(!/\W/.test(t.next)){var n=Ce(t,t.next).map((function(e){return null==t.inline?t.inline=e.isInline:t.inline!=e.isInline&&t.err("Mixing inline and block content"),{type:"name",value:e}}));return t.pos++,1==n.length?n[0]:{type:"choice",exprs:n}}t.err("Unexpected token '"+t.next+"'")}function Ne(t){var e=[[]];return o(i(t,0),n()),e;function n(){return e.push([])-1}function r(t,n,r){var o={term:r,to:n};return e[t].push(o),o}function o(t,e){t.forEach((function(t){return t.to=e}))}function i(t,e){if("choice"==t.type)return t.exprs.reduce((function(t,n){return t.concat(i(n,e))}),[]);if("seq"==t.type)for(var s=0;;s++){var a=i(t.exprs[s],e);if(s==t.exprs.length-1)return a;o(a,e=n())}else{if("star"==t.type){var c=n();return r(e,c),o(i(t.expr,c),c),[r(c)]}if("plus"==t.type){var h=n();return o(i(t.expr,e),h),o(i(t.expr,h),h),[r(h)]}if("opt"==t.type)return[r(e)].concat(i(t.expr,e));if("range"==t.type){for(var p=e,l=0;l<t.min;l++){var u=n();o(i(t.expr,p),u),p=u}if(-1==t.max)o(i(t.expr,p),p);else for(var f=t.min;f<t.max;f++){var d=n();r(p,d),o(i(t.expr,p),d),p=d}return[r(p)]}if("name"==t.type)return[r(e,null,t.value)]}}}function Te(t,e){return e-t}function Ee(t,e){var n=[];return r(e),n.sort(Te);function r(e){var o=t[e];if(1==o.length&&!o[0].term)return r(o[0].to);n.push(e);for(var i=0;i<o.length;i++){var s=o[i],a=s.term,c=s.to;a||-1!=n.indexOf(c)||r(c)}}}function Ae(t){var e=Object.create(null);return n(Ee(t,0));function n(r){var o=[];r.forEach((function(e){t[e].forEach((function(e){var n=e.term,r=e.to;if(n){var i=o.indexOf(n),s=i>-1&&o[i+1];Ee(t,r).forEach((function(t){s||o.push(n,s=[]),-1==s.indexOf(t)&&s.push(t)}))}}))}));for(var i=e[r.join(",")]=new ve(r.indexOf(t.length-1)>-1),s=0;s<o.length;s+=2){var a=o[s+1].sort(Te);i.next.push(o[s],e[a.join(",")]||n(a))}return i}}function De(t,e){for(var n=0,r=[t];n<r.length;n++){for(var o=r[n],i=!o.validEnd,s=[],a=0;a<o.next.length;a+=2){var c=o.next[a],h=o.next[a+1];s.push(c.name),!i||c.isText||c.hasRequiredAttrs()||(i=!1),-1==r.indexOf(h)&&r.push(h)}i&&e.err("Only non-generatable nodes ("+s.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function Re(t){var e=Object.create(null);for(var n in t){var r=t[n];if(!r.hasDefault)return null;e[n]=r.default}return e}function ze(t,e){var n=Object.create(null);for(var r in t){var o=e&&e[r];if(void 0===o){var i=t[r];if(!i.hasDefault)throw new RangeError("No value supplied for attribute "+r);o=i.default}n[r]=o}return n}function Ie(t){var e=Object.create(null);if(t)for(var n in t)e[n]=new Be(t[n]);return e}we.next.get=function(){return this.tokens[this.pos]},ye.prototype.eat=function(t){return this.next==t&&(this.pos++||!0)},ye.prototype.err=function(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")},Object.defineProperties(ye.prototype,we);var Pe=function(t,e,n){this.name=t,this.schema=e,this.spec=n,this.groups=n.group?n.group.split(" "):[],this.attrs=Ie(n.attrs),this.defaultAttrs=Re(this.attrs),this.contentMatch=null,this.markSet=null,this.inlineContent=null,this.isBlock=!(n.inline||"text"==t),this.isText="text"==t},Fe={isInline:{configurable:!0},isTextblock:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};Fe.isInline.get=function(){return!this.isBlock},Fe.isTextblock.get=function(){return this.isBlock&&this.inlineContent},Fe.isLeaf.get=function(){return this.contentMatch==ve.empty},Fe.isAtom.get=function(){return this.isLeaf||this.spec.atom},Pe.prototype.hasRequiredAttrs=function(){for(var t in this.attrs)if(this.attrs[t].isRequired)return!0;return!1},Pe.prototype.compatibleContent=function(t){return this==t||this.contentMatch.compatible(t.contentMatch)},Pe.prototype.computeAttrs=function(t){return!t&&this.defaultAttrs?this.defaultAttrs:ze(this.attrs,t)},Pe.prototype.create=function(t,e,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new ue(this,this.computeAttrs(t),Bt.from(e),Lt.setFrom(n))},Pe.prototype.createChecked=function(t,e,n){if(e=Bt.from(e),!this.validContent(e))throw new RangeError("Invalid content for node "+this.name);return new ue(this,this.computeAttrs(t),e,Lt.setFrom(n))},Pe.prototype.createAndFill=function(t,e,n){if(t=this.computeAttrs(t),e=Bt.from(e),e.size){var r=this.contentMatch.fillBefore(e);if(!r)return null;e=r.append(e)}var o=this.contentMatch.matchFragment(e).fillBefore(Bt.empty,!0);return o?new ue(this,t,e.append(o),Lt.setFrom(n)):null},Pe.prototype.validContent=function(t){var e=this.contentMatch.matchFragment(t);if(!e||!e.validEnd)return!1;for(var n=0;n<t.childCount;n++)if(!this.allowsMarks(t.child(n).marks))return!1;return!0},Pe.prototype.allowsMarkType=function(t){return null==this.markSet||this.markSet.indexOf(t)>-1},Pe.prototype.allowsMarks=function(t){if(null==this.markSet)return!0;for(var e=0;e<t.length;e++)if(!this.allowsMarkType(t[e].type))return!1;return!0},Pe.prototype.allowedMarks=function(t){if(null==this.markSet)return t;for(var e,n=0;n<t.length;n++)this.allowsMarkType(t[n].type)?e&&e.push(t[n]):e||(e=t.slice(0,n));return e?e.length?e:Lt.empty:t},Pe.compile=function(t,e){var n=Object.create(null);t.forEach((function(t,r){return n[t]=new Pe(t,e,r)}));var r=e.spec.topNode||"doc";if(!n[r])throw new RangeError("Schema is missing its top node type ('"+r+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(var o in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n},Object.defineProperties(Pe.prototype,Fe);var Be=function(t){this.hasDefault=Object.prototype.hasOwnProperty.call(t,"default"),this.default=t.default},$e={isRequired:{configurable:!0}};$e.isRequired.get=function(){return!this.hasDefault},Object.defineProperties(Be.prototype,$e);var _e=function(t,e,n,r){this.name=t,this.schema=n,this.spec=r,this.attrs=Ie(r.attrs),this.rank=e,this.excluded=null;var o=Re(this.attrs);this.instance=o&&new Lt(this,o)};_e.prototype.create=function(t){return!t&&this.instance?this.instance:new Lt(this,ze(this.attrs,t))},_e.compile=function(t,e){var n=Object.create(null),r=0;return t.forEach((function(t,o){return n[t]=new _e(t,r++,e,o)})),n},_e.prototype.removeFromSet=function(t){for(var e=0;e<t.length;e++)if(t[e].type==this)return t.slice(0,e).concat(t.slice(e+1));return t},_e.prototype.isInSet=function(t){for(var e=0;e<t.length;e++)if(t[e].type==this)return t[e]},_e.prototype.excludes=function(t){return this.excluded.indexOf(t)>-1};var je=function(t){for(var e in this.spec={},t)this.spec[e]=t[e];this.spec.nodes=c.from(t.nodes),this.spec.marks=c.from(t.marks),this.nodes=Pe.compile(this.spec.nodes,this),this.marks=_e.compile(this.spec.marks,this);var n=Object.create(null);for(var r in this.nodes){if(r in this.marks)throw new RangeError(r+" can not be both a node and a mark");var o=this.nodes[r],i=o.spec.content||"",s=o.spec.marks;o.contentMatch=n[i]||(n[i]=ve.parse(i,this.nodes)),o.inlineContent=o.contentMatch.inlineContent,o.markSet="_"==s?null:s?Je(this,s.split(" ")):""!=s&&o.inlineContent?null:[]}for(var a in this.marks){var h=this.marks[a],p=h.spec.excludes;h.excluded=null==p?[h]:""==p?[]:Je(this,p.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached=Object.create(null),this.cached.wrappings=Object.create(null)};function Je(t,e){for(var n=[],r=0;r<e.length;r++){var o=e[r],i=t.marks[o],s=i;if(i)n.push(i);else for(var a in t.marks){var c=t.marks[a];("_"==o||c.spec.group&&c.spec.group.split(" ").indexOf(o)>-1)&&n.push(s=c)}if(!s)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return n}je.prototype.node=function(t,e,n,r){if("string"==typeof t)t=this.nodeType(t);else{if(!(t instanceof Pe))throw new RangeError("Invalid node type: "+t);if(t.schema!=this)throw new RangeError("Node type from different schema used ("+t.name+")")}return t.createChecked(e,n,r)},je.prototype.text=function(t,e){var n=this.nodes.text;return new de(n,n.defaultAttrs,t,Lt.setFrom(e))},je.prototype.mark=function(t,e){return"string"==typeof t&&(t=this.marks[t]),t.create(e)},je.prototype.nodeFromJSON=function(t){return ue.fromJSON(this,t)},je.prototype.markFromJSON=function(t){return Lt.fromJSON(this,t)},je.prototype.nodeType=function(t){var e=this.nodes[t];if(!e)throw new RangeError("Unknown node type: "+t);return e};var Le=function(t,e){var n=this;this.schema=t,this.rules=e,this.tags=[],this.styles=[],e.forEach((function(t){t.tag?n.tags.push(t):t.style&&n.styles.push(t)})),this.normalizeLists=!this.tags.some((function(e){if(!/^(ul|ol)\b/.test(e.tag)||!e.node)return!1;var n=t.nodes[e.node];return n.contentMatch.matchType(n)}))};Le.prototype.parse=function(t,e){void 0===e&&(e={});var n=new Ye(this,e,!1);return n.addAll(t,null,e.from,e.to),n.finish()},Le.prototype.parseSlice=function(t,e){void 0===e&&(e={});var n=new Ye(this,e,!0);return n.addAll(t,null,e.from,e.to),qt.maxOpen(n.finish())},Le.prototype.matchTag=function(t,e){for(var n=0;n<this.tags.length;n++){var r=this.tags[n];if(tn(t,r.tag)&&(void 0===r.namespace||t.namespaceURI==r.namespace)&&(!r.context||e.matchesContext(r.context))){if(r.getAttrs){var o=r.getAttrs(t);if(!1===o)continue;r.attrs=o}return r}}},Le.prototype.matchStyle=function(t,e,n){for(var r=0;r<this.styles.length;r++){var o=this.styles[r];if(!(0!=o.style.indexOf(t)||o.context&&!n.matchesContext(o.context)||o.style.length>t.length&&(61!=o.style.charCodeAt(t.length)||o.style.slice(t.length+1)!=e))){if(o.getAttrs){var i=o.getAttrs(e);if(!1===i)continue;o.attrs=i}return o}}},Le.schemaRules=function(t){var e=[];function n(t){for(var n=null==t.priority?50:t.priority,r=0;r<e.length;r++){var o=e[r],i=null==o.priority?50:o.priority;if(i<n)break}e.splice(r,0,t)}var r=function(e){var r=t.marks[e].spec.parseDOM;r&&r.forEach((function(t){n(t=nn(t)),t.mark=e}))};for(var o in t.marks)r(o);var i=function(e){var r=t.nodes[s].spec.parseDOM;r&&r.forEach((function(t){n(t=nn(t)),t.node=s}))};for(var s in t.nodes)i();return e},Le.fromSchema=function(t){return t.cached.domParser||(t.cached.domParser=new Le(t,Le.schemaRules(t)))};var Ve={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},qe={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},We={ol:!0,ul:!0},He=1,Ke=2,Ue=4;function Ge(t){return(t?He:0)|("full"===t?Ke:0)}var Xe=function(t,e,n,r,o,i,s){this.type=t,this.attrs=e,this.solid=o,this.match=i||(s&Ue?null:t.contentMatch),this.options=s,this.content=[],this.marks=n,this.activeMarks=Lt.none,this.pendingMarks=r};Xe.prototype.findWrapping=function(t){if(!this.match){if(!this.type)return[];var e=this.type.contentMatch.fillBefore(Bt.from(t));if(!e){var n,r=this.type.contentMatch;return(n=r.findWrapping(t.type))?(this.match=r,n):null}this.match=this.type.contentMatch.matchFragment(e)}return this.match.findWrapping(t.type)},Xe.prototype.finish=function(t){if(!(this.options&He)){var e,n=this.content[this.content.length-1];n&&n.isText&&(e=/[ \t\r\n\u000c]+$/.exec(n.text))&&(n.text.length==e[0].length?this.content.pop():this.content[this.content.length-1]=n.withText(n.text.slice(0,n.text.length-e[0].length)))}var r=Bt.from(this.content);return!t&&this.match&&(r=r.append(this.match.fillBefore(Bt.empty,!0))),this.type?this.type.create(this.attrs,r,this.marks):r},Xe.prototype.applyPending=function(t){for(var e=0,n=this.pendingMarks;e<n.length;e++){var r=n[e];(this.type?this.type.allowsMarkType(r.type):rn(r.type,t))&&!r.isInSet(this.activeMarks)&&(this.activeMarks=r.addToSet(this.activeMarks),this.pendingMarks=r.removeFromSet(this.pendingMarks))}};var Ye=function(t,e,n){this.parser=t,this.options=e,this.isOpen=n;var r,o=e.topNode,i=Ge(e.preserveWhitespace)|(n?Ue:0);r=o?new Xe(o.type,o.attrs,Lt.none,Lt.none,!0,e.topMatch||o.type.contentMatch,i):new Xe(n?null:t.schema.topNodeType,null,Lt.none,Lt.none,!0,null,i),this.nodes=[r],this.open=0,this.find=e.findPositions,this.needsBlock=!1},Ze={top:{configurable:!0},currentPos:{configurable:!0}};function Qe(t){for(var e=t.firstChild,n=null;e;e=e.nextSibling){var r=1==e.nodeType?e.nodeName.toLowerCase():null;r&&We.hasOwnProperty(r)&&n?(n.appendChild(e),e=n):"li"==r?n=e:r&&(n=null)}}function tn(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function en(t){var e,n=/\s*([\w-]+)\s*:\s*([^;]+)/g,r=[];while(e=n.exec(t))r.push(e[1],e[2].trim());return r}function nn(t){var e={};for(var n in t)e[n]=t[n];return e}function rn(t,e){var n=e.schema.nodes,r=function(r){var o=n[r];if(o.allowsMarkType(t)){var i=[],s=function(t){i.push(t);for(var n=0;n<t.edgeCount;n++){var r=t.edge(n),o=r.type,a=r.next;if(o==e)return!0;if(i.indexOf(a)<0&&s(a))return!0}};return s(o.contentMatch)?{v:!0}:void 0}};for(var o in n){var i=r(o);if(i)return i.v}}Ze.top.get=function(){return this.nodes[this.open]},Ye.prototype.addDOM=function(t){if(3==t.nodeType)this.addTextNode(t);else if(1==t.nodeType){var e=t.getAttribute("style"),n=e?this.readStyles(en(e)):null,r=this.top;if(null!=n)for(var o=0;o<n.length;o++)this.addPendingMark(n[o]);if(this.addElement(t),null!=n)for(var i=0;i<n.length;i++)this.removePendingMark(n[i],r)}},Ye.prototype.addTextNode=function(t){var e=t.nodeValue,n=this.top;if((n.type?n.type.inlineContent:n.content.length&&n.content[0].isInline)||/[^ \t\r\n\u000c]/.test(e)){if(n.options&He)n.options&Ke||(e=e.replace(/\r?\n|\r/g," "));else if(e=e.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(e)&&this.open==this.nodes.length-1){var r=n.content[n.content.length-1],o=t.previousSibling;(!r||o&&"BR"==o.nodeName||r.isText&&/[ \t\r\n\u000c]$/.test(r.text))&&(e=e.slice(1))}e&&this.insertNode(this.parser.schema.text(e)),this.findInText(t)}else this.findInside(t)},Ye.prototype.addElement=function(t){var e=t.nodeName.toLowerCase();We.hasOwnProperty(e)&&this.normalizeLists&&Qe(t);var n=this.options.ruleFromNode&&this.options.ruleFromNode(t)||this.parser.matchTag(t,this);if(n?n.ignore:qe.hasOwnProperty(e))this.findInside(t);else if(!n||n.skip||n.closeParent){n&&n.closeParent?this.open=Math.max(0,this.open-1):n&&n.skip.nodeType&&(t=n.skip);var r,o=this.top,i=this.needsBlock;if(Ve.hasOwnProperty(e))r=!0,o.type||(this.needsBlock=!0);else if(!t.firstChild)return void this.leafFallback(t);this.addAll(t),r&&this.sync(o),this.needsBlock=i}else this.addElementByRule(t,n)},Ye.prototype.leafFallback=function(t){"BR"==t.nodeName&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(t.ownerDocument.createTextNode("\n"))},Ye.prototype.readStyles=function(t){for(var e=Lt.none,n=0;n<t.length;n+=2){var r=this.parser.matchStyle(t[n],t[n+1],this);if(r){if(r.ignore)return null;e=this.parser.schema.marks[r.mark].create(r.attrs).addToSet(e)}}return e},Ye.prototype.addElementByRule=function(t,e){var n,r,o,i,s=this;e.node?(r=this.parser.schema.nodes[e.node],r.isLeaf?this.insertNode(r.create(e.attrs))||this.leafFallback(t):n=this.enter(r,e.attrs,e.preserveWhitespace)):(o=this.parser.schema.marks[e.mark],i=o.create(e.attrs),this.addPendingMark(i));var a=this.top;if(r&&r.isLeaf)this.findInside(t);else if(e.getContent)this.findInside(t),e.getContent(t,this.parser.schema).forEach((function(t){return s.insertNode(t)}));else{var c=e.contentElement;"string"==typeof c?c=t.querySelector(c):"function"==typeof c&&(c=c(t)),c||(c=t),this.findAround(t,c,!0),this.addAll(c,n)}n&&(this.sync(a),this.open--),i&&this.removePendingMark(i,a)},Ye.prototype.addAll=function(t,e,n,r){for(var o=n||0,i=n?t.childNodes[n]:t.firstChild,s=null==r?null:t.childNodes[r];i!=s;i=i.nextSibling,++o)this.findAtPoint(t,o),this.addDOM(i),e&&Ve.hasOwnProperty(i.nodeName.toLowerCase())&&this.sync(e);this.findAtPoint(t,o)},Ye.prototype.findPlace=function(t){for(var e,n,r=this.open;r>=0;r--){var o=this.nodes[r],i=o.findWrapping(t);if(i&&(!e||e.length>i.length)&&(e=i,n=o,!i.length))break;if(o.solid)break}if(!e)return!1;this.sync(n);for(var s=0;s<e.length;s++)this.enterInner(e[s],null,!1);return!0},Ye.prototype.insertNode=function(t){if(t.isInline&&this.needsBlock&&!this.top.type){var e=this.textblockFromContext();e&&this.enterInner(e)}if(this.findPlace(t)){this.closeExtra();var n=this.top;n.applyPending(t.type),n.match&&(n.match=n.match.matchType(t.type));for(var r=n.activeMarks,o=0;o<t.marks.length;o++)n.type&&!n.type.allowsMarkType(t.marks[o].type)||(r=t.marks[o].addToSet(r));return n.content.push(t.mark(r)),!0}return!1},Ye.prototype.enter=function(t,e,n){var r=this.findPlace(t.create(e));return r&&this.enterInner(t,e,!0,n),r},Ye.prototype.enterInner=function(t,e,n,r){this.closeExtra();var o=this.top;o.applyPending(t),o.match=o.match&&o.match.matchType(t,e);var i=null==r?o.options&~Ue:Ge(r);o.options&Ue&&0==o.content.length&&(i|=Ue),this.nodes.push(new Xe(t,e,o.activeMarks,o.pendingMarks,n,null,i)),this.open++},Ye.prototype.closeExtra=function(t){var e=this.nodes.length-1;if(e>this.open){for(;e>this.open;e--)this.nodes[e-1].content.push(this.nodes[e].finish(t));this.nodes.length=this.open+1}},Ye.prototype.finish=function(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)},Ye.prototype.sync=function(t){for(var e=this.open;e>=0;e--)if(this.nodes[e]==t)return void(this.open=e)},Ze.currentPos.get=function(){this.closeExtra();for(var t=0,e=this.open;e>=0;e--){for(var n=this.nodes[e].content,r=n.length-1;r>=0;r--)t+=n[r].nodeSize;e&&t++}return t},Ye.prototype.findAtPoint=function(t,e){if(this.find)for(var n=0;n<this.find.length;n++)this.find[n].node==t&&this.find[n].offset==e&&(this.find[n].pos=this.currentPos)},Ye.prototype.findInside=function(t){if(this.find)for(var e=0;e<this.find.length;e++)null==this.find[e].pos&&1==t.nodeType&&t.contains(this.find[e].node)&&(this.find[e].pos=this.currentPos)},Ye.prototype.findAround=function(t,e,n){if(t!=e&&this.find)for(var r=0;r<this.find.length;r++)if(null==this.find[r].pos&&1==t.nodeType&&t.contains(this.find[r].node)){var o=e.compareDocumentPosition(this.find[r].node);o&(n?2:4)&&(this.find[r].pos=this.currentPos)}},Ye.prototype.findInText=function(t){if(this.find)for(var e=0;e<this.find.length;e++)this.find[e].node==t&&(this.find[e].pos=this.currentPos-(t.nodeValue.length-this.find[e].offset))},Ye.prototype.matchesContext=function(t){var e=this;if(t.indexOf("|")>-1)return t.split(/\s*\|\s*/).some(this.matchesContext,this);var n=t.split("/"),r=this.options.context,o=!this.isOpen&&(!r||r.parent.type==this.nodes[0].type),i=-(r?r.depth+1:0)+(o?0:1),s=function(t,a){for(;t>=0;t--){var c=n[t];if(""==c){if(t==n.length-1||0==t)continue;for(;a>=i;a--)if(s(t-1,a))return!0;return!1}var h=a>0||0==a&&o?e.nodes[a].type:r&&a>=i?r.node(a-i).type:null;if(!h||h.name!=c&&-1==h.groups.indexOf(c))return!1;a--}return!0};return s(n.length-1,this.open)},Ye.prototype.textblockFromContext=function(){var t=this.options.context;if(t)for(var e=t.depth;e>=0;e--){var n=t.node(e).contentMatchAt(t.indexAfter(e)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(var r in this.parser.schema.nodes){var o=this.parser.schema.nodes[r];if(o.isTextblock&&o.defaultAttrs)return o}},Ye.prototype.addPendingMark=function(t){this.top.pendingMarks=t.addToSet(this.top.pendingMarks)},Ye.prototype.removePendingMark=function(t,e){for(var n=this.open;n>=0;n--){var r=this.nodes[n],o=r.pendingMarks.lastIndexOf(t);if(o>-1?r.pendingMarks=t.removeFromSet(r.pendingMarks):r.activeMarks=t.removeFromSet(r.activeMarks),r==e)break}},Object.defineProperties(Ye.prototype,Ze);var on=function(t,e){this.nodes=t||{},this.marks=e||{}};function sn(t){var e={};for(var n in t){var r=t[n].spec.toDOM;r&&(e[n]=r)}return e}function an(t){return t.document||window.document}on.prototype.serializeFragment=function(t,e,n){var r=this;void 0===e&&(e={}),n||(n=an(e).createDocumentFragment());var o=n,i=null;return t.forEach((function(t){if(i||t.marks.length){i||(i=[]);var n=0,s=0;while(n<i.length&&s<t.marks.length){var a=t.marks[s];if(r.marks[a.type.name]){if(!a.eq(i[n])||!1===a.type.spec.spanning)break;n+=2,s++}else s++}while(n<i.length)o=i.pop(),i.pop();while(s<t.marks.length){var c=t.marks[s++],h=r.serializeMark(c,t.isInline,e);h&&(i.push(c,o),o.appendChild(h.dom),o=h.contentDOM||h.dom)}}o.appendChild(r.serializeNode(t,e))})),n},on.prototype.serializeNode=function(t,e){void 0===e&&(e={});var n=on.renderSpec(an(e),this.nodes[t.type.name](t)),r=n.dom,o=n.contentDOM;if(o){if(t.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");e.onContent?e.onContent(t,o,e):this.serializeFragment(t.content,e,o)}return r},on.prototype.serializeNodeAndMarks=function(t,e){void 0===e&&(e={});for(var n=this.serializeNode(t,e),r=t.marks.length-1;r>=0;r--){var o=this.serializeMark(t.marks[r],t.isInline,e);o&&((o.contentDOM||o.dom).appendChild(n),n=o.dom)}return n},on.prototype.serializeMark=function(t,e,n){void 0===n&&(n={});var r=this.marks[t.type.name];return r&&on.renderSpec(an(n),r(t,e))},on.renderSpec=function(t,e,n){if(void 0===n&&(n=null),"string"==typeof e)return{dom:t.createTextNode(e)};if(null!=e.nodeType)return{dom:e};var r=e[0],o=r.indexOf(" ");o>0&&(n=r.slice(0,o),r=r.slice(o+1));var i=null,s=n?t.createElementNS(n,r):t.createElement(r),a=e[1],c=1;if(a&&"object"==typeof a&&null==a.nodeType&&!Array.isArray(a))for(var h in c=2,a)if(null!=a[h]){var p=h.indexOf(" ");p>0?s.setAttributeNS(h.slice(0,p),h.slice(p+1),a[h]):s.setAttribute(h,a[h])}for(var l=c;l<e.length;l++){var u=e[l];if(0===u){if(l<e.length-1||l>c)throw new RangeError("Content hole must be the only child of its parent node");return{dom:s,contentDOM:s}}var f=on.renderSpec(t,u,n),d=f.dom,m=f.contentDOM;if(s.appendChild(d),m){if(i)throw new RangeError("Multiple content holes");i=m}}return{dom:s,contentDOM:i}},on.fromSchema=function(t){return t.cached.domSerializer||(t.cached.domSerializer=new on(this.nodesFromSchema(t),this.marksFromSchema(t)))},on.nodesFromSchema=function(t){var e=sn(t.nodes);return e.text||(e.text=function(t){return t.text}),e},on.marksFromSchema=function(t){return sn(t.marks)};var cn=65535,hn=Math.pow(2,16);function pn(t,e){return t+e*hn}function ln(t){return t&cn}function un(t){return(t-(t&cn))/hn}var fn=function(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=null),this.pos=t,this.deleted=e,this.recover=n},dn=function(t,e){void 0===e&&(e=!1),this.ranges=t,this.inverted=e};dn.prototype.recover=function(t){var e=0,n=ln(t);if(!this.inverted)for(var r=0;r<n;r++)e+=this.ranges[3*r+2]-this.ranges[3*r+1];return this.ranges[3*n]+e+un(t)},dn.prototype.mapResult=function(t,e){return void 0===e&&(e=1),this._map(t,e,!1)},dn.prototype.map=function(t,e){return void 0===e&&(e=1),this._map(t,e,!0)},dn.prototype._map=function(t,e,n){for(var r=0,o=this.inverted?2:1,i=this.inverted?1:2,s=0;s<this.ranges.length;s+=3){var a=this.ranges[s]-(this.inverted?r:0);if(a>t)break;var c=this.ranges[s+o],h=this.ranges[s+i],p=a+c;if(t<=p){var l=c?t==a?-1:t==p?1:e:e,u=a+r+(l<0?0:h);if(n)return u;var f=t==(e<0?a:p)?null:pn(s/3,t-a);return new fn(u,e<0?t!=a:t!=p,f)}r+=h-c}return n?t+r:new fn(t+r)},dn.prototype.touches=function(t,e){for(var n=0,r=ln(e),o=this.inverted?2:1,i=this.inverted?1:2,s=0;s<this.ranges.length;s+=3){var a=this.ranges[s]-(this.inverted?n:0);if(a>t)break;var c=this.ranges[s+o],h=a+c;if(t<=h&&s==3*r)return!0;n+=this.ranges[s+i]-c}return!1},dn.prototype.forEach=function(t){for(var e=this.inverted?2:1,n=this.inverted?1:2,r=0,o=0;r<this.ranges.length;r+=3){var i=this.ranges[r],s=i-(this.inverted?o:0),a=i+(this.inverted?0:o),c=this.ranges[r+e],h=this.ranges[r+n];t(s,s+c,a,a+h),o+=h-c}},dn.prototype.invert=function(){return new dn(this.ranges,!this.inverted)},dn.prototype.toString=function(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)},dn.offset=function(t){return 0==t?dn.empty:new dn(t<0?[0,-t,0]:[0,0,t])},dn.empty=new dn([]);var mn=function(t,e,n,r){this.maps=t||[],this.from=n||0,this.to=null==r?this.maps.length:r,this.mirror=e};function vn(t){var e=Error.call(this,t);return e.__proto__=vn.prototype,e}mn.prototype.slice=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=this.maps.length),new mn(this.maps,this.mirror,t,e)},mn.prototype.copy=function(){return new mn(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)},mn.prototype.appendMap=function(t,e){this.to=this.maps.push(t),null!=e&&this.setMirror(this.maps.length-1,e)},mn.prototype.appendMapping=function(t){for(var e=0,n=this.maps.length;e<t.maps.length;e++){var r=t.getMirror(e);this.appendMap(t.maps[e],null!=r&&r<e?n+r:null)}},mn.prototype.getMirror=function(t){if(this.mirror)for(var e=0;e<this.mirror.length;e++)if(this.mirror[e]==t)return this.mirror[e+(e%2?-1:1)]},mn.prototype.setMirror=function(t,e){this.mirror||(this.mirror=[]),this.mirror.push(t,e)},mn.prototype.appendMappingInverted=function(t){for(var e=t.maps.length-1,n=this.maps.length+t.maps.length;e>=0;e--){var r=t.getMirror(e);this.appendMap(t.maps[e].invert(),null!=r&&r>e?n-r-1:null)}},mn.prototype.invert=function(){var t=new mn;return t.appendMappingInverted(this),t},mn.prototype.map=function(t,e){if(void 0===e&&(e=1),this.mirror)return this._map(t,e,!0);for(var n=this.from;n<this.to;n++)t=this.maps[n].map(t,e);return t},mn.prototype.mapResult=function(t,e){return void 0===e&&(e=1),this._map(t,e,!1)},mn.prototype._map=function(t,e,n){for(var r=!1,o=this.from;o<this.to;o++){var i=this.maps[o],s=i.mapResult(t,e);if(null!=s.recover){var a=this.getMirror(o);if(null!=a&&a>o&&a<this.to){o=a,t=this.maps[a].recover(s.recover);continue}}s.deleted&&(r=!0),t=s.pos}return n?t:new fn(t,r)},vn.prototype=Object.create(Error.prototype),vn.prototype.constructor=vn,vn.prototype.name="TransformError";var gn=function(t){this.doc=t,this.steps=[],this.docs=[],this.mapping=new mn},yn={before:{configurable:!0},docChanged:{configurable:!0}};function wn(){throw new Error("Override me")}yn.before.get=function(){return this.docs.length?this.docs[0]:this.doc},gn.prototype.step=function(t){var e=this.maybeStep(t);if(e.failed)throw new vn(e.failed);return this},gn.prototype.maybeStep=function(t){var e=t.apply(this.doc);return e.failed||this.addStep(t,e.doc),e},yn.docChanged.get=function(){return this.steps.length>0},gn.prototype.addStep=function(t,e){this.docs.push(this.doc),this.steps.push(t),this.mapping.appendMap(t.getMap()),this.doc=e},Object.defineProperties(gn.prototype,yn);var xn=Object.create(null),bn=function(){};bn.prototype.apply=function(t){return wn()},bn.prototype.getMap=function(){return dn.empty},bn.prototype.invert=function(t){return wn()},bn.prototype.map=function(t){return wn()},bn.prototype.merge=function(t){return null},bn.prototype.toJSON=function(){return wn()},bn.fromJSON=function(t,e){if(!e||!e.stepType)throw new RangeError("Invalid input for Step.fromJSON");var n=xn[e.stepType];if(!n)throw new RangeError("No step type "+e.stepType+" defined");return n.fromJSON(t,e)},bn.jsonID=function(t,e){if(t in xn)throw new RangeError("Duplicate use of step JSON ID "+t);return xn[t]=e,e.prototype.jsonID=t,e};var kn=function(t,e){this.doc=t,this.failed=e};kn.ok=function(t){return new kn(t,null)},kn.fail=function(t){return new kn(null,t)},kn.fromReplace=function(t,e,n,r){try{return kn.ok(t.replace(e,n,r))}catch(o){if(o instanceof Vt)return kn.fail(o.message);throw o}};var Sn=function(t){function e(e,n,r,o){t.call(this),this.from=e,this.to=n,this.slice=r,this.structure=!!o}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(t){return this.structure&&Cn(t,this.from,this.to)?kn.fail("Structure replace would overwrite content"):kn.fromReplace(t,this.from,this.to,this.slice)},e.prototype.getMap=function(){return new dn([this.from,this.to-this.from,this.slice.size])},e.prototype.invert=function(t){return new e(this.from,this.from+this.slice.size,t.slice(this.from,this.to))},e.prototype.map=function(t){var n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return n.deleted&&r.deleted?null:new e(n.pos,Math.max(n.pos,r.pos),this.slice)},e.prototype.merge=function(t){if(!(t instanceof e)||t.structure!=this.structure)return null;if(this.from+this.slice.size!=t.from||this.slice.openEnd||t.slice.openStart){if(t.to!=this.from||this.slice.openStart||t.slice.openEnd)return null;var n=this.slice.size+t.slice.size==0?qt.empty:new qt(t.slice.content.append(this.slice.content),t.slice.openStart,this.slice.openEnd);return new e(t.from,this.to,n,this.structure)}var r=this.slice.size+t.slice.size==0?qt.empty:new qt(this.slice.content.append(t.slice.content),this.slice.openStart,t.slice.openEnd);return new e(this.from,this.to+(t.to-t.from),r,this.structure)},e.prototype.toJSON=function(){var t={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t},e.fromJSON=function(t,n){if("number"!=typeof n.from||"number"!=typeof n.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new e(n.from,n.to,qt.fromJSON(t,n.slice),!!n.structure)},e}(bn);bn.jsonID("replace",Sn);var On=function(t){function e(e,n,r,o,i,s,a){t.call(this),this.from=e,this.to=n,this.gapFrom=r,this.gapTo=o,this.slice=i,this.insert=s,this.structure=!!a}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(t){if(this.structure&&(Cn(t,this.from,this.gapFrom)||Cn(t,this.gapTo,this.to)))return kn.fail("Structure gap-replace would overwrite content");var e=t.slice(this.gapFrom,this.gapTo);if(e.openStart||e.openEnd)return kn.fail("Gap is not a flat range");var n=this.slice.insertAt(this.insert,e.content);return n?kn.fromReplace(t,this.from,this.to,n):kn.fail("Content does not fit in gap")},e.prototype.getMap=function(){return new dn([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])},e.prototype.invert=function(t){var n=this.gapTo-this.gapFrom;return new e(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)},e.prototype.map=function(t){var n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1),o=t.map(this.gapFrom,-1),i=t.map(this.gapTo,1);return n.deleted&&r.deleted||o<n.pos||i>r.pos?null:new e(n.pos,r.pos,o,i,this.slice,this.insert,this.structure)},e.prototype.toJSON=function(){var t={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t},e.fromJSON=function(t,n){if("number"!=typeof n.from||"number"!=typeof n.to||"number"!=typeof n.gapFrom||"number"!=typeof n.gapTo||"number"!=typeof n.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new e(n.from,n.to,n.gapFrom,n.gapTo,qt.fromJSON(t,n.slice),n.insert,!!n.structure)},e}(bn);function Cn(t,e,n){var r=t.resolve(e),o=n-e,i=r.depth;while(o>0&&i>0&&r.indexAfter(i)==r.node(i).childCount)i--,o--;if(o>0){var s=r.node(i).maybeChild(r.indexAfter(i));while(o>0){if(!s||s.isLeaf)return!0;s=s.firstChild,o--}}return!1}function Mn(t,e,n){return(0==e||t.canReplace(e,t.childCount))&&(n==t.childCount||t.canReplace(0,n))}function Nn(t){for(var e=t.parent,n=e.content.cutByIndex(t.startIndex,t.endIndex),r=t.depth;;--r){var o=t.$from.node(r),i=t.$from.index(r),s=t.$to.indexAfter(r);if(r<t.depth&&o.canReplace(i,s,n))return r;if(0==r||o.type.spec.isolating||!Mn(o,i,s))break}}function Tn(t,e,n){var r=t.resolve(e),o=r.index();return r.parent.canReplaceWith(o,o+1,n)}function En(t,e,n,r){void 0===n&&(n=1);var o=t.resolve(e),i=o.depth-n,s=r&&r[r.length-1]||o.parent;if(i<0||o.parent.type.spec.isolating||!o.parent.canReplace(o.index(),o.parent.childCount)||!s.type.validContent(o.parent.content.cutByIndex(o.index(),o.parent.childCount)))return!1;for(var a=o.depth-1,c=n-2;a>i;a--,c--){var h=o.node(a),p=o.index(a);if(h.type.spec.isolating)return!1;var l=h.content.cutByIndex(p,h.childCount),u=r&&r[c]||h;if(u!=h&&(l=l.replaceChild(0,u.type.create(u.attrs))),!h.canReplace(p+1,h.childCount)||!u.type.validContent(l))return!1}var f=o.indexAfter(i),d=r&&r[0];return o.node(i).canReplaceWith(f,f,d?d.type:o.node(i+1).type)}function An(t,e){var n=t.resolve(e),r=n.index();return Dn(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(r,r+1)}function Dn(t,e){return t&&e&&!t.isLeaf&&t.canAppend(e)}function Rn(t,e,n){var r=t.resolve(e);if(r.parent.canReplaceWith(r.index(),r.index(),n))return e;if(0==r.parentOffset)for(var o=r.depth-1;o>=0;o--){var i=r.index(o);if(r.node(o).canReplaceWith(i,i,n))return r.before(o+1);if(i>0)return null}if(r.parentOffset==r.parent.content.size)for(var s=r.depth-1;s>=0;s--){var a=r.indexAfter(s);if(r.node(s).canReplaceWith(a,a,n))return r.after(s+1);if(a<r.node(s).childCount)return null}}function zn(t,e,n){var r=t.resolve(e);if(!n.content.size)return e;for(var o=n.content,i=0;i<n.openStart;i++)o=o.firstChild.content;for(var s=1;s<=(0==n.openStart&&n.size?2:1);s++)for(var a=r.depth;a>=0;a--){var c=a==r.depth?0:r.pos<=(r.start(a+1)+r.end(a+1))/2?-1:1,h=r.index(a)+(c>0?1:0);if(1==s?r.node(a).canReplace(h,h,o):r.node(a).contentMatchAt(h).findWrapping(o.firstChild.type))return 0==c?r.pos:c<0?r.before(a+1):r.after(a+1)}return null}function In(t,e,n){for(var r=[],o=0;o<t.childCount;o++){var i=t.child(o);i.content.size&&(i=i.copy(In(i.content,e,i))),i.isInline&&(i=e(i,n,o)),r.push(i)}return Bt.fromArray(r)}bn.jsonID("replaceAround",On),gn.prototype.lift=function(t,e){for(var n=t.$from,r=t.$to,o=t.depth,i=n.before(o+1),s=r.after(o+1),a=i,c=s,h=Bt.empty,p=0,l=o,u=!1;l>e;l--)u||n.index(l)>0?(u=!0,h=Bt.from(n.node(l).copy(h)),p++):a--;for(var f=Bt.empty,d=0,m=o,v=!1;m>e;m--)v||r.after(m+1)<r.end(m)?(v=!0,f=Bt.from(r.node(m).copy(f)),d++):c++;return this.step(new On(a,c,i,s,new qt(h.append(f),p,d),h.size-p,!0))},gn.prototype.wrap=function(t,e){for(var n=Bt.empty,r=e.length-1;r>=0;r--)n=Bt.from(e[r].type.create(e[r].attrs,n));var o=t.start,i=t.end;return this.step(new On(o,i,o,i,new qt(n,0,0),e.length,!0))},gn.prototype.setBlockType=function(t,e,n,r){var o=this;if(void 0===e&&(e=t),!n.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");var i=this.steps.length;return this.doc.nodesBetween(t,e,(function(t,e){if(t.isTextblock&&!t.hasMarkup(n,r)&&Tn(o.doc,o.mapping.slice(i).map(e),n)){o.clearIncompatible(o.mapping.slice(i).map(e,1),n);var s=o.mapping.slice(i),a=s.map(e,1),c=s.map(e+t.nodeSize,1);return o.step(new On(a,c,a+1,c-1,new qt(Bt.from(n.create(r,null,t.marks)),0,0),1,!0)),!1}})),this},gn.prototype.setNodeMarkup=function(t,e,n,r){var o=this.doc.nodeAt(t);if(!o)throw new RangeError("No node at given position");e||(e=o.type);var i=e.create(n,null,r||o.marks);if(o.isLeaf)return this.replaceWith(t,t+o.nodeSize,i);if(!e.validContent(o.content))throw new RangeError("Invalid content for node type "+e.name);return this.step(new On(t,t+o.nodeSize,t+1,t+o.nodeSize-1,new qt(Bt.from(i),0,0),1,!0))},gn.prototype.split=function(t,e,n){void 0===e&&(e=1);for(var r=this.doc.resolve(t),o=Bt.empty,i=Bt.empty,s=r.depth,a=r.depth-e,c=e-1;s>a;s--,c--){o=Bt.from(r.node(s).copy(o));var h=n&&n[c];i=Bt.from(h?h.type.create(h.attrs,i):r.node(s).copy(i))}return this.step(new Sn(t,t,new qt(o.append(i),e,e),!0))},gn.prototype.join=function(t,e){void 0===e&&(e=1);var n=new Sn(t-e,t+e,qt.empty,!0);return this.step(n)};var Pn=function(t){function e(e,n,r){t.call(this),this.from=e,this.to=n,this.mark=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(t){var e=this,n=t.slice(this.from,this.to),r=t.resolve(this.from),o=r.node(r.sharedDepth(this.to)),i=new qt(In(n.content,(function(t,n){return n.type.allowsMarkType(e.mark.type)?t.mark(e.mark.addToSet(t.marks)):t}),o),n.openStart,n.openEnd);return kn.fromReplace(t,this.from,this.to,i)},e.prototype.invert=function(){return new Fn(this.from,this.to,this.mark)},e.prototype.map=function(t){var n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new e(n.pos,r.pos,this.mark)},e.prototype.merge=function(t){if(t instanceof e&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from)return new e(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark)},e.prototype.toJSON=function(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},e.fromJSON=function(t,n){if("number"!=typeof n.from||"number"!=typeof n.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new e(n.from,n.to,t.markFromJSON(n.mark))},e}(bn);bn.jsonID("addMark",Pn);var Fn=function(t){function e(e,n,r){t.call(this),this.from=e,this.to=n,this.mark=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(t){var e=this,n=t.slice(this.from,this.to),r=new qt(In(n.content,(function(t){return t.mark(e.mark.removeFromSet(t.marks))})),n.openStart,n.openEnd);return kn.fromReplace(t,this.from,this.to,r)},e.prototype.invert=function(){return new Pn(this.from,this.to,this.mark)},e.prototype.map=function(t){var n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new e(n.pos,r.pos,this.mark)},e.prototype.merge=function(t){if(t instanceof e&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from)return new e(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark)},e.prototype.toJSON=function(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},e.fromJSON=function(t,n){if("number"!=typeof n.from||"number"!=typeof n.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new e(n.from,n.to,t.markFromJSON(n.mark))},e}(bn);function Bn(t,e,n,r){if(void 0===n&&(n=e),void 0===r&&(r=qt.empty),e==n&&!r.size)return null;var o=t.resolve(e),i=t.resolve(n);return $n(o,i,r)?new Sn(e,n,r):new _n(o,i,r).fit()}function $n(t,e,n){return!n.openStart&&!n.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),n.content)}bn.jsonID("removeMark",Fn),gn.prototype.addMark=function(t,e,n){var r=this,o=[],i=[],s=null,a=null;return this.doc.nodesBetween(t,e,(function(r,c,h){if(r.isInline){var p=r.marks;if(!n.isInSet(p)&&h.type.allowsMarkType(n.type)){for(var l=Math.max(c,t),u=Math.min(c+r.nodeSize,e),f=n.addToSet(p),d=0;d<p.length;d++)p[d].isInSet(f)||(s&&s.to==l&&s.mark.eq(p[d])?s.to=u:o.push(s=new Fn(l,u,p[d])));a&&a.to==l?a.to=u:i.push(a=new Pn(l,u,n))}}})),o.forEach((function(t){return r.step(t)})),i.forEach((function(t){return r.step(t)})),this},gn.prototype.removeMark=function(t,e,n){var r=this;void 0===n&&(n=null);var o=[],i=0;return this.doc.nodesBetween(t,e,(function(r,s){if(r.isInline){i++;var a=null;if(n instanceof _e){var c=n.isInSet(r.marks);c&&(a=[c])}else n?n.isInSet(r.marks)&&(a=[n]):a=r.marks;if(a&&a.length)for(var h=Math.min(s+r.nodeSize,e),p=0;p<a.length;p++){for(var l=a[p],u=void 0,f=0;f<o.length;f++){var d=o[f];d.step==i-1&&l.eq(o[f].style)&&(u=d)}u?(u.to=h,u.step=i):o.push({style:l,from:Math.max(s,t),to:h,step:i})}}})),o.forEach((function(t){return r.step(new Fn(t.from,t.to,t.style))})),this},gn.prototype.clearIncompatible=function(t,e,n){void 0===n&&(n=e.contentMatch);for(var r=this.doc.nodeAt(t),o=[],i=t+1,s=0;s<r.childCount;s++){var a=r.child(s),c=i+a.nodeSize,h=n.matchType(a.type,a.attrs);if(h){n=h;for(var p=0;p<a.marks.length;p++)e.allowsMarkType(a.marks[p].type)||this.step(new Fn(i,c,a.marks[p]))}else o.push(new Sn(i,c,qt.empty));i=c}if(!n.validEnd){var l=n.fillBefore(Bt.empty,!0);this.replace(i,i,new qt(l,0,0))}for(var u=o.length-1;u>=0;u--)this.step(o[u]);return this},gn.prototype.replace=function(t,e,n){void 0===e&&(e=t),void 0===n&&(n=qt.empty);var r=Bn(this.doc,t,e,n);return r&&this.step(r),this},gn.prototype.replaceWith=function(t,e,n){return this.replace(t,e,new qt(Bt.from(n),0,0))},gn.prototype.delete=function(t,e){return this.replace(t,e,qt.empty)},gn.prototype.insert=function(t,e){return this.replaceWith(t,t,e)};var _n=function(t,e,n){this.$to=e,this.$from=t,this.unplaced=n,this.frontier=[];for(var r=0;r<=t.depth;r++){var o=t.node(r);this.frontier.push({type:o.type,match:o.contentMatchAt(t.indexAfter(r))})}this.placed=Bt.empty;for(var i=t.depth;i>0;i--)this.placed=Bt.from(t.node(i).copy(this.placed))},jn={depth:{configurable:!0}};function Jn(t,e,n){return 0==e?t.cutByIndex(n):t.replaceChild(0,t.firstChild.copy(Jn(t.firstChild.content,e-1,n)))}function Ln(t,e,n){return 0==e?t.append(n):t.replaceChild(t.childCount-1,t.lastChild.copy(Ln(t.lastChild.content,e-1,n)))}function Vn(t,e){for(var n=0;n<e;n++)t=t.firstChild.content;return t}function qn(t,e,n){if(e<=0)return t;var r=t.content;return e>1&&(r=r.replaceChild(0,qn(r.firstChild,e-1,1==r.childCount?n-1:0))),e>0&&(r=t.type.contentMatch.fillBefore(r).append(r),n<=0&&(r=r.append(t.type.contentMatch.matchFragment(r).fillBefore(Bt.empty,!0)))),t.copy(r)}function Wn(t,e,n,r,o){var i=t.node(e),s=o?t.indexAfter(e):t.index(e);if(s==i.childCount&&!n.compatibleContent(i.type))return null;var a=r.fillBefore(i.content,!0,s);return a&&!Hn(n,i.content,s)?a:null}function Hn(t,e,n){for(var r=n;r<e.childCount;r++)if(!t.allowsMarks(e.child(r).marks))return!0;return!1}function Kn(t,e,n,r,o){if(e<n){var i=t.firstChild;t=t.replaceChild(0,i.copy(Kn(i.content,e+1,n,r,i)))}if(e>r){var s=o.contentMatchAt(0),a=s.fillBefore(t).append(t);t=a.append(s.matchFragment(a).fillBefore(Bt.empty,!0))}return t}function Un(t,e){for(var n=[],r=Math.min(t.depth,e.depth),o=r;o>=0;o--){var i=t.start(o);if(i<t.pos-(t.depth-o)||e.end(o)>e.pos+(e.depth-o)||t.node(o).type.spec.isolating||e.node(o).type.spec.isolating)break;i==e.start(o)&&n.push(o)}return n}jn.depth.get=function(){return this.frontier.length-1},_n.prototype.fit=function(){while(this.unplaced.size){var t=this.findFittable();t?this.placeNodes(t):this.openMore()||this.dropNode()}var e=this.mustMoveInline(),n=this.placed.size-this.depth-this.$from.depth,r=this.$from,o=this.close(e<0?this.$to:r.doc.resolve(e));if(!o)return null;var i=this.placed,s=r.depth,a=o.depth;while(s&&a&&1==i.childCount)i=i.firstChild.content,s--,a--;var c=new qt(i,s,a);return e>-1?new On(r.pos,e,this.$to.pos,this.$to.end(),c,n):c.size||r.pos!=this.$to.pos?new Sn(r.pos,o.pos,c):void 0},_n.prototype.findFittable=function(){for(var t=1;t<=2;t++)for(var e=this.unplaced.openStart;e>=0;e--){var n=void 0,r=void 0;e?(r=Vn(this.unplaced.content,e-1).firstChild,n=r.content):n=this.unplaced.content;for(var o=n.firstChild,i=this.depth;i>=0;i--){var s=this.frontier[i],a=s.type,c=s.match,h=void 0,p=void 0;if(1==t&&(o?c.matchType(o.type)||(p=c.fillBefore(Bt.from(o),!1)):a.compatibleContent(r.type)))return{sliceDepth:e,frontierDepth:i,parent:r,inject:p};if(2==t&&o&&(h=c.findWrapping(o.type)))return{sliceDepth:e,frontierDepth:i,parent:r,wrap:h};if(r&&c.matchType(r.type))break}}},_n.prototype.openMore=function(){var t=this.unplaced,e=t.content,n=t.openStart,r=t.openEnd,o=Vn(e,n);return!(!o.childCount||o.firstChild.isLeaf)&&(this.unplaced=new qt(e,n+1,Math.max(r,o.size+n>=e.size-r?n+1:0)),!0)},_n.prototype.dropNode=function(){var t=this.unplaced,e=t.content,n=t.openStart,r=t.openEnd,o=Vn(e,n);if(o.childCount<=1&&n>0){var i=e.size-n<=n+o.size;this.unplaced=new qt(Jn(e,n-1,1),n-1,i?n-1:r)}else this.unplaced=new qt(Jn(e,n,1),n,r)},_n.prototype.placeNodes=function(t){var e=t.sliceDepth,n=t.frontierDepth,r=t.parent,o=t.inject,i=t.wrap;while(this.depth>n)this.closeFrontierNode();if(i)for(var s=0;s<i.length;s++)this.openFrontierNode(i[s]);var a=this.unplaced,c=r?r.content:a.content,h=a.openStart-e,p=0,l=[],u=this.frontier[n],f=u.match,d=u.type;if(o){for(var m=0;m<o.childCount;m++)l.push(o.child(m));f=f.matchFragment(o)}var v=c.size+e-(a.content.size-a.openEnd);while(p<c.childCount){var g=c.child(p),y=f.matchType(g.type);if(!y)break;p++,(p>1||0==h||g.content.size)&&(f=y,l.push(qn(g.mark(d.allowedMarks(g.marks)),1==p?h:0,p==c.childCount?v:-1)))}var w=p==c.childCount;w||(v=-1),w&&v<0&&r&&r.type==this.frontier[this.depth].type?this.closeFrontierNode():this.frontier[n].match=f;for(var x=0,b=c;x<v;x++){var k=b.lastChild;this.frontier.push({type:k.type,match:k.contentMatchAt(k.childCount)}),b=k.content}this.unplaced=w?0==e?qt.empty:new qt(Jn(a.content,e-1,1),e-1,v<0?a.openEnd:e-1):new qt(Jn(a.content,e,p),a.openStart,a.openEnd),this.placed=Ln(this.placed,n,Bt.from(l))},_n.prototype.mustMoveInline=function(){if(!this.$to.parent.isTextblock||this.$to.end()==this.$to.pos)return-1;var t,e=this.frontier[this.depth];if(!e.type.isTextblock||!Wn(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;var n=this.$to,r=n.depth,o=this.$to.after(r);while(r>1&&o==this.$to.end(--r))++o;return o},_n.prototype.findCloseLevel=function(t){t:for(var e=Math.min(this.depth,t.depth);e>=0;e--){var n=this.frontier[e],r=n.match,o=n.type,i=e<t.depth&&t.end(e+1)==t.pos+(t.depth-(e+1)),s=Wn(t,e,o,r,i);if(s){for(var a=e-1;a>=0;a--){var c=this.frontier[a],h=c.match,p=c.type,l=Wn(t,a,p,h,!0);if(!l||l.childCount)continue t}return{depth:e,fit:s,move:i?t.doc.resolve(t.after(e+1)):t}}}},_n.prototype.close=function(t){var e=this.findCloseLevel(t);if(!e)return null;while(this.depth>e.depth)this.closeFrontierNode();e.fit.childCount&&(this.placed=Ln(this.placed,e.depth,e.fit)),t=e.move;for(var n=e.depth+1;n<=t.depth;n++){var r=t.node(n),o=r.type.contentMatch.fillBefore(r.content,!0,t.index(n));this.openFrontierNode(r.type,r.attrs,o)}return t},_n.prototype.openFrontierNode=function(t,e,n){var r=this.frontier[this.depth];r.match=r.match.matchType(t),this.placed=Ln(this.placed,this.depth,Bt.from(t.create(e,n))),this.frontier.push({type:t,match:t.contentMatch})},_n.prototype.closeFrontierNode=function(){var t=this.frontier.pop(),e=t.match.fillBefore(Bt.empty,!0);e.childCount&&(this.placed=Ln(this.placed,this.frontier.length,e))},Object.defineProperties(_n.prototype,jn),gn.prototype.replaceRange=function(t,e,n){if(!n.size)return this.deleteRange(t,e);var r=this.doc.resolve(t),o=this.doc.resolve(e);if($n(r,o,n))return this.step(new Sn(t,e,n));var i=Un(r,this.doc.resolve(e));0==i[i.length-1]&&i.pop();var s=-(r.depth+1);i.unshift(s);for(var a=r.depth,c=r.pos-1;a>0;a--,c--){var h=r.node(a).type.spec;if(h.defining||h.isolating)break;i.indexOf(a)>-1?s=a:r.before(a)==c&&i.splice(1,0,-a)}for(var p=i.indexOf(s),l=[],u=n.openStart,f=n.content,d=0;;d++){var m=f.firstChild;if(l.push(m),d==n.openStart)break;f=m.content}u>0&&l[u-1].type.spec.defining&&r.node(p).type!=l[u-1].type?u-=1:u>=2&&l[u-1].isTextblock&&l[u-2].type.spec.defining&&r.node(p).type!=l[u-2].type&&(u-=2);for(var v=n.openStart;v>=0;v--){var g=(v+u+1)%(n.openStart+1),y=l[g];if(y)for(var w=0;w<i.length;w++){var x=i[(w+p)%i.length],b=!0;x<0&&(b=!1,x=-x);var k=r.node(x-1),S=r.index(x-1);if(k.canReplaceWith(S,S,y.type,y.marks))return this.replace(r.before(x),b?o.after(x):e,new qt(Kn(n.content,0,n.openStart,g),g,n.openEnd))}}for(var O=this.steps.length,C=i.length-1;C>=0;C--){if(this.replace(t,e,n),this.steps.length>O)break;var M=i[C];C<0||(t=r.before(M),e=o.after(M))}return this},gn.prototype.replaceRangeWith=function(t,e,n){if(!n.isInline&&t==e&&this.doc.resolve(t).parent.content.size){var r=Rn(this.doc,t,n.type);null!=r&&(t=e=r)}return this.replaceRange(t,e,new qt(Bt.from(n),0,0))},gn.prototype.deleteRange=function(t,e){for(var n=this.doc.resolve(t),r=this.doc.resolve(e),o=Un(n,r),i=0;i<o.length;i++){var s=o[i],a=i==o.length-1;if(a&&0==s||n.node(s).type.contentMatch.validEnd)return this.delete(n.start(s),r.end(s));if(s>0&&(a||n.node(s-1).canReplace(n.index(s-1),r.indexAfter(s-1))))return this.delete(n.before(s),r.after(s))}for(var c=1;c<=n.depth&&c<=r.depth;c++)if(t-n.start(c)==n.depth-c&&e>n.end(c)&&r.end(c)-e!=r.depth-c)return this.delete(n.before(c),e);return this.delete(t,e)};var Gn=Object.create(null),Xn=function(t,e,n){this.ranges=n||[new Zn(t.min(e),t.max(e))],this.$anchor=t,this.$head=e},Yn={anchor:{configurable:!0},head:{configurable:!0},from:{configurable:!0},to:{configurable:!0},$from:{configurable:!0},$to:{configurable:!0},empty:{configurable:!0}};Yn.anchor.get=function(){return this.$anchor.pos},Yn.head.get=function(){return this.$head.pos},Yn.from.get=function(){return this.$from.pos},Yn.to.get=function(){return this.$to.pos},Yn.$from.get=function(){return this.ranges[0].$from},Yn.$to.get=function(){return this.ranges[0].$to},Yn.empty.get=function(){for(var t=this.ranges,e=0;e<t.length;e++)if(t[e].$from.pos!=t[e].$to.pos)return!1;return!0},Xn.prototype.content=function(){return this.$from.node(0).slice(this.from,this.to,!0)},Xn.prototype.replace=function(t,e){void 0===e&&(e=y.empty);for(var n=e.content.lastChild,r=null,o=0;o<e.openEnd;o++)r=n,n=n.lastChild;for(var i=t.steps.length,s=this.ranges,a=0;a<s.length;a++){var c=s[a],h=c.$from,p=c.$to,l=t.mapping.slice(i);t.replaceRange(l.map(h.pos),l.map(p.pos),a?y.empty:e),0==a&&sr(t,i,(n?n.isInline:r&&r.isTextblock)?-1:1)}},Xn.prototype.replaceWith=function(t,e){for(var n=t.steps.length,r=this.ranges,o=0;o<r.length;o++){var i=r[o],s=i.$from,a=i.$to,c=t.mapping.slice(n),h=c.map(s.pos),p=c.map(a.pos);o?t.deleteRange(h,p):(t.replaceRangeWith(h,p,e),sr(t,n,e.isInline?-1:1))}},Xn.findFrom=function(t,e,n){var r=t.parent.inlineContent?new Qn(t):ir(t.node(0),t.parent,t.pos,t.index(),e,n);if(r)return r;for(var o=t.depth-1;o>=0;o--){var i=e<0?ir(t.node(0),t.node(o),t.before(o+1),t.index(o),e,n):ir(t.node(0),t.node(o),t.after(o+1),t.index(o)+1,e,n);if(i)return i}},Xn.near=function(t,e){return void 0===e&&(e=1),this.findFrom(t,e)||this.findFrom(t,-e)||new rr(t.node(0))},Xn.atStart=function(t){return ir(t,t,0,0,1)||new rr(t)},Xn.atEnd=function(t){return ir(t,t,t.content.size,t.childCount,-1)||new rr(t)},Xn.fromJSON=function(t,e){if(!e||!e.type)throw new RangeError("Invalid input for Selection.fromJSON");var n=Gn[e.type];if(!n)throw new RangeError("No selection type "+e.type+" defined");return n.fromJSON(t,e)},Xn.jsonID=function(t,e){if(t in Gn)throw new RangeError("Duplicate use of selection JSON ID "+t);return Gn[t]=e,e.prototype.jsonID=t,e},Xn.prototype.getBookmark=function(){return Qn.between(this.$anchor,this.$head).getBookmark()},Object.defineProperties(Xn.prototype,Yn),Xn.prototype.visible=!0;var Zn=function(t,e){this.$from=t,this.$to=e},Qn=function(t){function e(e,n){void 0===n&&(n=e),t.call(this,e,n)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={$cursor:{configurable:!0}};return n.$cursor.get=function(){return this.$anchor.pos==this.$head.pos?this.$head:null},e.prototype.map=function(n,r){var o=n.resolve(r.map(this.head));if(!o.parent.inlineContent)return t.near(o);var i=n.resolve(r.map(this.anchor));return new e(i.parent.inlineContent?i:o,o)},e.prototype.replace=function(e,n){if(void 0===n&&(n=y.empty),t.prototype.replace.call(this,e,n),n==y.empty){var r=this.$from.marksAcross(this.$to);r&&e.ensureMarks(r)}},e.prototype.eq=function(t){return t instanceof e&&t.anchor==this.anchor&&t.head==this.head},e.prototype.getBookmark=function(){return new tr(this.anchor,this.head)},e.prototype.toJSON=function(){return{type:"text",anchor:this.anchor,head:this.head}},e.fromJSON=function(t,n){if("number"!=typeof n.anchor||"number"!=typeof n.head)throw new RangeError("Invalid input for TextSelection.fromJSON");return new e(t.resolve(n.anchor),t.resolve(n.head))},e.create=function(t,e,n){void 0===n&&(n=e);var r=t.resolve(e);return new this(r,n==e?r:t.resolve(n))},e.between=function(n,r,o){var i=n.pos-r.pos;if(o&&!i||(o=i>=0?1:-1),!r.parent.inlineContent){var s=t.findFrom(r,o,!0)||t.findFrom(r,-o,!0);if(!s)return t.near(r,o);r=s.$head}return n.parent.inlineContent||(0==i?n=r:(n=(t.findFrom(n,-o,!0)||t.findFrom(n,o,!0)).$anchor,n.pos<r.pos!=i<0&&(n=r))),new e(n,r)},Object.defineProperties(e.prototype,n),e}(Xn);Xn.jsonID("text",Qn);var tr=function(t,e){this.anchor=t,this.head=e};tr.prototype.map=function(t){return new tr(t.map(this.anchor),t.map(this.head))},tr.prototype.resolve=function(t){return Qn.between(t.resolve(this.anchor),t.resolve(this.head))};var er=function(t){function e(e){var n=e.nodeAfter,r=e.node(0).resolve(e.pos+n.nodeSize);t.call(this,e,r),this.node=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.map=function(n,r){var o=r.mapResult(this.anchor),i=o.deleted,s=o.pos,a=n.resolve(s);return i?t.near(a):new e(a)},e.prototype.content=function(){return new y(l.from(this.node),0,0)},e.prototype.eq=function(t){return t instanceof e&&t.anchor==this.anchor},e.prototype.toJSON=function(){return{type:"node",anchor:this.anchor}},e.prototype.getBookmark=function(){return new nr(this.anchor)},e.fromJSON=function(t,n){if("number"!=typeof n.anchor)throw new RangeError("Invalid input for NodeSelection.fromJSON");return new e(t.resolve(n.anchor))},e.create=function(t,e){return new this(t.resolve(e))},e.isSelectable=function(t){return!t.isText&&!1!==t.type.spec.selectable},e}(Xn);er.prototype.visible=!1,Xn.jsonID("node",er);var nr=function(t){this.anchor=t};nr.prototype.map=function(t){var e=t.mapResult(this.anchor),n=e.deleted,r=e.pos;return n?new tr(r,r):new nr(r)},nr.prototype.resolve=function(t){var e=t.resolve(this.anchor),n=e.nodeAfter;return n&&er.isSelectable(n)?new er(e):Xn.near(e)};var rr=function(t){function e(e){t.call(this,e.resolve(0),e.resolve(e.content.size))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.replace=function(e,n){if(void 0===n&&(n=y.empty),n==y.empty){e.delete(0,e.doc.content.size);var r=t.atStart(e.doc);r.eq(e.selection)||e.setSelection(r)}else t.prototype.replace.call(this,e,n)},e.prototype.toJSON=function(){return{type:"all"}},e.fromJSON=function(t){return new e(t)},e.prototype.map=function(t){return new e(t)},e.prototype.eq=function(t){return t instanceof e},e.prototype.getBookmark=function(){return or},e}(Xn);Xn.jsonID("all",rr);var or={map:function(){return this},resolve:function(t){return new rr(t)}};function ir(t,e,n,r,o,i){if(e.inlineContent)return Qn.create(t,n);for(var s=r-(o>0?0:1);o>0?s<e.childCount:s>=0;s+=o){var a=e.child(s);if(a.isAtom){if(!i&&er.isSelectable(a))return er.create(t,n-(o<0?a.nodeSize:0))}else{var c=ir(t,a,n+o,o<0?a.childCount:0,o,i);if(c)return c}n+=a.nodeSize*o}}function sr(t,e,n){var r=t.steps.length-1;if(!(r<e)){var o=t.steps[r];if(o instanceof Sn||o instanceof On){var i,s=t.mapping.maps[r];s.forEach((function(t,e,n,r){null==i&&(i=r)})),t.setSelection(Xn.near(t.doc.resolve(i),n))}}}var ar=1,cr=2,hr=4,pr=function(t){function e(e){t.call(this,e.doc),this.time=Date.now(),this.curSelection=e.selection,this.curSelectionFor=0,this.storedMarks=e.storedMarks,this.updated=0,this.meta=Object.create(null)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={selection:{configurable:!0},selectionSet:{configurable:!0},storedMarksSet:{configurable:!0},isGeneric:{configurable:!0},scrolledIntoView:{configurable:!0}};return n.selection.get=function(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection},e.prototype.setSelection=function(t){if(t.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=t,this.curSelectionFor=this.steps.length,this.updated=(this.updated|ar)&~cr,this.storedMarks=null,this},n.selectionSet.get=function(){return(this.updated&ar)>0},e.prototype.setStoredMarks=function(t){return this.storedMarks=t,this.updated|=cr,this},e.prototype.ensureMarks=function(t){return v.sameSet(this.storedMarks||this.selection.$from.marks(),t)||this.setStoredMarks(t),this},e.prototype.addStoredMark=function(t){return this.ensureMarks(t.addToSet(this.storedMarks||this.selection.$head.marks()))},e.prototype.removeStoredMark=function(t){return this.ensureMarks(t.removeFromSet(this.storedMarks||this.selection.$head.marks()))},n.storedMarksSet.get=function(){return(this.updated&cr)>0},e.prototype.addStep=function(e,n){t.prototype.addStep.call(this,e,n),this.updated=this.updated&~cr,this.storedMarks=null},e.prototype.setTime=function(t){return this.time=t,this},e.prototype.replaceSelection=function(t){return this.selection.replace(this,t),this},e.prototype.replaceSelectionWith=function(t,e){var n=this.selection;return!1!==e&&(t=t.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||v.none))),n.replaceWith(this,t),this},e.prototype.deleteSelection=function(){return this.selection.replace(this),this},e.prototype.insertText=function(t,e,n){void 0===n&&(n=e);var r=this.doc.type.schema;if(null==e)return t?this.replaceSelectionWith(r.text(t),!0):this.deleteSelection();if(!t)return this.deleteRange(e,n);var o=this.storedMarks;if(!o){var i=this.doc.resolve(e);o=n==e?i.marks():i.marksAcross(this.doc.resolve(n))}return this.replaceRangeWith(e,n,r.text(t,o)),this.selection.empty||this.setSelection(Xn.near(this.selection.$to)),this},e.prototype.setMeta=function(t,e){return this.meta["string"==typeof t?t:t.key]=e,this},e.prototype.getMeta=function(t){return this.meta["string"==typeof t?t:t.key]},n.isGeneric.get=function(){for(var t in this.meta)return!1;return!0},e.prototype.scrollIntoView=function(){return this.updated|=hr,this},n.scrolledIntoView.get=function(){return(this.updated&hr)>0},Object.defineProperties(e.prototype,n),e}(gn);function lr(t,e){return e&&t?t.bind(e):t}var ur=function(t,e,n){this.name=t,this.init=lr(e.init,n),this.apply=lr(e.apply,n)},fr=[new ur("doc",{init:function(t){return t.doc||t.schema.topNodeType.createAndFill()},apply:function(t){return t.doc}}),new ur("selection",{init:function(t,e){return t.selection||Xn.atStart(e.doc)},apply:function(t){return t.selection}}),new ur("storedMarks",{init:function(t){return t.storedMarks||null},apply:function(t,e,n,r){return r.selection.$cursor?t.storedMarks:null}}),new ur("scrollToSelection",{init:function(){return 0},apply:function(t,e){return t.scrolledIntoView?e+1:e}})],dr=function(t,e){var n=this;this.schema=t,this.fields=fr.concat(),this.plugins=[],this.pluginsByKey=Object.create(null),e&&e.forEach((function(t){if(n.pluginsByKey[t.key])throw new RangeError("Adding different instances of a keyed plugin ("+t.key+")");n.plugins.push(t),n.pluginsByKey[t.key]=t,t.spec.state&&n.fields.push(new ur(t.key,t.spec.state,t))}))},mr=function(t){this.config=t},vr={schema:{configurable:!0},plugins:{configurable:!0},tr:{configurable:!0}};vr.schema.get=function(){return this.config.schema},vr.plugins.get=function(){return this.config.plugins},mr.prototype.apply=function(t){return this.applyTransaction(t).state},mr.prototype.filterTransaction=function(t,e){void 0===e&&(e=-1);for(var n=0;n<this.config.plugins.length;n++)if(n!=e){var r=this.config.plugins[n];if(r.spec.filterTransaction&&!r.spec.filterTransaction.call(r,t,this))return!1}return!0},mr.prototype.applyTransaction=function(t){if(!this.filterTransaction(t))return{state:this,transactions:[]};for(var e=[t],n=this.applyInner(t),r=null;;){for(var o=!1,i=0;i<this.config.plugins.length;i++){var s=this.config.plugins[i];if(s.spec.appendTransaction){var a=r?r[i].n:0,c=r?r[i].state:this,h=a<e.length&&s.spec.appendTransaction.call(s,a?e.slice(a):e,c,n);if(h&&n.filterTransaction(h,i)){if(h.setMeta("appendedTransaction",t),!r){r=[];for(var p=0;p<this.config.plugins.length;p++)r.push(p<i?{state:n,n:e.length}:{state:this,n:0})}e.push(h),n=n.applyInner(h),o=!0}r&&(r[i]={state:n,n:e.length})}}if(!o)return{state:n,transactions:e}}},mr.prototype.applyInner=function(t){if(!t.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");for(var e=new mr(this.config),n=this.config.fields,r=0;r<n.length;r++){var o=n[r];e[o.name]=o.apply(t,this[o.name],this,e)}for(var i=0;i<gr.length;i++)gr[i](this,t,e);return e},vr.tr.get=function(){return new pr(this)},mr.create=function(t){for(var e=new dr(t.doc?t.doc.type.schema:t.schema,t.plugins),n=new mr(e),r=0;r<e.fields.length;r++)n[e.fields[r].name]=e.fields[r].init(t,n);return n},mr.prototype.reconfigure=function(t){for(var e=new dr(this.schema,t.plugins),n=e.fields,r=new mr(e),o=0;o<n.length;o++){var i=n[o].name;r[i]=this.hasOwnProperty(i)?this[i]:n[o].init(t,r)}return r},mr.prototype.toJSON=function(t){var e={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(e.storedMarks=this.storedMarks.map((function(t){return t.toJSON()}))),t&&"object"==typeof t)for(var n in t){if("doc"==n||"selection"==n)throw new RangeError("The JSON fields `doc` and `selection` are reserved");var r=t[n],o=r.spec.state;o&&o.toJSON&&(e[n]=o.toJSON.call(r,this[r.key]))}return e},mr.fromJSON=function(t,e,n){if(!e)throw new RangeError("Invalid input for EditorState.fromJSON");if(!t.schema)throw new RangeError("Required config field 'schema' missing");var r=new dr(t.schema,t.plugins),o=new mr(r);return r.fields.forEach((function(r){if("doc"==r.name)o.doc=j.fromJSON(t.schema,e.doc);else if("selection"==r.name)o.selection=Xn.fromJSON(o.doc,e.selection);else if("storedMarks"==r.name)e.storedMarks&&(o.storedMarks=e.storedMarks.map(t.schema.markFromJSON));else{if(n)for(var i in n){var s=n[i],a=s.spec.state;if(s.key==r.name&&a&&a.fromJSON&&Object.prototype.hasOwnProperty.call(e,i))return void(o[r.name]=a.fromJSON.call(s,t,e[i],o))}o[r.name]=r.init(t,o)}})),o},mr.addApplyListener=function(t){gr.push(t)},mr.removeApplyListener=function(t){var e=gr.indexOf(t);e>-1&&gr.splice(e,1)},Object.defineProperties(mr.prototype,vr);var gr=[];function yr(t,e,n){for(var r in t){var o=t[r];o instanceof Function?o=o.bind(e):"handleDOMEvents"==r&&(o=yr(o,e,{})),n[r]=o}return n}var wr=function(t){this.props={},t.props&&yr(t.props,this,this.props),this.spec=t,this.key=t.key?t.key.key:br("plugin")};wr.prototype.getState=function(t){return t[this.key]};var xr=Object.create(null);function br(t){return t in xr?t+"$"+ ++xr[t]:(xr[t]=0,t+"$")}var kr=function(t){void 0===t&&(t="key"),this.key=br(t)};function Sr(t,e,n){for(var r=0;;r++){if(r==t.childCount||r==e.childCount)return t.childCount==e.childCount?null:n;var o=t.child(r),i=e.child(r);if(o!=i){if(!o.sameMarkup(i))return n;if(o.isText&&o.text!=i.text){for(var s=0;o.text[s]==i.text[s];s++)n++;return n}if(o.content.size||i.content.size){var a=Sr(o.content,i.content,n+1);if(null!=a)return a}n+=o.nodeSize}else n+=o.nodeSize}}function Or(t,e,n,r){for(var o=t.childCount,i=e.childCount;;){if(0==o||0==i)return o==i?null:{a:n,b:r};var s=t.child(--o),a=e.child(--i),c=s.nodeSize;if(s!=a){if(!s.sameMarkup(a))return{a:n,b:r};if(s.isText&&s.text!=a.text){var h=0,p=Math.min(s.text.length,a.text.length);while(h<p&&s.text[s.text.length-h-1]==a.text[a.text.length-h-1])h++,n--,r--;return{a:n,b:r}}if(s.content.size||a.content.size){var l=Or(s.content,a.content,n-1,r-1);if(l)return l}n-=c,r-=c}else n-=c,r-=c}}kr.prototype.get=function(t){return t.config.pluginsByKey[this.key]},kr.prototype.getState=function(t){return t[this.key]};var Cr=function(t,e){if(this.content=t,this.size=e||0,null==e)for(var n=0;n<t.length;n++)this.size+=t[n].nodeSize},Mr={firstChild:{configurable:!0},lastChild:{configurable:!0},childCount:{configurable:!0}};Cr.prototype.nodesBetween=function(t,e,n,r,o){void 0===r&&(r=0);for(var i=0,s=0;s<e;i++){var a=this.content[i],c=s+a.nodeSize;if(c>t&&!1!==n(a,r+s,o,i)&&a.content.size){var h=s+1;a.nodesBetween(Math.max(0,t-h),Math.min(a.content.size,e-h),n,r+h)}s=c}},Cr.prototype.descendants=function(t){this.nodesBetween(0,this.size,t)},Cr.prototype.textBetween=function(t,e,n,r){var o="",i=!0;return this.nodesBetween(t,e,(function(s,a){s.isText?(o+=s.text.slice(Math.max(t,a)-a,e-a),i=!n):s.isLeaf&&r?(o+=r,i=!n):!i&&s.isBlock&&(o+=n,i=!0)}),0),o},Cr.prototype.append=function(t){if(!t.size)return this;if(!this.size)return t;var e=this.lastChild,n=t.firstChild,r=this.content.slice(),o=0;for(e.isText&&e.sameMarkup(n)&&(r[r.length-1]=e.withText(e.text+n.text),o=1);o<t.content.length;o++)r.push(t.content[o]);return new Cr(r,this.size+t.size)},Cr.prototype.cut=function(t,e){if(null==e&&(e=this.size),0==t&&e==this.size)return this;var n=[],r=0;if(e>t)for(var o=0,i=0;i<e;o++){var s=this.content[o],a=i+s.nodeSize;a>t&&((i<t||a>e)&&(s=s.isText?s.cut(Math.max(0,t-i),Math.min(s.text.length,e-i)):s.cut(Math.max(0,t-i-1),Math.min(s.content.size,e-i-1))),n.push(s),r+=s.nodeSize),i=a}return new Cr(n,r)},Cr.prototype.cutByIndex=function(t,e){return t==e?Cr.empty:0==t&&e==this.content.length?this:new Cr(this.content.slice(t,e))},Cr.prototype.replaceChild=function(t,e){var n=this.content[t];if(n==e)return this;var r=this.content.slice(),o=this.size+e.nodeSize-n.nodeSize;return r[t]=e,new Cr(r,o)},Cr.prototype.addToStart=function(t){return new Cr([t].concat(this.content),this.size+t.nodeSize)},Cr.prototype.addToEnd=function(t){return new Cr(this.content.concat(t),this.size+t.nodeSize)},Cr.prototype.eq=function(t){if(this.content.length!=t.content.length)return!1;for(var e=0;e<this.content.length;e++)if(!this.content[e].eq(t.content[e]))return!1;return!0},Mr.firstChild.get=function(){return this.content.length?this.content[0]:null},Mr.lastChild.get=function(){return this.content.length?this.content[this.content.length-1]:null},Mr.childCount.get=function(){return this.content.length},Cr.prototype.child=function(t){var e=this.content[t];if(!e)throw new RangeError("Index "+t+" out of range for "+this);return e},Cr.prototype.maybeChild=function(t){return this.content[t]},Cr.prototype.forEach=function(t){for(var e=0,n=0;e<this.content.length;e++){var r=this.content[e];t(r,n,e),n+=r.nodeSize}},Cr.prototype.findDiffStart=function(t,e){return void 0===e&&(e=0),Sr(this,t,e)},Cr.prototype.findDiffEnd=function(t,e,n){return void 0===e&&(e=this.size),void 0===n&&(n=t.size),Or(this,t,e,n)},Cr.prototype.findIndex=function(t,e){if(void 0===e&&(e=-1),0==t)return Tr(0,t);if(t==this.size)return Tr(this.content.length,t);if(t>this.size||t<0)throw new RangeError("Position "+t+" outside of fragment ("+this+")");for(var n=0,r=0;;n++){var o=this.child(n),i=r+o.nodeSize;if(i>=t)return i==t||e>0?Tr(n+1,i):Tr(n,r);r=i}},Cr.prototype.toString=function(){return"<"+this.toStringInner()+">"},Cr.prototype.toStringInner=function(){return this.content.join(", ")},Cr.prototype.toJSON=function(){return this.content.length?this.content.map((function(t){return t.toJSON()})):null},Cr.fromJSON=function(t,e){if(!e)return Cr.empty;if(!Array.isArray(e))throw new RangeError("Invalid input for Fragment.fromJSON");return new Cr(e.map(t.nodeFromJSON))},Cr.fromArray=function(t){if(!t.length)return Cr.empty;for(var e,n=0,r=0;r<t.length;r++){var o=t[r];n+=o.nodeSize,r&&o.isText&&t[r-1].sameMarkup(o)?(e||(e=t.slice(0,r)),e[e.length-1]=o.withText(e[e.length-1].text+o.text)):e&&e.push(o)}return new Cr(e||t,n)},Cr.from=function(t){if(!t)return Cr.empty;if(t instanceof Cr)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new Cr([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))},Object.defineProperties(Cr.prototype,Mr);var Nr={index:0,offset:0};function Tr(t,e){return Nr.index=t,Nr.offset=e,Nr}function Er(t,e){if(t===e)return!0;if(!t||"object"!=typeof t||!e||"object"!=typeof e)return!1;var n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(var r=0;r<t.length;r++)if(!Er(t[r],e[r]))return!1}else{for(var o in t)if(!(o in e)||!Er(t[o],e[o]))return!1;for(var i in e)if(!(i in t))return!1}return!0}Cr.empty=new Cr([],0);var Ar=function(t,e){this.type=t,this.attrs=e};function Dr(t){var e=Error.call(this,t);return e.__proto__=Dr.prototype,e}Ar.prototype.addToSet=function(t){for(var e,n=!1,r=0;r<t.length;r++){var o=t[r];if(this.eq(o))return t;if(this.type.excludes(o.type))e||(e=t.slice(0,r));else{if(o.type.excludes(this.type))return t;!n&&o.type.rank>this.type.rank&&(e||(e=t.slice(0,r)),e.push(this),n=!0),e&&e.push(o)}}return e||(e=t.slice()),n||e.push(this),e},Ar.prototype.removeFromSet=function(t){for(var e=0;e<t.length;e++)if(this.eq(t[e]))return t.slice(0,e).concat(t.slice(e+1));return t},Ar.prototype.isInSet=function(t){for(var e=0;e<t.length;e++)if(this.eq(t[e]))return!0;return!1},Ar.prototype.eq=function(t){return this==t||this.type==t.type&&Er(this.attrs,t.attrs)},Ar.prototype.toJSON=function(){var t={type:this.type.name};for(var e in this.attrs){t.attrs=this.attrs;break}return t},Ar.fromJSON=function(t,e){if(!e)throw new RangeError("Invalid input for Mark.fromJSON");var n=t.marks[e.type];if(!n)throw new RangeError("There is no mark type "+e.type+" in this schema");return n.create(e.attrs)},Ar.sameSet=function(t,e){if(t==e)return!0;if(t.length!=e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].eq(e[n]))return!1;return!0},Ar.setFrom=function(t){if(!t||0==t.length)return Ar.none;if(t instanceof Ar)return[t];var e=t.slice();return e.sort((function(t,e){return t.type.rank-e.type.rank})),e},Ar.none=[],Dr.prototype=Object.create(Error.prototype),Dr.prototype.constructor=Dr,Dr.prototype.name="ReplaceError";var Rr=function(t,e,n){this.content=t,this.openStart=e,this.openEnd=n},zr={size:{configurable:!0}};function Ir(t,e,n){var r=t.findIndex(e),o=r.index,i=r.offset,s=t.maybeChild(o),a=t.findIndex(n),c=a.index,h=a.offset;if(i==e||s.isText){if(h!=n&&!t.child(c).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(o!=c)throw new RangeError("Removing non-flat range");return t.replaceChild(o,s.copy(Ir(s.content,e-i-1,n-i-1)))}function Pr(t,e,n,r){var o=t.findIndex(e),i=o.index,s=o.offset,a=t.maybeChild(i);if(s==e||a.isText)return r&&!r.canReplace(i,i,n)?null:t.cut(0,e).append(n).append(t.cut(e));var c=Pr(a.content,e-s-1,n);return c&&t.replaceChild(i,a.copy(c))}function Fr(t,e,n){if(n.openStart>t.depth)throw new Dr("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new Dr("Inconsistent open depths");return Br(t,e,n,0)}function Br(t,e,n,r){var o=t.index(r),i=t.node(r);if(o==e.index(r)&&r<t.depth-n.openStart){var s=Br(t,e,n,r+1);return i.copy(i.content.replaceChild(o,s))}if(n.content.size){if(n.openStart||n.openEnd||t.depth!=r||e.depth!=r){var a=Wr(n,t),c=a.start,h=a.end;return Lr(i,Vr(t,c,h,e,r))}var p=t.parent,l=p.content;return Lr(p,l.cut(0,t.parentOffset).append(n.content).append(l.cut(e.parentOffset)))}return Lr(i,qr(t,e,r))}function $r(t,e){if(!e.type.compatibleContent(t.type))throw new Dr("Cannot join "+e.type.name+" onto "+t.type.name)}function _r(t,e,n){var r=t.node(n);return $r(r,e.node(n)),r}function jr(t,e){var n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function Jr(t,e,n,r){var o=(e||t).node(n),i=0,s=e?e.index(n):o.childCount;t&&(i=t.index(n),t.depth>n?i++:t.textOffset&&(jr(t.nodeAfter,r),i++));for(var a=i;a<s;a++)jr(o.child(a),r);e&&e.depth==n&&e.textOffset&&jr(e.nodeBefore,r)}function Lr(t,e){if(!t.type.validContent(e))throw new Dr("Invalid content for node "+t.type.name);return t.copy(e)}function Vr(t,e,n,r,o){var i=t.depth>o&&_r(t,e,o+1),s=r.depth>o&&_r(n,r,o+1),a=[];return Jr(null,t,o,a),i&&s&&e.index(o)==n.index(o)?($r(i,s),jr(Lr(i,Vr(t,e,n,r,o+1)),a)):(i&&jr(Lr(i,qr(t,e,o+1)),a),Jr(e,n,o,a),s&&jr(Lr(s,qr(n,r,o+1)),a)),Jr(r,null,o,a),new Cr(a)}function qr(t,e,n){var r=[];if(Jr(null,t,n,r),t.depth>n){var o=_r(t,e,n+1);jr(Lr(o,qr(t,e,n+1)),r)}return Jr(e,null,n,r),new Cr(r)}function Wr(t,e){for(var n=e.depth-t.openStart,r=e.node(n),o=r.copy(t.content),i=n-1;i>=0;i--)o=e.node(i).copy(Cr.from(o));return{start:o.resolveNoCache(t.openStart+n),end:o.resolveNoCache(o.content.size-t.openEnd-n)}}zr.size.get=function(){return this.content.size-this.openStart-this.openEnd},Rr.prototype.insertAt=function(t,e){var n=Pr(this.content,t+this.openStart,e,null);return n&&new Rr(n,this.openStart,this.openEnd)},Rr.prototype.removeBetween=function(t,e){return new Rr(Ir(this.content,t+this.openStart,e+this.openStart),this.openStart,this.openEnd)},Rr.prototype.eq=function(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd},Rr.prototype.toString=function(){return this.content+"("+this.openStart+","+this.openEnd+")"},Rr.prototype.toJSON=function(){if(!this.content.size)return null;var t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t},Rr.fromJSON=function(t,e){if(!e)return Rr.empty;var n=e.openStart||0,r=e.openEnd||0;if("number"!=typeof n||"number"!=typeof r)throw new RangeError("Invalid input for Slice.fromJSON");return new Rr(Cr.fromJSON(t,e.content),e.openStart||0,e.openEnd||0)},Rr.maxOpen=function(t,e){void 0===e&&(e=!0);for(var n=0,r=0,o=t.firstChild;o&&!o.isLeaf&&(e||!o.type.spec.isolating);o=o.firstChild)n++;for(var i=t.lastChild;i&&!i.isLeaf&&(e||!i.type.spec.isolating);i=i.lastChild)r++;return new Rr(t,n,r)},Object.defineProperties(Rr.prototype,zr),Rr.empty=new Rr(Cr.empty,0,0);var Hr=function(t,e,n){this.pos=t,this.path=e,this.depth=e.length/3-1,this.parentOffset=n},Kr={parent:{configurable:!0},doc:{configurable:!0},textOffset:{configurable:!0},nodeAfter:{configurable:!0},nodeBefore:{configurable:!0}};Hr.prototype.resolveDepth=function(t){return null==t?this.depth:t<0?this.depth+t:t},Kr.parent.get=function(){return this.node(this.depth)},Kr.doc.get=function(){return this.node(0)},Hr.prototype.node=function(t){return this.path[3*this.resolveDepth(t)]},Hr.prototype.index=function(t){return this.path[3*this.resolveDepth(t)+1]},Hr.prototype.indexAfter=function(t){return t=this.resolveDepth(t),this.index(t)+(t!=this.depth||this.textOffset?1:0)},Hr.prototype.start=function(t){return t=this.resolveDepth(t),0==t?0:this.path[3*t-1]+1},Hr.prototype.end=function(t){return t=this.resolveDepth(t),this.start(t)+this.node(t).content.size},Hr.prototype.before=function(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position before the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]},Hr.prototype.after=function(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position after the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]+this.path[3*t].nodeSize},Kr.textOffset.get=function(){return this.pos-this.path[this.path.length-1]},Kr.nodeAfter.get=function(){var t=this.parent,e=this.index(this.depth);if(e==t.childCount)return null;var n=this.pos-this.path[this.path.length-1],r=t.child(e);return n?t.child(e).cut(n):r},Kr.nodeBefore.get=function(){var t=this.index(this.depth),e=this.pos-this.path[this.path.length-1];return e?this.parent.child(t).cut(0,e):0==t?null:this.parent.child(t-1)},Hr.prototype.marks=function(){var t=this.parent,e=this.index();if(0==t.content.size)return Ar.none;if(this.textOffset)return t.child(e).marks;var n=t.maybeChild(e-1),r=t.maybeChild(e);if(!n){var o=n;n=r,r=o}for(var i=n.marks,s=0;s<i.length;s++)!1!==i[s].type.spec.inclusive||r&&i[s].isInSet(r.marks)||(i=i[s--].removeFromSet(i));return i},Hr.prototype.marksAcross=function(t){var e=this.parent.maybeChild(this.index());if(!e||!e.isInline)return null;for(var n=e.marks,r=t.parent.maybeChild(t.index()),o=0;o<n.length;o++)!1!==n[o].type.spec.inclusive||r&&n[o].isInSet(r.marks)||(n=n[o--].removeFromSet(n));return n},Hr.prototype.sharedDepth=function(t){for(var e=this.depth;e>0;e--)if(this.start(e)<=t&&this.end(e)>=t)return e;return 0},Hr.prototype.blockRange=function(t,e){if(void 0===t&&(t=this),t.pos<this.pos)return t.blockRange(this);for(var n=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);n>=0;n--)if(t.pos<=this.end(n)&&(!e||e(this.node(n))))return new Yr(this,t,n)},Hr.prototype.sameParent=function(t){return this.pos-this.parentOffset==t.pos-t.parentOffset},Hr.prototype.max=function(t){return t.pos>this.pos?t:this},Hr.prototype.min=function(t){return t.pos<this.pos?t:this},Hr.prototype.toString=function(){for(var t="",e=1;e<=this.depth;e++)t+=(t?"/":"")+this.node(e).type.name+"_"+this.index(e-1);return t+":"+this.parentOffset},Hr.resolve=function(t,e){if(!(e>=0&&e<=t.content.size))throw new RangeError("Position "+e+" out of range");for(var n=[],r=0,o=e,i=t;;){var s=i.content.findIndex(o),a=s.index,c=s.offset,h=o-c;if(n.push(i,a,r+c),!h)break;if(i=i.child(a),i.isText)break;o=h-1,r+=c+1}return new Hr(e,n,o)},Hr.resolveCached=function(t,e){for(var n=0;n<Ur.length;n++){var r=Ur[n];if(r.pos==e&&r.doc==t)return r}var o=Ur[Gr]=Hr.resolve(t,e);return Gr=(Gr+1)%Xr,o},Object.defineProperties(Hr.prototype,Kr);var Ur=[],Gr=0,Xr=12,Yr=function(t,e,n){this.$from=t,this.$to=e,this.depth=n},Zr={start:{configurable:!0},end:{configurable:!0},parent:{configurable:!0},startIndex:{configurable:!0},endIndex:{configurable:!0}};Zr.start.get=function(){return this.$from.before(this.depth+1)},Zr.end.get=function(){return this.$to.after(this.depth+1)},Zr.parent.get=function(){return this.$from.node(this.depth)},Zr.startIndex.get=function(){return this.$from.index(this.depth)},Zr.endIndex.get=function(){return this.$to.indexAfter(this.depth)},Object.defineProperties(Yr.prototype,Zr);var Qr=Object.create(null),to=function(t,e,n,r){this.type=t,this.attrs=e,this.content=n||Cr.empty,this.marks=r||Ar.none},eo={nodeSize:{configurable:!0},childCount:{configurable:!0},textContent:{configurable:!0},firstChild:{configurable:!0},lastChild:{configurable:!0},isBlock:{configurable:!0},isTextblock:{configurable:!0},inlineContent:{configurable:!0},isInline:{configurable:!0},isText:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};eo.nodeSize.get=function(){return this.isLeaf?1:2+this.content.size},eo.childCount.get=function(){return this.content.childCount},to.prototype.child=function(t){return this.content.child(t)},to.prototype.maybeChild=function(t){return this.content.maybeChild(t)},to.prototype.forEach=function(t){this.content.forEach(t)},to.prototype.nodesBetween=function(t,e,n,r){void 0===r&&(r=0),this.content.nodesBetween(t,e,n,r,this)},to.prototype.descendants=function(t){this.nodesBetween(0,this.content.size,t)},eo.textContent.get=function(){return this.textBetween(0,this.content.size,"")},to.prototype.textBetween=function(t,e,n,r){return this.content.textBetween(t,e,n,r)},eo.firstChild.get=function(){return this.content.firstChild},eo.lastChild.get=function(){return this.content.lastChild},to.prototype.eq=function(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)},to.prototype.sameMarkup=function(t){return this.hasMarkup(t.type,t.attrs,t.marks)},to.prototype.hasMarkup=function(t,e,n){return this.type==t&&Er(this.attrs,e||t.defaultAttrs||Qr)&&Ar.sameSet(this.marks,n||Ar.none)},to.prototype.copy=function(t){return void 0===t&&(t=null),t==this.content?this:new this.constructor(this.type,this.attrs,t,this.marks)},to.prototype.mark=function(t){return t==this.marks?this:new this.constructor(this.type,this.attrs,this.content,t)},to.prototype.cut=function(t,e){return 0==t&&e==this.content.size?this:this.copy(this.content.cut(t,e))},to.prototype.slice=function(t,e,n){if(void 0===e&&(e=this.content.size),void 0===n&&(n=!1),t==e)return Rr.empty;var r=this.resolve(t),o=this.resolve(e),i=n?0:r.sharedDepth(e),s=r.start(i),a=r.node(i),c=a.content.cut(r.pos-s,o.pos-s);return new Rr(c,r.depth-i,o.depth-i)},to.prototype.replace=function(t,e,n){return Fr(this.resolve(t),this.resolve(e),n)},to.prototype.nodeAt=function(t){for(var e=this;;){var n=e.content.findIndex(t),r=n.index,o=n.offset;if(e=e.maybeChild(r),!e)return null;if(o==t||e.isText)return e;t-=o+1}},to.prototype.childAfter=function(t){var e=this.content.findIndex(t),n=e.index,r=e.offset;return{node:this.content.maybeChild(n),index:n,offset:r}},to.prototype.childBefore=function(t){if(0==t)return{node:null,index:0,offset:0};var e=this.content.findIndex(t),n=e.index,r=e.offset;if(r<t)return{node:this.content.child(n),index:n,offset:r};var o=this.content.child(n-1);return{node:o,index:n-1,offset:r-o.nodeSize}},to.prototype.resolve=function(t){return Hr.resolveCached(this,t)},to.prototype.resolveNoCache=function(t){return Hr.resolve(this,t)},to.prototype.rangeHasMark=function(t,e,n){var r=!1;return e>t&&this.nodesBetween(t,e,(function(t){return n.isInSet(t.marks)&&(r=!0),!r})),r},eo.isBlock.get=function(){return this.type.isBlock},eo.isTextblock.get=function(){return this.type.isTextblock},eo.inlineContent.get=function(){return this.type.inlineContent},eo.isInline.get=function(){return this.type.isInline},eo.isText.get=function(){return this.type.isText},eo.isLeaf.get=function(){return this.type.isLeaf},eo.isAtom.get=function(){return this.type.isAtom},to.prototype.toString=function(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);var t=this.type.name;return this.content.size&&(t+="("+this.content.toStringInner()+")"),ro(this.marks,t)},to.prototype.contentMatchAt=function(t){var e=this.type.contentMatch.matchFragment(this.content,0,t);if(!e)throw new Error("Called contentMatchAt on a node with invalid content");return e},to.prototype.canReplace=function(t,e,n,r,o){void 0===n&&(n=Cr.empty),void 0===r&&(r=0),void 0===o&&(o=n.childCount);var i=this.contentMatchAt(t).matchFragment(n,r,o),s=i&&i.matchFragment(this.content,e);if(!s||!s.validEnd)return!1;for(var a=r;a<o;a++)if(!this.type.allowsMarks(n.child(a).marks))return!1;return!0},to.prototype.canReplaceWith=function(t,e,n,r){if(r&&!this.type.allowsMarks(r))return!1;var o=this.contentMatchAt(t).matchType(n),i=o&&o.matchFragment(this.content,e);return!!i&&i.validEnd},to.prototype.canAppend=function(t){return t.content.size?this.canReplace(this.childCount,this.childCount,t.content):this.type.compatibleContent(t.type)},to.prototype.check=function(){if(!this.type.validContent(this.content))throw new RangeError("Invalid content for node "+this.type.name+": "+this.content.toString().slice(0,50));this.content.forEach((function(t){return t.check()}))},to.prototype.toJSON=function(){var t={type:this.type.name};for(var e in this.attrs){t.attrs=this.attrs;break}return this.content.size&&(t.content=this.content.toJSON()),this.marks.length&&(t.marks=this.marks.map((function(t){return t.toJSON()}))),t},to.fromJSON=function(t,e){if(!e)throw new RangeError("Invalid input for Node.fromJSON");var n=null;if(e.marks){if(!Array.isArray(e.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=e.marks.map(t.markFromJSON)}if("text"==e.type){if("string"!=typeof e.text)throw new RangeError("Invalid text node in JSON");return t.text(e.text,n)}var r=Cr.fromJSON(t,e.content);return t.nodeType(e.type).create(e.attrs,r,n)},Object.defineProperties(to.prototype,eo);var no=function(t){function e(e,n,r,o){if(t.call(this,e,n,null,o),!r)throw new RangeError("Empty text nodes are not allowed");this.text=r}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={textContent:{configurable:!0},nodeSize:{configurable:!0}};return e.prototype.toString=function(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):ro(this.marks,JSON.stringify(this.text))},n.textContent.get=function(){return this.text},e.prototype.textBetween=function(t,e){return this.text.slice(t,e)},n.nodeSize.get=function(){return this.text.length},e.prototype.mark=function(t){return t==this.marks?this:new e(this.type,this.attrs,this.text,t)},e.prototype.withText=function(t){return t==this.text?this:new e(this.type,this.attrs,t,this.marks)},e.prototype.cut=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=this.text.length),0==t&&e==this.text.length?this:this.withText(this.text.slice(t,e))},e.prototype.eq=function(t){return this.sameMarkup(t)&&this.text==t.text},e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.text=this.text,e},Object.defineProperties(e.prototype,n),e}(to);function ro(t,e){for(var n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}var oo=function(t){this.validEnd=t,this.next=[],this.wrapCache=[]},io={inlineContent:{configurable:!0},defaultType:{configurable:!0},edgeCount:{configurable:!0}};oo.parse=function(t,e){var n=new so(t,e);if(null==n.next)return oo.empty;var r=co(n);n.next&&n.err("Unexpected trailing text");var o=wo(vo(r));return xo(o,n),o},oo.prototype.matchType=function(t){for(var e=0;e<this.next.length;e+=2)if(this.next[e]==t)return this.next[e+1];return null},oo.prototype.matchFragment=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=t.childCount);for(var r=this,o=e;r&&o<n;o++)r=r.matchType(t.child(o).type);return r},io.inlineContent.get=function(){var t=this.next[0];return!!t&&t.isInline},io.defaultType.get=function(){for(var t=0;t<this.next.length;t+=2){var e=this.next[t];if(!e.isText&&!e.hasRequiredAttrs())return e}},oo.prototype.compatible=function(t){for(var e=0;e<this.next.length;e+=2)for(var n=0;n<t.next.length;n+=2)if(this.next[e]==t.next[n])return!0;return!1},oo.prototype.fillBefore=function(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=0);var r=[this];function o(i,s){var a=i.matchFragment(t,n);if(a&&(!e||a.validEnd))return Cr.from(s.map((function(t){return t.createAndFill()})));for(var c=0;c<i.next.length;c+=2){var h=i.next[c],p=i.next[c+1];if(!h.isText&&!h.hasRequiredAttrs()&&-1==r.indexOf(p)){r.push(p);var l=o(p,s.concat(h));if(l)return l}}}return o(this,[])},oo.prototype.findWrapping=function(t){for(var e=0;e<this.wrapCache.length;e+=2)if(this.wrapCache[e]==t)return this.wrapCache[e+1];var n=this.computeWrapping(t);return this.wrapCache.push(t,n),n},oo.prototype.computeWrapping=function(t){var e=Object.create(null),n=[{match:this,type:null,via:null}];while(n.length){var r=n.shift(),o=r.match;if(o.matchType(t)){for(var i=[],s=r;s.type;s=s.via)i.push(s.type);return i.reverse()}for(var a=0;a<o.next.length;a+=2){var c=o.next[a];c.isLeaf||c.hasRequiredAttrs()||c.name in e||r.type&&!o.next[a+1].validEnd||(n.push({match:c.contentMatch,type:c,via:r}),e[c.name]=!0)}}},io.edgeCount.get=function(){return this.next.length>>1},oo.prototype.edge=function(t){var e=t<<1;if(e>=this.next.length)throw new RangeError("There's no "+t+"th edge in this content match");return{type:this.next[e],next:this.next[e+1]}},oo.prototype.toString=function(){var t=[];function e(n){t.push(n);for(var r=1;r<n.next.length;r+=2)-1==t.indexOf(n.next[r])&&e(n.next[r])}return e(this),t.map((function(e,n){for(var r=n+(e.validEnd?"*":" ")+" ",o=0;o<e.next.length;o+=2)r+=(o?", ":"")+e.next[o].name+"->"+t.indexOf(e.next[o+1]);return r})).join("\n")},Object.defineProperties(oo.prototype,io),oo.empty=new oo(!0);var so=function(t,e){this.string=t,this.nodeTypes=e,this.inline=null,this.pos=0,this.tokens=t.split(/\s*(?=\b|\W|$)/),""==this.tokens[this.tokens.length-1]&&this.tokens.pop(),""==this.tokens[0]&&this.tokens.unshift()},ao={next:{configurable:!0}};function co(t){var e=[];do{e.push(ho(t))}while(t.eat("|"));return 1==e.length?e[0]:{type:"choice",exprs:e}}function ho(t){var e=[];do{e.push(po(t))}while(t.next&&")"!=t.next&&"|"!=t.next);return 1==e.length?e[0]:{type:"seq",exprs:e}}function po(t){for(var e=mo(t);;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else{if(!t.eat("{"))break;e=uo(t,e)}return e}function lo(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");var e=Number(t.next);return t.pos++,e}function uo(t,e){var n=lo(t),r=n;return t.eat(",")&&(r="}"!=t.next?lo(t):-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:e}}function fo(t,e){var n=t.nodeTypes,r=n[e];if(r)return[r];var o=[];for(var i in n){var s=n[i];s.groups.indexOf(e)>-1&&o.push(s)}return 0==o.length&&t.err("No node type or group '"+e+"' found"),o}function mo(t){if(t.eat("(")){var e=co(t);return t.eat(")")||t.err("Missing closing paren"),e}if(!/\W/.test(t.next)){var n=fo(t,t.next).map((function(e){return null==t.inline?t.inline=e.isInline:t.inline!=e.isInline&&t.err("Mixing inline and block content"),{type:"name",value:e}}));return t.pos++,1==n.length?n[0]:{type:"choice",exprs:n}}t.err("Unexpected token '"+t.next+"'")}function vo(t){var e=[[]];return o(i(t,0),n()),e;function n(){return e.push([])-1}function r(t,n,r){var o={term:r,to:n};return e[t].push(o),o}function o(t,e){t.forEach((function(t){return t.to=e}))}function i(t,e){if("choice"==t.type)return t.exprs.reduce((function(t,n){return t.concat(i(n,e))}),[]);if("seq"==t.type)for(var s=0;;s++){var a=i(t.exprs[s],e);if(s==t.exprs.length-1)return a;o(a,e=n())}else{if("star"==t.type){var c=n();return r(e,c),o(i(t.expr,c),c),[r(c)]}if("plus"==t.type){var h=n();return o(i(t.expr,e),h),o(i(t.expr,h),h),[r(h)]}if("opt"==t.type)return[r(e)].concat(i(t.expr,e));if("range"==t.type){for(var p=e,l=0;l<t.min;l++){var u=n();o(i(t.expr,p),u),p=u}if(-1==t.max)o(i(t.expr,p),p);else for(var f=t.min;f<t.max;f++){var d=n();r(p,d),o(i(t.expr,p),d),p=d}return[r(p)]}if("name"==t.type)return[r(e,null,t.value)]}}}function go(t,e){return e-t}function yo(t,e){var n=[];return r(e),n.sort(go);function r(e){var o=t[e];if(1==o.length&&!o[0].term)return r(o[0].to);n.push(e);for(var i=0;i<o.length;i++){var s=o[i],a=s.term,c=s.to;a||-1!=n.indexOf(c)||r(c)}}}function wo(t){var e=Object.create(null);return n(yo(t,0));function n(r){var o=[];r.forEach((function(e){t[e].forEach((function(e){var n=e.term,r=e.to;if(n){var i=o.indexOf(n),s=i>-1&&o[i+1];yo(t,r).forEach((function(t){s||o.push(n,s=[]),-1==s.indexOf(t)&&s.push(t)}))}}))}));for(var i=e[r.join(",")]=new oo(r.indexOf(t.length-1)>-1),s=0;s<o.length;s+=2){var a=o[s+1].sort(go);i.next.push(o[s],e[a.join(",")]||n(a))}return i}}function xo(t,e){for(var n=0,r=[t];n<r.length;n++){for(var o=r[n],i=!o.validEnd,s=[],a=0;a<o.next.length;a+=2){var c=o.next[a],h=o.next[a+1];s.push(c.name),!i||c.isText||c.hasRequiredAttrs()||(i=!1),-1==r.indexOf(h)&&r.push(h)}i&&e.err("Only non-generatable nodes ("+s.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function bo(t){var e=Object.create(null);for(var n in t){var r=t[n];if(!r.hasDefault)return null;e[n]=r.default}return e}function ko(t,e){var n=Object.create(null);for(var r in t){var o=e&&e[r];if(void 0===o){var i=t[r];if(!i.hasDefault)throw new RangeError("No value supplied for attribute "+r);o=i.default}n[r]=o}return n}function So(t){var e=Object.create(null);if(t)for(var n in t)e[n]=new Mo(t[n]);return e}ao.next.get=function(){return this.tokens[this.pos]},so.prototype.eat=function(t){return this.next==t&&(this.pos++||!0)},so.prototype.err=function(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")},Object.defineProperties(so.prototype,ao);var Oo=function(t,e,n){this.name=t,this.schema=e,this.spec=n,this.groups=n.group?n.group.split(" "):[],this.attrs=So(n.attrs),this.defaultAttrs=bo(this.attrs),this.contentMatch=null,this.markSet=null,this.inlineContent=null,this.isBlock=!(n.inline||"text"==t),this.isText="text"==t},Co={isInline:{configurable:!0},isTextblock:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};Co.isInline.get=function(){return!this.isBlock},Co.isTextblock.get=function(){return this.isBlock&&this.inlineContent},Co.isLeaf.get=function(){return this.contentMatch==oo.empty},Co.isAtom.get=function(){return this.isLeaf||this.spec.atom},Oo.prototype.hasRequiredAttrs=function(){for(var t in this.attrs)if(this.attrs[t].isRequired)return!0;return!1},Oo.prototype.compatibleContent=function(t){return this==t||this.contentMatch.compatible(t.contentMatch)},Oo.prototype.computeAttrs=function(t){return!t&&this.defaultAttrs?this.defaultAttrs:ko(this.attrs,t)},Oo.prototype.create=function(t,e,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new to(this,this.computeAttrs(t),Cr.from(e),Ar.setFrom(n))},Oo.prototype.createChecked=function(t,e,n){if(e=Cr.from(e),!this.validContent(e))throw new RangeError("Invalid content for node "+this.name);return new to(this,this.computeAttrs(t),e,Ar.setFrom(n))},Oo.prototype.createAndFill=function(t,e,n){if(t=this.computeAttrs(t),e=Cr.from(e),e.size){var r=this.contentMatch.fillBefore(e);if(!r)return null;e=r.append(e)}var o=this.contentMatch.matchFragment(e).fillBefore(Cr.empty,!0);return o?new to(this,t,e.append(o),Ar.setFrom(n)):null},Oo.prototype.validContent=function(t){var e=this.contentMatch.matchFragment(t);if(!e||!e.validEnd)return!1;for(var n=0;n<t.childCount;n++)if(!this.allowsMarks(t.child(n).marks))return!1;return!0},Oo.prototype.allowsMarkType=function(t){return null==this.markSet||this.markSet.indexOf(t)>-1},Oo.prototype.allowsMarks=function(t){if(null==this.markSet)return!0;for(var e=0;e<t.length;e++)if(!this.allowsMarkType(t[e].type))return!1;return!0},Oo.prototype.allowedMarks=function(t){if(null==this.markSet)return t;for(var e,n=0;n<t.length;n++)this.allowsMarkType(t[n].type)?e&&e.push(t[n]):e||(e=t.slice(0,n));return e?e.length?e:Ar.empty:t},Oo.compile=function(t,e){var n=Object.create(null);t.forEach((function(t,r){return n[t]=new Oo(t,e,r)}));var r=e.spec.topNode||"doc";if(!n[r])throw new RangeError("Schema is missing its top node type ('"+r+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(var o in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n},Object.defineProperties(Oo.prototype,Co);var Mo=function(t){this.hasDefault=Object.prototype.hasOwnProperty.call(t,"default"),this.default=t.default},No={isRequired:{configurable:!0}};No.isRequired.get=function(){return!this.hasDefault},Object.defineProperties(Mo.prototype,No);var To=function(t,e,n,r){this.name=t,this.schema=n,this.spec=r,this.attrs=So(r.attrs),this.rank=e,this.excluded=null;var o=bo(this.attrs);this.instance=o&&new Ar(this,o)};To.prototype.create=function(t){return!t&&this.instance?this.instance:new Ar(this,ko(this.attrs,t))},To.compile=function(t,e){var n=Object.create(null),r=0;return t.forEach((function(t,o){return n[t]=new To(t,r++,e,o)})),n},To.prototype.removeFromSet=function(t){for(var e=0;e<t.length;e++)if(t[e].type==this)return t.slice(0,e).concat(t.slice(e+1));return t},To.prototype.isInSet=function(t){for(var e=0;e<t.length;e++)if(t[e].type==this)return t[e]},To.prototype.excludes=function(t){return this.excluded.indexOf(t)>-1};var Eo=function(t){for(var e in this.spec={},t)this.spec[e]=t[e];this.spec.nodes=c.from(t.nodes),this.spec.marks=c.from(t.marks),this.nodes=Oo.compile(this.spec.nodes,this),this.marks=To.compile(this.spec.marks,this);var n=Object.create(null);for(var r in this.nodes){if(r in this.marks)throw new RangeError(r+" can not be both a node and a mark");var o=this.nodes[r],i=o.spec.content||"",s=o.spec.marks;o.contentMatch=n[i]||(n[i]=oo.parse(i,this.nodes)),o.inlineContent=o.contentMatch.inlineContent,o.markSet="_"==s?null:s?Ao(this,s.split(" ")):""!=s&&o.inlineContent?null:[]}for(var a in this.marks){var h=this.marks[a],p=h.spec.excludes;h.excluded=null==p?[h]:""==p?[]:Ao(this,p.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached=Object.create(null),this.cached.wrappings=Object.create(null)};function Ao(t,e){for(var n=[],r=0;r<e.length;r++){var o=e[r],i=t.marks[o],s=i;if(i)n.push(i);else for(var a in t.marks){var c=t.marks[a];("_"==o||c.spec.group&&c.spec.group.split(" ").indexOf(o)>-1)&&n.push(s=c)}if(!s)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return n}Eo.prototype.node=function(t,e,n,r){if("string"==typeof t)t=this.nodeType(t);else{if(!(t instanceof Oo))throw new RangeError("Invalid node type: "+t);if(t.schema!=this)throw new RangeError("Node type from different schema used ("+t.name+")")}return t.createChecked(e,n,r)},Eo.prototype.text=function(t,e){var n=this.nodes.text;return new no(n,n.defaultAttrs,t,Ar.setFrom(e))},Eo.prototype.mark=function(t,e){return"string"==typeof t&&(t=this.marks[t]),t.create(e)},Eo.prototype.nodeFromJSON=function(t){return to.fromJSON(this,t)},Eo.prototype.markFromJSON=function(t){return Ar.fromJSON(this,t)},Eo.prototype.nodeType=function(t){var e=this.nodes[t];if(!e)throw new RangeError("Unknown node type: "+t);return e};var Do=function(t,e){var n=this;this.schema=t,this.rules=e,this.tags=[],this.styles=[],e.forEach((function(t){t.tag?n.tags.push(t):t.style&&n.styles.push(t)})),this.normalizeLists=!this.tags.some((function(e){if(!/^(ul|ol)\b/.test(e.tag)||!e.node)return!1;var n=t.nodes[e.node];return n.contentMatch.matchType(n)}))};Do.prototype.parse=function(t,e){void 0===e&&(e={});var n=new jo(this,e,!1);return n.addAll(t,null,e.from,e.to),n.finish()},Do.prototype.parseSlice=function(t,e){void 0===e&&(e={});var n=new jo(this,e,!0);return n.addAll(t,null,e.from,e.to),Rr.maxOpen(n.finish())},Do.prototype.matchTag=function(t,e){for(var n=0;n<this.tags.length;n++){var r=this.tags[n];if(Vo(t,r.tag)&&(void 0===r.namespace||t.namespaceURI==r.namespace)&&(!r.context||e.matchesContext(r.context))){if(r.getAttrs){var o=r.getAttrs(t);if(!1===o)continue;r.attrs=o}return r}}},Do.prototype.matchStyle=function(t,e,n){for(var r=0;r<this.styles.length;r++){var o=this.styles[r];if(!(0!=o.style.indexOf(t)||o.context&&!n.matchesContext(o.context)||o.style.length>t.length&&(61!=o.style.charCodeAt(t.length)||o.style.slice(t.length+1)!=e))){if(o.getAttrs){var i=o.getAttrs(e);if(!1===i)continue;o.attrs=i}return o}}},Do.schemaRules=function(t){var e=[];function n(t){for(var n=null==t.priority?50:t.priority,r=0;r<e.length;r++){var o=e[r],i=null==o.priority?50:o.priority;if(i<n)break}e.splice(r,0,t)}var r=function(e){var r=t.marks[e].spec.parseDOM;r&&r.forEach((function(t){n(t=Wo(t)),t.mark=e}))};for(var o in t.marks)r(o);var i=function(e){var r=t.nodes[s].spec.parseDOM;r&&r.forEach((function(t){n(t=Wo(t)),t.node=s}))};for(var s in t.nodes)i();return e},Do.fromSchema=function(t){return t.cached.domParser||(t.cached.domParser=new Do(t,Do.schemaRules(t)))};var Ro={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},zo={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},Io={ol:!0,ul:!0},Po=1,Fo=2,Bo=4;function $o(t){return(t?Po:0)|("full"===t?Fo:0)}var _o=function(t,e,n,r,o,i,s){this.type=t,this.attrs=e,this.solid=o,this.match=i||(s&Bo?null:t.contentMatch),this.options=s,this.content=[],this.marks=n,this.activeMarks=Ar.none,this.pendingMarks=r};_o.prototype.findWrapping=function(t){if(!this.match){if(!this.type)return[];var e=this.type.contentMatch.fillBefore(Cr.from(t));if(!e){var n,r=this.type.contentMatch;return(n=r.findWrapping(t.type))?(this.match=r,n):null}this.match=this.type.contentMatch.matchFragment(e)}return this.match.findWrapping(t.type)},_o.prototype.finish=function(t){if(!(this.options&Po)){var e,n=this.content[this.content.length-1];n&&n.isText&&(e=/[ \t\r\n\u000c]+$/.exec(n.text))&&(n.text.length==e[0].length?this.content.pop():this.content[this.content.length-1]=n.withText(n.text.slice(0,n.text.length-e[0].length)))}var r=Cr.from(this.content);return!t&&this.match&&(r=r.append(this.match.fillBefore(Cr.empty,!0))),this.type?this.type.create(this.attrs,r,this.marks):r},_o.prototype.applyPending=function(t){for(var e=0,n=this.pendingMarks;e<n.length;e++){var r=n[e];(this.type?this.type.allowsMarkType(r.type):Ho(r.type,t))&&!r.isInSet(this.activeMarks)&&(this.activeMarks=r.addToSet(this.activeMarks),this.pendingMarks=r.removeFromSet(this.pendingMarks))}};var jo=function(t,e,n){this.parser=t,this.options=e,this.isOpen=n;var r,o=e.topNode,i=$o(e.preserveWhitespace)|(n?Bo:0);r=o?new _o(o.type,o.attrs,Ar.none,Ar.none,!0,e.topMatch||o.type.contentMatch,i):new _o(n?null:t.schema.topNodeType,null,Ar.none,Ar.none,!0,null,i),this.nodes=[r],this.open=0,this.find=e.findPositions,this.needsBlock=!1},Jo={top:{configurable:!0},currentPos:{configurable:!0}};function Lo(t){for(var e=t.firstChild,n=null;e;e=e.nextSibling){var r=1==e.nodeType?e.nodeName.toLowerCase():null;r&&Io.hasOwnProperty(r)&&n?(n.appendChild(e),e=n):"li"==r?n=e:r&&(n=null)}}function Vo(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function qo(t){var e,n=/\s*([\w-]+)\s*:\s*([^;]+)/g,r=[];while(e=n.exec(t))r.push(e[1],e[2].trim());return r}function Wo(t){var e={};for(var n in t)e[n]=t[n];return e}function Ho(t,e){var n=e.schema.nodes,r=function(r){var o=n[r];if(o.allowsMarkType(t)){var i=[],s=function(t){i.push(t);for(var n=0;n<t.edgeCount;n++){var r=t.edge(n),o=r.type,a=r.next;if(o==e)return!0;if(i.indexOf(a)<0&&s(a))return!0}};return s(o.contentMatch)?{v:!0}:void 0}};for(var o in n){var i=r(o);if(i)return i.v}}Jo.top.get=function(){return this.nodes[this.open]},jo.prototype.addDOM=function(t){if(3==t.nodeType)this.addTextNode(t);else if(1==t.nodeType){var e=t.getAttribute("style"),n=e?this.readStyles(qo(e)):null,r=this.top;if(null!=n)for(var o=0;o<n.length;o++)this.addPendingMark(n[o]);if(this.addElement(t),null!=n)for(var i=0;i<n.length;i++)this.removePendingMark(n[i],r)}},jo.prototype.addTextNode=function(t){var e=t.nodeValue,n=this.top;if((n.type?n.type.inlineContent:n.content.length&&n.content[0].isInline)||/[^ \t\r\n\u000c]/.test(e)){if(n.options&Po)n.options&Fo||(e=e.replace(/\r?\n|\r/g," "));else if(e=e.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(e)&&this.open==this.nodes.length-1){var r=n.content[n.content.length-1],o=t.previousSibling;(!r||o&&"BR"==o.nodeName||r.isText&&/[ \t\r\n\u000c]$/.test(r.text))&&(e=e.slice(1))}e&&this.insertNode(this.parser.schema.text(e)),this.findInText(t)}else this.findInside(t)},jo.prototype.addElement=function(t){var e=t.nodeName.toLowerCase();Io.hasOwnProperty(e)&&this.normalizeLists&&Lo(t);var n=this.options.ruleFromNode&&this.options.ruleFromNode(t)||this.parser.matchTag(t,this);if(n?n.ignore:zo.hasOwnProperty(e))this.findInside(t);else if(!n||n.skip||n.closeParent){n&&n.closeParent?this.open=Math.max(0,this.open-1):n&&n.skip.nodeType&&(t=n.skip);var r,o=this.top,i=this.needsBlock;if(Ro.hasOwnProperty(e))r=!0,o.type||(this.needsBlock=!0);else if(!t.firstChild)return void this.leafFallback(t);this.addAll(t),r&&this.sync(o),this.needsBlock=i}else this.addElementByRule(t,n)},jo.prototype.leafFallback=function(t){"BR"==t.nodeName&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(t.ownerDocument.createTextNode("\n"))},jo.prototype.readStyles=function(t){for(var e=Ar.none,n=0;n<t.length;n+=2){var r=this.parser.matchStyle(t[n],t[n+1],this);if(r){if(r.ignore)return null;e=this.parser.schema.marks[r.mark].create(r.attrs).addToSet(e)}}return e},jo.prototype.addElementByRule=function(t,e){var n,r,o,i,s=this;e.node?(r=this.parser.schema.nodes[e.node],r.isLeaf?this.insertNode(r.create(e.attrs))||this.leafFallback(t):n=this.enter(r,e.attrs,e.preserveWhitespace)):(o=this.parser.schema.marks[e.mark],i=o.create(e.attrs),this.addPendingMark(i));var a=this.top;if(r&&r.isLeaf)this.findInside(t);else if(e.getContent)this.findInside(t),e.getContent(t,this.parser.schema).forEach((function(t){return s.insertNode(t)}));else{var c=e.contentElement;"string"==typeof c?c=t.querySelector(c):"function"==typeof c&&(c=c(t)),c||(c=t),this.findAround(t,c,!0),this.addAll(c,n)}n&&(this.sync(a),this.open--),i&&this.removePendingMark(i,a)},jo.prototype.addAll=function(t,e,n,r){for(var o=n||0,i=n?t.childNodes[n]:t.firstChild,s=null==r?null:t.childNodes[r];i!=s;i=i.nextSibling,++o)this.findAtPoint(t,o),this.addDOM(i),e&&Ro.hasOwnProperty(i.nodeName.toLowerCase())&&this.sync(e);this.findAtPoint(t,o)},jo.prototype.findPlace=function(t){for(var e,n,r=this.open;r>=0;r--){var o=this.nodes[r],i=o.findWrapping(t);if(i&&(!e||e.length>i.length)&&(e=i,n=o,!i.length))break;if(o.solid)break}if(!e)return!1;this.sync(n);for(var s=0;s<e.length;s++)this.enterInner(e[s],null,!1);return!0},jo.prototype.insertNode=function(t){if(t.isInline&&this.needsBlock&&!this.top.type){var e=this.textblockFromContext();e&&this.enterInner(e)}if(this.findPlace(t)){this.closeExtra();var n=this.top;n.applyPending(t.type),n.match&&(n.match=n.match.matchType(t.type));for(var r=n.activeMarks,o=0;o<t.marks.length;o++)n.type&&!n.type.allowsMarkType(t.marks[o].type)||(r=t.marks[o].addToSet(r));return n.content.push(t.mark(r)),!0}return!1},jo.prototype.enter=function(t,e,n){var r=this.findPlace(t.create(e));return r&&this.enterInner(t,e,!0,n),r},jo.prototype.enterInner=function(t,e,n,r){this.closeExtra();var o=this.top;o.applyPending(t),o.match=o.match&&o.match.matchType(t,e);var i=null==r?o.options&~Bo:$o(r);o.options&Bo&&0==o.content.length&&(i|=Bo),this.nodes.push(new _o(t,e,o.activeMarks,o.pendingMarks,n,null,i)),this.open++},jo.prototype.closeExtra=function(t){var e=this.nodes.length-1;if(e>this.open){for(;e>this.open;e--)this.nodes[e-1].content.push(this.nodes[e].finish(t));this.nodes.length=this.open+1}},jo.prototype.finish=function(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)},jo.prototype.sync=function(t){for(var e=this.open;e>=0;e--)if(this.nodes[e]==t)return void(this.open=e)},Jo.currentPos.get=function(){this.closeExtra();for(var t=0,e=this.open;e>=0;e--){for(var n=this.nodes[e].content,r=n.length-1;r>=0;r--)t+=n[r].nodeSize;e&&t++}return t},jo.prototype.findAtPoint=function(t,e){if(this.find)for(var n=0;n<this.find.length;n++)this.find[n].node==t&&this.find[n].offset==e&&(this.find[n].pos=this.currentPos)},jo.prototype.findInside=function(t){if(this.find)for(var e=0;e<this.find.length;e++)null==this.find[e].pos&&1==t.nodeType&&t.contains(this.find[e].node)&&(this.find[e].pos=this.currentPos)},jo.prototype.findAround=function(t,e,n){if(t!=e&&this.find)for(var r=0;r<this.find.length;r++)if(null==this.find[r].pos&&1==t.nodeType&&t.contains(this.find[r].node)){var o=e.compareDocumentPosition(this.find[r].node);o&(n?2:4)&&(this.find[r].pos=this.currentPos)}},jo.prototype.findInText=function(t){if(this.find)for(var e=0;e<this.find.length;e++)this.find[e].node==t&&(this.find[e].pos=this.currentPos-(t.nodeValue.length-this.find[e].offset))},jo.prototype.matchesContext=function(t){var e=this;if(t.indexOf("|")>-1)return t.split(/\s*\|\s*/).some(this.matchesContext,this);var n=t.split("/"),r=this.options.context,o=!this.isOpen&&(!r||r.parent.type==this.nodes[0].type),i=-(r?r.depth+1:0)+(o?0:1),s=function(t,a){for(;t>=0;t--){var c=n[t];if(""==c){if(t==n.length-1||0==t)continue;for(;a>=i;a--)if(s(t-1,a))return!0;return!1}var h=a>0||0==a&&o?e.nodes[a].type:r&&a>=i?r.node(a-i).type:null;if(!h||h.name!=c&&-1==h.groups.indexOf(c))return!1;a--}return!0};return s(n.length-1,this.open)},jo.prototype.textblockFromContext=function(){var t=this.options.context;if(t)for(var e=t.depth;e>=0;e--){var n=t.node(e).contentMatchAt(t.indexAfter(e)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(var r in this.parser.schema.nodes){var o=this.parser.schema.nodes[r];if(o.isTextblock&&o.defaultAttrs)return o}},jo.prototype.addPendingMark=function(t){this.top.pendingMarks=t.addToSet(this.top.pendingMarks)},jo.prototype.removePendingMark=function(t,e){for(var n=this.open;n>=0;n--){var r=this.nodes[n],o=r.pendingMarks.lastIndexOf(t);if(o>-1?r.pendingMarks=t.removeFromSet(r.pendingMarks):r.activeMarks=t.removeFromSet(r.activeMarks),r==e)break}},Object.defineProperties(jo.prototype,Jo);var Ko=function(t,e){this.nodes=t||{},this.marks=e||{}};function Uo(t){var e={};for(var n in t){var r=t[n].spec.toDOM;r&&(e[n]=r)}return e}function Go(t){return t.document||window.document}Ko.prototype.serializeFragment=function(t,e,n){var r=this;void 0===e&&(e={}),n||(n=Go(e).createDocumentFragment());var o=n,i=null;return t.forEach((function(t){if(i||t.marks.length){i||(i=[]);var n=0,s=0;while(n<i.length&&s<t.marks.length){var a=t.marks[s];if(r.marks[a.type.name]){if(!a.eq(i[n])||!1===a.type.spec.spanning)break;n+=2,s++}else s++}while(n<i.length)o=i.pop(),i.pop();while(s<t.marks.length){var c=t.marks[s++],h=r.serializeMark(c,t.isInline,e);h&&(i.push(c,o),o.appendChild(h.dom),o=h.contentDOM||h.dom)}}o.appendChild(r.serializeNode(t,e))})),n},Ko.prototype.serializeNode=function(t,e){void 0===e&&(e={});var n=Ko.renderSpec(Go(e),this.nodes[t.type.name](t)),r=n.dom,o=n.contentDOM;if(o){if(t.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");e.onContent?e.onContent(t,o,e):this.serializeFragment(t.content,e,o)}return r},Ko.prototype.serializeNodeAndMarks=function(t,e){void 0===e&&(e={});for(var n=this.serializeNode(t,e),r=t.marks.length-1;r>=0;r--){var o=this.serializeMark(t.marks[r],t.isInline,e);o&&((o.contentDOM||o.dom).appendChild(n),n=o.dom)}return n},Ko.prototype.serializeMark=function(t,e,n){void 0===n&&(n={});var r=this.marks[t.type.name];return r&&Ko.renderSpec(Go(n),r(t,e))},Ko.renderSpec=function(t,e,n){if(void 0===n&&(n=null),"string"==typeof e)return{dom:t.createTextNode(e)};if(null!=e.nodeType)return{dom:e};var r=e[0],o=r.indexOf(" ");o>0&&(n=r.slice(0,o),r=r.slice(o+1));var i=null,s=n?t.createElementNS(n,r):t.createElement(r),a=e[1],c=1;if(a&&"object"==typeof a&&null==a.nodeType&&!Array.isArray(a))for(var h in c=2,a)if(null!=a[h]){var p=h.indexOf(" ");p>0?s.setAttributeNS(h.slice(0,p),h.slice(p+1),a[h]):s.setAttribute(h,a[h])}for(var l=c;l<e.length;l++){var u=e[l];if(0===u){if(l<e.length-1||l>c)throw new RangeError("Content hole must be the only child of its parent node");return{dom:s,contentDOM:s}}var f=Ko.renderSpec(t,u,n),d=f.dom,m=f.contentDOM;if(s.appendChild(d),m){if(i)throw new RangeError("Multiple content holes");i=m}}return{dom:s,contentDOM:i}},Ko.fromSchema=function(t){return t.cached.domSerializer||(t.cached.domSerializer=new Ko(this.nodesFromSchema(t),this.marksFromSchema(t)))},Ko.nodesFromSchema=function(t){var e=Uo(t.nodes);return e.text||(e.text=function(t){return t.text}),e},Ko.marksFromSchema=function(t){return Uo(t.marks)};var Xo=Object.create(null),Yo=function(t,e,n){this.ranges=n||[new Qo(t.min(e),t.max(e))],this.$anchor=t,this.$head=e},Zo={anchor:{configurable:!0},head:{configurable:!0},from:{configurable:!0},to:{configurable:!0},$from:{configurable:!0},$to:{configurable:!0},empty:{configurable:!0}};Zo.anchor.get=function(){return this.$anchor.pos},Zo.head.get=function(){return this.$head.pos},Zo.from.get=function(){return this.$from.pos},Zo.to.get=function(){return this.$to.pos},Zo.$from.get=function(){return this.ranges[0].$from},Zo.$to.get=function(){return this.ranges[0].$to},Zo.empty.get=function(){for(var t=this.ranges,e=0;e<t.length;e++)if(t[e].$from.pos!=t[e].$to.pos)return!1;return!0},Yo.prototype.content=function(){return this.$from.node(0).slice(this.from,this.to,!0)},Yo.prototype.replace=function(t,e){void 0===e&&(e=Rr.empty);for(var n=e.content.lastChild,r=null,o=0;o<e.openEnd;o++)r=n,n=n.lastChild;for(var i=t.steps.length,s=this.ranges,a=0;a<s.length;a++){var c=s[a],h=c.$from,p=c.$to,l=t.mapping.slice(i);t.replaceRange(l.map(h.pos),l.map(p.pos),a?Rr.empty:e),0==a&&ai(t,i,(n?n.isInline:r&&r.isTextblock)?-1:1)}},Yo.prototype.replaceWith=function(t,e){for(var n=t.steps.length,r=this.ranges,o=0;o<r.length;o++){var i=r[o],s=i.$from,a=i.$to,c=t.mapping.slice(n),h=c.map(s.pos),p=c.map(a.pos);o?t.deleteRange(h,p):(t.replaceRangeWith(h,p,e),ai(t,n,e.isInline?-1:1))}},Yo.findFrom=function(t,e,n){var r=t.parent.inlineContent?new ti(t):si(t.node(0),t.parent,t.pos,t.index(),e,n);if(r)return r;for(var o=t.depth-1;o>=0;o--){var i=e<0?si(t.node(0),t.node(o),t.before(o+1),t.index(o),e,n):si(t.node(0),t.node(o),t.after(o+1),t.index(o)+1,e,n);if(i)return i}},Yo.near=function(t,e){return void 0===e&&(e=1),this.findFrom(t,e)||this.findFrom(t,-e)||new oi(t.node(0))},Yo.atStart=function(t){return si(t,t,0,0,1)||new oi(t)},Yo.atEnd=function(t){return si(t,t,t.content.size,t.childCount,-1)||new oi(t)},Yo.fromJSON=function(t,e){if(!e||!e.type)throw new RangeError("Invalid input for Selection.fromJSON");var n=Xo[e.type];if(!n)throw new RangeError("No selection type "+e.type+" defined");return n.fromJSON(t,e)},Yo.jsonID=function(t,e){if(t in Xo)throw new RangeError("Duplicate use of selection JSON ID "+t);return Xo[t]=e,e.prototype.jsonID=t,e},Yo.prototype.getBookmark=function(){return ti.between(this.$anchor,this.$head).getBookmark()},Object.defineProperties(Yo.prototype,Zo),Yo.prototype.visible=!0;var Qo=function(t,e){this.$from=t,this.$to=e},ti=function(t){function e(e,n){void 0===n&&(n=e),t.call(this,e,n)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={$cursor:{configurable:!0}};return n.$cursor.get=function(){return this.$anchor.pos==this.$head.pos?this.$head:null},e.prototype.map=function(n,r){var o=n.resolve(r.map(this.head));if(!o.parent.inlineContent)return t.near(o);var i=n.resolve(r.map(this.anchor));return new e(i.parent.inlineContent?i:o,o)},e.prototype.replace=function(e,n){if(void 0===n&&(n=Rr.empty),t.prototype.replace.call(this,e,n),n==Rr.empty){var r=this.$from.marksAcross(this.$to);r&&e.ensureMarks(r)}},e.prototype.eq=function(t){return t instanceof e&&t.anchor==this.anchor&&t.head==this.head},e.prototype.getBookmark=function(){return new ei(this.anchor,this.head)},e.prototype.toJSON=function(){return{type:"text",anchor:this.anchor,head:this.head}},e.fromJSON=function(t,n){if("number"!=typeof n.anchor||"number"!=typeof n.head)throw new RangeError("Invalid input for TextSelection.fromJSON");return new e(t.resolve(n.anchor),t.resolve(n.head))},e.create=function(t,e,n){void 0===n&&(n=e);var r=t.resolve(e);return new this(r,n==e?r:t.resolve(n))},e.between=function(n,r,o){var i=n.pos-r.pos;if(o&&!i||(o=i>=0?1:-1),!r.parent.inlineContent){var s=t.findFrom(r,o,!0)||t.findFrom(r,-o,!0);if(!s)return t.near(r,o);r=s.$head}return n.parent.inlineContent||(0==i?n=r:(n=(t.findFrom(n,-o,!0)||t.findFrom(n,o,!0)).$anchor,n.pos<r.pos!=i<0&&(n=r))),new e(n,r)},Object.defineProperties(e.prototype,n),e}(Yo);Yo.jsonID("text",ti);var ei=function(t,e){this.anchor=t,this.head=e};ei.prototype.map=function(t){return new ei(t.map(this.anchor),t.map(this.head))},ei.prototype.resolve=function(t){return ti.between(t.resolve(this.anchor),t.resolve(this.head))};var ni=function(t){function e(e){var n=e.nodeAfter,r=e.node(0).resolve(e.pos+n.nodeSize);t.call(this,e,r),this.node=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.map=function(n,r){var o=r.mapResult(this.anchor),i=o.deleted,s=o.pos,a=n.resolve(s);return i?t.near(a):new e(a)},e.prototype.content=function(){return new Rr(Cr.from(this.node),0,0)},e.prototype.eq=function(t){return t instanceof e&&t.anchor==this.anchor},e.prototype.toJSON=function(){return{type:"node",anchor:this.anchor}},e.prototype.getBookmark=function(){return new ri(this.anchor)},e.fromJSON=function(t,n){if("number"!=typeof n.anchor)throw new RangeError("Invalid input for NodeSelection.fromJSON");return new e(t.resolve(n.anchor))},e.create=function(t,e){return new this(t.resolve(e))},e.isSelectable=function(t){return!t.isText&&!1!==t.type.spec.selectable},e}(Yo);ni.prototype.visible=!1,Yo.jsonID("node",ni);var ri=function(t){this.anchor=t};ri.prototype.map=function(t){var e=t.mapResult(this.anchor),n=e.deleted,r=e.pos;return n?new ei(r,r):new ri(r)},ri.prototype.resolve=function(t){var e=t.resolve(this.anchor),n=e.nodeAfter;return n&&ni.isSelectable(n)?new ni(e):Yo.near(e)};var oi=function(t){function e(e){t.call(this,e.resolve(0),e.resolve(e.content.size))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.replace=function(e,n){if(void 0===n&&(n=Rr.empty),n==Rr.empty){e.delete(0,e.doc.content.size);var r=t.atStart(e.doc);r.eq(e.selection)||e.setSelection(r)}else t.prototype.replace.call(this,e,n)},e.prototype.toJSON=function(){return{type:"all"}},e.fromJSON=function(t){return new e(t)},e.prototype.map=function(t){return new e(t)},e.prototype.eq=function(t){return t instanceof e},e.prototype.getBookmark=function(){return ii},e}(Yo);Yo.jsonID("all",oi);var ii={map:function(){return this},resolve:function(t){return new oi(t)}};function si(t,e,n,r,o,i){if(e.inlineContent)return ti.create(t,n);for(var s=r-(o>0?0:1);o>0?s<e.childCount:s>=0;s+=o){var a=e.child(s);if(a.isAtom){if(!i&&ni.isSelectable(a))return ni.create(t,n-(o<0?a.nodeSize:0))}else{var c=si(t,a,n+o,o<0?a.childCount:0,o,i);if(c)return c}n+=a.nodeSize*o}}function ai(t,e,n){var r=t.steps.length-1;if(!(r<e)){var o=t.steps[r];if(o instanceof Sn||o instanceof On){var i,s=t.mapping.maps[r];s.forEach((function(t,e,n,r){null==i&&(i=r)})),t.setSelection(Yo.near(t.doc.resolve(i),n))}}}var ci=1,hi=2,pi=4,li=function(t){function e(e){t.call(this,e.doc),this.time=Date.now(),this.curSelection=e.selection,this.curSelectionFor=0,this.storedMarks=e.storedMarks,this.updated=0,this.meta=Object.create(null)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={selection:{configurable:!0},selectionSet:{configurable:!0},storedMarksSet:{configurable:!0},isGeneric:{configurable:!0},scrolledIntoView:{configurable:!0}};return n.selection.get=function(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection},e.prototype.setSelection=function(t){if(t.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=t,this.curSelectionFor=this.steps.length,this.updated=(this.updated|ci)&~hi,this.storedMarks=null,this},n.selectionSet.get=function(){return(this.updated&ci)>0},e.prototype.setStoredMarks=function(t){return this.storedMarks=t,this.updated|=hi,this},e.prototype.ensureMarks=function(t){return Ar.sameSet(this.storedMarks||this.selection.$from.marks(),t)||this.setStoredMarks(t),this},e.prototype.addStoredMark=function(t){return this.ensureMarks(t.addToSet(this.storedMarks||this.selection.$head.marks()))},e.prototype.removeStoredMark=function(t){return this.ensureMarks(t.removeFromSet(this.storedMarks||this.selection.$head.marks()))},n.storedMarksSet.get=function(){return(this.updated&hi)>0},e.prototype.addStep=function(e,n){t.prototype.addStep.call(this,e,n),this.updated=this.updated&~hi,this.storedMarks=null},e.prototype.setTime=function(t){return this.time=t,this},e.prototype.replaceSelection=function(t){return this.selection.replace(this,t),this},e.prototype.replaceSelectionWith=function(t,e){var n=this.selection;return!1!==e&&(t=t.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||Ar.none))),n.replaceWith(this,t),this},e.prototype.deleteSelection=function(){return this.selection.replace(this),this},e.prototype.insertText=function(t,e,n){void 0===n&&(n=e);var r=this.doc.type.schema;if(null==e)return t?this.replaceSelectionWith(r.text(t),!0):this.deleteSelection();if(!t)return this.deleteRange(e,n);var o=this.storedMarks;if(!o){var i=this.doc.resolve(e);o=n==e?i.marks():i.marksAcross(this.doc.resolve(n))}return this.replaceRangeWith(e,n,r.text(t,o)),this.selection.empty||this.setSelection(Yo.near(this.selection.$to)),this},e.prototype.setMeta=function(t,e){return this.meta["string"==typeof t?t:t.key]=e,this},e.prototype.getMeta=function(t){return this.meta["string"==typeof t?t:t.key]},n.isGeneric.get=function(){for(var t in this.meta)return!1;return!0},e.prototype.scrollIntoView=function(){return this.updated|=pi,this},n.scrolledIntoView.get=function(){return(this.updated&pi)>0},Object.defineProperties(e.prototype,n),e}(gn);function ui(t,e){return e&&t?t.bind(e):t}var fi=function(t,e,n){this.name=t,this.init=ui(e.init,n),this.apply=ui(e.apply,n)},di=[new fi("doc",{init:function(t){return t.doc||t.schema.topNodeType.createAndFill()},apply:function(t){return t.doc}}),new fi("selection",{init:function(t,e){return t.selection||Yo.atStart(e.doc)},apply:function(t){return t.selection}}),new fi("storedMarks",{init:function(t){return t.storedMarks||null},apply:function(t,e,n,r){return r.selection.$cursor?t.storedMarks:null}}),new fi("scrollToSelection",{init:function(){return 0},apply:function(t,e){return t.scrolledIntoView?e+1:e}})],mi=function(t,e){var n=this;this.schema=t,this.fields=di.concat(),this.plugins=[],this.pluginsByKey=Object.create(null),e&&e.forEach((function(t){if(n.pluginsByKey[t.key])throw new RangeError("Adding different instances of a keyed plugin ("+t.key+")");n.plugins.push(t),n.pluginsByKey[t.key]=t,t.spec.state&&n.fields.push(new fi(t.key,t.spec.state,t))}))},vi=function(t){this.config=t},gi={schema:{configurable:!0},plugins:{configurable:!0},tr:{configurable:!0}};gi.schema.get=function(){return this.config.schema},gi.plugins.get=function(){return this.config.plugins},vi.prototype.apply=function(t){return this.applyTransaction(t).state},vi.prototype.filterTransaction=function(t,e){void 0===e&&(e=-1);for(var n=0;n<this.config.plugins.length;n++)if(n!=e){var r=this.config.plugins[n];if(r.spec.filterTransaction&&!r.spec.filterTransaction.call(r,t,this))return!1}return!0},vi.prototype.applyTransaction=function(t){if(!this.filterTransaction(t))return{state:this,transactions:[]};for(var e=[t],n=this.applyInner(t),r=null;;){for(var o=!1,i=0;i<this.config.plugins.length;i++){var s=this.config.plugins[i];if(s.spec.appendTransaction){var a=r?r[i].n:0,c=r?r[i].state:this,h=a<e.length&&s.spec.appendTransaction.call(s,a?e.slice(a):e,c,n);if(h&&n.filterTransaction(h,i)){if(h.setMeta("appendedTransaction",t),!r){r=[];for(var p=0;p<this.config.plugins.length;p++)r.push(p<i?{state:n,n:e.length}:{state:this,n:0})}e.push(h),n=n.applyInner(h),o=!0}r&&(r[i]={state:n,n:e.length})}}if(!o)return{state:n,transactions:e}}},vi.prototype.applyInner=function(t){if(!t.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");for(var e=new vi(this.config),n=this.config.fields,r=0;r<n.length;r++){var o=n[r];e[o.name]=o.apply(t,this[o.name],this,e)}for(var i=0;i<yi.length;i++)yi[i](this,t,e);return e},gi.tr.get=function(){return new li(this)},vi.create=function(t){for(var e=new mi(t.schema||t.doc.type.schema,t.plugins),n=new vi(e),r=0;r<e.fields.length;r++)n[e.fields[r].name]=e.fields[r].init(t,n);return n},vi.prototype.reconfigure=function(t){for(var e=new mi(t.schema||this.schema,t.plugins),n=e.fields,r=new vi(e),o=0;o<n.length;o++){var i=n[o].name;r[i]=this.hasOwnProperty(i)?this[i]:n[o].init(t,r)}return r},vi.prototype.toJSON=function(t){var e={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(e.storedMarks=this.storedMarks.map((function(t){return t.toJSON()}))),t&&"object"==typeof t)for(var n in t){if("doc"==n||"selection"==n)throw new RangeError("The JSON fields `doc` and `selection` are reserved");var r=t[n],o=r.spec.state;o&&o.toJSON&&(e[n]=o.toJSON.call(r,this[r.key]))}return e},vi.fromJSON=function(t,e,n){if(!e)throw new RangeError("Invalid input for EditorState.fromJSON");if(!t.schema)throw new RangeError("Required config field 'schema' missing");var r=new mi(t.schema,t.plugins),o=new vi(r);return r.fields.forEach((function(r){if("doc"==r.name)o.doc=to.fromJSON(t.schema,e.doc);else if("selection"==r.name)o.selection=Yo.fromJSON(o.doc,e.selection);else if("storedMarks"==r.name)e.storedMarks&&(o.storedMarks=e.storedMarks.map(t.schema.markFromJSON));else{if(n)for(var i in n){var s=n[i],a=s.spec.state;if(s.key==r.name&&a&&a.fromJSON&&Object.prototype.hasOwnProperty.call(e,i))return void(o[r.name]=a.fromJSON.call(s,t,e[i],o))}o[r.name]=r.init(t,o)}})),o},vi.addApplyListener=function(t){yi.push(t)},vi.removeApplyListener=function(t){var e=yi.indexOf(t);e>-1&&yi.splice(e,1)},Object.defineProperties(vi.prototype,gi);var yi=[];function wi(t,e,n){for(var r in t){var o=t[r];o instanceof Function?o=o.bind(e):"handleDOMEvents"==r&&(o=wi(o,e,{})),n[r]=o}return n}var xi=function(t){this.props={},t.props&&wi(t.props,this,this.props),this.spec=t,this.key=t.key?t.key.key:ki("plugin")};xi.prototype.getState=function(t){return t[this.key]};var bi=Object.create(null);function ki(t){return t in bi?t+"$"+ ++bi[t]:(bi[t]=0,t+"$")}var Si=function(t){void 0===t&&(t="key"),this.key=ki(t)};Si.prototype.get=function(t){return t.config.pluginsByKey[this.key]},Si.prototype.getState=function(t){return t[this.key]};var Oi={};if("undefined"!=typeof navigator&&"undefined"!=typeof document){var Ci=/Edge\/(\d+)/.exec(navigator.userAgent),Mi=/MSIE \d/.test(navigator.userAgent),Ni=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);Oi.mac=/Mac/.test(navigator.platform);var Ti=Oi.ie=!!(Mi||Ni||Ci);Oi.ie_version=Mi?document.documentMode||6:Ni?+Ni[1]:Ci?+Ci[1]:null,Oi.gecko=!Ti&&/gecko\/(\d+)/i.test(navigator.userAgent),Oi.gecko_version=Oi.gecko&&+(/Firefox\/(\d+)/.exec(navigator.userAgent)||[0,0])[1];var Ei=!Ti&&/Chrome\/(\d+)/.exec(navigator.userAgent);Oi.chrome=!!Ei,Oi.chrome_version=Ei&&+Ei[1],Oi.safari=!Ti&&/Apple Computer/.test(navigator.vendor),Oi.ios=Oi.safari&&(/Mobile\/\w+/.test(navigator.userAgent)||navigator.maxTouchPoints>2),Oi.android=/Android \d/.test(navigator.userAgent),Oi.webkit="webkitFontSmoothing"in document.documentElement.style,Oi.webkit_version=Oi.webkit&&+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]}var Ai=function(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e},Di=function(t){var e=t.assignedSlot||t.parentNode;return e&&11==e.nodeType?e.host:e},Ri=null,zi=function(t,e,n){var r=Ri||(Ri=document.createRange());return r.setEnd(t,null==n?t.nodeValue.length:n),r.setStart(t,e||0),r},Ii=function(t,e,n,r){return n&&(Fi(t,e,n,r,-1)||Fi(t,e,n,r,1))},Pi=/^(img|br|input|textarea|hr)$/i;function Fi(t,e,n,r,o){for(;;){if(t==n&&e==r)return!0;if(e==(o<0?0:Bi(t))){var i=t.parentNode;if(1!=i.nodeType||_i(t)||Pi.test(t.nodeName)||"false"==t.contentEditable)return!1;e=Ai(t)+(o<0?0:1),t=i}else{if(1!=t.nodeType)return!1;if(t=t.childNodes[e+(o<0?-1:0)],"false"==t.contentEditable)return!1;e=o<0?Bi(t):0}}}function Bi(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}function $i(t,e,n){for(var r=0==e,o=e==Bi(t);r||o;){if(t==n)return!0;var i=Ai(t);if(t=t.parentNode,!t)return!1;r=r&&0==i,o=o&&i==Bi(t)}}function _i(t){for(var e,n=t;n;n=n.parentNode)if(e=n.pmViewDesc)break;return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}var ji=function(t){var e=t.isCollapsed;return e&&Oi.chrome&&t.rangeCount&&!t.getRangeAt(0).collapsed&&(e=!1),e};function Ji(t,e){var n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=t,n.key=n.code=e,n}function Li(t){return{left:0,right:t.documentElement.clientWidth,top:0,bottom:t.documentElement.clientHeight}}function Vi(t,e){return"number"==typeof t?t:t[e]}function qi(t){var e=t.getBoundingClientRect(),n=e.width/t.offsetWidth||1,r=e.height/t.offsetHeight||1;return{left:e.left,right:e.left+t.clientWidth*n,top:e.top,bottom:e.top+t.clientHeight*r}}function Wi(t,e,n){for(var r=t.someProp("scrollThreshold")||0,o=t.someProp("scrollMargin")||5,i=t.dom.ownerDocument,s=n||t.dom;;s=Di(s)){if(!s)break;if(1==s.nodeType){var a=s==i.body||1!=s.nodeType,c=a?Li(i):qi(s),h=0,p=0;if(e.top<c.top+Vi(r,"top")?p=-(c.top-e.top+Vi(o,"top")):e.bottom>c.bottom-Vi(r,"bottom")&&(p=e.bottom-c.bottom+Vi(o,"bottom")),e.left<c.left+Vi(r,"left")?h=-(c.left-e.left+Vi(o,"left")):e.right>c.right-Vi(r,"right")&&(h=e.right-c.right+Vi(o,"right")),h||p)if(a)i.defaultView.scrollBy(h,p);else{var l=s.scrollLeft,u=s.scrollTop;p&&(s.scrollTop+=p),h&&(s.scrollLeft+=h);var f=s.scrollLeft-l,d=s.scrollTop-u;e={left:e.left-f,top:e.top-d,right:e.right-f,bottom:e.bottom-d}}if(a)break}}}function Hi(t){for(var e,n,r=t.dom.getBoundingClientRect(),o=Math.max(0,r.top),i=(r.left+r.right)/2,s=o+1;s<Math.min(innerHeight,r.bottom);s+=5){var a=t.root.elementFromPoint(i,s);if(a!=t.dom&&t.dom.contains(a)){var c=a.getBoundingClientRect();if(c.top>=o-20){e=a,n=c.top;break}}}return{refDOM:e,refTop:n,stack:Ki(t.dom)}}function Ki(t){for(var e=[],n=t.ownerDocument;t;t=Di(t))if(e.push({dom:t,top:t.scrollTop,left:t.scrollLeft}),t==n)break;return e}function Ui(t){var e=t.refDOM,n=t.refTop,r=t.stack,o=e?e.getBoundingClientRect().top:0;Gi(r,0==o?0:o-n)}function Gi(t,e){for(var n=0;n<t.length;n++){var r=t[n],o=r.dom,i=r.top,s=r.left;o.scrollTop!=i+e&&(o.scrollTop=i+e),o.scrollLeft!=s&&(o.scrollLeft=s)}}var Xi=null;function Yi(t){if(t.setActive)return t.setActive();if(Xi)return t.focus(Xi);var e=Ki(t);t.focus(null==Xi?{get preventScroll(){return Xi={preventScroll:!0},!0}}:void 0),Xi||(Xi=!1,Gi(e,0))}function Zi(t,e){for(var n,r,o=2e8,i=0,s=e.top,a=e.top,c=t.firstChild,h=0;c;c=c.nextSibling,h++){var p=void 0;if(1==c.nodeType)p=c.getClientRects();else{if(3!=c.nodeType)continue;p=zi(c).getClientRects()}for(var l=0;l<p.length;l++){var u=p[l];if(u.top<=s&&u.bottom>=a){s=Math.max(u.bottom,s),a=Math.min(u.top,a);var f=u.left>e.left?u.left-e.left:u.right<e.left?e.left-u.right:0;if(f<o){n=c,o=f,r=f&&3==n.nodeType?{left:u.right<e.left?u.right:u.left,top:e.top}:e,1==c.nodeType&&f&&(i=h+(e.left>=(u.left+u.right)/2?1:0));continue}}!n&&(e.left>=u.right&&e.top>=u.top||e.left>=u.left&&e.top>=u.bottom)&&(i=h+1)}}return n&&3==n.nodeType?Qi(n,r):!n||o&&1==n.nodeType?{node:t,offset:i}:Zi(n,r)}function Qi(t,e){for(var n=t.nodeValue.length,r=document.createRange(),o=0;o<n;o++){r.setEnd(t,o+1),r.setStart(t,o);var i=as(r,1);if(i.top!=i.bottom&&ts(e,i))return{node:t,offset:o+(e.left>=(i.left+i.right)/2?1:0)}}return{node:t,offset:0}}function ts(t,e){return t.left>=e.left-1&&t.left<=e.right+1&&t.top>=e.top-1&&t.top<=e.bottom+1}function es(t,e){var n=t.parentNode;return n&&/^li$/i.test(n.nodeName)&&e.left<t.getBoundingClientRect().left?n:t}function ns(t,e,n){var r=Zi(e,n),o=r.node,i=r.offset,s=-1;if(1==o.nodeType&&!o.firstChild){var a=o.getBoundingClientRect();s=a.left!=a.right&&n.left>(a.left+a.right)/2?1:-1}return t.docView.posFromDOM(o,i,s)}function rs(t,e,n,r){for(var o=-1,i=e;;){if(i==t.dom)break;var s=t.docView.nearestDesc(i,!0);if(!s)return null;if(s.node.isBlock&&s.parent){var a=s.dom.getBoundingClientRect();if(a.left>r.left||a.top>r.top)o=s.posBefore;else{if(!(a.right<r.left||a.bottom<r.top))break;o=s.posAfter}}i=s.dom.parentNode}return o>-1?o:t.docView.posFromDOM(e,n)}function is(t,e,n){var r=t.childNodes.length;if(r&&n.top<n.bottom)for(var o=Math.max(0,Math.min(r-1,Math.floor(r*(e.top-n.top)/(n.bottom-n.top))-2)),i=o;;){var s=t.childNodes[i];if(1==s.nodeType)for(var a=s.getClientRects(),c=0;c<a.length;c++){var h=a[c];if(ts(e,h))return is(s,e,h)}if((i=(i+1)%r)==o)break}return t}function ss(t,e){var n,r,o,i,s=t.root;if(s.caretPositionFromPoint)try{var a=s.caretPositionFromPoint(e.left,e.top);a&&(n=a,o=n.offsetNode,i=n.offset)}catch(v){}if(!o&&s.caretRangeFromPoint){var c=s.caretRangeFromPoint(e.left,e.top);c&&(r=c,o=r.startContainer,i=r.startOffset)}var h,p=s.elementFromPoint(e.left,e.top+1);if(!p||!t.dom.contains(1!=p.nodeType?p.parentNode:p)){var l=t.dom.getBoundingClientRect();if(!ts(e,l))return null;if(p=is(t.dom,e,l),!p)return null}if(Oi.safari)for(var u=p;o&&u;u=Di(u))u.draggable&&(o=i=null);if(p=es(p,e),o){if(Oi.gecko&&1==o.nodeType&&(i=Math.min(i,o.childNodes.length),i<o.childNodes.length)){var f,d=o.childNodes[i];"IMG"==d.nodeName&&(f=d.getBoundingClientRect()).right<=e.left&&f.bottom>e.top&&i++}o==t.dom&&i==o.childNodes.length-1&&1==o.lastChild.nodeType&&e.top>o.lastChild.getBoundingClientRect().bottom?h=t.state.doc.content.size:0!=i&&1==o.nodeType&&"BR"==o.childNodes[i-1].nodeName||(h=rs(t,o,i,e))}null==h&&(h=ns(t,p,e));var m=t.docView.nearestDesc(p,!0);return{pos:h,inside:m?m.posAtStart-m.border:-1}}function as(t,e){var n=t.getClientRects();return n.length?n[e<0?0:n.length-1]:t.getBoundingClientRect()}var cs=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function hs(t,e,n){var r=t.docView.domFromPos(e,n<0?-1:1),o=r.node,i=r.offset,s=Oi.webkit||Oi.gecko;if(3==o.nodeType){if(!s||!cs.test(o.nodeValue)&&(n<0?i:i!=o.nodeValue.length)){var a=i,c=i,h=n<0?1:-1;return n<0&&!i?(c++,h=-1):n>=0&&i==o.nodeValue.length?(a--,h=1):n<0?a--:c++,ps(as(zi(o,a,c),h),h<0)}var p=as(zi(o,i,i),n);if(Oi.gecko&&i&&/\s/.test(o.nodeValue[i-1])&&i<o.nodeValue.length){var l=as(zi(o,i-1,i-1),-1);if(l.top==p.top){var u=as(zi(o,i,i+1),-1);if(u.top!=p.top)return ps(u,u.left<l.left)}}return p}if(!t.state.doc.resolve(e).parent.inlineContent){if(i&&(n<0||i==Bi(o))){var f=o.childNodes[i-1];if(1==f.nodeType)return ls(f.getBoundingClientRect(),!1)}if(i<Bi(o)){var d=o.childNodes[i];if(1==d.nodeType)return ls(d.getBoundingClientRect(),!0)}return ls(o.getBoundingClientRect(),n>=0)}if(i&&(n<0||i==Bi(o))){var m=o.childNodes[i-1],v=3==m.nodeType?zi(m,Bi(m)-(s?0:1)):1!=m.nodeType||"BR"==m.nodeName&&m.nextSibling?null:m;if(v)return ps(as(v,1),!1)}if(i<Bi(o)){var g=o.childNodes[i],y=3==g.nodeType?zi(g,0,s?0:1):1==g.nodeType?g:null;if(y)return ps(as(y,-1),!0)}return ps(as(3==o.nodeType?zi(o):o,-n),n>=0)}function ps(t,e){if(0==t.width)return t;var n=e?t.left:t.right;return{top:t.top,bottom:t.bottom,left:n,right:n}}function ls(t,e){if(0==t.height)return t;var n=e?t.top:t.bottom;return{top:n,bottom:n,left:t.left,right:t.right}}function us(t,e,n){var r=t.state,o=t.root.activeElement;r!=e&&t.updateState(e),o!=t.dom&&t.focus();try{return n()}finally{r!=e&&t.updateState(r),o!=t.dom&&o&&o.focus()}}function fs(t,e,n){var r=e.selection,o="up"==n?r.$from:r.$to;return us(t,e,(function(){for(var e=t.docView.domFromPos(o.pos,"up"==n?-1:1),r=e.node;;){var i=t.docView.nearestDesc(r,!0);if(!i)break;if(i.node.isBlock){r=i.dom;break}r=i.dom.parentNode}for(var s=hs(t,o.pos,1),a=r.firstChild;a;a=a.nextSibling){var c=void 0;if(1==a.nodeType)c=a.getClientRects();else{if(3!=a.nodeType)continue;c=zi(a,0,a.nodeValue.length).getClientRects()}for(var h=0;h<c.length;h++){var p=c[h];if(p.bottom>p.top&&("up"==n?p.bottom<s.top+1:p.top>s.bottom-1))return!1}}return!0}))}var ds=/[\u0590-\u08ac]/;function ms(t,e,n){var r=e.selection,o=r.$head;if(!o.parent.isTextblock)return!1;var i=o.parentOffset,s=!i,a=i==o.parent.content.size,c=getSelection();return ds.test(o.parent.textContent)&&c.modify?us(t,e,(function(){var e=c.getRangeAt(0),r=c.focusNode,i=c.focusOffset,s=c.caretBidiLevel;c.modify("move",n,"character");var a=o.depth?t.docView.domAfterPos(o.before()):t.dom,h=!a.contains(1==c.focusNode.nodeType?c.focusNode:c.focusNode.parentNode)||r==c.focusNode&&i==c.focusOffset;return c.removeAllRanges(),c.addRange(e),null!=s&&(c.caretBidiLevel=s),h})):"left"==n||"backward"==n?s:a}var vs=null,gs=null,ys=!1;function ws(t,e,n){return vs==e&&gs==n?ys:(vs=e,gs=n,ys="up"==n||"down"==n?fs(t,e,n):ms(t,e,n))}var xs=0,bs=1,ks=2,Ss=3,Os=function(t,e,n,r){this.parent=t,this.children=e,this.dom=n,n.pmViewDesc=this,this.contentDOM=r,this.dirty=xs},Cs={beforePosition:{configurable:!0},size:{configurable:!0},border:{configurable:!0},posBefore:{configurable:!0},posAtStart:{configurable:!0},posAfter:{configurable:!0},posAtEnd:{configurable:!0},contentLost:{configurable:!0},domAtom:{configurable:!0}};Os.prototype.matchesWidget=function(){return!1},Os.prototype.matchesMark=function(){return!1},Os.prototype.matchesNode=function(){return!1},Os.prototype.matchesHack=function(){return!1},Cs.beforePosition.get=function(){return!1},Os.prototype.parseRule=function(){return null},Os.prototype.stopEvent=function(){return!1},Cs.size.get=function(){for(var t=0,e=0;e<this.children.length;e++)t+=this.children[e].size;return t},Cs.border.get=function(){return 0},Os.prototype.destroy=function(){this.parent=null,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=null);for(var t=0;t<this.children.length;t++)this.children[t].destroy()},Os.prototype.posBeforeChild=function(t){for(var e=0,n=this.posAtStart;e<this.children.length;e++){var r=this.children[e];if(r==t)return n;n+=r.size}},Cs.posBefore.get=function(){return this.parent.posBeforeChild(this)},Cs.posAtStart.get=function(){return this.parent?this.parent.posBeforeChild(this)+this.border:0},Cs.posAfter.get=function(){return this.posBefore+this.size},Cs.posAtEnd.get=function(){return this.posAtStart+this.size-2*this.border},Os.prototype.localPosFromDOM=function(t,e,n){if(this.contentDOM&&this.contentDOM.contains(1==t.nodeType?t:t.parentNode)){if(n<0){var r,o;if(t==this.contentDOM)r=t.childNodes[e-1];else{while(t.parentNode!=this.contentDOM)t=t.parentNode;r=t.previousSibling}while(r&&(!(o=r.pmViewDesc)||o.parent!=this))r=r.previousSibling;return r?this.posBeforeChild(o)+o.size:this.posAtStart}var i,s;if(t==this.contentDOM)i=t.childNodes[e];else{while(t.parentNode!=this.contentDOM)t=t.parentNode;i=t.nextSibling}while(i&&(!(s=i.pmViewDesc)||s.parent!=this))i=i.nextSibling;return i?this.posBeforeChild(s):this.posAtEnd}var a;if(t==this.dom&&this.contentDOM)a=e>Ai(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))a=2&t.compareDocumentPosition(this.contentDOM);else if(this.dom.firstChild){if(0==e)for(var c=t;;c=c.parentNode){if(c==this.dom){a=!1;break}if(c.parentNode.firstChild!=c)break}if(null==a&&e==t.childNodes.length)for(var h=t;;h=h.parentNode){if(h==this.dom){a=!0;break}if(h.parentNode.lastChild!=h)break}}return(null==a?n>0:a)?this.posAtEnd:this.posAtStart},Os.prototype.nearestDesc=function(t,e){for(var n=!0,r=t;r;r=r.parentNode){var o=this.getDesc(r);if(o&&(!e||o.node)){if(!n||!o.nodeDOM||(1==o.nodeDOM.nodeType?o.nodeDOM.contains(1==t.nodeType?t:t.parentNode):o.nodeDOM==t))return o;n=!1}}},Os.prototype.getDesc=function(t){for(var e=t.pmViewDesc,n=e;n;n=n.parent)if(n==this)return e},Os.prototype.posFromDOM=function(t,e,n){for(var r=t;r;r=r.parentNode){var o=this.getDesc(r);if(o)return o.localPosFromDOM(t,e,n)}return-1},Os.prototype.descAt=function(t){for(var e=0,n=0;e<this.children.length;e++){var r=this.children[e],o=n+r.size;if(n==t&&o!=n){while(!r.border&&r.children.length)r=r.children[0];return r}if(t<o)return r.descAt(t-n-r.border);n=o}},Os.prototype.domFromPos=function(t,e){if(!this.contentDOM)return{node:this.dom,offset:0};for(var n=0,r=0,o=!0;;r++,o=!1){while(r<this.children.length&&(this.children[r].beforePosition||this.children[r].dom.parentNode!=this.contentDOM))n+=this.children[r++].size;var i=r==this.children.length?null:this.children[r];if(n==t&&(0==e||!i||!i.size||i.border||e<0&&o)||i&&i.domAtom&&t<n+i.size)return{node:this.contentDOM,offset:i?Ai(i.dom):this.contentDOM.childNodes.length};if(!i)throw new Error("Invalid position "+t);var s=n+i.size;if(!i.domAtom&&(e<0&&!i.border?s>=t:s>t)&&(s>t||r+1>=this.children.length||!this.children[r+1].beforePosition))return i.domFromPos(t-n-i.border,e);n=s}},Os.prototype.parseRange=function(t,e,n){if(void 0===n&&(n=0),0==this.children.length)return{node:this.contentDOM,from:t,to:e,fromOffset:0,toOffset:this.contentDOM.childNodes.length};for(var r=-1,o=-1,i=n,s=0;;s++){var a=this.children[s],c=i+a.size;if(-1==r&&t<=c){var h=i+a.border;if(t>=h&&e<=c-a.border&&a.node&&a.contentDOM&&this.contentDOM.contains(a.contentDOM))return a.parseRange(t,e,h);t=i;for(var p=s;p>0;p--){var l=this.children[p-1];if(l.size&&l.dom.parentNode==this.contentDOM&&!l.emptyChildAt(1)){r=Ai(l.dom)+1;break}t-=l.size}-1==r&&(r=0)}if(r>-1&&(c>e||s==this.children.length-1)){e=c;for(var u=s+1;u<this.children.length;u++){var f=this.children[u];if(f.size&&f.dom.parentNode==this.contentDOM&&!f.emptyChildAt(-1)){o=Ai(f.dom);break}e+=f.size}-1==o&&(o=this.contentDOM.childNodes.length);break}i=c}return{node:this.contentDOM,from:t,to:e,fromOffset:r,toOffset:o}},Os.prototype.emptyChildAt=function(t){if(this.border||!this.contentDOM||!this.children.length)return!1;var e=this.children[t<0?0:this.children.length-1];return 0==e.size||e.emptyChildAt(t)},Os.prototype.domAfterPos=function(t){var e=this.domFromPos(t,0),n=e.node,r=e.offset;if(1!=n.nodeType||r==n.childNodes.length)throw new RangeError("No node after pos "+t);return n.childNodes[r]},Os.prototype.setSelection=function(t,e,n,r){for(var o=Math.min(t,e),i=Math.max(t,e),s=0,a=0;s<this.children.length;s++){var c=this.children[s],h=a+c.size;if(o>a&&i<h)return c.setSelection(t-a-c.border,e-a-c.border,n,r);a=h}var p=this.domFromPos(t,t?-1:1),l=e==t?p:this.domFromPos(e,e?-1:1),u=n.getSelection(),f=!1;if((Oi.gecko||Oi.safari)&&t==e){var d=p.node,m=p.offset;if(3==d.nodeType)f=m&&"\n"==d.nodeValue[m-1],f&&m==d.nodeValue.length&&d.nextSibling&&"BR"==d.nextSibling.nodeName&&(p=l={node:d.parentNode,offset:Ai(d)+1});else{var v=d.childNodes[m-1];f=v&&("BR"==v.nodeName||"false"==v.contentEditable)}}if(Oi.gecko&&u.focusNode&&u.focusNode!=l.node&&1==u.focusNode.nodeType){var g=u.focusNode.childNodes[u.focusOffset];g&&"false"==g.contentEditable&&(r=!0)}if(r||f&&Oi.safari||!Ii(p.node,p.offset,u.anchorNode,u.anchorOffset)||!Ii(l.node,l.offset,u.focusNode,u.focusOffset)){var y=!1;if((u.extend||t==e)&&!f){u.collapse(p.node,p.offset);try{t!=e&&u.extend(l.node,l.offset),y=!0}catch(b){if(!(b instanceof DOMException))throw b}}if(!y){if(t>e){var w=p;p=l,l=w}var x=document.createRange();x.setEnd(l.node,l.offset),x.setStart(p.node,p.offset),u.removeAllRanges(),u.addRange(x)}}},Os.prototype.ignoreMutation=function(t){return!this.contentDOM&&"selection"!=t.type},Cs.contentLost.get=function(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)},Os.prototype.markDirty=function(t,e){for(var n=0,r=0;r<this.children.length;r++){var o=this.children[r],i=n+o.size;if(n==i?t<=i&&e>=n:t<i&&e>n){var s=n+o.border,a=i-o.border;if(t>=s&&e<=a)return this.dirty=t==n||e==i?ks:bs,void(t!=s||e!=a||!o.contentLost&&o.dom.parentNode==this.contentDOM?o.markDirty(t-s,e-s):o.dirty=Ss);o.dirty=Ss}n=i}this.dirty=ks},Os.prototype.markParentsDirty=function(){for(var t=1,e=this.parent;e;e=e.parent,t++){var n=1==t?ks:bs;e.dirty<n&&(e.dirty=n)}},Cs.domAtom.get=function(){return!1},Object.defineProperties(Os.prototype,Cs);var Ms=[],Ns=function(t){function e(e,n,r,o){var i,s=n.type.toDOM;if("function"==typeof s&&(s=s(r,(function(){return i?i.parent?i.parent.posBeforeChild(i):void 0:o}))),!n.type.spec.raw){if(1!=s.nodeType){var a=document.createElement("span");a.appendChild(s),s=a}s.contentEditable=!1,s.classList.add("ProseMirror-widget")}t.call(this,e,Ms,s,null),this.widget=n,i=this}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={beforePosition:{configurable:!0},domAtom:{configurable:!0}};return n.beforePosition.get=function(){return this.widget.type.side<0},e.prototype.matchesWidget=function(t){return this.dirty==xs&&t.type.eq(this.widget.type)},e.prototype.parseRule=function(){return{ignore:!0}},e.prototype.stopEvent=function(t){var e=this.widget.spec.stopEvent;return!!e&&e(t)},e.prototype.ignoreMutation=function(t){return"selection"!=t.type||this.widget.spec.ignoreSelection},n.domAtom.get=function(){return!0},Object.defineProperties(e.prototype,n),e}(Os),Ts=function(t){function e(e,n,r,o){t.call(this,e,Ms,n,null),this.textDOM=r,this.text=o}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={size:{configurable:!0}};return n.size.get=function(){return this.text.length},e.prototype.localPosFromDOM=function(t,e){return t!=this.textDOM?this.posAtStart+(e?this.size:0):this.posAtStart+e},e.prototype.domFromPos=function(t){return{node:this.textDOM,offset:t}},e.prototype.ignoreMutation=function(t){return"characterData"===t.type&&t.target.nodeValue==t.oldValue},Object.defineProperties(e.prototype,n),e}(Os),Es=function(t){function e(e,n,r,o){t.call(this,e,[],r,o),this.mark=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.create=function(t,n,r,o){var i=o.nodeViews[n.type.name],s=i&&i(n,o,r);return s&&s.dom||(s=Ko.renderSpec(document,n.type.spec.toDOM(n,r))),new e(t,n,s.dom,s.contentDOM||s.dom)},e.prototype.parseRule=function(){return{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}},e.prototype.matchesMark=function(t){return this.dirty!=Ss&&this.mark.eq(t)},e.prototype.markDirty=function(e,n){if(t.prototype.markDirty.call(this,e,n),this.dirty!=xs){var r=this.parent;while(!r.node)r=r.parent;r.dirty<this.dirty&&(r.dirty=this.dirty),this.dirty=xs}},e.prototype.slice=function(t,n,r){var o=e.create(this.parent,this.mark,!0,r),i=this.children,s=this.size;n<s&&(i=Ys(i,n,s,r)),t>0&&(i=Ys(i,0,t,r));for(var a=0;a<i.length;a++)i[a].parent=o;return o.children=i,o},e}(Os),As=function(t){function e(e,n,r,o,i,s,a,c,h){t.call(this,e,n.isLeaf?Ms:[],i,s),this.nodeDOM=a,this.node=n,this.outerDeco=r,this.innerDeco=o,s&&this.updateChildren(c,h)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={size:{configurable:!0},border:{configurable:!0},domAtom:{configurable:!0}};return e.create=function(t,n,r,o,i,s){var a,c,h=i.nodeViews[n.type.name],p=h&&h(n,i,(function(){return c?c.parent?c.parent.posBeforeChild(c):void 0:s}),r,o),l=p&&p.dom,u=p&&p.contentDOM;if(n.isText)if(l){if(3!=l.nodeType)throw new RangeError("Text must be rendered as a DOM text node")}else l=document.createTextNode(n.text);else l||(a=Ko.renderSpec(document,n.type.spec.toDOM(n)),l=a.dom,u=a.contentDOM);u||n.isText||"BR"==l.nodeName||(l.hasAttribute("contenteditable")||(l.contentEditable=!1),n.type.spec.draggable&&(l.draggable=!0));var f=l;return l=Js(l,r,n),p?c=new Is(t,n,r,o,l,u,f,p,i,s+1):n.isText?new Rs(t,n,r,o,l,f,i):new e(t,n,r,o,l,u,f,i,s+1)},e.prototype.parseRule=function(){var t=this;if(this.node.type.spec.reparseInView)return null;var e={node:this.node.type.name,attrs:this.node.attrs};return this.node.type.spec.code&&(e.preserveWhitespace="full"),this.contentDOM&&!this.contentLost?e.contentElement=this.contentDOM:e.getContent=function(){return t.contentDOM?Cr.empty:t.node.content},e},e.prototype.matchesNode=function(t,e,n){return this.dirty==xs&&t.eq(this.node)&&Ls(e,this.outerDeco)&&n.eq(this.innerDeco)},n.size.get=function(){return this.node.nodeSize},n.border.get=function(){return this.node.isLeaf?0:1},e.prototype.updateChildren=function(t,e){var n=this,r=this.node.inlineContent,o=e,i=r&&t.composing&&this.localCompositionNode(t,e),s=new qs(this,i&&i.node);Ks(this.node,this.innerDeco,(function(e,i,a){e.spec.marks?s.syncToMarks(e.spec.marks,r,t):e.type.side>=0&&!a&&s.syncToMarks(i==n.node.childCount?Ar.none:n.node.child(i).marks,r,t),s.placeWidget(e,t,o)}),(function(e,n,i,a){s.syncToMarks(e.marks,r,t),s.findNodeMatch(e,n,i,a)||s.updateNextNode(e,n,i,t,a)||s.addNode(e,n,i,t,o),o+=e.nodeSize})),s.syncToMarks(Ms,r,t),this.node.isTextblock&&s.addTextblockHacks(),s.destroyRest(),(s.changed||this.dirty==ks)&&(i&&this.protectLocalComposition(t,i),Ps(this.contentDOM,this.children,t),Oi.ios&&Us(this.dom))},e.prototype.localCompositionNode=function(t,e){var n=t.state.selection,r=n.from,o=n.to;if(!(!(t.state.selection instanceof ti)||r<e||o>e+this.node.content.size)){var i=t.root.getSelection(),s=Gs(i.focusNode,i.focusOffset);if(s&&this.dom.contains(s.parentNode)){var a=s.nodeValue,c=Xs(this.node.content,a,r-e,o-e);return c<0?null:{node:s,pos:c,text:a}}}},e.prototype.protectLocalComposition=function(t,e){var n=e.node,r=e.pos,o=e.text;if(!this.getDesc(n)){for(var i=n;;i=i.parentNode){if(i.parentNode==this.contentDOM)break;while(i.previousSibling)i.parentNode.removeChild(i.previousSibling);while(i.nextSibling)i.parentNode.removeChild(i.nextSibling);i.pmViewDesc&&(i.pmViewDesc=null)}var s=new Ts(this,i,n,o);t.compositionNodes.push(s),this.children=Ys(this.children,r,r+o.length,t,s)}},e.prototype.update=function(t,e,n,r){return!(this.dirty==Ss||!t.sameMarkup(this.node))&&(this.updateInner(t,e,n,r),!0)},e.prototype.updateInner=function(t,e,n,r){this.updateOuterDeco(e),this.node=t,this.innerDeco=n,this.contentDOM&&this.updateChildren(r,this.posAtStart),this.dirty=xs},e.prototype.updateOuterDeco=function(t){if(!Ls(t,this.outerDeco)){var e=1!=this.nodeDOM.nodeType,n=this.dom;this.dom=_s(this.dom,this.nodeDOM,$s(this.outerDeco,this.node,e),$s(t,this.node,e)),this.dom!=n&&(n.pmViewDesc=null,this.dom.pmViewDesc=this),this.outerDeco=t}},e.prototype.selectNode=function(){this.nodeDOM.classList.add("ProseMirror-selectednode"),!this.contentDOM&&this.node.type.spec.draggable||(this.dom.draggable=!0)},e.prototype.deselectNode=function(){this.nodeDOM.classList.remove("ProseMirror-selectednode"),!this.contentDOM&&this.node.type.spec.draggable||this.dom.removeAttribute("draggable")},n.domAtom.get=function(){return this.node.isAtom},Object.defineProperties(e.prototype,n),e}(Os);function Ds(t,e,n,r,o){return Js(r,e,t),new As(null,t,e,n,r,r,r,o,0)}var Rs=function(t){function e(e,n,r,o,i,s,a){t.call(this,e,n,r,o,i,null,s,a)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={domAtom:{configurable:!0}};return e.prototype.parseRule=function(){var t=this.nodeDOM.parentNode;while(t&&t!=this.dom&&!t.pmIsDeco)t=t.parentNode;return{skip:t||!0}},e.prototype.update=function(t,e,n,r){return!(this.dirty==Ss||this.dirty!=xs&&!this.inParent()||!t.sameMarkup(this.node))&&(this.updateOuterDeco(e),this.dirty==xs&&t.text==this.node.text||t.text==this.nodeDOM.nodeValue||(this.nodeDOM.nodeValue=t.text,r.trackWrites==this.nodeDOM&&(r.trackWrites=null)),this.node=t,this.dirty=xs,!0)},e.prototype.inParent=function(){for(var t=this.parent.contentDOM,e=this.nodeDOM;e;e=e.parentNode)if(e==t)return!0;return!1},e.prototype.domFromPos=function(t){return{node:this.nodeDOM,offset:t}},e.prototype.localPosFromDOM=function(e,n,r){return e==this.nodeDOM?this.posAtStart+Math.min(n,this.node.text.length):t.prototype.localPosFromDOM.call(this,e,n,r)},e.prototype.ignoreMutation=function(t){return"characterData"!=t.type&&"selection"!=t.type},e.prototype.slice=function(t,n,r){var o=this.node.cut(t,n),i=document.createTextNode(o.text);return new e(this.parent,o,this.outerDeco,this.innerDeco,i,i,r)},n.domAtom.get=function(){return!1},Object.defineProperties(e.prototype,n),e}(As),zs=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={domAtom:{configurable:!0}};return e.prototype.parseRule=function(){return{ignore:!0}},e.prototype.matchesHack=function(){return this.dirty==xs},n.domAtom.get=function(){return!0},Object.defineProperties(e.prototype,n),e}(Os),Is=function(t){function e(e,n,r,o,i,s,a,c,h,p){t.call(this,e,n,r,o,i,s,a,h,p),this.spec=c}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.update=function(e,n,r,o){if(this.dirty==Ss)return!1;if(this.spec.update){var i=this.spec.update(e,n,r);return i&&this.updateInner(e,n,r,o),i}return!(!this.contentDOM&&!e.isLeaf)&&t.prototype.update.call(this,e,n,r,o)},e.prototype.selectNode=function(){this.spec.selectNode?this.spec.selectNode():t.prototype.selectNode.call(this)},e.prototype.deselectNode=function(){this.spec.deselectNode?this.spec.deselectNode():t.prototype.deselectNode.call(this)},e.prototype.setSelection=function(e,n,r,o){this.spec.setSelection?this.spec.setSelection(e,n,r):t.prototype.setSelection.call(this,e,n,r,o)},e.prototype.destroy=function(){this.spec.destroy&&this.spec.destroy(),t.prototype.destroy.call(this)},e.prototype.stopEvent=function(t){return!!this.spec.stopEvent&&this.spec.stopEvent(t)},e.prototype.ignoreMutation=function(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):t.prototype.ignoreMutation.call(this,e)},e}(As);function Ps(t,e,n){for(var r=t.firstChild,o=!1,i=0;i<e.length;i++){var s=e[i],a=s.dom;if(a.parentNode==t){while(a!=r)r=Vs(r),o=!0;r=r.nextSibling}else o=!0,t.insertBefore(a,r);if(s instanceof Es){var c=r?r.previousSibling:t.lastChild;Ps(s.contentDOM,s.children,n),r=c?c.nextSibling:t.firstChild}}while(r)r=Vs(r),o=!0;o&&n.trackWrites==t&&(n.trackWrites=null)}function Fs(t){t&&(this.nodeName=t)}Fs.prototype=Object.create(null);var Bs=[new Fs];function $s(t,e,n){if(0==t.length)return Bs;for(var r=n?Bs[0]:new Fs,o=[r],i=0;i<t.length;i++){var s=t[i].type.attrs;if(s)for(var a in s.nodeName&&o.push(r=new Fs(s.nodeName)),s){var c=s[a];null!=c&&(n&&1==o.length&&o.push(r=new Fs(e.isInline?"span":"div")),"class"==a?r.class=(r.class?r.class+" ":"")+c:"style"==a?r.style=(r.style?r.style+";":"")+c:"nodeName"!=a&&(r[a]=c))}}return o}function _s(t,e,n,r){if(n==Bs&&r==Bs)return e;for(var o=e,i=0;i<r.length;i++){var s=r[i],a=n[i];if(i){var c=void 0;a&&a.nodeName==s.nodeName&&o!=t&&(c=o.parentNode)&&c.tagName.toLowerCase()==s.nodeName||(c=document.createElement(s.nodeName),c.pmIsDeco=!0,c.appendChild(o),a=Bs[0]),o=c}js(o,a||Bs[0],s)}return o}function js(t,e,n){for(var r in e)"class"==r||"style"==r||"nodeName"==r||r in n||t.removeAttribute(r);for(var o in n)"class"!=o&&"style"!=o&&"nodeName"!=o&&n[o]!=e[o]&&t.setAttribute(o,n[o]);if(e.class!=n.class){for(var i=e.class?e.class.split(" ").filter(Boolean):Ms,s=n.class?n.class.split(" ").filter(Boolean):Ms,a=0;a<i.length;a++)-1==s.indexOf(i[a])&&t.classList.remove(i[a]);for(var c=0;c<s.length;c++)-1==i.indexOf(s[c])&&t.classList.add(s[c])}if(e.style!=n.style){if(e.style){var h,p=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g;while(h=p.exec(e.style))t.style.removeProperty(h[1])}n.style&&(t.style.cssText+=n.style)}}function Js(t,e,n){return _s(t,t,Bs,$s(e,n,1!=t.nodeType))}function Ls(t,e){if(t.length!=e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].type.eq(e[n].type))return!1;return!0}function Vs(t){var e=t.nextSibling;return t.parentNode.removeChild(t),e}var qs=function(t,e){this.top=t,this.lock=e,this.index=0,this.stack=[],this.changed=!1,this.preMatch=Ws(t.node.content,t.children)};function Ws(t,e){for(var n=t.childCount,r=e.length,o=new Map;n>0&&r>0;r--){var i=e[r-1],s=i.node;if(s){if(s!=t.child(n-1))break;--n,o.set(i,n)}}return{index:n,matched:o}}function Hs(t,e){return t.type.side-e.type.side}function Ks(t,e,n,r){var o=e.locals(t),i=0;if(0!=o.length)for(var s=0,a=[],c=null,h=0;;){if(s<o.length&&o[s].to==i){var p=o[s++],l=void 0;while(s<o.length&&o[s].to==i)(l||(l=[p])).push(o[s++]);if(l){l.sort(Hs);for(var u=0;u<l.length;u++)n(l[u],h,!!c)}else n(p,h,!!c)}var f=void 0,d=void 0;if(c)d=-1,f=c,c=null;else{if(!(h<t.childCount))break;d=h,f=t.child(h++)}for(var m=0;m<a.length;m++)a[m].to<=i&&a.splice(m--,1);while(s<o.length&&o[s].from<=i&&o[s].to>i)a.push(o[s++]);var v=i+f.nodeSize;if(f.isText){var g=v;s<o.length&&o[s].from<g&&(g=o[s].from);for(var y=0;y<a.length;y++)a[y].to<g&&(g=a[y].to);g<v&&(c=f.cut(g-i),f=f.cut(0,g-i),v=g,d=-1)}var w=a.length?f.isInline&&!f.isLeaf?a.filter((function(t){return!t.inline})):a.slice():Ms;r(f,w,e.forChild(i,f),d),i=v}else for(var x=0;x<t.childCount;x++){var b=t.child(x);r(b,o,e.forChild(i,b),x),i+=b.nodeSize}}function Us(t){if("UL"==t.nodeName||"OL"==t.nodeName){var e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t).listStyle,t.style.cssText=e}}function Gs(t,e){for(;;){if(3==t.nodeType)return t;if(1==t.nodeType&&e>0){if(t.childNodes.length>e&&3==t.childNodes[e].nodeType)return t.childNodes[e];t=t.childNodes[e-1],e=Bi(t)}else{if(!(1==t.nodeType&&e<t.childNodes.length))return null;t=t.childNodes[e],e=0}}}function Xs(t,e,n,r){for(var o=0,i=0;o<t.childCount&&i<=r;){var s=t.child(o++),a=i;if(i+=s.nodeSize,s.isText){var c=s.text;while(o<t.childCount){var h=t.child(o++);if(i+=h.nodeSize,!h.isText)break;c+=h.text}if(i>=n){var p=c.lastIndexOf(e,r-a);if(p>=0&&p+e.length+a>=n)return a+p}}}return-1}function Ys(t,e,n,r,o){for(var i=[],s=0,a=0;s<t.length;s++){var c=t[s],h=a,p=a+=c.size;h>=n||p<=e?i.push(c):(h<e&&i.push(c.slice(0,e-h,r)),o&&(i.push(o),o=null),p>n&&i.push(c.slice(n-h,c.size,r)))}return i}function Zs(t,e){var n=t.root.getSelection(),r=t.state.doc;if(!n.focusNode)return null;var o=t.docView.nearestDesc(n.focusNode),i=o&&0==o.size,s=t.docView.posFromDOM(n.focusNode,n.focusOffset);if(s<0)return null;var a,c,h=r.resolve(s);if(ji(n)){a=h;while(o&&!o.node)o=o.parent;if(o&&o.node.isAtom&&ni.isSelectable(o.node)&&o.parent&&(!o.node.isInline||!$i(n.focusNode,n.focusOffset,o.dom))){var p=o.posBefore;c=new ni(s==p?h:r.resolve(p))}}else{var l=t.docView.posFromDOM(n.anchorNode,n.anchorOffset);if(l<0)return null;a=r.resolve(l)}if(!c){var u="pointer"==e||t.state.selection.head<h.pos&&!i?1:-1;c=ha(t,a,h,u)}return c}function Qs(t){return t.editable?t.hasFocus():la(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function ta(t,e){var n=t.state.selection;if(aa(t,n),Qs(t)){if(t.domObserver.disconnectSelection(),t.cursorWrapper)sa(t);else{var r,o,i=n.anchor,s=n.head;!ea||n instanceof ti||(n.$from.parent.inlineContent||(r=na(t,n.from)),n.empty||n.$from.parent.inlineContent||(o=na(t,n.to))),t.docView.setSelection(i,s,t.root,e),ea&&(r&&oa(r),o&&oa(o)),n.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&ia(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}qs.prototype.destroyBetween=function(t,e){if(t!=e){for(var n=t;n<e;n++)this.top.children[n].destroy();this.top.children.splice(t,e-t),this.changed=!0}},qs.prototype.destroyRest=function(){this.destroyBetween(this.index,this.top.children.length)},qs.prototype.syncToMarks=function(t,e,n){var r=0,o=this.stack.length>>1,i=Math.min(o,t.length);while(r<i&&(r==o-1?this.top:this.stack[r+1<<1]).matchesMark(t[r])&&!1!==t[r].type.spec.spanning)r++;while(r<o)this.destroyRest(),this.top.dirty=xs,this.index=this.stack.pop(),this.top=this.stack.pop(),o--;while(o<t.length){this.stack.push(this.top,this.index+1);for(var s=-1,a=this.index;a<Math.min(this.index+3,this.top.children.length);a++)if(this.top.children[a].matchesMark(t[o])){s=a;break}if(s>-1)s>this.index&&(this.changed=!0,this.destroyBetween(this.index,s)),this.top=this.top.children[this.index];else{var c=Es.create(this.top,t[o],e,n);this.top.children.splice(this.index,0,c),this.top=c,this.changed=!0}this.index=0,o++}},qs.prototype.findNodeMatch=function(t,e,n,r){var o=this.top.children,i=-1;if(r>=this.preMatch.index){for(var s=this.index;s<o.length;s++)if(o[s].matchesNode(t,e,n)){i=s;break}}else for(var a=this.index,c=Math.min(o.length,a+1);a<c;a++){var h=o[a];if(h.matchesNode(t,e,n)&&!this.preMatch.matched.has(h)){i=a;break}}return!(i<0)&&(this.destroyBetween(this.index,i),this.index++,!0)},qs.prototype.updateNextNode=function(t,e,n,r,o){for(var i=this.index;i<this.top.children.length;i++){var s=this.top.children[i];if(s instanceof As){var a=this.preMatch.matched.get(s);if(null!=a&&a!=o)return!1;var c=s.dom,h=this.lock&&(c==this.lock||1==c.nodeType&&c.contains(this.lock.parentNode))&&!(t.isText&&s.node&&s.node.isText&&s.nodeDOM.nodeValue==t.text&&s.dirty!=Ss&&Ls(e,s.outerDeco));if(!h&&s.update(t,e,n,r))return this.destroyBetween(this.index,i),s.dom!=c&&(this.changed=!0),this.index++,!0;break}}return!1},qs.prototype.addNode=function(t,e,n,r,o){this.top.children.splice(this.index++,0,As.create(this.top,t,e,n,r,o)),this.changed=!0},qs.prototype.placeWidget=function(t,e,n){var r=this.index<this.top.children.length?this.top.children[this.index]:null;if(!r||!r.matchesWidget(t)||t!=r.widget&&r.widget.type.toDOM.parentNode){var o=new Ns(this.top,t,e,n);this.top.children.splice(this.index++,0,o),this.changed=!0}else this.index++},qs.prototype.addTextblockHacks=function(){var t=this.top.children[this.index-1];while(t instanceof Es)t=t.children[t.children.length-1];if(!t||!(t instanceof Rs)||/\n$/.test(t.node.text))if(this.index<this.top.children.length&&this.top.children[this.index].matchesHack())this.index++;else{var e=document.createElement("br");this.top.children.splice(this.index++,0,new zs(this.top,Ms,e,null)),this.changed=!0}};var ea=Oi.safari||Oi.chrome&&Oi.chrome_version<63;function na(t,e){var n=t.docView.domFromPos(e,0),r=n.node,o=n.offset,i=o<r.childNodes.length?r.childNodes[o]:null,s=o?r.childNodes[o-1]:null;if(Oi.safari&&i&&"false"==i.contentEditable)return ra(i);if((!i||"false"==i.contentEditable)&&(!s||"false"==s.contentEditable)){if(i)return ra(i);if(s)return ra(s)}}function ra(t){return t.contentEditable="true",Oi.safari&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function oa(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function ia(t){var e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.hideSelectionGuard);var n=t.root.getSelection(),r=n.anchorNode,o=n.anchorOffset;e.addEventListener("selectionchange",t.hideSelectionGuard=function(){n.anchorNode==r&&n.anchorOffset==o||(e.removeEventListener("selectionchange",t.hideSelectionGuard),setTimeout((function(){Qs(t)&&!t.state.selection.visible||t.dom.classList.remove("ProseMirror-hideselection")}),20))})}function sa(t){var e=t.root.getSelection(),n=document.createRange(),r=t.cursorWrapper.dom,o="IMG"==r.nodeName;o?n.setEnd(r.parentNode,Ai(r)+1):n.setEnd(r,0),n.collapse(!1),e.removeAllRanges(),e.addRange(n),!o&&!t.state.selection.visible&&Oi.ie&&Oi.ie_version<=11&&(r.disabled=!0,r.disabled=!1)}function aa(t,e){if(e instanceof ni){var n=t.docView.descAt(e.from);n!=t.lastSelectedViewDesc&&(ca(t),n&&n.selectNode(),t.lastSelectedViewDesc=n)}else ca(t)}function ca(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=null)}function ha(t,e,n,r){return t.someProp("createSelectionBetween",(function(r){return r(t,e,n)}))||ti.between(e,n,r)}function pa(t){return(!t.editable||t.root.activeElement==t.dom)&&la(t)}function la(t){var e=t.root.getSelection();if(!e.anchorNode)return!1;try{return t.dom.contains(3==e.anchorNode.nodeType?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(3==e.focusNode.nodeType?e.focusNode.parentNode:e.focusNode))}catch(n){return!1}}function ua(t){var e=t.docView.domFromPos(t.state.selection.anchor,0),n=t.root.getSelection();return Ii(e.node,e.offset,n.anchorNode,n.anchorOffset)}function fa(t,e){var n=t.selection,r=n.$anchor,o=n.$head,i=e>0?r.max(o):r.min(o),s=i.parent.inlineContent?i.depth?t.doc.resolve(e>0?i.after():i.before()):null:i;return s&&Yo.findFrom(s,e)}function da(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function ma(t,e,n){var r=t.state.selection;if(!(r instanceof ti)){if(r instanceof ni&&r.node.isInline)return da(t,new ti(e>0?r.$to:r.$from));var o=fa(t.state,e);return!!o&&da(t,o)}if(!r.empty||n.indexOf("s")>-1)return!1;if(t.endOfTextblock(e>0?"right":"left")){var i=fa(t.state,e);return!!(i&&i instanceof ni)&&da(t,i)}if(!(Oi.mac&&n.indexOf("m")>-1)){var s,a=r.$head,c=a.textOffset?null:e<0?a.nodeBefore:a.nodeAfter;if(!c||c.isText)return!1;var h=e<0?a.pos-c.nodeSize:a.pos;return!!(c.isAtom||(s=t.docView.descAt(h))&&!s.contentDOM)&&(ni.isSelectable(c)?da(t,new ni(e<0?t.state.doc.resolve(a.pos-c.nodeSize):a)):!!Oi.webkit&&da(t,new ti(t.state.doc.resolve(e<0?h:h+c.nodeSize))))}}function va(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}function ga(t){var e=t.pmViewDesc;return e&&0==e.size&&(t.nextSibling||"BR"!=t.nodeName)}function ya(t){var e=t.root.getSelection(),n=e.focusNode,r=e.focusOffset;if(n){var o,i,s=!1;for(Oi.gecko&&1==n.nodeType&&r<va(n)&&ga(n.childNodes[r])&&(s=!0);;)if(r>0){if(1!=n.nodeType)break;var a=n.childNodes[r-1];if(ga(a))o=n,i=--r;else{if(3!=a.nodeType)break;n=a,r=n.nodeValue.length}}else{if(xa(n))break;var c=n.previousSibling;while(c&&ga(c))o=n.parentNode,i=Ai(c),c=c.previousSibling;if(c)n=c,r=va(n);else{if(n=n.parentNode,n==t.dom)break;r=0}}s?ba(t,e,n,r):o&&ba(t,e,o,i)}}function wa(t){var e=t.root.getSelection(),n=e.focusNode,r=e.focusOffset;if(n){for(var o,i,s=va(n);;)if(r<s){if(1!=n.nodeType)break;var a=n.childNodes[r];if(!ga(a))break;o=n,i=++r}else{if(xa(n))break;var c=n.nextSibling;while(c&&ga(c))o=c.parentNode,i=Ai(c)+1,c=c.nextSibling;if(c)n=c,r=0,s=va(n);else{if(n=n.parentNode,n==t.dom)break;r=s=0}}o&&ba(t,e,o,i)}}function xa(t){var e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function ba(t,e,n,r){if(ji(e)){var o=document.createRange();o.setEnd(n,r),o.setStart(n,r),e.removeAllRanges(),e.addRange(o)}else e.extend&&e.extend(n,r);t.domObserver.setCurSelection();var i=t.state;setTimeout((function(){t.state==i&&ta(t)}),50)}function ka(t,e,n){var r=t.state.selection;if(r instanceof ti&&!r.empty||n.indexOf("s")>-1)return!1;if(Oi.mac&&n.indexOf("m")>-1)return!1;var o=r.$from,i=r.$to;if(!o.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){var s=fa(t.state,e);if(s&&s instanceof ni)return da(t,s)}if(!o.parent.inlineContent){var a=e<0?o:i,c=r instanceof oi?Yo.near(a,e):Yo.findFrom(a,e);return!!c&&da(t,c)}return!1}function Sa(t,e){if(!(t.state.selection instanceof ti))return!0;var n=t.state.selection,r=n.$head,o=n.$anchor,i=n.empty;if(!r.sameParent(o))return!0;if(!i)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;var s=!r.textOffset&&(e<0?r.nodeBefore:r.nodeAfter);if(s&&!s.isText){var a=t.state.tr;return e<0?a.delete(r.pos-s.nodeSize,r.pos):a.delete(r.pos,r.pos+s.nodeSize),t.dispatch(a),!0}return!1}function Oa(t,e,n){t.domObserver.stop(),e.contentEditable=n,t.domObserver.start()}function Ca(t){if(Oi.safari&&!(t.state.selection.$head.parentOffset>0)){var e=t.root.getSelection(),n=e.focusNode,r=e.focusOffset;if(n&&1==n.nodeType&&0==r&&n.firstChild&&"false"==n.firstChild.contentEditable){var o=n.firstChild;Oa(t,o,!0),setTimeout((function(){return Oa(t,o,!1)}),20)}}}function Ma(t){var e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}function Na(t,e){var n=e.keyCode,r=Ma(e);return 8==n||Oi.mac&&72==n&&"c"==r?Sa(t,-1)||ya(t):46==n||Oi.mac&&68==n&&"c"==r?Sa(t,1)||wa(t):13==n||27==n||(37==n?ma(t,-1,r)||ya(t):39==n?ma(t,1,r)||wa(t):38==n?ka(t,-1,r)||ya(t):40==n?Ca(t)||ka(t,1,r)||wa(t):r==(Oi.mac?"m":"c")&&(66==n||73==n||89==n||90==n))}function Ta(t,e,n){var r=t.docView.parseRange(e,n),o=r.node,i=r.fromOffset,s=r.toOffset,a=r.from,c=r.to,h=t.root.getSelection(),p=null,l=h.anchorNode;if(l&&t.dom.contains(1==l.nodeType?l:l.parentNode)&&(p=[{node:l,offset:h.anchorOffset}],ji(h)||p.push({node:h.focusNode,offset:h.focusOffset})),Oi.chrome&&8===t.lastKeyCode)for(var u=s;u>i;u--){var f=o.childNodes[u-1],d=f.pmViewDesc;if("BR"==f.nodeName&&!d){s=u;break}if(!d||d.size)break}var m=t.state.doc,v=t.someProp("domParser")||Do.fromSchema(t.state.schema),g=m.resolve(a),y=null,w=v.parse(o,{topNode:g.parent,topMatch:g.parent.contentMatchAt(g.index()),topOpen:!0,from:i,to:s,preserveWhitespace:!g.parent.type.spec.code||"full",editableContent:!0,findPositions:p,ruleFromNode:Ea,context:g});if(p&&null!=p[0].pos){var x=p[0].pos,b=p[1]&&p[1].pos;null==b&&(b=x),y={anchor:x+a,head:b+a}}return{doc:w,sel:y,from:a,to:c}}function Ea(t){var e=t.pmViewDesc;if(e)return e.parseRule();if("BR"==t.nodeName&&t.parentNode){if(Oi.safari&&/^(ul|ol)$/i.test(t.parentNode.nodeName)){var n=document.createElement("div");return n.appendChild(document.createElement("li")),{skip:n}}if(t.parentNode.lastChild==t||Oi.safari&&/^(tr|table)$/i.test(t.parentNode.nodeName))return{ignore:!0}}else if("IMG"==t.nodeName&&t.getAttribute("mark-placeholder"))return{ignore:!0}}function Aa(t,e,n,r,o){if(e<0){var i=t.lastSelectionTime>Date.now()-50?t.lastSelectionOrigin:null,s=Zs(t,i);if(s&&!t.state.selection.eq(s)){var a=t.state.tr.setSelection(s);"pointer"==i?a.setMeta("pointer",!0):"key"==i&&a.scrollIntoView(),t.dispatch(a)}}else{var c=t.state.doc.resolve(e),h=c.sharedDepth(n);e=c.before(h+1),n=t.state.doc.resolve(n).after(h+1);var p=t.state.selection,l=Ta(t,e,n);if(Oi.chrome&&t.cursorWrapper&&l.sel&&l.sel.anchor==t.cursorWrapper.deco.from){var u=t.cursorWrapper.deco.type.toDOM.nextSibling,f=u&&u.nodeValue?u.nodeValue.length:1;l.sel={anchor:l.sel.anchor+f,head:l.sel.anchor+f}}var d,m,v=t.state.doc,g=v.slice(l.from,l.to);8===t.lastKeyCode&&Date.now()-100<t.lastKeyCodeTime?(d=t.state.selection.to,m="end"):(d=t.state.selection.from,m="start"),t.lastKeyCode=null;var y=Pa(g.content,l.doc.content,l.from,d,m);if(!y){if(!(r&&p instanceof ti&&!p.empty&&p.$head.sameParent(p.$anchor))||t.composing||l.sel&&l.sel.anchor!=l.sel.head){if((Oi.ios&&t.lastIOSEnter>Date.now()-225||Oi.android)&&o.some((function(t){return"DIV"==t.nodeName||"P"==t.nodeName}))&&t.someProp("handleKeyDown",(function(e){return e(t,Ji(13,"Enter"))})))return void(t.lastIOSEnter=0);if(l.sel){var w=Da(t,t.state.doc,l.sel);w&&!w.eq(t.state.selection)&&t.dispatch(t.state.tr.setSelection(w))}return}y={start:p.from,endA:p.to,endB:p.to}}t.domChangeCount++,t.state.selection.from<t.state.selection.to&&y.start==y.endB&&t.state.selection instanceof ti&&(y.start>t.state.selection.from&&y.start<=t.state.selection.from+2?y.start=t.state.selection.from:y.endA<t.state.selection.to&&y.endA>=t.state.selection.to-2&&(y.endB+=t.state.selection.to-y.endA,y.endA=t.state.selection.to)),Oi.ie&&Oi.ie_version<=11&&y.endB==y.start+1&&y.endA==y.start&&y.start>l.from&&" "==l.doc.textBetween(y.start-l.from-1,y.start-l.from+1)&&(y.start--,y.endA--,y.endB--);var x,b=l.doc.resolveNoCache(y.start-l.from),k=l.doc.resolveNoCache(y.endB-l.from),S=b.sameParent(k)&&b.parent.inlineContent;if((Oi.ios&&t.lastIOSEnter>Date.now()-225&&(!S||o.some((function(t){return"DIV"==t.nodeName||"P"==t.nodeName})))||!S&&b.pos<l.doc.content.size&&(x=Yo.findFrom(l.doc.resolve(b.pos+1),1,!0))&&x.head==k.pos)&&t.someProp("handleKeyDown",(function(e){return e(t,Ji(13,"Enter"))})))t.lastIOSEnter=0;else if(t.state.selection.anchor>y.start&&za(v,y.start,y.endA,b,k)&&t.someProp("handleKeyDown",(function(e){return e(t,Ji(8,"Backspace"))})))Oi.android&&Oi.chrome&&t.domObserver.suppressSelectionUpdates();else{Oi.chrome&&Oi.android&&y.toB==y.from&&(t.lastAndroidDelete=Date.now()),Oi.android&&!S&&b.start()!=k.start()&&0==k.parentOffset&&b.depth==k.depth&&l.sel&&l.sel.anchor==l.sel.head&&l.sel.head==y.endA&&(y.endB-=2,k=l.doc.resolveNoCache(y.endB-l.from),setTimeout((function(){t.someProp("handleKeyDown",(function(e){return e(t,Ji(13,"Enter"))}))}),20));var O,C,M,N,T=y.start,E=y.endA;if(S)if(b.pos==k.pos)Oi.ie&&Oi.ie_version<=11&&0==b.parentOffset&&(t.domObserver.suppressSelectionUpdates(),setTimeout((function(){return ta(t)}),20)),O=t.state.tr.delete(T,E),C=v.resolve(y.start).marksAcross(v.resolve(y.endA));else if(y.endA==y.endB&&(N=v.resolve(y.start))&&(M=Ra(b.parent.content.cut(b.parentOffset,k.parentOffset),N.parent.content.cut(N.parentOffset,y.endA-N.start()))))O=t.state.tr,"add"==M.type?O.addMark(T,E,M.mark):O.removeMark(T,E,M.mark);else if(b.parent.child(b.index()).isText&&b.index()==k.index()-(k.textOffset?0:1)){var A=b.parent.textBetween(b.parentOffset,k.parentOffset);if(t.someProp("handleTextInput",(function(e){return e(t,T,E,A)})))return;O=t.state.tr.insertText(A,T,E)}if(O||(O=t.state.tr.replace(T,E,l.doc.slice(y.start-l.from,y.endB-l.from))),l.sel){var D=Da(t,O.doc,l.sel);D&&!(Oi.chrome&&Oi.android&&t.composing&&D.empty&&(y.start!=y.endB||t.lastAndroidDelete<Date.now()-100)&&(D.head==T||D.head==O.mapping.map(E)-1)||Oi.ie&&D.empty&&D.head==T)&&O.setSelection(D)}C&&O.ensureMarks(C),t.dispatch(O.scrollIntoView())}}}function Da(t,e,n){return Math.max(n.anchor,n.head)>e.content.size?null:ha(t,e.resolve(n.anchor),e.resolve(n.head))}function Ra(t,e){for(var n,r,o,i=t.firstChild.marks,s=e.firstChild.marks,a=i,c=s,h=0;h<s.length;h++)a=s[h].removeFromSet(a);for(var p=0;p<i.length;p++)c=i[p].removeFromSet(c);if(1==a.length&&0==c.length)r=a[0],n="add",o=function(t){return t.mark(r.addToSet(t.marks))};else{if(0!=a.length||1!=c.length)return null;r=c[0],n="remove",o=function(t){return t.mark(r.removeFromSet(t.marks))}}for(var l=[],u=0;u<e.childCount;u++)l.push(o(e.child(u)));if(Cr.from(l).eq(t))return{mark:r,type:n}}function za(t,e,n,r,o){if(!r.parent.isTextblock||n-e<=o.pos-r.pos||Ia(r,!0,!1)<o.pos)return!1;var i=t.resolve(e);if(i.parentOffset<i.parent.content.size||!i.parent.isTextblock)return!1;var s=t.resolve(Ia(i,!0,!0));return!(!s.parent.isTextblock||s.pos>n||Ia(s,!0,!1)<n)&&r.parent.content.cut(r.parentOffset).eq(s.parent.content)}function Ia(t,e,n){var r=t.depth,o=e?t.end():t.pos;while(r>0&&(e||t.indexAfter(r)==t.node(r).childCount))r--,o++,e=!1;if(n){var i=t.node(r).maybeChild(t.indexAfter(r));while(i&&!i.isLeaf)i=i.firstChild,o++}return o}function Pa(t,e,n,r,o){var i=t.findDiffStart(e,n);if(null==i)return null;var s=t.findDiffEnd(e,n+t.size,n+e.size),a=s.a,c=s.b;if("end"==o){var h=Math.max(0,i-Math.min(a,c));r-=a+h-i}if(a<i&&t.size<e.size){var p=r<=i&&r>=a?i-r:0;i-=p,c=i+(c-a),a=i}else if(c<i){var l=r<=i&&r>=c?i-r:0;i-=l,a=i+(a-c),c=i}return{start:i,endA:a,endB:c}}function Fa(t,e){var n=[],r=e.content,o=e.openStart,i=e.openEnd;while(o>1&&i>1&&1==r.childCount&&1==r.firstChild.childCount){o--,i--;var s=r.firstChild;n.push(s.type.name,s.attrs!=s.type.defaultAttrs?s.attrs:null),r=s.content}var a=t.someProp("clipboardSerializer")||Ko.fromSchema(t.state.schema),c=Ha(),h=c.createElement("div");h.appendChild(a.serializeFragment(r,{document:c}));var p,l=h.firstChild;while(l&&1==l.nodeType&&(p=qa[l.nodeName.toLowerCase()])){for(var u=p.length-1;u>=0;u--){var f=c.createElement(p[u]);while(h.firstChild)f.appendChild(h.firstChild);h.appendChild(f)}l=h.firstChild}l&&1==l.nodeType&&l.setAttribute("data-pm-slice",o+" "+i+" "+JSON.stringify(n));var d=t.someProp("clipboardTextSerializer",(function(t){return t(e)}))||e.content.textBetween(0,e.content.size,"\n\n");return{dom:h,text:d}}function Ba(t,e,n,r,o){var i,s,a=o.parent.type.spec.code;if(!n&&!e)return null;var c=e&&(r||a||!n);if(c){if(t.someProp("transformPastedText",(function(t){e=t(e,a||r)})),a)return new Rr(Cr.from(t.state.schema.text(e.replace(/\r\n?/g,"\n"))),0,0);var h=t.someProp("clipboardTextParser",(function(t){return t(e,o,r)}));h?s=h:(i=document.createElement("div"),e.trim().split(/(?:\r\n?|\n)+/).forEach((function(t){i.appendChild(document.createElement("p")).textContent=t})))}else t.someProp("transformPastedHTML",(function(t){n=t(n)})),i=Ka(n);var p=i&&i.querySelector("[data-pm-slice]"),l=p&&/^(\d+) (\d+) (.*)/.exec(p.getAttribute("data-pm-slice"));if(!s){var u=t.someProp("clipboardParser")||t.someProp("domParser")||Do.fromSchema(t.state.schema);s=u.parseSlice(i,{preserveWhitespace:!(!c&&!l),context:o})}return s=l?Ua(Va(s,+l[1],+l[2]),l[3]):Rr.maxOpen($a(s.content,o),!1),t.someProp("transformPasted",(function(t){s=t(s)})),s}function $a(t,e){if(t.childCount<2)return t;for(var n=function(n){var r=e.node(n),o=r.contentMatchAt(e.index(n)),i=void 0,s=[];if(t.forEach((function(t){if(s){var e,n=o.findWrapping(t.type);if(!n)return s=null;if(e=s.length&&i.length&&ja(n,i,t,s[s.length-1],0))s[s.length-1]=e;else{s.length&&(s[s.length-1]=Ja(s[s.length-1],i.length));var r=_a(t,n);s.push(r),o=o.matchType(r.type,r.attrs),i=n}}})),s)return{v:Cr.from(s)}},r=e.depth;r>=0;r--){var o=n(r);if(o)return o.v}return t}function _a(t,e,n){void 0===n&&(n=0);for(var r=e.length-1;r>=n;r--)t=e[r].create(null,Cr.from(t));return t}function ja(t,e,n,r,o){if(o<t.length&&o<e.length&&t[o]==e[o]){var i=ja(t,e,n,r.lastChild,o+1);if(i)return r.copy(r.content.replaceChild(r.childCount-1,i));var s=r.contentMatchAt(r.childCount);if(s.matchType(o==t.length-1?n.type:t[o+1]))return r.copy(r.content.append(Cr.from(_a(n,t,o+1))))}}function Ja(t,e){if(0==e)return t;var n=t.content.replaceChild(t.childCount-1,Ja(t.lastChild,e-1)),r=t.contentMatchAt(t.childCount).fillBefore(Cr.empty,!0);return t.copy(n.append(r))}function La(t,e,n,r,o,i){var s=e<0?t.firstChild:t.lastChild,a=s.content;return o<r-1&&(a=La(a,e,n,r,o+1,i)),o>=n&&(a=e<0?s.contentMatchAt(0).fillBefore(a,t.childCount>1||i<=o).append(a):a.append(s.contentMatchAt(s.childCount).fillBefore(Cr.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,s.copy(a))}function Va(t,e,n){return e<t.openStart&&(t=new Rr(La(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),n<t.openEnd&&(t=new Rr(La(t.content,1,n,t.openEnd,0,0),t.openStart,n)),t}var qa={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]},Wa=null;function Ha(){return Wa||(Wa=document.implementation.createHTMLDocument("title"))}function Ka(t){var e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));var n,r=Ha().createElement("div"),o=/<([a-z][^>\s]+)/i.exec(t);if((n=o&&qa[o[1].toLowerCase()])&&(t=n.map((function(t){return"<"+t+">"})).join("")+t+n.map((function(t){return"</"+t+">"})).reverse().join("")),r.innerHTML=t,n)for(var i=0;i<n.length;i++)r=r.querySelector(n[i])||r;return r}function Ua(t,e){if(!t.size)return t;var n,r=t.content.firstChild.type.schema;try{n=JSON.parse(e)}catch(h){return t}for(var o=t.content,i=t.openStart,s=t.openEnd,a=n.length-2;a>=0;a-=2){var c=r.nodes[n[a]];if(!c||c.hasRequiredAttrs())break;o=Cr.from(c.create(n[a+1],o)),i++,s++}return new Rr(o,i,s)}var Ga={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},Xa=Oi.ie&&Oi.ie_version<=11,Ya=function(){this.anchorNode=this.anchorOffset=this.focusNode=this.focusOffset=null};Ya.prototype.set=function(t){this.anchorNode=t.anchorNode,this.anchorOffset=t.anchorOffset,this.focusNode=t.focusNode,this.focusOffset=t.focusOffset},Ya.prototype.eq=function(t){return t.anchorNode==this.anchorNode&&t.anchorOffset==this.anchorOffset&&t.focusNode==this.focusNode&&t.focusOffset==this.focusOffset};var Za=function(t,e){var n=this;this.view=t,this.handleDOMChange=e,this.queue=[],this.flushingSoon=-1,this.observer=window.MutationObserver&&new window.MutationObserver((function(t){for(var e=0;e<t.length;e++)n.queue.push(t[e]);Oi.ie&&Oi.ie_version<=11&&t.some((function(t){return"childList"==t.type&&t.removedNodes.length||"characterData"==t.type&&t.oldValue.length>t.target.nodeValue.length}))?n.flushSoon():n.flush()})),this.currentSelection=new Ya,Xa&&(this.onCharData=function(t){n.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),n.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.suppressingSelectionUpdates=!1};Za.prototype.flushSoon=function(){var t=this;this.flushingSoon<0&&(this.flushingSoon=window.setTimeout((function(){t.flushingSoon=-1,t.flush()}),20))},Za.prototype.forceFlush=function(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())},Za.prototype.start=function(){this.observer&&this.observer.observe(this.view.dom,Ga),Xa&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()},Za.prototype.stop=function(){var t=this;if(this.observer){var e=this.observer.takeRecords();if(e.length){for(var n=0;n<e.length;n++)this.queue.push(e[n]);window.setTimeout((function(){return t.flush()}),20)}this.observer.disconnect()}Xa&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()},Za.prototype.connectSelection=function(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)},Za.prototype.disconnectSelection=function(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)},Za.prototype.suppressSelectionUpdates=function(){var t=this;this.suppressingSelectionUpdates=!0,setTimeout((function(){return t.suppressingSelectionUpdates=!1}),50)},Za.prototype.onSelectionChange=function(){if(pa(this.view)){if(this.suppressingSelectionUpdates)return ta(this.view);if(Oi.ie&&Oi.ie_version<=11&&!this.view.state.selection.empty){var t=this.view.root.getSelection();if(t.focusNode&&Ii(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset))return this.flushSoon()}this.flush()}},Za.prototype.setCurSelection=function(){this.currentSelection.set(this.view.root.getSelection())},Za.prototype.ignoreSelectionChange=function(t){if(0==t.rangeCount)return!0;var e=t.getRangeAt(0).commonAncestorContainer,n=this.view.docView.nearestDesc(e);return n&&n.ignoreMutation({type:"selection",target:3==e.nodeType?e.parentNode:e})?(this.setCurSelection(),!0):void 0},Za.prototype.flush=function(){if(this.view.docView&&!(this.flushingSoon>-1)){var t=this.observer?this.observer.takeRecords():[];this.queue.length&&(t=this.queue.concat(t),this.queue.length=0);var e=this.view.root.getSelection(),n=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(e)&&la(this.view)&&!this.ignoreSelectionChange(e),r=-1,o=-1,i=!1,s=[];if(this.view.editable)for(var a=0;a<t.length;a++){var c=this.registerMutation(t[a],s);c&&(r=r<0?c.from:Math.min(c.from,r),o=o<0?c.to:Math.max(c.to,o),c.typeOver&&(i=!0))}if(Oi.gecko&&s.length>1){var h=s.filter((function(t){return"BR"==t.nodeName}));if(2==h.length){var p=h[0],l=h[1];p.parentNode&&p.parentNode.parentNode==l.parentNode?l.remove():p.remove()}}(r>-1||n)&&(r>-1&&(this.view.docView.markDirty(r,o),tc(this.view)),this.handleDOMChange(r,o,i,s),this.view.docView.dirty?this.view.updateState(this.view.state):this.currentSelection.eq(e)||ta(this.view),this.currentSelection.set(e))}},Za.prototype.registerMutation=function(t,e){if(e.indexOf(t.target)>-1)return null;var n=this.view.docView.nearestDesc(t.target);if("attributes"==t.type&&(n==this.view.docView||"contenteditable"==t.attributeName||"style"==t.attributeName&&!t.oldValue&&!t.target.getAttribute("style")))return null;if(!n||n.ignoreMutation(t))return null;if("childList"==t.type){for(var r=0;r<t.addedNodes.length;r++)e.push(t.addedNodes[r]);if(n.contentDOM&&n.contentDOM!=n.dom&&!n.contentDOM.contains(t.target))return{from:n.posBefore,to:n.posAfter};var o=t.previousSibling,i=t.nextSibling;if(Oi.ie&&Oi.ie_version<=11&&t.addedNodes.length)for(var s=0;s<t.addedNodes.length;s++){var a=t.addedNodes[s],c=a.previousSibling,h=a.nextSibling;(!c||Array.prototype.indexOf.call(t.addedNodes,c)<0)&&(o=c),(!h||Array.prototype.indexOf.call(t.addedNodes,h)<0)&&(i=h)}var p=o&&o.parentNode==t.target?Ai(o)+1:0,l=n.localPosFromDOM(t.target,p,-1),u=i&&i.parentNode==t.target?Ai(i):t.target.childNodes.length,f=n.localPosFromDOM(t.target,u,1);return{from:l,to:f}}return"attributes"==t.type?{from:n.posAtStart-n.border,to:n.posAtEnd+n.border}:{from:n.posAtStart,to:n.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}};var Qa=!1;function tc(t){Qa||(Qa=!0,"normal"==getComputedStyle(t.dom).whiteSpace&&console["warn"]("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."))}var ec={},nc={};function rc(t){t.shiftKey=!1,t.mouseDown=null,t.lastKeyCode=null,t.lastKeyCodeTime=0,t.lastClick={time:0,x:0,y:0,type:""},t.lastSelectionOrigin=null,t.lastSelectionTime=0,t.lastIOSEnter=0,t.lastIOSEnterFallbackTimeout=null,t.lastAndroidDelete=0,t.composing=!1,t.composingTimeout=null,t.compositionNodes=[],t.compositionEndedAt=-2e8,t.domObserver=new Za(t,(function(e,n,r,o){return Aa(t,e,n,r,o)})),t.domObserver.start(),t.domChangeCount=0,t.eventHandlers=Object.create(null);var e=function(e){var n=ec[e];t.dom.addEventListener(e,t.eventHandlers[e]=function(e){!cc(t,e)||ac(t,e)||!t.editable&&e.type in nc||n(t,e)})};for(var n in ec)e(n);Oi.safari&&t.dom.addEventListener("input",(function(){return null})),sc(t)}function oc(t,e){t.lastSelectionOrigin=e,t.lastSelectionTime=Date.now()}function ic(t){for(var e in t.domObserver.stop(),t.eventHandlers)t.dom.removeEventListener(e,t.eventHandlers[e]);clearTimeout(t.composingTimeout),clearTimeout(t.lastIOSEnterFallbackTimeout)}function sc(t){t.someProp("handleDOMEvents",(function(e){for(var n in e)t.eventHandlers[n]||t.dom.addEventListener(n,t.eventHandlers[n]=function(e){return ac(t,e)})}))}function ac(t,e){return t.someProp("handleDOMEvents",(function(n){var r=n[e.type];return!!r&&(r(t,e)||e.defaultPrevented)}))}function cc(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(var n=e.target;n!=t.dom;n=n.parentNode)if(!n||11==n.nodeType||n.pmViewDesc&&n.pmViewDesc.stopEvent(e))return!1;return!0}function hc(t,e){ac(t,e)||!ec[e.type]||!t.editable&&e.type in nc||ec[e.type](t,e)}function pc(t){return{left:t.clientX,top:t.clientY}}function lc(t,e){var n=e.x-t.clientX,r=e.y-t.clientY;return n*n+r*r<100}function uc(t,e,n,r,o){if(-1==r)return!1;for(var i=t.state.doc.resolve(r),s=function(r){if(t.someProp(e,(function(e){return r>i.depth?e(t,n,i.nodeAfter,i.before(r),o,!0):e(t,n,i.node(r),i.before(r),o,!1)})))return{v:!0}},a=i.depth+1;a>0;a--){var c=s(a);if(c)return c.v}return!1}function fc(t,e,n){t.focused||t.focus();var r=t.state.tr.setSelection(e);"pointer"==n&&r.setMeta("pointer",!0),t.dispatch(r)}function dc(t,e){if(-1==e)return!1;var n=t.state.doc.resolve(e),r=n.nodeAfter;return!!(r&&r.isAtom&&ni.isSelectable(r))&&(fc(t,new ni(n),"pointer"),!0)}function mc(t,e){if(-1==e)return!1;var n,r,o=t.state.selection;o instanceof ni&&(n=o.node);for(var i=t.state.doc.resolve(e),s=i.depth+1;s>0;s--){var a=s>i.depth?i.nodeAfter:i.node(s);if(ni.isSelectable(a)){r=n&&o.$from.depth>0&&s>=o.$from.depth&&i.before(o.$from.depth+1)==o.$from.pos?i.before(o.$from.depth):i.before(s);break}}return null!=r&&(fc(t,ni.create(t.state.doc,r),"pointer"),!0)}function vc(t,e,n,r,o){return uc(t,"handleClickOn",e,n,r)||t.someProp("handleClick",(function(n){return n(t,e,r)}))||(o?mc(t,n):dc(t,n))}function gc(t,e,n,r){return uc(t,"handleDoubleClickOn",e,n,r)||t.someProp("handleDoubleClick",(function(n){return n(t,e,r)}))}function yc(t,e,n,r){return uc(t,"handleTripleClickOn",e,n,r)||t.someProp("handleTripleClick",(function(n){return n(t,e,r)}))||wc(t,n)}function wc(t,e){var n=t.state.doc;if(-1==e)return!!n.inlineContent&&(fc(t,ti.create(n,0,n.content.size),"pointer"),!0);for(var r=n.resolve(e),o=r.depth+1;o>0;o--){var i=o>r.depth?r.nodeAfter:r.node(o),s=r.before(o);if(i.inlineContent)fc(t,ti.create(n,s+1,s+1+i.content.size),"pointer");else{if(!ni.isSelectable(i))continue;fc(t,ni.create(n,s),"pointer")}return!0}}function xc(t){return Nc(t)}nc.keydown=function(t,e){if(t.shiftKey=16==e.keyCode||e.shiftKey,!Sc(t,e))if(t.domObserver.forceFlush(),t.lastKeyCode=e.keyCode,t.lastKeyCodeTime=Date.now(),!Oi.ios||13!=e.keyCode||e.ctrlKey||e.altKey||e.metaKey)t.someProp("handleKeyDown",(function(n){return n(t,e)}))||Na(t,e)?e.preventDefault():oc(t,"key");else{var n=Date.now();t.lastIOSEnter=n,t.lastIOSEnterFallbackTimeout=setTimeout((function(){t.lastIOSEnter==n&&(t.someProp("handleKeyDown",(function(e){return e(t,Ji(13,"Enter"))})),t.lastIOSEnter=0)}),200)}},nc.keyup=function(t,e){16==e.keyCode&&(t.shiftKey=!1)},nc.keypress=function(t,e){if(!(Sc(t,e)||!e.charCode||e.ctrlKey&&!e.altKey||Oi.mac&&e.metaKey))if(t.someProp("handleKeyPress",(function(n){return n(t,e)})))e.preventDefault();else{var n=t.state.selection;if(!(n instanceof ti)||!n.$from.sameParent(n.$to)){var r=String.fromCharCode(e.charCode);t.someProp("handleTextInput",(function(e){return e(t,n.$from.pos,n.$to.pos,r)}))||t.dispatch(t.state.tr.insertText(r).scrollIntoView()),e.preventDefault()}}};var bc=Oi.mac?"metaKey":"ctrlKey";ec.mousedown=function(t,e){t.shiftKey=e.shiftKey;var n=xc(t),r=Date.now(),o="singleClick";r-t.lastClick.time<500&&lc(e,t.lastClick)&&!e[bc]&&("singleClick"==t.lastClick.type?o="doubleClick":"doubleClick"==t.lastClick.type&&(o="tripleClick")),t.lastClick={time:r,x:e.clientX,y:e.clientY,type:o};var i=t.posAtCoords(pc(e));i&&("singleClick"==o?(t.mouseDown&&t.mouseDown.done(),t.mouseDown=new kc(t,i,e,n)):("doubleClick"==o?gc:yc)(t,i.pos,i.inside,e)?e.preventDefault():oc(t,"pointer"))};var kc=function(t,e,n,r){var o,i,s=this;if(this.view=t,this.startDoc=t.state.doc,this.pos=e,this.event=n,this.flushed=r,this.selectNode=n[bc],this.allowDefault=n.shiftKey,e.inside>-1)o=t.state.doc.nodeAt(e.inside),i=e.inside;else{var a=t.state.doc.resolve(e.pos);o=a.parent,i=a.depth?a.before():0}this.mightDrag=null;var c=r?null:n.target,h=c?t.docView.nearestDesc(c,!0):null;this.target=h?h.dom:null;var p=t.state,l=p.selection;(o.type.spec.draggable&&!1!==o.type.spec.selectable||l instanceof ni&&l.from<=i&&l.to>i)&&(this.mightDrag={node:o,pos:i,addAttr:this.target&&!this.target.draggable,setUneditable:this.target&&Oi.gecko&&!this.target.hasAttribute("contentEditable")}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout((function(){s.view.mouseDown==s&&s.target.setAttribute("contentEditable","false")}),20),this.view.domObserver.start()),t.root.addEventListener("mouseup",this.up=this.up.bind(this)),t.root.addEventListener("mousemove",this.move=this.move.bind(this)),oc(t,"pointer")};function Sc(t,e){return!!t.composing||!!(Oi.safari&&Math.abs(e.timeStamp-t.compositionEndedAt)<500)&&(t.compositionEndedAt=-2e8,!0)}kc.prototype.done=function(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.view.mouseDown=null},kc.prototype.up=function(t){if(this.done(),this.view.dom.contains(3==t.target.nodeType?t.target.parentNode:t.target)){var e=this.pos;this.view.state.doc!=this.startDoc&&(e=this.view.posAtCoords(pc(t))),this.allowDefault||!e?oc(this.view,"pointer"):vc(this.view,e.pos,e.inside,t,this.selectNode)?t.preventDefault():this.flushed||Oi.safari&&this.mightDrag&&!this.mightDrag.node.isAtom||Oi.chrome&&!(this.view.state.selection instanceof ti)&&Math.min(Math.abs(e.pos-this.view.state.selection.from),Math.abs(e.pos-this.view.state.selection.to))<=2?(fc(this.view,Yo.near(this.view.state.doc.resolve(e.pos)),"pointer"),t.preventDefault()):oc(this.view,"pointer")}},kc.prototype.move=function(t){!this.allowDefault&&(Math.abs(this.event.x-t.clientX)>4||Math.abs(this.event.y-t.clientY)>4)&&(this.allowDefault=!0),oc(this.view,"pointer"),0==t.buttons&&this.done()},ec.touchdown=function(t){xc(t),oc(t,"pointer")},ec.contextmenu=function(t){return xc(t)};var Oc=Oi.android?5e3:-1;function Cc(t,e){clearTimeout(t.composingTimeout),e>-1&&(t.composingTimeout=setTimeout((function(){return Nc(t)}),e))}function Mc(t){t.composing=!1;while(t.compositionNodes.length>0)t.compositionNodes.pop().markParentsDirty()}function Nc(t,e){if(t.domObserver.forceFlush(),Mc(t),e||t.docView.dirty){var n=Zs(t);return n&&!n.eq(t.state.selection)?t.dispatch(t.state.tr.setSelection(n)):t.updateState(t.state),!0}return!1}function Tc(t,e){if(t.dom.parentNode){var n=t.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(e),n.style.cssText="position: fixed; left: -10000px; top: 10px";var r=getSelection(),o=document.createRange();o.selectNodeContents(e),t.dom.blur(),r.removeAllRanges(),r.addRange(o),setTimeout((function(){n.parentNode&&n.parentNode.removeChild(n),t.focus()}),50)}}nc.compositionstart=nc.compositionupdate=function(t){if(!t.composing){t.domObserver.flush();var e=t.state,n=e.selection.$from;if(e.selection.empty&&(e.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some((function(t){return!1===t.type.spec.inclusive}))))t.markCursor=t.state.storedMarks||n.marks(),Nc(t,!0),t.markCursor=null;else if(Nc(t),Oi.gecko&&e.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length)for(var r=t.root.getSelection(),o=r.focusNode,i=r.focusOffset;o&&1==o.nodeType&&0!=i;){var s=i<0?o.lastChild:o.childNodes[i-1];if(!s)break;if(3==s.nodeType){r.collapse(s,s.nodeValue.length);break}o=s,i=-1}t.composing=!0}Cc(t,Oc)},nc.compositionend=function(t,e){t.composing&&(t.composing=!1,t.compositionEndedAt=e.timeStamp,Cc(t,20))};var Ec=Oi.ie&&Oi.ie_version<15||Oi.ios&&Oi.webkit_version<604;function Ac(t){return 0==t.openStart&&0==t.openEnd&&1==t.content.childCount?t.content.firstChild:null}function Dc(t,e){if(t.dom.parentNode){var n=t.shiftKey||t.state.selection.$from.parent.type.spec.code,r=t.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus(),setTimeout((function(){t.focus(),r.parentNode&&r.parentNode.removeChild(r),n?Rc(t,r.value,null,e):Rc(t,r.textContent,r.innerHTML,e)}),50)}}function Rc(t,e,n,r){var o=Ba(t,e,n,t.shiftKey,t.state.selection.$from);if(t.someProp("handlePaste",(function(e){return e(t,r,o||Rr.empty)})))return!0;if(!o)return!1;var i=Ac(o),s=i?t.state.tr.replaceSelectionWith(i,t.shiftKey):t.state.tr.replaceSelection(o);return t.dispatch(s.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}ec.copy=nc.cut=function(t,e){var n=t.state.selection,r="cut"==e.type;if(!n.empty){var o=Ec?null:e.clipboardData,i=n.content(),s=Fa(t,i),a=s.dom,c=s.text;o?(e.preventDefault(),o.clearData(),o.setData("text/html",a.innerHTML),o.setData("text/plain",c)):Tc(t,a),r&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))}},nc.paste=function(t,e){var n=Ec?null:e.clipboardData;n&&Rc(t,n.getData("text/plain"),n.getData("text/html"),e)?e.preventDefault():Dc(t,e)};var zc=function(t,e){this.slice=t,this.move=e},Ic=Oi.mac?"altKey":"ctrlKey";for(var Pc in ec.dragstart=function(t,e){var n=t.mouseDown;if(n&&n.done(),e.dataTransfer){var r=t.state.selection,o=r.empty?null:t.posAtCoords(pc(e));if(o&&o.pos>=r.from&&o.pos<=(r instanceof ni?r.to-1:r.to));else if(n&&n.mightDrag)t.dispatch(t.state.tr.setSelection(ni.create(t.state.doc,n.mightDrag.pos)));else if(e.target&&1==e.target.nodeType){var i=t.docView.nearestDesc(e.target,!0);if(!i||!i.node.type.spec.draggable||i==t.docView)return;t.dispatch(t.state.tr.setSelection(ni.create(t.state.doc,i.posBefore)))}var s=t.state.selection.content(),a=Fa(t,s),c=a.dom,h=a.text;e.dataTransfer.clearData(),e.dataTransfer.setData(Ec?"Text":"text/html",c.innerHTML),e.dataTransfer.effectAllowed="copyMove",Ec||e.dataTransfer.setData("text/plain",h),t.dragging=new zc(s,!e[Ic])}},ec.dragend=function(t){var e=t.dragging;window.setTimeout((function(){t.dragging==e&&(t.dragging=null)}),50)},nc.dragover=nc.dragenter=function(t,e){return e.preventDefault()},nc.drop=function(t,e){var n=t.dragging;if(t.dragging=null,e.dataTransfer){var r=t.posAtCoords(pc(e));if(r){var o=t.state.doc.resolve(r.pos);if(o){var i=n&&n.slice;i?t.someProp("transformPasted",(function(t){i=t(i)})):i=Ba(t,e.dataTransfer.getData(Ec?"Text":"text/plain"),Ec?null:e.dataTransfer.getData("text/html"),!1,o);var s=n&&!e[Ic];if(t.someProp("handleDrop",(function(n){return n(t,e,i||Rr.empty,s)})))e.preventDefault();else if(i){e.preventDefault();var a=i?zn(t.state.doc,o.pos,i):o.pos;null==a&&(a=o.pos);var c=t.state.tr;s&&c.deleteSelection();var h=c.mapping.map(a),p=0==i.openStart&&0==i.openEnd&&1==i.content.childCount,l=c.doc;if(p?c.replaceRangeWith(h,h,i.content.firstChild):c.replaceRange(h,h,i),!c.doc.eq(l)){var u=c.doc.resolve(h);if(p&&ni.isSelectable(i.content.firstChild)&&u.nodeAfter&&u.nodeAfter.sameMarkup(i.content.firstChild))c.setSelection(new ni(u));else{var f=c.mapping.map(a);c.mapping.maps[c.mapping.maps.length-1].forEach((function(t,e,n,r){return f=r})),c.setSelection(ha(t,u,c.doc.resolve(f)))}t.focus(),t.dispatch(c.setMeta("uiEvent","drop"))}}}}}},ec.focus=function(t){t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout((function(){t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.root.getSelection())&&ta(t)}),20))},ec.blur=function(t){t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),t.domObserver.currentSelection.set({}),t.focused=!1)},ec.beforeinput=function(t,e){if(Oi.chrome&&Oi.android&&"deleteContentBackward"==e.inputType){var n=t.domChangeCount;setTimeout((function(){if(t.domChangeCount==n&&(t.dom.blur(),t.focus(),!t.someProp("handleKeyDown",(function(e){return e(t,Ji(8,"Backspace"))})))){var e=t.state.selection,r=e.$cursor;r&&r.pos>0&&t.dispatch(t.state.tr.delete(r.pos-1,r.pos).scrollIntoView())}}),50)}},nc)ec[Pc]=nc[Pc];function Fc(t,e){if(t==e)return!0;for(var n in t)if(t[n]!==e[n])return!1;for(var r in e)if(!(r in t))return!1;return!0}var Bc=function(t,e){this.spec=e||Vc,this.side=this.spec.side||0,this.toDOM=t};Bc.prototype.map=function(t,e,n,r){var o=t.mapResult(e.from+r,this.side<0?-1:1),i=o.pos,s=o.deleted;return s?null:new jc(i-n,i-n,this)},Bc.prototype.valid=function(){return!0},Bc.prototype.eq=function(t){return this==t||t instanceof Bc&&(this.spec.key&&this.spec.key==t.spec.key||this.toDOM==t.toDOM&&Fc(this.spec,t.spec))};var $c=function(t,e){this.spec=e||Vc,this.attrs=t};$c.prototype.map=function(t,e,n,r){var o=t.map(e.from+r,this.spec.inclusiveStart?-1:1)-n,i=t.map(e.to+r,this.spec.inclusiveEnd?1:-1)-n;return o>=i?null:new jc(o,i,this)},$c.prototype.valid=function(t,e){return e.from<e.to},$c.prototype.eq=function(t){return this==t||t instanceof $c&&Fc(this.attrs,t.attrs)&&Fc(this.spec,t.spec)},$c.is=function(t){return t.type instanceof $c};var _c=function(t,e){this.spec=e||Vc,this.attrs=t};_c.prototype.map=function(t,e,n,r){var o=t.mapResult(e.from+r,1);if(o.deleted)return null;var i=t.mapResult(e.to+r,-1);return i.deleted||i.pos<=o.pos?null:new jc(o.pos-n,i.pos-n,this)},_c.prototype.valid=function(t,e){var n=t.content.findIndex(e.from),r=n.index,o=n.offset;return o==e.from&&o+t.child(r).nodeSize==e.to},_c.prototype.eq=function(t){return this==t||t instanceof _c&&Fc(this.attrs,t.attrs)&&Fc(this.spec,t.spec)};var jc=function(t,e,n){this.from=t,this.to=e,this.type=n},Jc={spec:{configurable:!0},inline:{configurable:!0}};jc.prototype.copy=function(t,e){return new jc(t,e,this.type)},jc.prototype.eq=function(t,e){return void 0===e&&(e=0),this.type.eq(t.type)&&this.from+e==t.from&&this.to+e==t.to},jc.prototype.map=function(t,e,n){return this.type.map(t,this,e,n)},jc.widget=function(t,e,n){return new jc(t,t,new Bc(e,n))},jc.inline=function(t,e,n,r){return new jc(t,e,new $c(n,r))},jc.node=function(t,e,n,r){return new jc(t,e,new _c(n,r))},Jc.spec.get=function(){return this.type.spec},Jc.inline.get=function(){return this.type instanceof $c},Object.defineProperties(jc.prototype,Jc);var Lc=[],Vc={},qc=function(t,e){this.local=t&&t.length?t:Lc,this.children=e&&e.length?e:Lc};qc.create=function(t,e){return e.length?Zc(e,t,0,Vc):Wc},qc.prototype.find=function(t,e,n){var r=[];return this.findInner(null==t?0:t,null==e?1e9:e,r,0,n),r},qc.prototype.findInner=function(t,e,n,r,o){for(var i=0;i<this.local.length;i++){var s=this.local[i];s.from<=e&&s.to>=t&&(!o||o(s.spec))&&n.push(s.copy(s.from+r,s.to+r))}for(var a=0;a<this.children.length;a+=3)if(this.children[a]<e&&this.children[a+1]>t){var c=this.children[a]+1;this.children[a+2].findInner(t-c,e-c,n,r+c,o)}},qc.prototype.map=function(t,e,n){return this==Wc||0==t.maps.length?this:this.mapInner(t,e,0,0,n||Vc)},qc.prototype.mapInner=function(t,e,n,r,o){for(var i,s=0;s<this.local.length;s++){var a=this.local[s].map(t,n,r);a&&a.type.valid(e,a)?(i||(i=[])).push(a):o.onRemove&&o.onRemove(this.local[s].spec)}return this.children.length?Kc(this.children,i,t,e,n,r,o):i?new qc(i.sort(Qc)):Wc},qc.prototype.add=function(t,e){return e.length?this==Wc?qc.create(t,e):this.addInner(t,e,0):this},qc.prototype.addInner=function(t,e,n){var r,o=this,i=0;t.forEach((function(t,s){var a,c=s+n;if(a=Xc(e,t,c)){r||(r=o.children.slice());while(i<r.length&&r[i]<s)i+=3;r[i]==s?r[i+2]=r[i+2].addInner(t,a,c+1):r.splice(i,0,s,s+t.nodeSize,Zc(a,t,c+1,Vc)),i+=3}}));for(var s=Uc(i?Yc(e):e,-n),a=0;a<s.length;a++)s[a].type.valid(t,s[a])||s.splice(a--,1);return new qc(s.length?this.local.concat(s).sort(Qc):this.local,r||this.children)},qc.prototype.remove=function(t){return 0==t.length||this==Wc?this:this.removeInner(t,0)},qc.prototype.removeInner=function(t,e){for(var n=this.children,r=this.local,o=0;o<n.length;o+=3){for(var i=void 0,s=n[o]+e,a=n[o+1]+e,c=0,h=void 0;c<t.length;c++)(h=t[c])&&h.from>s&&h.to<a&&(t[c]=null,(i||(i=[])).push(h));if(i){n==this.children&&(n=this.children.slice());var p=n[o+2].removeInner(i,s+1);p!=Wc?n[o+2]=p:(n.splice(o,3),o-=3)}}if(r.length)for(var l=0,u=void 0;l<t.length;l++)if(u=t[l])for(var f=0;f<r.length;f++)r[f].eq(u,e)&&(r==this.local&&(r=this.local.slice()),r.splice(f--,1));return n==this.children&&r==this.local?this:r.length||n.length?new qc(r,n):Wc},qc.prototype.forChild=function(t,e){if(this==Wc)return this;if(e.isLeaf)return qc.empty;for(var n,r,o=0;o<this.children.length;o+=3)if(this.children[o]>=t){this.children[o]==t&&(n=this.children[o+2]);break}for(var i=t+1,s=i+e.content.size,a=0;a<this.local.length;a++){var c=this.local[a];if(c.from<s&&c.to>i&&c.type instanceof $c){var h=Math.max(i,c.from)-i,p=Math.min(s,c.to)-i;h<p&&(r||(r=[])).push(c.copy(h,p))}}if(r){var l=new qc(r.sort(Qc));return n?new Hc([l,n]):l}return n||Wc},qc.prototype.eq=function(t){if(this==t)return!0;if(!(t instanceof qc)||this.local.length!=t.local.length||this.children.length!=t.children.length)return!1;for(var e=0;e<this.local.length;e++)if(!this.local[e].eq(t.local[e]))return!1;for(var n=0;n<this.children.length;n+=3)if(this.children[n]!=t.children[n]||this.children[n+1]!=t.children[n+1]||!this.children[n+2].eq(t.children[n+2]))return!1;return!0},qc.prototype.locals=function(t){return th(this.localsInner(t))},qc.prototype.localsInner=function(t){if(this==Wc)return Lc;if(t.inlineContent||!this.local.some($c.is))return this.local;for(var e=[],n=0;n<this.local.length;n++)this.local[n].type instanceof $c||e.push(this.local[n]);return e};var Wc=new qc;qc.empty=Wc,qc.removeOverlap=th;var Hc=function(t){this.members=t};function Kc(t,e,n,r,o,i,s){for(var a=t.slice(),c=function(t,e,n,r){for(var s=0;s<a.length;s+=3){var c=a[s+1],h=void 0;-1==c||t>c+i||(e>=a[s]+i?a[s+1]=-1:n>=o&&(h=r-n-(e-t))&&(a[s]+=h,a[s+1]+=h))}},h=0;h<n.maps.length;h++)n.maps[h].forEach(c);for(var p=!1,l=0;l<a.length;l+=3)if(-1==a[l+1]){var u=n.map(t[l]+i),f=u-o;if(f<0||f>=r.content.size){p=!0;continue}var d=n.map(t[l+1]+i,-1),m=d-o,v=r.content.findIndex(f),g=v.index,y=v.offset,w=r.maybeChild(g);if(w&&y==f&&y+w.nodeSize==m){var x=a[l+2].mapInner(n,w,u+1,t[l]+i+1,s);x!=Wc?(a[l]=f,a[l+1]=m,a[l+2]=x):(a[l+1]=-2,p=!0)}else p=!0}if(p){var b=Gc(a,t,e||[],n,o,i,s),k=Zc(b,r,0,s);e=k.local;for(var S=0;S<a.length;S+=3)a[S+1]<0&&(a.splice(S,3),S-=3);for(var O=0,C=0;O<k.children.length;O+=3){var M=k.children[O];while(C<a.length&&a[C]<M)C+=3;a.splice(C,0,k.children[O],k.children[O+1],k.children[O+2])}}return new qc(e&&e.sort(Qc),a)}function Uc(t,e){if(!e||!t.length)return t;for(var n=[],r=0;r<t.length;r++){var o=t[r];n.push(new jc(o.from+e,o.to+e,o.type))}return n}function Gc(t,e,n,r,o,i,s){function a(t,e){for(var i=0;i<t.local.length;i++){var c=t.local[i].map(r,o,e);c?n.push(c):s.onRemove&&s.onRemove(t.local[i].spec)}for(var h=0;h<t.children.length;h+=3)a(t.children[h+2],t.children[h]+e+1)}for(var c=0;c<t.length;c+=3)-1==t[c+1]&&a(t[c+2],e[c]+i+1);return n}function Xc(t,e,n){if(e.isLeaf)return null;for(var r=n+e.nodeSize,o=null,i=0,s=void 0;i<t.length;i++)(s=t[i])&&s.from>n&&s.to<r&&((o||(o=[])).push(s),t[i]=null);return o}function Yc(t){for(var e=[],n=0;n<t.length;n++)null!=t[n]&&e.push(t[n]);return e}function Zc(t,e,n,r){var o=[],i=!1;e.forEach((function(e,s){var a=Xc(t,e,s+n);if(a){i=!0;var c=Zc(a,e,n+s+1,r);c!=Wc&&o.push(s,s+e.nodeSize,c)}}));for(var s=Uc(i?Yc(t):t,-n).sort(Qc),a=0;a<s.length;a++)s[a].type.valid(e,s[a])||(r.onRemove&&r.onRemove(s[a].spec),s.splice(a--,1));return s.length||o.length?new qc(s,o):Wc}function Qc(t,e){return t.from-e.from||t.to-e.to}function th(t){for(var e=t,n=0;n<e.length-1;n++){var r=e[n];if(r.from!=r.to)for(var o=n+1;o<e.length;o++){var i=e[o];if(i.from!=r.from){i.from<r.to&&(e==t&&(e=t.slice()),e[n]=r.copy(r.from,i.from),eh(e,o,r.copy(i.from,r.to)));break}i.to!=r.to&&(e==t&&(e=t.slice()),e[o]=i.copy(i.from,r.to),eh(e,o+1,i.copy(r.to,i.to)))}}return e}function eh(t,e,n){while(e<t.length&&Qc(n,t[e])>0)e++;t.splice(e,0,n)}function nh(t){var e=[];return t.someProp("decorations",(function(n){var r=n(t.state);r&&r!=Wc&&e.push(r)})),t.cursorWrapper&&e.push(qc.create(t.state.doc,[t.cursorWrapper.deco])),Hc.from(e)}Hc.prototype.forChild=function(t,e){if(e.isLeaf)return qc.empty;for(var n=[],r=0;r<this.members.length;r++){var o=this.members[r].forChild(t,e);o!=Wc&&(o instanceof Hc?n=n.concat(o.members):n.push(o))}return Hc.from(n)},Hc.prototype.eq=function(t){if(!(t instanceof Hc)||t.members.length!=this.members.length)return!1;for(var e=0;e<this.members.length;e++)if(!this.members[e].eq(t.members[e]))return!1;return!0},Hc.prototype.locals=function(t){for(var e,n=!0,r=0;r<this.members.length;r++){var o=this.members[r].localsInner(t);if(o.length)if(e){n&&(e=e.slice(),n=!1);for(var i=0;i<o.length;i++)e.push(o[i])}else e=o}return e?th(n?e:e.sort(Qc)):Lc},Hc.from=function(t){switch(t.length){case 0:return Wc;case 1:return t[0];default:return new Hc(t)}};var rh=function(t,e){this._props=e,this.state=e.state,this.dispatch=this.dispatch.bind(this),this._root=null,this.focused=!1,this.trackWrites=null,this.dom=t&&t.mount||document.createElement("div"),t&&(t.appendChild?t.appendChild(this.dom):t.apply?t(this.dom):t.mount&&(this.mounted=!0)),this.editable=ah(this),this.markCursor=null,this.cursorWrapper=null,sh(this),this.nodeViews=hh(this),this.docView=Ds(this.state.doc,ih(this),nh(this),this.dom,this),this.lastSelectedViewDesc=null,this.dragging=null,rc(this),this.pluginViews=[],this.updatePluginViews()},oh={props:{configurable:!0},root:{configurable:!0}};function ih(t){var e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(t.editable),t.someProp("attributes",(function(n){if("function"==typeof n&&(n=n(t.state)),n)for(var r in n)"class"==r?e.class+=" "+n[r]:e[r]||"contenteditable"==r||"nodeName"==r||(e[r]=String(n[r]))})),[jc.node(0,t.state.doc.content.size,e)]}function sh(t){if(t.markCursor){var e=document.createElement("img");e.setAttribute("mark-placeholder","true"),t.cursorWrapper={dom:e,deco:jc.widget(t.state.selection.head,e,{raw:!0,marks:t.markCursor})}}else t.cursorWrapper=null}function ah(t){return!t.someProp("editable",(function(e){return!1===e(t.state)}))}function ch(t,e){var n=Math.min(t.$anchor.sharedDepth(t.head),e.$anchor.sharedDepth(e.head));return t.$anchor.start(n)!=e.$anchor.start(n)}function hh(t){var e={};return t.someProp("nodeViews",(function(t){for(var n in t)Object.prototype.hasOwnProperty.call(e,n)||(e[n]=t[n])})),e}function ph(t,e){var n=0,r=0;for(var o in t){if(t[o]!=e[o])return!0;n++}for(var i in e)r++;return n!=r}function lh(t,e,n){for(var r=0;;r++){if(r==t.childCount||r==e.childCount)return t.childCount==e.childCount?null:n;var o=t.child(r),i=e.child(r);if(o!=i){if(!o.sameMarkup(i))return n;if(o.isText&&o.text!=i.text){for(var s=0;o.text[s]==i.text[s];s++)n++;return n}if(o.content.size||i.content.size){var a=lh(o.content,i.content,n+1);if(null!=a)return a}n+=o.nodeSize}else n+=o.nodeSize}}function uh(t,e,n,r){for(var o=t.childCount,i=e.childCount;;){if(0==o||0==i)return o==i?null:{a:n,b:r};var s=t.child(--o),a=e.child(--i),c=s.nodeSize;if(s!=a){if(!s.sameMarkup(a))return{a:n,b:r};if(s.isText&&s.text!=a.text){var h=0,p=Math.min(s.text.length,a.text.length);while(h<p&&s.text[s.text.length-h-1]==a.text[a.text.length-h-1])h++,n--,r--;return{a:n,b:r}}if(s.content.size||a.content.size){var l=uh(s.content,a.content,n-1,r-1);if(l)return l}n-=c,r-=c}else n-=c,r-=c}}oh.props.get=function(){if(this._props.state!=this.state){var t=this._props;for(var e in this._props={},t)this._props[e]=t[e];this._props.state=this.state}return this._props},rh.prototype.update=function(t){t.handleDOMEvents!=this._props.handleDOMEvents&&sc(this),this._props=t,this.updateStateInner(t.state,!0)},rh.prototype.setProps=function(t){var e={};for(var n in this._props)e[n]=this._props[n];for(var r in e.state=this.state,t)e[r]=t[r];this.update(e)},rh.prototype.updateState=function(t){this.updateStateInner(t,this.state.plugins!=t.plugins)},rh.prototype.updateStateInner=function(t,e){var n=this,r=this.state,o=!1,i=!1;if(t.storedMarks&&this.composing&&(Mc(this),i=!0),this.state=t,e){var s=hh(this);ph(s,this.nodeViews)&&(this.nodeViews=s,o=!0),sc(this)}this.editable=ah(this),sh(this);var a=nh(this),c=ih(this),h=e?"reset":t.scrollToSelection>r.scrollToSelection?"to selection":"preserve",p=o||!this.docView.matchesNode(t.doc,c,a);!p&&t.selection.eq(r.selection)||(i=!0);var l="preserve"==h&&i&&null==this.dom.style.overflowAnchor&&Hi(this);if(i){this.domObserver.stop();var u=p&&(Oi.ie||Oi.chrome)&&!this.composing&&!r.selection.empty&&!t.selection.empty&&ch(r.selection,t.selection);if(p){var f=Oi.chrome?this.trackWrites=this.root.getSelection().focusNode:null;!o&&this.docView.update(t.doc,c,a,this)||(this.docView.updateOuterDeco([]),this.docView.destroy(),this.docView=Ds(t.doc,c,a,this.dom,this)),f&&!this.trackWrites&&(u=!0)}u||!(this.mouseDown&&this.domObserver.currentSelection.eq(this.root.getSelection())&&ua(this))?ta(this,u):(aa(this,t.selection),this.domObserver.setCurSelection()),this.domObserver.start()}if(this.updatePluginViews(r),"reset"==h)this.dom.scrollTop=0;else if("to selection"==h){var d=this.root.getSelection().focusNode;this.someProp("handleScrollToSelection",(function(t){return t(n)}))||(t.selection instanceof ni?Wi(this,this.docView.domAfterPos(t.selection.from).getBoundingClientRect(),d):Wi(this,this.coordsAtPos(t.selection.head,1),d))}else l&&Ui(l)},rh.prototype.destroyPluginViews=function(){var t;while(t=this.pluginViews.pop())t.destroy&&t.destroy()},rh.prototype.updatePluginViews=function(t){if(t&&t.plugins==this.state.plugins)for(var e=0;e<this.pluginViews.length;e++){var n=this.pluginViews[e];n.update&&n.update(this,t)}else{this.destroyPluginViews();for(var r=0;r<this.state.plugins.length;r++){var o=this.state.plugins[r];o.spec.view&&this.pluginViews.push(o.spec.view(this))}}},rh.prototype.someProp=function(t,e){var n,r=this._props&&this._props[t];if(null!=r&&(n=e?e(r):r))return n;var o=this.state.plugins;if(o)for(var i=0;i<o.length;i++){var s=o[i].props[t];if(null!=s&&(n=e?e(s):s))return n}},rh.prototype.hasFocus=function(){return this.root.activeElement==this.dom},rh.prototype.focus=function(){this.domObserver.stop(),this.editable&&Yi(this.dom),ta(this),this.domObserver.start()},oh.root.get=function(){var t=this._root;if(null==t)for(var e=this.dom.parentNode;e;e=e.parentNode)if(9==e.nodeType||11==e.nodeType&&e.host)return e.getSelection||(Object.getPrototypeOf(e).getSelection=function(){return document.getSelection()}),this._root=e;return t||document},rh.prototype.posAtCoords=function(t){return ss(this,t)},rh.prototype.coordsAtPos=function(t,e){return void 0===e&&(e=1),hs(this,t,e)},rh.prototype.domAtPos=function(t,e){return void 0===e&&(e=0),this.docView.domFromPos(t,e)},rh.prototype.nodeDOM=function(t){var e=this.docView.descAt(t);return e?e.nodeDOM:null},rh.prototype.posAtDOM=function(t,e,n){void 0===n&&(n=-1);var r=this.docView.posFromDOM(t,e,n);if(null==r)throw new RangeError("DOM position not inside the editor");return r},rh.prototype.endOfTextblock=function(t,e){return ws(this,e||this.state,t)},rh.prototype.destroy=function(){this.docView&&(ic(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],nh(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null)},rh.prototype.dispatchEvent=function(t){return hc(this,t)},rh.prototype.dispatch=function(t){var e=this._props.dispatchTransaction;e?e.call(this,t):this.updateState(this.state.apply(t))},Object.defineProperties(rh.prototype,oh);var fh=function(t,e){if(this.content=t,this.size=e||0,null==e)for(var n=0;n<t.length;n++)this.size+=t[n].nodeSize},dh={firstChild:{configurable:!0},lastChild:{configurable:!0},childCount:{configurable:!0}};fh.prototype.nodesBetween=function(t,e,n,r,o){void 0===r&&(r=0);for(var i=0,s=0;s<e;i++){var a=this.content[i],c=s+a.nodeSize;if(c>t&&!1!==n(a,r+s,o,i)&&a.content.size){var h=s+1;a.nodesBetween(Math.max(0,t-h),Math.min(a.content.size,e-h),n,r+h)}s=c}},fh.prototype.descendants=function(t){this.nodesBetween(0,this.size,t)},fh.prototype.textBetween=function(t,e,n,r){var o="",i=!0;return this.nodesBetween(t,e,(function(s,a){s.isText?(o+=s.text.slice(Math.max(t,a)-a,e-a),i=!n):s.isLeaf&&r?(o+=r,i=!n):!i&&s.isBlock&&(o+=n,i=!0)}),0),o},fh.prototype.append=function(t){if(!t.size)return this;if(!this.size)return t;var e=this.lastChild,n=t.firstChild,r=this.content.slice(),o=0;for(e.isText&&e.sameMarkup(n)&&(r[r.length-1]=e.withText(e.text+n.text),o=1);o<t.content.length;o++)r.push(t.content[o]);return new fh(r,this.size+t.size)},fh.prototype.cut=function(t,e){if(null==e&&(e=this.size),0==t&&e==this.size)return this;var n=[],r=0;if(e>t)for(var o=0,i=0;i<e;o++){var s=this.content[o],a=i+s.nodeSize;a>t&&((i<t||a>e)&&(s=s.isText?s.cut(Math.max(0,t-i),Math.min(s.text.length,e-i)):s.cut(Math.max(0,t-i-1),Math.min(s.content.size,e-i-1))),n.push(s),r+=s.nodeSize),i=a}return new fh(n,r)},fh.prototype.cutByIndex=function(t,e){return t==e?fh.empty:0==t&&e==this.content.length?this:new fh(this.content.slice(t,e))},fh.prototype.replaceChild=function(t,e){var n=this.content[t];if(n==e)return this;var r=this.content.slice(),o=this.size+e.nodeSize-n.nodeSize;return r[t]=e,new fh(r,o)},fh.prototype.addToStart=function(t){return new fh([t].concat(this.content),this.size+t.nodeSize)},fh.prototype.addToEnd=function(t){return new fh(this.content.concat(t),this.size+t.nodeSize)},fh.prototype.eq=function(t){if(this.content.length!=t.content.length)return!1;for(var e=0;e<this.content.length;e++)if(!this.content[e].eq(t.content[e]))return!1;return!0},dh.firstChild.get=function(){return this.content.length?this.content[0]:null},dh.lastChild.get=function(){return this.content.length?this.content[this.content.length-1]:null},dh.childCount.get=function(){return this.content.length},fh.prototype.child=function(t){var e=this.content[t];if(!e)throw new RangeError("Index "+t+" out of range for "+this);return e},fh.prototype.maybeChild=function(t){return this.content[t]},fh.prototype.forEach=function(t){for(var e=0,n=0;e<this.content.length;e++){var r=this.content[e];t(r,n,e),n+=r.nodeSize}},fh.prototype.findDiffStart=function(t,e){return void 0===e&&(e=0),lh(this,t,e)},fh.prototype.findDiffEnd=function(t,e,n){return void 0===e&&(e=this.size),void 0===n&&(n=t.size),uh(this,t,e,n)},fh.prototype.findIndex=function(t,e){if(void 0===e&&(e=-1),0==t)return vh(0,t);if(t==this.size)return vh(this.content.length,t);if(t>this.size||t<0)throw new RangeError("Position "+t+" outside of fragment ("+this+")");for(var n=0,r=0;;n++){var o=this.child(n),i=r+o.nodeSize;if(i>=t)return i==t||e>0?vh(n+1,i):vh(n,r);r=i}},fh.prototype.toString=function(){return"<"+this.toStringInner()+">"},fh.prototype.toStringInner=function(){return this.content.join(", ")},fh.prototype.toJSON=function(){return this.content.length?this.content.map((function(t){return t.toJSON()})):null},fh.fromJSON=function(t,e){if(!e)return fh.empty;if(!Array.isArray(e))throw new RangeError("Invalid input for Fragment.fromJSON");return new fh(e.map(t.nodeFromJSON))},fh.fromArray=function(t){if(!t.length)return fh.empty;for(var e,n=0,r=0;r<t.length;r++){var o=t[r];n+=o.nodeSize,r&&o.isText&&t[r-1].sameMarkup(o)?(e||(e=t.slice(0,r)),e[e.length-1]=o.withText(e[e.length-1].text+o.text)):e&&e.push(o)}return new fh(e||t,n)},fh.from=function(t){if(!t)return fh.empty;if(t instanceof fh)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new fh([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))},Object.defineProperties(fh.prototype,dh);var mh={index:0,offset:0};function vh(t,e){return mh.index=t,mh.offset=e,mh}function gh(t,e){if(t===e)return!0;if(!t||"object"!=typeof t||!e||"object"!=typeof e)return!1;var n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(var r=0;r<t.length;r++)if(!gh(t[r],e[r]))return!1}else{for(var o in t)if(!(o in e)||!gh(t[o],e[o]))return!1;for(var i in e)if(!(i in t))return!1}return!0}fh.empty=new fh([],0);var yh=function(t,e){this.type=t,this.attrs=e};function wh(t){var e=Error.call(this,t);return e.__proto__=wh.prototype,e}yh.prototype.addToSet=function(t){for(var e,n=!1,r=0;r<t.length;r++){var o=t[r];if(this.eq(o))return t;if(this.type.excludes(o.type))e||(e=t.slice(0,r));else{if(o.type.excludes(this.type))return t;!n&&o.type.rank>this.type.rank&&(e||(e=t.slice(0,r)),e.push(this),n=!0),e&&e.push(o)}}return e||(e=t.slice()),n||e.push(this),e},yh.prototype.removeFromSet=function(t){for(var e=0;e<t.length;e++)if(this.eq(t[e]))return t.slice(0,e).concat(t.slice(e+1));return t},yh.prototype.isInSet=function(t){for(var e=0;e<t.length;e++)if(this.eq(t[e]))return!0;return!1},yh.prototype.eq=function(t){return this==t||this.type==t.type&&gh(this.attrs,t.attrs)},yh.prototype.toJSON=function(){var t={type:this.type.name};for(var e in this.attrs){t.attrs=this.attrs;break}return t},yh.fromJSON=function(t,e){if(!e)throw new RangeError("Invalid input for Mark.fromJSON");var n=t.marks[e.type];if(!n)throw new RangeError("There is no mark type "+e.type+" in this schema");return n.create(e.attrs)},yh.sameSet=function(t,e){if(t==e)return!0;if(t.length!=e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].eq(e[n]))return!1;return!0},yh.setFrom=function(t){if(!t||0==t.length)return yh.none;if(t instanceof yh)return[t];var e=t.slice();return e.sort((function(t,e){return t.type.rank-e.type.rank})),e},yh.none=[],wh.prototype=Object.create(Error.prototype),wh.prototype.constructor=wh,wh.prototype.name="ReplaceError";var xh=function(t,e,n){this.content=t,this.openStart=e,this.openEnd=n},bh={size:{configurable:!0}};function kh(t,e,n){var r=t.findIndex(e),o=r.index,i=r.offset,s=t.maybeChild(o),a=t.findIndex(n),c=a.index,h=a.offset;if(i==e||s.isText){if(h!=n&&!t.child(c).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(o!=c)throw new RangeError("Removing non-flat range");return t.replaceChild(o,s.copy(kh(s.content,e-i-1,n-i-1)))}function Sh(t,e,n,r){var o=t.findIndex(e),i=o.index,s=o.offset,a=t.maybeChild(i);if(s==e||a.isText)return r&&!r.canReplace(i,i,n)?null:t.cut(0,e).append(n).append(t.cut(e));var c=Sh(a.content,e-s-1,n);return c&&t.replaceChild(i,a.copy(c))}function Oh(t,e,n){if(n.openStart>t.depth)throw new wh("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new wh("Inconsistent open depths");return Ch(t,e,n,0)}function Ch(t,e,n,r){var o=t.index(r),i=t.node(r);if(o==e.index(r)&&r<t.depth-n.openStart){var s=Ch(t,e,n,r+1);return i.copy(i.content.replaceChild(o,s))}if(n.content.size){if(n.openStart||n.openEnd||t.depth!=r||e.depth!=r){var a=zh(n,t),c=a.start,h=a.end;return Ah(i,Dh(t,c,h,e,r))}var p=t.parent,l=p.content;return Ah(p,l.cut(0,t.parentOffset).append(n.content).append(l.cut(e.parentOffset)))}return Ah(i,Rh(t,e,r))}function Mh(t,e){if(!e.type.compatibleContent(t.type))throw new wh("Cannot join "+e.type.name+" onto "+t.type.name)}function Nh(t,e,n){var r=t.node(n);return Mh(r,e.node(n)),r}function Th(t,e){var n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function Eh(t,e,n,r){var o=(e||t).node(n),i=0,s=e?e.index(n):o.childCount;t&&(i=t.index(n),t.depth>n?i++:t.textOffset&&(Th(t.nodeAfter,r),i++));for(var a=i;a<s;a++)Th(o.child(a),r);e&&e.depth==n&&e.textOffset&&Th(e.nodeBefore,r)}function Ah(t,e){if(!t.type.validContent(e))throw new wh("Invalid content for node "+t.type.name);return t.copy(e)}function Dh(t,e,n,r,o){var i=t.depth>o&&Nh(t,e,o+1),s=r.depth>o&&Nh(n,r,o+1),a=[];return Eh(null,t,o,a),i&&s&&e.index(o)==n.index(o)?(Mh(i,s),Th(Ah(i,Dh(t,e,n,r,o+1)),a)):(i&&Th(Ah(i,Rh(t,e,o+1)),a),Eh(e,n,o,a),s&&Th(Ah(s,Rh(n,r,o+1)),a)),Eh(r,null,o,a),new fh(a)}function Rh(t,e,n){var r=[];if(Eh(null,t,n,r),t.depth>n){var o=Nh(t,e,n+1);Th(Ah(o,Rh(t,e,n+1)),r)}return Eh(e,null,n,r),new fh(r)}function zh(t,e){for(var n=e.depth-t.openStart,r=e.node(n),o=r.copy(t.content),i=n-1;i>=0;i--)o=e.node(i).copy(fh.from(o));return{start:o.resolveNoCache(t.openStart+n),end:o.resolveNoCache(o.content.size-t.openEnd-n)}}bh.size.get=function(){return this.content.size-this.openStart-this.openEnd},xh.prototype.insertAt=function(t,e){var n=Sh(this.content,t+this.openStart,e,null);return n&&new xh(n,this.openStart,this.openEnd)},xh.prototype.removeBetween=function(t,e){return new xh(kh(this.content,t+this.openStart,e+this.openStart),this.openStart,this.openEnd)},xh.prototype.eq=function(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd},xh.prototype.toString=function(){return this.content+"("+this.openStart+","+this.openEnd+")"},xh.prototype.toJSON=function(){if(!this.content.size)return null;var t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t},xh.fromJSON=function(t,e){if(!e)return xh.empty;var n=e.openStart||0,r=e.openEnd||0;if("number"!=typeof n||"number"!=typeof r)throw new RangeError("Invalid input for Slice.fromJSON");return new xh(fh.fromJSON(t,e.content),n,r)},xh.maxOpen=function(t,e){void 0===e&&(e=!0);for(var n=0,r=0,o=t.firstChild;o&&!o.isLeaf&&(e||!o.type.spec.isolating);o=o.firstChild)n++;for(var i=t.lastChild;i&&!i.isLeaf&&(e||!i.type.spec.isolating);i=i.lastChild)r++;return new xh(t,n,r)},Object.defineProperties(xh.prototype,bh),xh.empty=new xh(fh.empty,0,0);var Ih=function(t,e,n){this.pos=t,this.path=e,this.depth=e.length/3-1,this.parentOffset=n},Ph={parent:{configurable:!0},doc:{configurable:!0},textOffset:{configurable:!0},nodeAfter:{configurable:!0},nodeBefore:{configurable:!0}};Ih.prototype.resolveDepth=function(t){return null==t?this.depth:t<0?this.depth+t:t},Ph.parent.get=function(){return this.node(this.depth)},Ph.doc.get=function(){return this.node(0)},Ih.prototype.node=function(t){return this.path[3*this.resolveDepth(t)]},Ih.prototype.index=function(t){return this.path[3*this.resolveDepth(t)+1]},Ih.prototype.indexAfter=function(t){return t=this.resolveDepth(t),this.index(t)+(t!=this.depth||this.textOffset?1:0)},Ih.prototype.start=function(t){return t=this.resolveDepth(t),0==t?0:this.path[3*t-1]+1},Ih.prototype.end=function(t){return t=this.resolveDepth(t),this.start(t)+this.node(t).content.size},Ih.prototype.before=function(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position before the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]},Ih.prototype.after=function(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position after the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]+this.path[3*t].nodeSize},Ph.textOffset.get=function(){return this.pos-this.path[this.path.length-1]},Ph.nodeAfter.get=function(){var t=this.parent,e=this.index(this.depth);if(e==t.childCount)return null;var n=this.pos-this.path[this.path.length-1],r=t.child(e);return n?t.child(e).cut(n):r},Ph.nodeBefore.get=function(){var t=this.index(this.depth),e=this.pos-this.path[this.path.length-1];return e?this.parent.child(t).cut(0,e):0==t?null:this.parent.child(t-1)},Ih.prototype.posAtIndex=function(t,e){e=this.resolveDepth(e);for(var n=this.path[3*e],r=0==e?0:this.path[3*e-1]+1,o=0;o<t;o++)r+=n.child(o).nodeSize;return r},Ih.prototype.marks=function(){var t=this.parent,e=this.index();if(0==t.content.size)return yh.none;if(this.textOffset)return t.child(e).marks;var n=t.maybeChild(e-1),r=t.maybeChild(e);if(!n){var o=n;n=r,r=o}for(var i=n.marks,s=0;s<i.length;s++)!1!==i[s].type.spec.inclusive||r&&i[s].isInSet(r.marks)||(i=i[s--].removeFromSet(i));return i},Ih.prototype.marksAcross=function(t){var e=this.parent.maybeChild(this.index());if(!e||!e.isInline)return null;for(var n=e.marks,r=t.parent.maybeChild(t.index()),o=0;o<n.length;o++)!1!==n[o].type.spec.inclusive||r&&n[o].isInSet(r.marks)||(n=n[o--].removeFromSet(n));return n},Ih.prototype.sharedDepth=function(t){for(var e=this.depth;e>0;e--)if(this.start(e)<=t&&this.end(e)>=t)return e;return 0},Ih.prototype.blockRange=function(t,e){if(void 0===t&&(t=this),t.pos<this.pos)return t.blockRange(this);for(var n=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);n>=0;n--)if(t.pos<=this.end(n)&&(!e||e(this.node(n))))return new _h(this,t,n)},Ih.prototype.sameParent=function(t){return this.pos-this.parentOffset==t.pos-t.parentOffset},Ih.prototype.max=function(t){return t.pos>this.pos?t:this},Ih.prototype.min=function(t){return t.pos<this.pos?t:this},Ih.prototype.toString=function(){for(var t="",e=1;e<=this.depth;e++)t+=(t?"/":"")+this.node(e).type.name+"_"+this.index(e-1);return t+":"+this.parentOffset},Ih.resolve=function(t,e){if(!(e>=0&&e<=t.content.size))throw new RangeError("Position "+e+" out of range");for(var n=[],r=0,o=e,i=t;;){var s=i.content.findIndex(o),a=s.index,c=s.offset,h=o-c;if(n.push(i,a,r+c),!h)break;if(i=i.child(a),i.isText)break;o=h-1,r+=c+1}return new Ih(e,n,o)},Ih.resolveCached=function(t,e){for(var n=0;n<Fh.length;n++){var r=Fh[n];if(r.pos==e&&r.doc==t)return r}var o=Fh[Bh]=Ih.resolve(t,e);return Bh=(Bh+1)%$h,o},Object.defineProperties(Ih.prototype,Ph);var Fh=[],Bh=0,$h=12,_h=function(t,e,n){this.$from=t,this.$to=e,this.depth=n},jh={start:{configurable:!0},end:{configurable:!0},parent:{configurable:!0},startIndex:{configurable:!0},endIndex:{configurable:!0}};jh.start.get=function(){return this.$from.before(this.depth+1)},jh.end.get=function(){return this.$to.after(this.depth+1)},jh.parent.get=function(){return this.$from.node(this.depth)},jh.startIndex.get=function(){return this.$from.index(this.depth)},jh.endIndex.get=function(){return this.$to.indexAfter(this.depth)},Object.defineProperties(_h.prototype,jh);var Jh=Object.create(null),Lh=function(t,e,n,r){this.type=t,this.attrs=e,this.content=n||fh.empty,this.marks=r||yh.none},Vh={nodeSize:{configurable:!0},childCount:{configurable:!0},textContent:{configurable:!0},firstChild:{configurable:!0},lastChild:{configurable:!0},isBlock:{configurable:!0},isTextblock:{configurable:!0},inlineContent:{configurable:!0},isInline:{configurable:!0},isText:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};Vh.nodeSize.get=function(){return this.isLeaf?1:2+this.content.size},Vh.childCount.get=function(){return this.content.childCount},Lh.prototype.child=function(t){return this.content.child(t)},Lh.prototype.maybeChild=function(t){return this.content.maybeChild(t)},Lh.prototype.forEach=function(t){this.content.forEach(t)},Lh.prototype.nodesBetween=function(t,e,n,r){void 0===r&&(r=0),this.content.nodesBetween(t,e,n,r,this)},Lh.prototype.descendants=function(t){this.nodesBetween(0,this.content.size,t)},Vh.textContent.get=function(){return this.textBetween(0,this.content.size,"")},Lh.prototype.textBetween=function(t,e,n,r){return this.content.textBetween(t,e,n,r)},Vh.firstChild.get=function(){return this.content.firstChild},Vh.lastChild.get=function(){return this.content.lastChild},Lh.prototype.eq=function(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)},Lh.prototype.sameMarkup=function(t){return this.hasMarkup(t.type,t.attrs,t.marks)},Lh.prototype.hasMarkup=function(t,e,n){return this.type==t&&gh(this.attrs,e||t.defaultAttrs||Jh)&&yh.sameSet(this.marks,n||yh.none)},Lh.prototype.copy=function(t){return void 0===t&&(t=null),t==this.content?this:new this.constructor(this.type,this.attrs,t,this.marks)},Lh.prototype.mark=function(t){return t==this.marks?this:new this.constructor(this.type,this.attrs,this.content,t)},Lh.prototype.cut=function(t,e){return 0==t&&e==this.content.size?this:this.copy(this.content.cut(t,e))},Lh.prototype.slice=function(t,e,n){if(void 0===e&&(e=this.content.size),void 0===n&&(n=!1),t==e)return xh.empty;var r=this.resolve(t),o=this.resolve(e),i=n?0:r.sharedDepth(e),s=r.start(i),a=r.node(i),c=a.content.cut(r.pos-s,o.pos-s);return new xh(c,r.depth-i,o.depth-i)},Lh.prototype.replace=function(t,e,n){return Oh(this.resolve(t),this.resolve(e),n)},Lh.prototype.nodeAt=function(t){for(var e=this;;){var n=e.content.findIndex(t),r=n.index,o=n.offset;if(e=e.maybeChild(r),!e)return null;if(o==t||e.isText)return e;t-=o+1}},Lh.prototype.childAfter=function(t){var e=this.content.findIndex(t),n=e.index,r=e.offset;return{node:this.content.maybeChild(n),index:n,offset:r}},Lh.prototype.childBefore=function(t){if(0==t)return{node:null,index:0,offset:0};var e=this.content.findIndex(t),n=e.index,r=e.offset;if(r<t)return{node:this.content.child(n),index:n,offset:r};var o=this.content.child(n-1);return{node:o,index:n-1,offset:r-o.nodeSize}},Lh.prototype.resolve=function(t){return Ih.resolveCached(this,t)},Lh.prototype.resolveNoCache=function(t){return Ih.resolve(this,t)},Lh.prototype.rangeHasMark=function(t,e,n){var r=!1;return e>t&&this.nodesBetween(t,e,(function(t){return n.isInSet(t.marks)&&(r=!0),!r})),r},Vh.isBlock.get=function(){return this.type.isBlock},Vh.isTextblock.get=function(){return this.type.isTextblock},Vh.inlineContent.get=function(){return this.type.inlineContent},Vh.isInline.get=function(){return this.type.isInline},Vh.isText.get=function(){return this.type.isText},Vh.isLeaf.get=function(){return this.type.isLeaf},Vh.isAtom.get=function(){return this.type.isAtom},Lh.prototype.toString=function(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);var t=this.type.name;return this.content.size&&(t+="("+this.content.toStringInner()+")"),Wh(this.marks,t)},Lh.prototype.contentMatchAt=function(t){var e=this.type.contentMatch.matchFragment(this.content,0,t);if(!e)throw new Error("Called contentMatchAt on a node with invalid content");return e},Lh.prototype.canReplace=function(t,e,n,r,o){void 0===n&&(n=fh.empty),void 0===r&&(r=0),void 0===o&&(o=n.childCount);var i=this.contentMatchAt(t).matchFragment(n,r,o),s=i&&i.matchFragment(this.content,e);if(!s||!s.validEnd)return!1;for(var a=r;a<o;a++)if(!this.type.allowsMarks(n.child(a).marks))return!1;return!0},Lh.prototype.canReplaceWith=function(t,e,n,r){if(r&&!this.type.allowsMarks(r))return!1;var o=this.contentMatchAt(t).matchType(n),i=o&&o.matchFragment(this.content,e);return!!i&&i.validEnd},Lh.prototype.canAppend=function(t){return t.content.size?this.canReplace(this.childCount,this.childCount,t.content):this.type.compatibleContent(t.type)},Lh.prototype.check=function(){if(!this.type.validContent(this.content))throw new RangeError("Invalid content for node "+this.type.name+": "+this.content.toString().slice(0,50));for(var t=yh.none,e=0;e<this.marks.length;e++)t=this.marks[e].addToSet(t);if(!yh.sameSet(t,this.marks))throw new RangeError("Invalid collection of marks for node "+this.type.name+": "+this.marks.map((function(t){return t.type.name})));this.content.forEach((function(t){return t.check()}))},Lh.prototype.toJSON=function(){var t={type:this.type.name};for(var e in this.attrs){t.attrs=this.attrs;break}return this.content.size&&(t.content=this.content.toJSON()),this.marks.length&&(t.marks=this.marks.map((function(t){return t.toJSON()}))),t},Lh.fromJSON=function(t,e){if(!e)throw new RangeError("Invalid input for Node.fromJSON");var n=null;if(e.marks){if(!Array.isArray(e.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=e.marks.map(t.markFromJSON)}if("text"==e.type){if("string"!=typeof e.text)throw new RangeError("Invalid text node in JSON");return t.text(e.text,n)}var r=fh.fromJSON(t,e.content);return t.nodeType(e.type).create(e.attrs,r,n)},Object.defineProperties(Lh.prototype,Vh);var qh=function(t){function e(e,n,r,o){if(t.call(this,e,n,null,o),!r)throw new RangeError("Empty text nodes are not allowed");this.text=r}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={textContent:{configurable:!0},nodeSize:{configurable:!0}};return e.prototype.toString=function(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):Wh(this.marks,JSON.stringify(this.text))},n.textContent.get=function(){return this.text},e.prototype.textBetween=function(t,e){return this.text.slice(t,e)},n.nodeSize.get=function(){return this.text.length},e.prototype.mark=function(t){return t==this.marks?this:new e(this.type,this.attrs,this.text,t)},e.prototype.withText=function(t){return t==this.text?this:new e(this.type,this.attrs,t,this.marks)},e.prototype.cut=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=this.text.length),0==t&&e==this.text.length?this:this.withText(this.text.slice(t,e))},e.prototype.eq=function(t){return this.sameMarkup(t)&&this.text==t.text},e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.text=this.text,e},Object.defineProperties(e.prototype,n),e}(Lh);function Wh(t,e){for(var n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}var Hh=function(t){this.validEnd=t,this.next=[],this.wrapCache=[]},Kh={inlineContent:{configurable:!0},defaultType:{configurable:!0},edgeCount:{configurable:!0}};Hh.parse=function(t,e){var n=new Uh(t,e);if(null==n.next)return Hh.empty;var r=Xh(n);n.next&&n.err("Unexpected trailing text");var o=sp(rp(r));return ap(o,n),o},Hh.prototype.matchType=function(t){for(var e=0;e<this.next.length;e+=2)if(this.next[e]==t)return this.next[e+1];return null},Hh.prototype.matchFragment=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=t.childCount);for(var r=this,o=e;r&&o<n;o++)r=r.matchType(t.child(o).type);return r},Kh.inlineContent.get=function(){var t=this.next[0];return!!t&&t.isInline},Kh.defaultType.get=function(){for(var t=0;t<this.next.length;t+=2){var e=this.next[t];if(!e.isText&&!e.hasRequiredAttrs())return e}},Hh.prototype.compatible=function(t){for(var e=0;e<this.next.length;e+=2)for(var n=0;n<t.next.length;n+=2)if(this.next[e]==t.next[n])return!0;return!1},Hh.prototype.fillBefore=function(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=0);var r=[this];function o(i,s){var a=i.matchFragment(t,n);if(a&&(!e||a.validEnd))return fh.from(s.map((function(t){return t.createAndFill()})));for(var c=0;c<i.next.length;c+=2){var h=i.next[c],p=i.next[c+1];if(!h.isText&&!h.hasRequiredAttrs()&&-1==r.indexOf(p)){r.push(p);var l=o(p,s.concat(h));if(l)return l}}}return o(this,[])},Hh.prototype.findWrapping=function(t){for(var e=0;e<this.wrapCache.length;e+=2)if(this.wrapCache[e]==t)return this.wrapCache[e+1];var n=this.computeWrapping(t);return this.wrapCache.push(t,n),n},Hh.prototype.computeWrapping=function(t){var e=Object.create(null),n=[{match:this,type:null,via:null}];while(n.length){var r=n.shift(),o=r.match;if(o.matchType(t)){for(var i=[],s=r;s.type;s=s.via)i.push(s.type);return i.reverse()}for(var a=0;a<o.next.length;a+=2){var c=o.next[a];c.isLeaf||c.hasRequiredAttrs()||c.name in e||r.type&&!o.next[a+1].validEnd||(n.push({match:c.contentMatch,type:c,via:r}),e[c.name]=!0)}}},Kh.edgeCount.get=function(){return this.next.length>>1},Hh.prototype.edge=function(t){var e=t<<1;if(e>=this.next.length)throw new RangeError("There's no "+t+"th edge in this content match");return{type:this.next[e],next:this.next[e+1]}},Hh.prototype.toString=function(){var t=[];function e(n){t.push(n);for(var r=1;r<n.next.length;r+=2)-1==t.indexOf(n.next[r])&&e(n.next[r])}return e(this),t.map((function(e,n){for(var r=n+(e.validEnd?"*":" ")+" ",o=0;o<e.next.length;o+=2)r+=(o?", ":"")+e.next[o].name+"->"+t.indexOf(e.next[o+1]);return r})).join("\n")},Object.defineProperties(Hh.prototype,Kh),Hh.empty=new Hh(!0);var Uh=function(t,e){this.string=t,this.nodeTypes=e,this.inline=null,this.pos=0,this.tokens=t.split(/\s*(?=\b|\W|$)/),""==this.tokens[this.tokens.length-1]&&this.tokens.pop(),""==this.tokens[0]&&this.tokens.shift()},Gh={next:{configurable:!0}};function Xh(t){var e=[];do{e.push(Yh(t))}while(t.eat("|"));return 1==e.length?e[0]:{type:"choice",exprs:e}}function Yh(t){var e=[];do{e.push(Zh(t))}while(t.next&&")"!=t.next&&"|"!=t.next);return 1==e.length?e[0]:{type:"seq",exprs:e}}function Zh(t){for(var e=np(t);;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else{if(!t.eat("{"))break;e=tp(t,e)}return e}function Qh(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");var e=Number(t.next);return t.pos++,e}function tp(t,e){var n=Qh(t),r=n;return t.eat(",")&&(r="}"!=t.next?Qh(t):-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:e}}function ep(t,e){var n=t.nodeTypes,r=n[e];if(r)return[r];var o=[];for(var i in n){var s=n[i];s.groups.indexOf(e)>-1&&o.push(s)}return 0==o.length&&t.err("No node type or group '"+e+"' found"),o}function np(t){if(t.eat("(")){var e=Xh(t);return t.eat(")")||t.err("Missing closing paren"),e}if(!/\W/.test(t.next)){var n=ep(t,t.next).map((function(e){return null==t.inline?t.inline=e.isInline:t.inline!=e.isInline&&t.err("Mixing inline and block content"),{type:"name",value:e}}));return t.pos++,1==n.length?n[0]:{type:"choice",exprs:n}}t.err("Unexpected token '"+t.next+"'")}function rp(t){var e=[[]];return o(i(t,0),n()),e;function n(){return e.push([])-1}function r(t,n,r){var o={term:r,to:n};return e[t].push(o),o}function o(t,e){t.forEach((function(t){return t.to=e}))}function i(t,e){if("choice"==t.type)return t.exprs.reduce((function(t,n){return t.concat(i(n,e))}),[]);if("seq"==t.type)for(var s=0;;s++){var a=i(t.exprs[s],e);if(s==t.exprs.length-1)return a;o(a,e=n())}else{if("star"==t.type){var c=n();return r(e,c),o(i(t.expr,c),c),[r(c)]}if("plus"==t.type){var h=n();return o(i(t.expr,e),h),o(i(t.expr,h),h),[r(h)]}if("opt"==t.type)return[r(e)].concat(i(t.expr,e));if("range"==t.type){for(var p=e,l=0;l<t.min;l++){var u=n();o(i(t.expr,p),u),p=u}if(-1==t.max)o(i(t.expr,p),p);else for(var f=t.min;f<t.max;f++){var d=n();r(p,d),o(i(t.expr,p),d),p=d}return[r(p)]}if("name"==t.type)return[r(e,null,t.value)]}}}function op(t,e){return e-t}function ip(t,e){var n=[];return r(e),n.sort(op);function r(e){var o=t[e];if(1==o.length&&!o[0].term)return r(o[0].to);n.push(e);for(var i=0;i<o.length;i++){var s=o[i],a=s.term,c=s.to;a||-1!=n.indexOf(c)||r(c)}}}function sp(t){var e=Object.create(null);return n(ip(t,0));function n(r){var o=[];r.forEach((function(e){t[e].forEach((function(e){var n=e.term,r=e.to;if(n){var i=o.indexOf(n),s=i>-1&&o[i+1];ip(t,r).forEach((function(t){s||o.push(n,s=[]),-1==s.indexOf(t)&&s.push(t)}))}}))}));for(var i=e[r.join(",")]=new Hh(r.indexOf(t.length-1)>-1),s=0;s<o.length;s+=2){var a=o[s+1].sort(op);i.next.push(o[s],e[a.join(",")]||n(a))}return i}}function ap(t,e){for(var n=0,r=[t];n<r.length;n++){for(var o=r[n],i=!o.validEnd,s=[],a=0;a<o.next.length;a+=2){var c=o.next[a],h=o.next[a+1];s.push(c.name),!i||c.isText||c.hasRequiredAttrs()||(i=!1),-1==r.indexOf(h)&&r.push(h)}i&&e.err("Only non-generatable nodes ("+s.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function cp(t){var e=Object.create(null);for(var n in t){var r=t[n];if(!r.hasDefault)return null;e[n]=r.default}return e}function hp(t,e){var n=Object.create(null);for(var r in t){var o=e&&e[r];if(void 0===o){var i=t[r];if(!i.hasDefault)throw new RangeError("No value supplied for attribute "+r);o=i.default}n[r]=o}return n}function pp(t){var e=Object.create(null);if(t)for(var n in t)e[n]=new fp(t[n]);return e}Gh.next.get=function(){return this.tokens[this.pos]},Uh.prototype.eat=function(t){return this.next==t&&(this.pos++||!0)},Uh.prototype.err=function(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")},Object.defineProperties(Uh.prototype,Gh);var lp=function(t,e,n){this.name=t,this.schema=e,this.spec=n,this.groups=n.group?n.group.split(" "):[],this.attrs=pp(n.attrs),this.defaultAttrs=cp(this.attrs),this.contentMatch=null,this.markSet=null,this.inlineContent=null,this.isBlock=!(n.inline||"text"==t),this.isText="text"==t},up={isInline:{configurable:!0},isTextblock:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};up.isInline.get=function(){return!this.isBlock},up.isTextblock.get=function(){return this.isBlock&&this.inlineContent},up.isLeaf.get=function(){return this.contentMatch==Hh.empty},up.isAtom.get=function(){return this.isLeaf||this.spec.atom},lp.prototype.hasRequiredAttrs=function(){for(var t in this.attrs)if(this.attrs[t].isRequired)return!0;return!1},lp.prototype.compatibleContent=function(t){return this==t||this.contentMatch.compatible(t.contentMatch)},lp.prototype.computeAttrs=function(t){return!t&&this.defaultAttrs?this.defaultAttrs:hp(this.attrs,t)},lp.prototype.create=function(t,e,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Lh(this,this.computeAttrs(t),fh.from(e),yh.setFrom(n))},lp.prototype.createChecked=function(t,e,n){if(e=fh.from(e),!this.validContent(e))throw new RangeError("Invalid content for node "+this.name);return new Lh(this,this.computeAttrs(t),e,yh.setFrom(n))},lp.prototype.createAndFill=function(t,e,n){if(t=this.computeAttrs(t),e=fh.from(e),e.size){var r=this.contentMatch.fillBefore(e);if(!r)return null;e=r.append(e)}var o=this.contentMatch.matchFragment(e).fillBefore(fh.empty,!0);return o?new Lh(this,t,e.append(o),yh.setFrom(n)):null},lp.prototype.validContent=function(t){var e=this.contentMatch.matchFragment(t);if(!e||!e.validEnd)return!1;for(var n=0;n<t.childCount;n++)if(!this.allowsMarks(t.child(n).marks))return!1;return!0},lp.prototype.allowsMarkType=function(t){return null==this.markSet||this.markSet.indexOf(t)>-1},lp.prototype.allowsMarks=function(t){if(null==this.markSet)return!0;for(var e=0;e<t.length;e++)if(!this.allowsMarkType(t[e].type))return!1;return!0},lp.prototype.allowedMarks=function(t){if(null==this.markSet)return t;for(var e,n=0;n<t.length;n++)this.allowsMarkType(t[n].type)?e&&e.push(t[n]):e||(e=t.slice(0,n));return e?e.length?e:yh.empty:t},lp.compile=function(t,e){var n=Object.create(null);t.forEach((function(t,r){return n[t]=new lp(t,e,r)}));var r=e.spec.topNode||"doc";if(!n[r])throw new RangeError("Schema is missing its top node type ('"+r+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(var o in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n},Object.defineProperties(lp.prototype,up);var fp=function(t){this.hasDefault=Object.prototype.hasOwnProperty.call(t,"default"),this.default=t.default},dp={isRequired:{configurable:!0}};dp.isRequired.get=function(){return!this.hasDefault},Object.defineProperties(fp.prototype,dp);var mp=function(t,e,n,r){this.name=t,this.schema=n,this.spec=r,this.attrs=pp(r.attrs),this.rank=e,this.excluded=null;var o=cp(this.attrs);this.instance=o&&new yh(this,o)};mp.prototype.create=function(t){return!t&&this.instance?this.instance:new yh(this,hp(this.attrs,t))},mp.compile=function(t,e){var n=Object.create(null),r=0;return t.forEach((function(t,o){return n[t]=new mp(t,r++,e,o)})),n},mp.prototype.removeFromSet=function(t){for(var e=0;e<t.length;e++)t[e].type==this&&(t=t.slice(0,e).concat(t.slice(e+1)),e--);return t},mp.prototype.isInSet=function(t){for(var e=0;e<t.length;e++)if(t[e].type==this)return t[e]},mp.prototype.excludes=function(t){return this.excluded.indexOf(t)>-1};var vp=function(t){for(var e in this.spec={},t)this.spec[e]=t[e];this.spec.nodes=c.from(t.nodes),this.spec.marks=c.from(t.marks),this.nodes=lp.compile(this.spec.nodes,this),this.marks=mp.compile(this.spec.marks,this);var n=Object.create(null);for(var r in this.nodes){if(r in this.marks)throw new RangeError(r+" can not be both a node and a mark");var o=this.nodes[r],i=o.spec.content||"",s=o.spec.marks;o.contentMatch=n[i]||(n[i]=Hh.parse(i,this.nodes)),o.inlineContent=o.contentMatch.inlineContent,o.markSet="_"==s?null:s?gp(this,s.split(" ")):""!=s&&o.inlineContent?null:[]}for(var a in this.marks){var h=this.marks[a],p=h.spec.excludes;h.excluded=null==p?[h]:""==p?[]:gp(this,p.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached=Object.create(null),this.cached.wrappings=Object.create(null)};function gp(t,e){for(var n=[],r=0;r<e.length;r++){var o=e[r],i=t.marks[o],s=i;if(i)n.push(i);else for(var a in t.marks){var c=t.marks[a];("_"==o||c.spec.group&&c.spec.group.split(" ").indexOf(o)>-1)&&n.push(s=c)}if(!s)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return n}vp.prototype.node=function(t,e,n,r){if("string"==typeof t)t=this.nodeType(t);else{if(!(t instanceof lp))throw new RangeError("Invalid node type: "+t);if(t.schema!=this)throw new RangeError("Node type from different schema used ("+t.name+")")}return t.createChecked(e,n,r)},vp.prototype.text=function(t,e){var n=this.nodes.text;return new qh(n,n.defaultAttrs,t,yh.setFrom(e))},vp.prototype.mark=function(t,e){return"string"==typeof t&&(t=this.marks[t]),t.create(e)},vp.prototype.nodeFromJSON=function(t){return Lh.fromJSON(this,t)},vp.prototype.markFromJSON=function(t){return yh.fromJSON(this,t)},vp.prototype.nodeType=function(t){var e=this.nodes[t];if(!e)throw new RangeError("Unknown node type: "+t);return e};var yp=function(t,e){var n=this;this.schema=t,this.rules=e,this.tags=[],this.styles=[],e.forEach((function(t){t.tag?n.tags.push(t):t.style&&n.styles.push(t)})),this.normalizeLists=!this.tags.some((function(e){if(!/^(ul|ol)\b/.test(e.tag)||!e.node)return!1;var n=t.nodes[e.node];return n.contentMatch.matchType(n)}))};yp.prototype.parse=function(t,e){void 0===e&&(e={});var n=new Np(this,e,!1);return n.addAll(t,null,e.from,e.to),n.finish()},yp.prototype.parseSlice=function(t,e){void 0===e&&(e={});var n=new Np(this,e,!0);return n.addAll(t,null,e.from,e.to),xh.maxOpen(n.finish())},yp.prototype.matchTag=function(t,e,n){for(var r=n?this.tags.indexOf(n)+1:0;r<this.tags.length;r++){var o=this.tags[r];if(Ap(t,o.tag)&&(void 0===o.namespace||t.namespaceURI==o.namespace)&&(!o.context||e.matchesContext(o.context))){if(o.getAttrs){var i=o.getAttrs(t);if(!1===i)continue;o.attrs=i}return o}}},yp.prototype.matchStyle=function(t,e,n,r){for(var o=r?this.styles.indexOf(r)+1:0;o<this.styles.length;o++){var i=this.styles[o];if(!(0!=i.style.indexOf(t)||i.context&&!n.matchesContext(i.context)||i.style.length>t.length&&(61!=i.style.charCodeAt(t.length)||i.style.slice(t.length+1)!=e))){if(i.getAttrs){var s=i.getAttrs(e);if(!1===s)continue;i.attrs=s}return i}}},yp.schemaRules=function(t){var e=[];function n(t){for(var n=null==t.priority?50:t.priority,r=0;r<e.length;r++){var o=e[r],i=null==o.priority?50:o.priority;if(i<n)break}e.splice(r,0,t)}var r=function(e){var r=t.marks[e].spec.parseDOM;r&&r.forEach((function(t){n(t=Rp(t)),t.mark=e}))};for(var o in t.marks)r(o);var i=function(e){var r=t.nodes[s].spec.parseDOM;r&&r.forEach((function(t){n(t=Rp(t)),t.node=s}))};for(var s in t.nodes)i();return e},yp.fromSchema=function(t){return t.cached.domParser||(t.cached.domParser=new yp(t,yp.schemaRules(t)))};var wp={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},xp={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},bp={ol:!0,ul:!0},kp=1,Sp=2,Op=4;function Cp(t){return(t?kp:0)|("full"===t?Sp:0)}var Mp=function(t,e,n,r,o,i,s){this.type=t,this.attrs=e,this.solid=o,this.match=i||(s&Op?null:t.contentMatch),this.options=s,this.content=[],this.marks=n,this.activeMarks=yh.none,this.pendingMarks=r,this.stashMarks=[]};Mp.prototype.findWrapping=function(t){if(!this.match){if(!this.type)return[];var e=this.type.contentMatch.fillBefore(fh.from(t));if(!e){var n,r=this.type.contentMatch;return(n=r.findWrapping(t.type))?(this.match=r,n):null}this.match=this.type.contentMatch.matchFragment(e)}return this.match.findWrapping(t.type)},Mp.prototype.finish=function(t){if(!(this.options&kp)){var e,n=this.content[this.content.length-1];n&&n.isText&&(e=/[ \t\r\n\u000c]+$/.exec(n.text))&&(n.text.length==e[0].length?this.content.pop():this.content[this.content.length-1]=n.withText(n.text.slice(0,n.text.length-e[0].length)))}var r=fh.from(this.content);return!t&&this.match&&(r=r.append(this.match.fillBefore(fh.empty,!0))),this.type?this.type.create(this.attrs,r,this.marks):r},Mp.prototype.popFromStashMark=function(t){for(var e=this.stashMarks.length-1;e>=0;e--)if(t.eq(this.stashMarks[e]))return this.stashMarks.splice(e,1)[0]},Mp.prototype.applyPending=function(t){for(var e=0,n=this.pendingMarks;e<n.length;e++){var r=n[e];(this.type?this.type.allowsMarkType(r.type):zp(r.type,t))&&!r.isInSet(this.activeMarks)&&(this.activeMarks=r.addToSet(this.activeMarks),this.pendingMarks=r.removeFromSet(this.pendingMarks))}};var Np=function(t,e,n){this.parser=t,this.options=e,this.isOpen=n;var r,o=e.topNode,i=Cp(e.preserveWhitespace)|(n?Op:0);r=o?new Mp(o.type,o.attrs,yh.none,yh.none,!0,e.topMatch||o.type.contentMatch,i):new Mp(n?null:t.schema.topNodeType,null,yh.none,yh.none,!0,null,i),this.nodes=[r],this.open=0,this.find=e.findPositions,this.needsBlock=!1},Tp={top:{configurable:!0},currentPos:{configurable:!0}};function Ep(t){for(var e=t.firstChild,n=null;e;e=e.nextSibling){var r=1==e.nodeType?e.nodeName.toLowerCase():null;r&&bp.hasOwnProperty(r)&&n?(n.appendChild(e),e=n):"li"==r?n=e:r&&(n=null)}}function Ap(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function Dp(t){var e,n=/\s*([\w-]+)\s*:\s*([^;]+)/g,r=[];while(e=n.exec(t))r.push(e[1],e[2].trim());return r}function Rp(t){var e={};for(var n in t)e[n]=t[n];return e}function zp(t,e){var n=e.schema.nodes,r=function(r){var o=n[r];if(o.allowsMarkType(t)){var i=[],s=function(t){i.push(t);for(var n=0;n<t.edgeCount;n++){var r=t.edge(n),o=r.type,a=r.next;if(o==e)return!0;if(i.indexOf(a)<0&&s(a))return!0}};return s(o.contentMatch)?{v:!0}:void 0}};for(var o in n){var i=r(o);if(i)return i.v}}function Ip(t,e){for(var n=0;n<e.length;n++)if(t.eq(e[n]))return e[n]}Tp.top.get=function(){return this.nodes[this.open]},Np.prototype.addDOM=function(t){if(3==t.nodeType)this.addTextNode(t);else if(1==t.nodeType){var e=t.getAttribute("style"),n=e?this.readStyles(Dp(e)):null,r=this.top;if(null!=n)for(var o=0;o<n.length;o++)this.addPendingMark(n[o]);if(this.addElement(t),null!=n)for(var i=0;i<n.length;i++)this.removePendingMark(n[i],r)}},Np.prototype.addTextNode=function(t){var e=t.nodeValue,n=this.top;if(n.options&Sp||(n.type?n.type.inlineContent:n.content.length&&n.content[0].isInline)||/[^ \t\r\n\u000c]/.test(e)){if(n.options&kp)e=n.options&Sp?e.replace(/\r\n?/g,"\n"):e.replace(/\r?\n|\r/g," ");else if(e=e.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(e)&&this.open==this.nodes.length-1){var r=n.content[n.content.length-1],o=t.previousSibling;(!r||o&&"BR"==o.nodeName||r.isText&&/[ \t\r\n\u000c]$/.test(r.text))&&(e=e.slice(1))}e&&this.insertNode(this.parser.schema.text(e)),this.findInText(t)}else this.findInside(t)},Np.prototype.addElement=function(t,e){var n,r=t.nodeName.toLowerCase();bp.hasOwnProperty(r)&&this.parser.normalizeLists&&Ep(t);var o=this.options.ruleFromNode&&this.options.ruleFromNode(t)||(n=this.parser.matchTag(t,this,e));if(o?o.ignore:xp.hasOwnProperty(r))this.findInside(t),this.ignoreFallback(t);else if(!o||o.skip||o.closeParent){o&&o.closeParent?this.open=Math.max(0,this.open-1):o&&o.skip.nodeType&&(t=o.skip);var i,s=this.top,a=this.needsBlock;if(wp.hasOwnProperty(r))i=!0,s.type||(this.needsBlock=!0);else if(!t.firstChild)return void this.leafFallback(t);this.addAll(t),i&&this.sync(s),this.needsBlock=a}else this.addElementByRule(t,o,!1===o.consuming?n:null)},Np.prototype.leafFallback=function(t){"BR"==t.nodeName&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(t.ownerDocument.createTextNode("\n"))},Np.prototype.ignoreFallback=function(t){"BR"!=t.nodeName||this.top.type&&this.top.type.inlineContent||this.findPlace(this.parser.schema.text("-"))},Np.prototype.readStyles=function(t){var e=yh.none;t:for(var n=0;n<t.length;n+=2)for(var r=null;;){var o=this.parser.matchStyle(t[n],t[n+1],this,r);if(!o)continue t;if(o.ignore)return null;if(e=this.parser.schema.marks[o.mark].create(o.attrs).addToSet(e),!1!==o.consuming)break;r=o}return e},Np.prototype.addElementByRule=function(t,e,n){var r,o,i,s,a=this;e.node?(o=this.parser.schema.nodes[e.node],o.isLeaf?this.insertNode(o.create(e.attrs))||this.leafFallback(t):r=this.enter(o,e.attrs,e.preserveWhitespace)):(i=this.parser.schema.marks[e.mark],s=i.create(e.attrs),this.addPendingMark(s));var c=this.top;if(o&&o.isLeaf)this.findInside(t);else if(n)this.addElement(t,n);else if(e.getContent)this.findInside(t),e.getContent(t,this.parser.schema).forEach((function(t){return a.insertNode(t)}));else{var h=e.contentElement;"string"==typeof h?h=t.querySelector(h):"function"==typeof h&&(h=h(t)),h||(h=t),this.findAround(t,h,!0),this.addAll(h,r)}r&&(this.sync(c),this.open--),s&&this.removePendingMark(s,c)},Np.prototype.addAll=function(t,e,n,r){for(var o=n||0,i=n?t.childNodes[n]:t.firstChild,s=null==r?null:t.childNodes[r];i!=s;i=i.nextSibling,++o)this.findAtPoint(t,o),this.addDOM(i),e&&wp.hasOwnProperty(i.nodeName.toLowerCase())&&this.sync(e);this.findAtPoint(t,o)},Np.prototype.findPlace=function(t){for(var e,n,r=this.open;r>=0;r--){var o=this.nodes[r],i=o.findWrapping(t);if(i&&(!e||e.length>i.length)&&(e=i,n=o,!i.length))break;if(o.solid)break}if(!e)return!1;this.sync(n);for(var s=0;s<e.length;s++)this.enterInner(e[s],null,!1);return!0},Np.prototype.insertNode=function(t){if(t.isInline&&this.needsBlock&&!this.top.type){var e=this.textblockFromContext();e&&this.enterInner(e)}if(this.findPlace(t)){this.closeExtra();var n=this.top;n.applyPending(t.type),n.match&&(n.match=n.match.matchType(t.type));for(var r=n.activeMarks,o=0;o<t.marks.length;o++)n.type&&!n.type.allowsMarkType(t.marks[o].type)||(r=t.marks[o].addToSet(r));return n.content.push(t.mark(r)),!0}return!1},Np.prototype.enter=function(t,e,n){var r=this.findPlace(t.create(e));return r&&this.enterInner(t,e,!0,n),r},Np.prototype.enterInner=function(t,e,n,r){this.closeExtra();var o=this.top;o.applyPending(t),o.match=o.match&&o.match.matchType(t,e);var i=null==r?o.options&~Op:Cp(r);o.options&Op&&0==o.content.length&&(i|=Op),this.nodes.push(new Mp(t,e,o.activeMarks,o.pendingMarks,n,null,i)),this.open++},Np.prototype.closeExtra=function(t){var e=this.nodes.length-1;if(e>this.open){for(;e>this.open;e--)this.nodes[e-1].content.push(this.nodes[e].finish(t));this.nodes.length=this.open+1}},Np.prototype.finish=function(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)},Np.prototype.sync=function(t){for(var e=this.open;e>=0;e--)if(this.nodes[e]==t)return void(this.open=e)},Tp.currentPos.get=function(){this.closeExtra();for(var t=0,e=this.open;e>=0;e--){for(var n=this.nodes[e].content,r=n.length-1;r>=0;r--)t+=n[r].nodeSize;e&&t++}return t},Np.prototype.findAtPoint=function(t,e){if(this.find)for(var n=0;n<this.find.length;n++)this.find[n].node==t&&this.find[n].offset==e&&(this.find[n].pos=this.currentPos)},Np.prototype.findInside=function(t){if(this.find)for(var e=0;e<this.find.length;e++)null==this.find[e].pos&&1==t.nodeType&&t.contains(this.find[e].node)&&(this.find[e].pos=this.currentPos)},Np.prototype.findAround=function(t,e,n){if(t!=e&&this.find)for(var r=0;r<this.find.length;r++)if(null==this.find[r].pos&&1==t.nodeType&&t.contains(this.find[r].node)){var o=e.compareDocumentPosition(this.find[r].node);o&(n?2:4)&&(this.find[r].pos=this.currentPos)}},Np.prototype.findInText=function(t){if(this.find)for(var e=0;e<this.find.length;e++)this.find[e].node==t&&(this.find[e].pos=this.currentPos-(t.nodeValue.length-this.find[e].offset))},Np.prototype.matchesContext=function(t){var e=this;if(t.indexOf("|")>-1)return t.split(/\s*\|\s*/).some(this.matchesContext,this);var n=t.split("/"),r=this.options.context,o=!this.isOpen&&(!r||r.parent.type==this.nodes[0].type),i=-(r?r.depth+1:0)+(o?0:1),s=function(t,a){for(;t>=0;t--){var c=n[t];if(""==c){if(t==n.length-1||0==t)continue;for(;a>=i;a--)if(s(t-1,a))return!0;return!1}var h=a>0||0==a&&o?e.nodes[a].type:r&&a>=i?r.node(a-i).type:null;if(!h||h.name!=c&&-1==h.groups.indexOf(c))return!1;a--}return!0};return s(n.length-1,this.open)},Np.prototype.textblockFromContext=function(){var t=this.options.context;if(t)for(var e=t.depth;e>=0;e--){var n=t.node(e).contentMatchAt(t.indexAfter(e)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(var r in this.parser.schema.nodes){var o=this.parser.schema.nodes[r];if(o.isTextblock&&o.defaultAttrs)return o}},Np.prototype.addPendingMark=function(t){var e=Ip(t,this.top.pendingMarks);e&&this.top.stashMarks.push(e),this.top.pendingMarks=t.addToSet(this.top.pendingMarks)},Np.prototype.removePendingMark=function(t,e){for(var n=this.open;n>=0;n--){var r=this.nodes[n],o=r.pendingMarks.lastIndexOf(t);if(o>-1)r.pendingMarks=t.removeFromSet(r.pendingMarks);else{r.activeMarks=t.removeFromSet(r.activeMarks);var i=r.popFromStashMark(t);i&&r.type&&r.type.allowsMarkType(i.type)&&(r.activeMarks=i.addToSet(r.activeMarks))}if(r==e)break}},Object.defineProperties(Np.prototype,Tp);var Pp=function(t,e){this.nodes=t||{},this.marks=e||{}};function Fp(t){var e={};for(var n in t){var r=t[n].spec.toDOM;r&&(e[n]=r)}return e}function Bp(t){return t.document||window.document}Pp.prototype.serializeFragment=function(t,e,n){var r=this;void 0===e&&(e={}),n||(n=Bp(e).createDocumentFragment());var o=n,i=null;return t.forEach((function(t){if(i||t.marks.length){i||(i=[]);var n=0,s=0;while(n<i.length&&s<t.marks.length){var a=t.marks[s];if(r.marks[a.type.name]){if(!a.eq(i[n])||!1===a.type.spec.spanning)break;n+=2,s++}else s++}while(n<i.length)o=i.pop(),i.pop();while(s<t.marks.length){var c=t.marks[s++],h=r.serializeMark(c,t.isInline,e);h&&(i.push(c,o),o.appendChild(h.dom),o=h.contentDOM||h.dom)}}o.appendChild(r.serializeNode(t,e))})),n},Pp.prototype.serializeNode=function(t,e){void 0===e&&(e={});var n=Pp.renderSpec(Bp(e),this.nodes[t.type.name](t)),r=n.dom,o=n.contentDOM;if(o){if(t.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");e.onContent?e.onContent(t,o,e):this.serializeFragment(t.content,e,o)}return r},Pp.prototype.serializeNodeAndMarks=function(t,e){void 0===e&&(e={});for(var n=this.serializeNode(t,e),r=t.marks.length-1;r>=0;r--){var o=this.serializeMark(t.marks[r],t.isInline,e);o&&((o.contentDOM||o.dom).appendChild(n),n=o.dom)}return n},Pp.prototype.serializeMark=function(t,e,n){void 0===n&&(n={});var r=this.marks[t.type.name];return r&&Pp.renderSpec(Bp(n),r(t,e))},Pp.renderSpec=function(t,e,n){if(void 0===n&&(n=null),"string"==typeof e)return{dom:t.createTextNode(e)};if(null!=e.nodeType)return{dom:e};if(e.dom&&null!=e.dom.nodeType)return e;var r=e[0],o=r.indexOf(" ");o>0&&(n=r.slice(0,o),r=r.slice(o+1));var i=null,s=n?t.createElementNS(n,r):t.createElement(r),a=e[1],c=1;if(a&&"object"==typeof a&&null==a.nodeType&&!Array.isArray(a))for(var h in c=2,a)if(null!=a[h]){var p=h.indexOf(" ");p>0?s.setAttributeNS(h.slice(0,p),h.slice(p+1),a[h]):s.setAttribute(h,a[h])}for(var l=c;l<e.length;l++){var u=e[l];if(0===u){if(l<e.length-1||l>c)throw new RangeError("Content hole must be the only child of its parent node");return{dom:s,contentDOM:s}}var f=Pp.renderSpec(t,u,n),d=f.dom,m=f.contentDOM;if(s.appendChild(d),m){if(i)throw new RangeError("Multiple content holes");i=m}}return{dom:s,contentDOM:i}},Pp.fromSchema=function(t){return t.cached.domSerializer||(t.cached.domSerializer=new Pp(this.nodesFromSchema(t),this.marksFromSchema(t)))},Pp.nodesFromSchema=function(t){var e=Fp(t.nodes);return e.text||(e.text=function(t){return t.text}),e},Pp.marksFromSchema=function(t){return Fp(t.marks)};var $p=Object.create(null),_p=function(t,e,n){this.ranges=n||[new Jp(t.min(e),t.max(e))],this.$anchor=t,this.$head=e},jp={anchor:{configurable:!0},head:{configurable:!0},from:{configurable:!0},to:{configurable:!0},$from:{configurable:!0},$to:{configurable:!0},empty:{configurable:!0}};jp.anchor.get=function(){return this.$anchor.pos},jp.head.get=function(){return this.$head.pos},jp.from.get=function(){return this.$from.pos},jp.to.get=function(){return this.$to.pos},jp.$from.get=function(){return this.ranges[0].$from},jp.$to.get=function(){return this.ranges[0].$to},jp.empty.get=function(){for(var t=this.ranges,e=0;e<t.length;e++)if(t[e].$from.pos!=t[e].$to.pos)return!1;return!0},_p.prototype.content=function(){return this.$from.node(0).slice(this.from,this.to,!0)},_p.prototype.replace=function(t,e){void 0===e&&(e=qt.empty);for(var n=e.content.lastChild,r=null,o=0;o<e.openEnd;o++)r=n,n=n.lastChild;for(var i=t.steps.length,s=this.ranges,a=0;a<s.length;a++){var c=s[a],h=c.$from,p=c.$to,l=t.mapping.slice(i);t.replaceRange(l.map(h.pos),l.map(p.pos),a?qt.empty:e),0==a&&Gp(t,i,(n?n.isInline:r&&r.isTextblock)?-1:1)}},_p.prototype.replaceWith=function(t,e){for(var n=t.steps.length,r=this.ranges,o=0;o<r.length;o++){var i=r[o],s=i.$from,a=i.$to,c=t.mapping.slice(n),h=c.map(s.pos),p=c.map(a.pos);o?t.deleteRange(h,p):(t.replaceRangeWith(h,p,e),Gp(t,n,e.isInline?-1:1))}},_p.findFrom=function(t,e,n){var r=t.parent.inlineContent?new Lp(t):Up(t.node(0),t.parent,t.pos,t.index(),e,n);if(r)return r;for(var o=t.depth-1;o>=0;o--){var i=e<0?Up(t.node(0),t.node(o),t.before(o+1),t.index(o),e,n):Up(t.node(0),t.node(o),t.after(o+1),t.index(o)+1,e,n);if(i)return i}},_p.near=function(t,e){return void 0===e&&(e=1),this.findFrom(t,e)||this.findFrom(t,-e)||new Hp(t.node(0))},_p.atStart=function(t){return Up(t,t,0,0,1)||new Hp(t)},_p.atEnd=function(t){return Up(t,t,t.content.size,t.childCount,-1)||new Hp(t)},_p.fromJSON=function(t,e){if(!e||!e.type)throw new RangeError("Invalid input for Selection.fromJSON");var n=$p[e.type];if(!n)throw new RangeError("No selection type "+e.type+" defined");return n.fromJSON(t,e)},_p.jsonID=function(t,e){if(t in $p)throw new RangeError("Duplicate use of selection JSON ID "+t);return $p[t]=e,e.prototype.jsonID=t,e},_p.prototype.getBookmark=function(){return Lp.between(this.$anchor,this.$head).getBookmark()},Object.defineProperties(_p.prototype,jp),_p.prototype.visible=!0;var Jp=function(t,e){this.$from=t,this.$to=e},Lp=function(t){function e(e,n){void 0===n&&(n=e),t.call(this,e,n)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={$cursor:{configurable:!0}};return n.$cursor.get=function(){return this.$anchor.pos==this.$head.pos?this.$head:null},e.prototype.map=function(n,r){var o=n.resolve(r.map(this.head));if(!o.parent.inlineContent)return t.near(o);var i=n.resolve(r.map(this.anchor));return new e(i.parent.inlineContent?i:o,o)},e.prototype.replace=function(e,n){if(void 0===n&&(n=qt.empty),t.prototype.replace.call(this,e,n),n==qt.empty){var r=this.$from.marksAcross(this.$to);r&&e.ensureMarks(r)}},e.prototype.eq=function(t){return t instanceof e&&t.anchor==this.anchor&&t.head==this.head},e.prototype.getBookmark=function(){return new Vp(this.anchor,this.head)},e.prototype.toJSON=function(){return{type:"text",anchor:this.anchor,head:this.head}},e.fromJSON=function(t,n){if("number"!=typeof n.anchor||"number"!=typeof n.head)throw new RangeError("Invalid input for TextSelection.fromJSON");return new e(t.resolve(n.anchor),t.resolve(n.head))},e.create=function(t,e,n){void 0===n&&(n=e);var r=t.resolve(e);return new this(r,n==e?r:t.resolve(n))},e.between=function(n,r,o){var i=n.pos-r.pos;if(o&&!i||(o=i>=0?1:-1),!r.parent.inlineContent){var s=t.findFrom(r,o,!0)||t.findFrom(r,-o,!0);if(!s)return t.near(r,o);r=s.$head}return n.parent.inlineContent||(0==i?n=r:(n=(t.findFrom(n,-o,!0)||t.findFrom(n,o,!0)).$anchor,n.pos<r.pos!=i<0&&(n=r))),new e(n,r)},Object.defineProperties(e.prototype,n),e}(_p);_p.jsonID("text",Lp);var Vp=function(t,e){this.anchor=t,this.head=e};Vp.prototype.map=function(t){return new Vp(t.map(this.anchor),t.map(this.head))},Vp.prototype.resolve=function(t){return Lp.between(t.resolve(this.anchor),t.resolve(this.head))};var qp=function(t){function e(e){var n=e.nodeAfter,r=e.node(0).resolve(e.pos+n.nodeSize);t.call(this,e,r),this.node=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.map=function(n,r){var o=r.mapResult(this.anchor),i=o.deleted,s=o.pos,a=n.resolve(s);return i?t.near(a):new e(a)},e.prototype.content=function(){return new qt(Bt.from(this.node),0,0)},e.prototype.eq=function(t){return t instanceof e&&t.anchor==this.anchor},e.prototype.toJSON=function(){return{type:"node",anchor:this.anchor}},e.prototype.getBookmark=function(){return new Wp(this.anchor)},e.fromJSON=function(t,n){if("number"!=typeof n.anchor)throw new RangeError("Invalid input for NodeSelection.fromJSON");return new e(t.resolve(n.anchor))},e.create=function(t,e){return new this(t.resolve(e))},e.isSelectable=function(t){return!t.isText&&!1!==t.type.spec.selectable},e}(_p);qp.prototype.visible=!1,_p.jsonID("node",qp);var Wp=function(t){this.anchor=t};Wp.prototype.map=function(t){var e=t.mapResult(this.anchor),n=e.deleted,r=e.pos;return n?new Vp(r,r):new Wp(r)},Wp.prototype.resolve=function(t){var e=t.resolve(this.anchor),n=e.nodeAfter;return n&&qp.isSelectable(n)?new qp(e):_p.near(e)};var Hp=function(t){function e(e){t.call(this,e.resolve(0),e.resolve(e.content.size))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.replace=function(e,n){if(void 0===n&&(n=qt.empty),n==qt.empty){e.delete(0,e.doc.content.size);var r=t.atStart(e.doc);r.eq(e.selection)||e.setSelection(r)}else t.prototype.replace.call(this,e,n)},e.prototype.toJSON=function(){return{type:"all"}},e.fromJSON=function(t){return new e(t)},e.prototype.map=function(t){return new e(t)},e.prototype.eq=function(t){return t instanceof e},e.prototype.getBookmark=function(){return Kp},e}(_p);_p.jsonID("all",Hp);var Kp={map:function(){return this},resolve:function(t){return new Hp(t)}};function Up(t,e,n,r,o,i){if(e.inlineContent)return Lp.create(t,n);for(var s=r-(o>0?0:1);o>0?s<e.childCount:s>=0;s+=o){var a=e.child(s);if(a.isAtom){if(!i&&qp.isSelectable(a))return qp.create(t,n-(o<0?a.nodeSize:0))}else{var c=Up(t,a,n+o,o<0?a.childCount:0,o,i);if(c)return c}n+=a.nodeSize*o}}function Gp(t,e,n){var r=t.steps.length-1;if(!(r<e)){var o=t.steps[r];if(o instanceof Sn||o instanceof On){var i,s=t.mapping.maps[r];s.forEach((function(t,e,n,r){null==i&&(i=r)})),t.setSelection(_p.near(t.doc.resolve(i),n))}}}var Xp=1,Yp=2,Zp=4,Qp=function(t){function e(e){t.call(this,e.doc),this.time=Date.now(),this.curSelection=e.selection,this.curSelectionFor=0,this.storedMarks=e.storedMarks,this.updated=0,this.meta=Object.create(null)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={selection:{configurable:!0},selectionSet:{configurable:!0},storedMarksSet:{configurable:!0},isGeneric:{configurable:!0},scrolledIntoView:{configurable:!0}};return n.selection.get=function(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection},e.prototype.setSelection=function(t){if(t.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=t,this.curSelectionFor=this.steps.length,this.updated=(this.updated|Xp)&~Yp,this.storedMarks=null,this},n.selectionSet.get=function(){return(this.updated&Xp)>0},e.prototype.setStoredMarks=function(t){return this.storedMarks=t,this.updated|=Yp,this},e.prototype.ensureMarks=function(t){return Lt.sameSet(this.storedMarks||this.selection.$from.marks(),t)||this.setStoredMarks(t),this},e.prototype.addStoredMark=function(t){return this.ensureMarks(t.addToSet(this.storedMarks||this.selection.$head.marks()))},e.prototype.removeStoredMark=function(t){return this.ensureMarks(t.removeFromSet(this.storedMarks||this.selection.$head.marks()))},n.storedMarksSet.get=function(){return(this.updated&Yp)>0},e.prototype.addStep=function(e,n){t.prototype.addStep.call(this,e,n),this.updated=this.updated&~Yp,this.storedMarks=null},e.prototype.setTime=function(t){return this.time=t,this},e.prototype.replaceSelection=function(t){return this.selection.replace(this,t),this},e.prototype.replaceSelectionWith=function(t,e){var n=this.selection;return!1!==e&&(t=t.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||Lt.none))),n.replaceWith(this,t),this},e.prototype.deleteSelection=function(){return this.selection.replace(this),this},e.prototype.insertText=function(t,e,n){void 0===n&&(n=e);var r=this.doc.type.schema;if(null==e)return t?this.replaceSelectionWith(r.text(t),!0):this.deleteSelection();if(!t)return this.deleteRange(e,n);var o=this.storedMarks;if(!o){var i=this.doc.resolve(e);o=n==e?i.marks():i.marksAcross(this.doc.resolve(n))}return this.replaceRangeWith(e,n,r.text(t,o)),this.selection.empty||this.setSelection(_p.near(this.selection.$to)),this},e.prototype.setMeta=function(t,e){return this.meta["string"==typeof t?t:t.key]=e,this},e.prototype.getMeta=function(t){return this.meta["string"==typeof t?t:t.key]},n.isGeneric.get=function(){for(var t in this.meta)return!1;return!0},e.prototype.scrollIntoView=function(){return this.updated|=Zp,this},n.scrolledIntoView.get=function(){return(this.updated&Zp)>0},Object.defineProperties(e.prototype,n),e}(gn);function tl(t,e){return e&&t?t.bind(e):t}var el=function(t,e,n){this.name=t,this.init=tl(e.init,n),this.apply=tl(e.apply,n)},nl=[new el("doc",{init:function(t){return t.doc||t.schema.topNodeType.createAndFill()},apply:function(t){return t.doc}}),new el("selection",{init:function(t,e){return t.selection||_p.atStart(e.doc)},apply:function(t){return t.selection}}),new el("storedMarks",{init:function(t){return t.storedMarks||null},apply:function(t,e,n,r){return r.selection.$cursor?t.storedMarks:null}}),new el("scrollToSelection",{init:function(){return 0},apply:function(t,e){return t.scrolledIntoView?e+1:e}})],rl=function(t,e){var n=this;this.schema=t,this.fields=nl.concat(),this.plugins=[],this.pluginsByKey=Object.create(null),e&&e.forEach((function(t){if(n.pluginsByKey[t.key])throw new RangeError("Adding different instances of a keyed plugin ("+t.key+")");n.plugins.push(t),n.pluginsByKey[t.key]=t,t.spec.state&&n.fields.push(new el(t.key,t.spec.state,t))}))},ol=function(t){this.config=t},il={schema:{configurable:!0},plugins:{configurable:!0},tr:{configurable:!0}};il.schema.get=function(){return this.config.schema},il.plugins.get=function(){return this.config.plugins},ol.prototype.apply=function(t){return this.applyTransaction(t).state},ol.prototype.filterTransaction=function(t,e){void 0===e&&(e=-1);for(var n=0;n<this.config.plugins.length;n++)if(n!=e){var r=this.config.plugins[n];if(r.spec.filterTransaction&&!r.spec.filterTransaction.call(r,t,this))return!1}return!0},ol.prototype.applyTransaction=function(t){if(!this.filterTransaction(t))return{state:this,transactions:[]};for(var e=[t],n=this.applyInner(t),r=null;;){for(var o=!1,i=0;i<this.config.plugins.length;i++){var s=this.config.plugins[i];if(s.spec.appendTransaction){var a=r?r[i].n:0,c=r?r[i].state:this,h=a<e.length&&s.spec.appendTransaction.call(s,a?e.slice(a):e,c,n);if(h&&n.filterTransaction(h,i)){if(h.setMeta("appendedTransaction",t),!r){r=[];for(var p=0;p<this.config.plugins.length;p++)r.push(p<i?{state:n,n:e.length}:{state:this,n:0})}e.push(h),n=n.applyInner(h),o=!0}r&&(r[i]={state:n,n:e.length})}}if(!o)return{state:n,transactions:e}}},ol.prototype.applyInner=function(t){if(!t.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");for(var e=new ol(this.config),n=this.config.fields,r=0;r<n.length;r++){var o=n[r];e[o.name]=o.apply(t,this[o.name],this,e)}for(var i=0;i<sl.length;i++)sl[i](this,t,e);return e},il.tr.get=function(){return new Qp(this)},ol.create=function(t){for(var e=new rl(t.schema||t.doc.type.schema,t.plugins),n=new ol(e),r=0;r<e.fields.length;r++)n[e.fields[r].name]=e.fields[r].init(t,n);return n},ol.prototype.reconfigure=function(t){for(var e=new rl(t.schema||this.schema,t.plugins),n=e.fields,r=new ol(e),o=0;o<n.length;o++){var i=n[o].name;r[i]=this.hasOwnProperty(i)?this[i]:n[o].init(t,r)}return r},ol.prototype.toJSON=function(t){var e={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(e.storedMarks=this.storedMarks.map((function(t){return t.toJSON()}))),t&&"object"==typeof t)for(var n in t){if("doc"==n||"selection"==n)throw new RangeError("The JSON fields `doc` and `selection` are reserved");var r=t[n],o=r.spec.state;o&&o.toJSON&&(e[n]=o.toJSON.call(r,this[r.key]))}return e},ol.fromJSON=function(t,e,n){if(!e)throw new RangeError("Invalid input for EditorState.fromJSON");if(!t.schema)throw new RangeError("Required config field 'schema' missing");var r=new rl(t.schema,t.plugins),o=new ol(r);return r.fields.forEach((function(r){if("doc"==r.name)o.doc=ue.fromJSON(t.schema,e.doc);else if("selection"==r.name)o.selection=_p.fromJSON(o.doc,e.selection);else if("storedMarks"==r.name)e.storedMarks&&(o.storedMarks=e.storedMarks.map(t.schema.markFromJSON));else{if(n)for(var i in n){var s=n[i],a=s.spec.state;if(s.key==r.name&&a&&a.fromJSON&&Object.prototype.hasOwnProperty.call(e,i))return void(o[r.name]=a.fromJSON.call(s,t,e[i],o))}o[r.name]=r.init(t,o)}})),o},ol.addApplyListener=function(t){sl.push(t)},ol.removeApplyListener=function(t){var e=sl.indexOf(t);e>-1&&sl.splice(e,1)},Object.defineProperties(ol.prototype,il);var sl=[];function al(t,e,n){for(var r in t){var o=t[r];o instanceof Function?o=o.bind(e):"handleDOMEvents"==r&&(o=al(o,e,{})),n[r]=o}return n}var cl=function(t){this.props={},t.props&&al(t.props,this,this.props),this.spec=t,this.key=t.key?t.key.key:pl("plugin")};cl.prototype.getState=function(t){return t[this.key]};var hl=Object.create(null);function pl(t){return t in hl?t+"$"+ ++hl[t]:(hl[t]=0,t+"$")}var ll=function(t){void 0===t&&(t="key"),this.key=pl(t)};function ul(t){return void 0===t&&(t={}),new cl({view:function(e){return new fl(e,t)}})}ll.prototype.get=function(t){return t.config.pluginsByKey[this.key]},ll.prototype.getState=function(t){return t[this.key]};var fl=function(t,e){var n=this;this.editorView=t,this.width=e.width||1,this.color=e.color||"black",this.class=e.class,this.cursorPos=null,this.element=null,this.timeout=null,this.handlers=["dragover","dragend","drop","dragleave"].map((function(e){var r=function(t){return n[e](t)};return t.dom.addEventListener(e,r),{name:e,handler:r}}))};fl.prototype.destroy=function(){var t=this;this.handlers.forEach((function(e){var n=e.name,r=e.handler;return t.editorView.dom.removeEventListener(n,r)}))},fl.prototype.update=function(t,e){null!=this.cursorPos&&e.doc!=t.state.doc&&(this.cursorPos>t.state.doc.content.size?this.setCursor(null):this.updateOverlay())},fl.prototype.setCursor=function(t){t!=this.cursorPos&&(this.cursorPos=t,null==t?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())},fl.prototype.updateOverlay=function(){var t,e=this.editorView.state.doc.resolve(this.cursorPos);if(!e.parent.inlineContent){var n=e.nodeBefore,r=e.nodeAfter;if(n||r){var o=this.editorView.nodeDOM(this.cursorPos-(n?n.nodeSize:0)).getBoundingClientRect(),i=n?o.bottom:o.top;n&&r&&(i=(i+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),t={left:o.left,right:o.right,top:i-this.width/2,bottom:i+this.width/2}}}if(!t){var s=this.editorView.coordsAtPos(this.cursorPos);t={left:s.left-this.width/2,right:s.left+this.width/2,top:s.top,bottom:s.bottom}}var a,c,h=this.editorView.dom.offsetParent;if(this.element||(this.element=h.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none; background-color: "+this.color),!h||h==document.body&&"static"==getComputedStyle(h).position)a=-pageXOffset,c=-pageYOffset;else{var p=h.getBoundingClientRect();a=p.left-h.scrollLeft,c=p.top-h.scrollTop}this.element.style.left=t.left-a+"px",this.element.style.top=t.top-c+"px",this.element.style.width=t.right-t.left+"px",this.element.style.height=t.bottom-t.top+"px"},fl.prototype.scheduleRemoval=function(t){var e=this;clearTimeout(this.timeout),this.timeout=setTimeout((function(){return e.setCursor(null)}),t)},fl.prototype.dragover=function(t){if(this.editorView.editable){var e=this.editorView.posAtCoords({left:t.clientX,top:t.clientY});if(e){var n=e.pos;if(this.editorView.dragging&&this.editorView.dragging.slice&&(n=zn(this.editorView.state.doc,n,this.editorView.dragging.slice),null==n))return this.setCursor(null);this.setCursor(n),this.scheduleRemoval(5e3)}}},fl.prototype.dragend=function(){this.scheduleRemoval(20)},fl.prototype.drop=function(){this.scheduleRemoval(20)},fl.prototype.dragleave=function(t){t.target!=this.editorView.dom&&this.editorView.dom.contains(t.relatedTarget)||this.setCursor(null)};for(var dl={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",229:"q"},ml={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"',229:"Q"},vl="undefined"!=typeof navigator&&/Chrome\/(\d+)/.exec(navigator.userAgent),gl="undefined"!=typeof navigator&&/Apple Computer/.test(navigator.vendor),yl="undefined"!=typeof navigator&&/Gecko\/\d+/.test(navigator.userAgent),wl="undefined"!=typeof navigator&&/Mac/.test(navigator.platform),xl="undefined"!=typeof navigator&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),bl=vl&&(wl||+vl[1]<57)||yl&&wl,kl=0;kl<10;kl++)dl[48+kl]=dl[96+kl]=String(kl);for(kl=1;kl<=24;kl++)dl[kl+111]="F"+kl;for(kl=65;kl<=90;kl++)dl[kl]=String.fromCharCode(kl+32),ml[kl]=String.fromCharCode(kl);for(var Sl in dl)ml.hasOwnProperty(Sl)||(ml[Sl]=dl[Sl]);function Ol(t){var e=bl&&(t.ctrlKey||t.altKey||t.metaKey)||(gl||xl)&&t.shiftKey&&t.key&&1==t.key.length,n=!e&&t.key||(t.shiftKey?ml:dl)[t.keyCode]||t.key||"Unidentified";return"Esc"==n&&(n="Escape"),"Del"==n&&(n="Delete"),"Left"==n&&(n="ArrowLeft"),"Up"==n&&(n="ArrowUp"),"Right"==n&&(n="ArrowRight"),"Down"==n&&(n="ArrowDown"),n}var Cl="undefined"!=typeof navigator&&/Mac/.test(navigator.platform);function Ml(t){var e,n,r,o,i=t.split(/-(?!$)/),s=i[i.length-1];"Space"==s&&(s=" ");for(var a=0;a<i.length-1;a++){var c=i[a];if(/^(cmd|meta|m)$/i.test(c))o=!0;else if(/^a(lt)?$/i.test(c))e=!0;else if(/^(c|ctrl|control)$/i.test(c))n=!0;else if(/^s(hift)?$/i.test(c))r=!0;else{if(!/^mod$/i.test(c))throw new Error("Unrecognized modifier name: "+c);Cl?o=!0:n=!0}}return e&&(s="Alt-"+s),n&&(s="Ctrl-"+s),o&&(s="Meta-"+s),r&&(s="Shift-"+s),s}function Nl(t){var e=Object.create(null);for(var n in t)e[Ml(n)]=t[n];return e}function Tl(t,e,n){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),!1!==n&&e.shiftKey&&(t="Shift-"+t),t}function El(t){return new cl({props:{handleKeyDown:Al(t)}})}function Al(t){var e=Nl(t);return function(t,n){var r,o=Ol(n),i=1==o.length&&" "!=o,s=e[Tl(o,n,!i)];if(s&&s(t.state,t.dispatch,t))return!0;if(i&&(n.shiftKey||n.altKey||n.metaKey||o.charCodeAt(0)>127)&&(r=dl[n.keyCode])&&r!=o){var a=e[Tl(r,n,!0)];if(a&&a(t.state,t.dispatch,t))return!0}else if(i&&n.shiftKey){var c=e[Tl(o,n,!0)];if(c&&c(t.state,t.dispatch,t))return!0}return!1}}var Dl={};if("undefined"!=typeof navigator&&"undefined"!=typeof document){var Rl=/Edge\/(\d+)/.exec(navigator.userAgent),zl=/MSIE \d/.test(navigator.userAgent),Il=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);Dl.mac=/Mac/.test(navigator.platform);var Pl=Dl.ie=!!(zl||Il||Rl);Dl.ie_version=zl?document.documentMode||6:Il?+Il[1]:Rl?+Rl[1]:null,Dl.gecko=!Pl&&/gecko\/(\d+)/i.test(navigator.userAgent),Dl.gecko_version=Dl.gecko&&+(/Firefox\/(\d+)/.exec(navigator.userAgent)||[0,0])[1];var Fl=!Pl&&/Chrome\/(\d+)/.exec(navigator.userAgent);Dl.chrome=!!Fl,Dl.chrome_version=Fl&&+Fl[1],Dl.ios=!Pl&&/AppleWebKit/.test(navigator.userAgent)&&/Mobile\/\w+/.test(navigator.userAgent),Dl.android=/Android \d/.test(navigator.userAgent),Dl.webkit="webkitFontSmoothing"in document.documentElement.style,Dl.safari=/Apple Computer/.test(navigator.vendor),Dl.webkit_version=Dl.webkit&&+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]}var Bl=function(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e},$l=function(t){var e=t.parentNode;return e&&11==e.nodeType?e.host:e},_l=function(t,e,n){var r=document.createRange();return r.setEnd(t,null==n?t.nodeValue.length:n),r.setStart(t,e||0),r},jl=function(t,e,n,r){return n&&(Ll(t,e,n,r,-1)||Ll(t,e,n,r,1))},Jl=/^(img|br|input|textarea|hr)$/i;function Ll(t,e,n,r,o){for(;;){if(t==n&&e==r)return!0;if(e==(o<0?0:Vl(t))){var i=t.parentNode;if(1!=i.nodeType||Wl(t)||Jl.test(t.nodeName)||"false"==t.contentEditable)return!1;e=Bl(t)+(o<0?0:1),t=i}else{if(1!=t.nodeType)return!1;if(t=t.childNodes[e+(o<0?-1:0)],"false"==t.contentEditable)return!1;e=o<0?Vl(t):0}}}function Vl(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}function ql(t,e,n){for(var r=0==e,o=e==Vl(t);r||o;){if(t==n)return!0;var i=Bl(t);if(t=t.parentNode,!t)return!1;r=r&&0==i,o=o&&i==Vl(t)}}function Wl(t){for(var e,n=t;n;n=n.parentNode)if(e=n.pmViewDesc)break;return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}var Hl=function(t){var e=t.isCollapsed;return e&&Dl.chrome&&t.rangeCount&&!t.getRangeAt(0).collapsed&&(e=!1),e};function Kl(t,e){var n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=t,n.key=n.code=e,n}function Ul(t){return{left:0,right:t.documentElement.clientWidth,top:0,bottom:t.documentElement.clientHeight}}function Gl(t,e){return"number"==typeof t?t:t[e]}function Xl(t){var e=t.getBoundingClientRect();return{left:e.left,right:e.left+t.clientWidth,top:e.top,bottom:e.top+t.clientHeight}}function Yl(t,e,n){for(var r=t.someProp("scrollThreshold")||0,o=t.someProp("scrollMargin")||5,i=t.dom.ownerDocument,s=n||t.dom;;s=$l(s)){if(!s)break;if(1==s.nodeType){var a=s==i.body||1!=s.nodeType,c=a?Ul(i):Xl(s),h=0,p=0;if(e.top<c.top+Gl(r,"top")?p=-(c.top-e.top+Gl(o,"top")):e.bottom>c.bottom-Gl(r,"bottom")&&(p=e.bottom-c.bottom+Gl(o,"bottom")),e.left<c.left+Gl(r,"left")?h=-(c.left-e.left+Gl(o,"left")):e.right>c.right-Gl(r,"right")&&(h=e.right-c.right+Gl(o,"right")),h||p)if(a)i.defaultView.scrollBy(h,p);else{var l=s.scrollLeft,u=s.scrollTop;p&&(s.scrollTop+=p),h&&(s.scrollLeft+=h);var f=s.scrollLeft-l,d=s.scrollTop-u;e={left:e.left-f,top:e.top-d,right:e.right-f,bottom:e.bottom-d}}if(a)break}}}function Zl(t){for(var e,n,r=t.dom.getBoundingClientRect(),o=Math.max(0,r.top),i=(r.left+r.right)/2,s=o+1;s<Math.min(innerHeight,r.bottom);s+=5){var a=t.root.elementFromPoint(i,s);if(a!=t.dom&&t.dom.contains(a)){var c=a.getBoundingClientRect();if(c.top>=o-20){e=a,n=c.top;break}}}return{refDOM:e,refTop:n,stack:Ql(t.dom)}}function Ql(t){for(var e=[],n=t.ownerDocument;t;t=$l(t))if(e.push({dom:t,top:t.scrollTop,left:t.scrollLeft}),t==n)break;return e}function tu(t){var e=t.refDOM,n=t.refTop,r=t.stack,o=e?e.getBoundingClientRect().top:0;eu(r,0==o?0:o-n)}function eu(t,e){for(var n=0;n<t.length;n++){var r=t[n],o=r.dom,i=r.top,s=r.left;o.scrollTop!=i+e&&(o.scrollTop=i+e),o.scrollLeft!=s&&(o.scrollLeft=s)}}var nu=null;function ru(t){if(t.setActive)return t.setActive();if(nu)return t.focus(nu);var e=Ql(t);t.focus(null==nu?{get preventScroll(){return nu={preventScroll:!0},!0}}:void 0),nu||(nu=!1,eu(e,0))}function ou(t,e){for(var n,r,o=2e8,i=0,s=e.top,a=e.top,c=t.firstChild,h=0;c;c=c.nextSibling,h++){var p=void 0;if(1==c.nodeType)p=c.getClientRects();else{if(3!=c.nodeType)continue;p=_l(c).getClientRects()}for(var l=0;l<p.length;l++){var u=p[l];if(u.top<=s&&u.bottom>=a){s=Math.max(u.bottom,s),a=Math.min(u.top,a);var f=u.left>e.left?u.left-e.left:u.right<e.left?e.left-u.right:0;if(f<o){n=c,o=f,r=f&&3==n.nodeType?{left:u.right<e.left?u.right:u.left,top:e.top}:e,1==c.nodeType&&f&&(i=h+(e.left>=(u.left+u.right)/2?1:0));continue}}!n&&(e.left>=u.right&&e.top>=u.top||e.left>=u.left&&e.top>=u.bottom)&&(i=h+1)}}return n&&3==n.nodeType?iu(n,r):!n||o&&1==n.nodeType?{node:t,offset:i}:ou(n,r)}function iu(t,e){for(var n=t.nodeValue.length,r=document.createRange(),o=0;o<n;o++){r.setEnd(t,o+1),r.setStart(t,o);var i=uu(r,1);if(i.top!=i.bottom&&su(e,i))return{node:t,offset:o+(e.left>=(i.left+i.right)/2?1:0)}}return{node:t,offset:0}}function su(t,e){return t.left>=e.left-1&&t.left<=e.right+1&&t.top>=e.top-1&&t.top<=e.bottom+1}function au(t,e){var n=t.parentNode;return n&&/^li$/i.test(n.nodeName)&&e.left<t.getBoundingClientRect().left?n:t}function cu(t,e,n){var r=ou(e,n),o=r.node,i=r.offset,s=-1;if(1==o.nodeType&&!o.firstChild){var a=o.getBoundingClientRect();s=a.left!=a.right&&n.left>(a.left+a.right)/2?1:-1}return t.docView.posFromDOM(o,i,s)}function hu(t,e,n,r){for(var o=-1,i=e;;){if(i==t.dom)break;var s=t.docView.nearestDesc(i,!0);if(!s)return null;if(s.node.isBlock&&s.parent){var a=s.dom.getBoundingClientRect();if(a.left>r.left||a.top>r.top)o=s.posBefore;else{if(!(a.right<r.left||a.bottom<r.top))break;o=s.posAfter}}i=s.dom.parentNode}return o>-1?o:t.docView.posFromDOM(e,n)}function pu(t,e,n){var r=t.childNodes.length;if(r&&n.top<n.bottom)for(var o=Math.max(0,Math.min(r-1,Math.floor(r*(e.top-n.top)/(n.bottom-n.top))-2)),i=o;;){var s=t.childNodes[i];if(1==s.nodeType)for(var a=s.getClientRects(),c=0;c<a.length;c++){var h=a[c];if(su(e,h))return pu(s,e,h)}if((i=(i+1)%r)==o)break}return t}function lu(t,e){var n,r,o,i,s=t.root;if(s.caretPositionFromPoint)try{var a=s.caretPositionFromPoint(e.left,e.top);a&&(n=a,o=n.offsetNode,i=n.offset)}catch(m){}if(!o&&s.caretRangeFromPoint){var c=s.caretRangeFromPoint(e.left,e.top);c&&(r=c,o=r.startContainer,i=r.startOffset)}var h,p=s.elementFromPoint(e.left,e.top+1);if(!p||!t.dom.contains(1!=p.nodeType?p.parentNode:p)){var l=t.dom.getBoundingClientRect();if(!su(e,l))return null;if(p=pu(t.dom,e,l),!p)return null}if(Dl.safari&&p.draggable&&(o=i=null),p=au(p,e),o){if(Dl.gecko&&1==o.nodeType&&(i=Math.min(i,o.childNodes.length),i<o.childNodes.length)){var u,f=o.childNodes[i];"IMG"==f.nodeName&&(u=f.getBoundingClientRect()).right<=e.left&&u.bottom>e.top&&i++}o==t.dom&&i==o.childNodes.length-1&&1==o.lastChild.nodeType&&e.top>o.lastChild.getBoundingClientRect().bottom?h=t.state.doc.content.size:0!=i&&1==o.nodeType&&"BR"==o.childNodes[i-1].nodeName||(h=hu(t,o,i,e))}null==h&&(h=cu(t,p,e));var d=t.docView.nearestDesc(p,!0);return{pos:h,inside:d?d.posAtStart-d.border:-1}}function uu(t,e){var n=t.getClientRects();return n.length?n[e<0?0:n.length-1]:t.getBoundingClientRect()}function fu(t,e){var n=t.docView.domFromPos(e),r=n.node,o=n.offset;if(3==r.nodeType&&(Dl.webkit||Dl.gecko)){var i=uu(_l(r,o,o),0);if(Dl.gecko&&o&&/\s/.test(r.nodeValue[o-1])&&o<r.nodeValue.length){var s=uu(_l(r,o-1,o-1),-1);if(s.top==i.top){var a=uu(_l(r,o,o+1),-1);if(a.top!=i.top)return du(a,a.left<s.left)}}return i}if(1==r.nodeType&&!t.state.doc.resolve(e).parent.inlineContent){var c,h=!0;if(o<r.childNodes.length){var p=r.childNodes[o];1==p.nodeType&&(c=p.getBoundingClientRect())}if(!c&&o){var l=r.childNodes[o-1];1==l.nodeType&&(c=l.getBoundingClientRect(),h=!1)}return mu(c||r.getBoundingClientRect(),h)}for(var u=-1;u<2;u+=2)if(u<0&&o){var f=void 0,d=3==r.nodeType?_l(r,o-1,o):3==(f=r.childNodes[o-1]).nodeType?_l(f):1==f.nodeType&&"BR"!=f.nodeName?f:null;if(d){var m=uu(d,1);if(m.top<m.bottom)return du(m,!1)}}else if(u>0&&o<Vl(r)){var v=void 0,g=3==r.nodeType?_l(r,o,o+1):3==(v=r.childNodes[o]).nodeType?_l(v):1==v.nodeType?v:null;if(g){var y=uu(g,-1);if(y.top<y.bottom)return du(y,!0)}}return du(uu(3==r.nodeType?_l(r):r,0),!1)}function du(t,e){if(0==t.width)return t;var n=e?t.left:t.right;return{top:t.top,bottom:t.bottom,left:n,right:n}}function mu(t,e){if(0==t.height)return t;var n=e?t.top:t.bottom;return{top:n,bottom:n,left:t.left,right:t.right}}function vu(t,e,n){var r=t.state,o=t.root.activeElement;r!=e&&t.updateState(e),o!=t.dom&&t.focus();try{return n()}finally{r!=e&&t.updateState(r),o!=t.dom&&o&&o.focus()}}function gu(t,e,n){var r=e.selection,o="up"==n?r.$anchor.min(r.$head):r.$anchor.max(r.$head);return vu(t,e,(function(){for(var e=t.docView.domFromPos(o.pos),r=e.node;;){var i=t.docView.nearestDesc(r,!0);if(!i)break;if(i.node.isBlock){r=i.dom;break}r=i.dom.parentNode}for(var s=fu(t,o.pos),a=r.firstChild;a;a=a.nextSibling){var c=void 0;if(1==a.nodeType)c=a.getClientRects();else{if(3!=a.nodeType)continue;c=_l(a,0,a.nodeValue.length).getClientRects()}for(var h=0;h<c.length;h++){var p=c[h];if(p.bottom>p.top&&("up"==n?p.bottom<s.top+1:p.top>s.bottom-1))return!1}}return!0}))}var yu=/[\u0590-\u08ac]/;function wu(t,e,n){var r=e.selection,o=r.$head;if(!o.parent.isTextblock)return!1;var i=o.parentOffset,s=!i,a=i==o.parent.content.size,c=getSelection();return yu.test(o.parent.textContent)&&c.modify?vu(t,e,(function(){var e=c.getRangeAt(0),r=c.focusNode,i=c.focusOffset,s=c.caretBidiLevel;c.modify("move",n,"character");var a=o.depth?t.docView.domAfterPos(o.before()):t.dom,h=!a.contains(1==c.focusNode.nodeType?c.focusNode:c.focusNode.parentNode)||r==c.focusNode&&i==c.focusOffset;return c.removeAllRanges(),c.addRange(e),null!=s&&(c.caretBidiLevel=s),h})):"left"==n||"backward"==n?s:a}var xu=null,bu=null,ku=!1;function Su(t,e,n){return xu==e&&bu==n?ku:(xu=e,bu=n,ku="up"==n||"down"==n?gu(t,e,n):wu(t,e,n))}var Ou=0,Cu=1,Mu=2,Nu=3,Tu=function(t,e,n,r){this.parent=t,this.children=e,this.dom=n,n.pmViewDesc=this,this.contentDOM=r,this.dirty=Ou},Eu={beforePosition:{configurable:!0},size:{configurable:!0},border:{configurable:!0},posBefore:{configurable:!0},posAtStart:{configurable:!0},posAfter:{configurable:!0},posAtEnd:{configurable:!0},contentLost:{configurable:!0}};Tu.prototype.matchesWidget=function(){return!1},Tu.prototype.matchesMark=function(){return!1},Tu.prototype.matchesNode=function(){return!1},Tu.prototype.matchesHack=function(){return!1},Eu.beforePosition.get=function(){return!1},Tu.prototype.parseRule=function(){return null},Tu.prototype.stopEvent=function(){return!1},Eu.size.get=function(){for(var t=0,e=0;e<this.children.length;e++)t+=this.children[e].size;return t},Eu.border.get=function(){return 0},Tu.prototype.destroy=function(){this.parent=null,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=null);for(var t=0;t<this.children.length;t++)this.children[t].destroy()},Tu.prototype.posBeforeChild=function(t){for(var e=0,n=this.posAtStart;e<this.children.length;e++){var r=this.children[e];if(r==t)return n;n+=r.size}},Eu.posBefore.get=function(){return this.parent.posBeforeChild(this)},Eu.posAtStart.get=function(){return this.parent?this.parent.posBeforeChild(this)+this.border:0},Eu.posAfter.get=function(){return this.posBefore+this.size},Eu.posAtEnd.get=function(){return this.posAtStart+this.size-2*this.border},Tu.prototype.localPosFromDOM=function(t,e,n){if(this.contentDOM&&this.contentDOM.contains(1==t.nodeType?t:t.parentNode)){if(n<0){var r,o;if(t==this.contentDOM)r=t.childNodes[e-1];else{while(t.parentNode!=this.contentDOM)t=t.parentNode;r=t.previousSibling}while(r&&(!(o=r.pmViewDesc)||o.parent!=this))r=r.previousSibling;return r?this.posBeforeChild(o)+o.size:this.posAtStart}var i,s;if(t==this.contentDOM)i=t.childNodes[e];else{while(t.parentNode!=this.contentDOM)t=t.parentNode;i=t.nextSibling}while(i&&(!(s=i.pmViewDesc)||s.parent!=this))i=i.nextSibling;return i?this.posBeforeChild(s):this.posAtEnd}var a;if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))a=2&t.compareDocumentPosition(this.contentDOM);else if(this.dom.firstChild){if(0==e)for(var c=t;;c=c.parentNode){if(c==this.dom){a=!1;break}if(c.parentNode.firstChild!=c)break}if(null==a&&e==t.childNodes.length)for(var h=t;;h=h.parentNode){if(h==this.dom){a=!0;break}if(h.parentNode.lastChild!=h)break}}return(null==a?n>0:a)?this.posAtEnd:this.posAtStart},Tu.prototype.nearestDesc=function(t,e){for(var n=!0,r=t;r;r=r.parentNode){var o=this.getDesc(r);if(o&&(!e||o.node)){if(!n||!o.nodeDOM||(1==o.nodeDOM.nodeType?o.nodeDOM.contains(1==t.nodeType?t:t.parentNode):o.nodeDOM==t))return o;n=!1}}},Tu.prototype.getDesc=function(t){for(var e=t.pmViewDesc,n=e;n;n=n.parent)if(n==this)return e},Tu.prototype.posFromDOM=function(t,e,n){for(var r=t;r;r=r.parentNode){var o=this.getDesc(r);if(o)return o.localPosFromDOM(t,e,n)}return-1},Tu.prototype.descAt=function(t){for(var e=0,n=0;e<this.children.length;e++){var r=this.children[e],o=n+r.size;if(n==t&&o!=n){while(!r.border&&r.children.length)r=r.children[0];return r}if(t<o)return r.descAt(t-n-r.border);n=o}},Tu.prototype.domFromPos=function(t){if(!this.contentDOM)return{node:this.dom,offset:0};for(var e=0,n=0;;n++){if(e==t){while(n<this.children.length&&(this.children[n].beforePosition||this.children[n].dom.parentNode!=this.contentDOM))n++;return{node:this.contentDOM,offset:n==this.children.length?this.contentDOM.childNodes.length:Bl(this.children[n].dom)}}if(n==this.children.length)throw new Error("Invalid position "+t);var r=this.children[n],o=e+r.size;if(t<o)return r.domFromPos(t-e-r.border);e=o}},Tu.prototype.parseRange=function(t,e,n){if(void 0===n&&(n=0),0==this.children.length)return{node:this.contentDOM,from:t,to:e,fromOffset:0,toOffset:this.contentDOM.childNodes.length};for(var r=-1,o=-1,i=n,s=0;;s++){var a=this.children[s],c=i+a.size;if(-1==r&&t<=c){var h=i+a.border;if(t>=h&&e<=c-a.border&&a.node&&a.contentDOM&&this.contentDOM.contains(a.contentDOM))return a.parseRange(t,e,h);t=i;for(var p=s;p>0;p--){var l=this.children[p-1];if(l.size&&l.dom.parentNode==this.contentDOM&&!l.emptyChildAt(1)){r=Bl(l.dom)+1;break}t-=l.size}-1==r&&(r=0)}if(r>-1&&e<=c){e=c;for(var u=s+1;u<this.children.length;u++){var f=this.children[u];if(f.size&&f.dom.parentNode==this.contentDOM&&!f.emptyChildAt(-1)){o=Bl(f.dom);break}e+=f.size}-1==o&&(o=this.contentDOM.childNodes.length);break}i=c}return{node:this.contentDOM,from:t,to:e,fromOffset:r,toOffset:o}},Tu.prototype.emptyChildAt=function(t){if(this.border||!this.contentDOM||!this.children.length)return!1;var e=this.children[t<0?0:this.children.length-1];return 0==e.size||e.emptyChildAt(t)},Tu.prototype.domAfterPos=function(t){var e=this.domFromPos(t),n=e.node,r=e.offset;if(1!=n.nodeType||r==n.childNodes.length)throw new RangeError("No node after pos "+t);return n.childNodes[r]},Tu.prototype.setSelection=function(t,e,n,r){for(var o=Math.min(t,e),i=Math.max(t,e),s=0,a=0;s<this.children.length;s++){var c=this.children[s],h=a+c.size;if(o>a&&i<h)return c.setSelection(t-a-c.border,e-a-c.border,n,r);a=h}var p=this.domFromPos(t),l=this.domFromPos(e),u=n.getSelection();if(r||!jl(p.node,p.offset,u.anchorNode,u.anchorOffset)||!jl(l.node,l.offset,u.focusNode,u.focusOffset)){var f=!1;if(u.extend||t==e){u.collapse(p.node,p.offset);try{t!=e&&u.extend(l.node,l.offset),f=!0}catch(v){if(!(v instanceof DOMException))throw v}}if(!f){if(t>e){var d=p;p=l,l=d}var m=document.createRange();m.setEnd(l.node,l.offset),m.setStart(p.node,p.offset),u.removeAllRanges(),u.addRange(m)}}},Tu.prototype.ignoreMutation=function(t){return!this.contentDOM&&"selection"!=t.type},Eu.contentLost.get=function(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)},Tu.prototype.markDirty=function(t,e){for(var n=0,r=0;r<this.children.length;r++){var o=this.children[r],i=n+o.size;if(n==i?t<=i&&e>=n:t<i&&e>n){var s=n+o.border,a=i-o.border;if(t>=s&&e<=a)return this.dirty=t==n||e==i?Mu:Cu,void(t!=s||e!=a||!o.contentLost&&o.dom.parentNode==this.contentDOM?o.markDirty(t-s,e-s):o.dirty=Nu);o.dirty=Nu}n=i}this.dirty=Mu},Tu.prototype.markParentsDirty=function(){for(var t=1,e=this.parent;e;e=e.parent,t++){var n=1==t?Mu:Cu;e.dirty<n&&(e.dirty=n)}},Object.defineProperties(Tu.prototype,Eu);var Au=[],Du=function(t){function e(e,n,r,o){var i,s=n.type.toDOM;if("function"==typeof s&&(s=s(r,(function(){return i?i.parent?i.parent.posBeforeChild(i):void 0:o}))),!n.type.spec.raw){if(1!=s.nodeType){var a=document.createElement("span");a.appendChild(s),s=a}s.contentEditable=!1,s.classList.add("ProseMirror-widget")}t.call(this,e,Au,s,null),this.widget=n,i=this}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={beforePosition:{configurable:!0}};return n.beforePosition.get=function(){return this.widget.type.side<0},e.prototype.matchesWidget=function(t){return this.dirty==Ou&&t.type.eq(this.widget.type)},e.prototype.parseRule=function(){return{ignore:!0}},e.prototype.stopEvent=function(t){var e=this.widget.spec.stopEvent;return!!e&&e(t)},e.prototype.ignoreMutation=function(t){return"selection"!=t.type||this.widget.spec.ignoreSelection},Object.defineProperties(e.prototype,n),e}(Tu),Ru=function(t){function e(e,n,r,o){t.call(this,e,Au,n,null),this.textDOM=r,this.text=o}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={size:{configurable:!0}};return n.size.get=function(){return this.text.length},e.prototype.localPosFromDOM=function(t,e){return t!=this.textDOM?this.posAtStart+(e?this.size:0):this.posAtStart+e},e.prototype.domFromPos=function(t){return{node:this.textDOM,offset:t}},e.prototype.ignoreMutation=function(t){return"characterData"===t.type&&t.target.nodeValue==t.oldValue},Object.defineProperties(e.prototype,n),e}(Tu),zu=function(t){function e(e,n,r,o){t.call(this,e,[],r,o),this.mark=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.create=function(t,n,r,o){var i=o.nodeViews[n.type.name],s=i&&i(n,o,r);return s&&s.dom||(s=on.renderSpec(document,n.type.spec.toDOM(n,r))),new e(t,n,s.dom,s.contentDOM||s.dom)},e.prototype.parseRule=function(){return{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}},e.prototype.matchesMark=function(t){return this.dirty!=Nu&&this.mark.eq(t)},e.prototype.markDirty=function(e,n){if(t.prototype.markDirty.call(this,e,n),this.dirty!=Ou){var r=this.parent;while(!r.node)r=r.parent;r.dirty<this.dirty&&(r.dirty=this.dirty),this.dirty=Ou}},e.prototype.slice=function(t,n,r){var o=e.create(this.parent,this.mark,!0,r),i=this.children,s=this.size;n<s&&(i=ef(i,n,s,r)),t>0&&(i=ef(i,0,t,r));for(var a=0;a<i.length;a++)i[a].parent=o;return o.children=i,o},e}(Tu),Iu=function(t){function e(e,n,r,o,i,s,a,c,h){t.call(this,e,n.isLeaf?Au:[],i,s),this.nodeDOM=a,this.node=n,this.outerDeco=r,this.innerDeco=o,s&&this.updateChildren(c,h)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={size:{configurable:!0},border:{configurable:!0}};return e.create=function(t,n,r,o,i,s){var a,c,h=i.nodeViews[n.type.name],p=h&&h(n,i,(function(){return c?c.parent?c.parent.posBeforeChild(c):void 0:s}),r),l=p&&p.dom,u=p&&p.contentDOM;if(n.isText)if(l){if(3!=l.nodeType)throw new RangeError("Text must be rendered as a DOM text node")}else l=document.createTextNode(n.text);else l||(a=on.renderSpec(document,n.type.spec.toDOM(n)),l=a.dom,u=a.contentDOM);u||n.isText||"BR"==l.nodeName||(l.hasAttribute("contenteditable")||(l.contentEditable=!1),n.type.spec.draggable&&(l.draggable=!0));var f=l;return l=Wu(l,r,n),p?c=new $u(t,n,r,o,l,u,f,p,i,s+1):n.isText?new Fu(t,n,r,o,l,f,i):new e(t,n,r,o,l,u,f,i,s+1)},e.prototype.parseRule=function(){var t=this;if(this.node.type.spec.reparseInView)return null;var e={node:this.node.type.name,attrs:this.node.attrs};return this.node.type.spec.code&&(e.preserveWhitespace="full"),this.contentDOM&&!this.contentLost?e.contentElement=this.contentDOM:e.getContent=function(){return t.contentDOM?Bt.empty:t.node.content},e},e.prototype.matchesNode=function(t,e,n){return this.dirty==Ou&&t.eq(this.node)&&Hu(e,this.outerDeco)&&n.eq(this.innerDeco)},n.size.get=function(){return this.node.nodeSize},n.border.get=function(){return this.node.isLeaf?0:1},e.prototype.updateChildren=function(t,e){var n=this,r=this.node.inlineContent,o=e,i=r&&t.composing&&this.localCompositionNode(t,e),s=new Uu(this,i&&i.node);Yu(this.node,this.innerDeco,(function(e,i,a){e.spec.marks?s.syncToMarks(e.spec.marks,r,t):e.type.side>=0&&!a&&s.syncToMarks(i==n.node.childCount?Lt.none:n.node.child(i).marks,r,t),s.placeWidget(e,t,o)}),(function(e,n,i,a){s.syncToMarks(e.marks,r,t),s.findNodeMatch(e,n,i,a)||s.updateNextNode(e,n,i,t,a)||s.addNode(e,n,i,t,o),o+=e.nodeSize})),s.syncToMarks(Au,r,t),this.node.isTextblock&&s.addTextblockHacks(),s.destroyRest(),(s.changed||this.dirty==Mu)&&(i&&this.protectLocalComposition(t,i),this.renderChildren())},e.prototype.renderChildren=function(){_u(this.contentDOM,this.children),Dl.ios&&Zu(this.dom)},e.prototype.localCompositionNode=function(t,e){var n=t.state.selection,r=n.from,o=n.to;if(!(!(t.state.selection instanceof Lp)||r<e||o>e+this.node.content.size)){var i=t.root.getSelection(),s=Qu(i.focusNode,i.focusOffset);if(s&&this.dom.contains(s.parentNode)){var a=s.nodeValue,c=tf(this.node.content,a,r-e,o-e);return c<0?null:{node:s,pos:c,text:a}}}},e.prototype.protectLocalComposition=function(t,e){var n=e.node,r=e.pos,o=e.text;if(!this.getDesc(n)){for(var i=n;;i=i.parentNode){if(i.parentNode==this.contentDOM)break;while(i.previousSibling)i.parentNode.removeChild(i.previousSibling);while(i.nextSibling)i.parentNode.removeChild(i.nextSibling);i.pmViewDesc&&(i.pmViewDesc=null)}var s=new Ru(this,i,n,o);t.compositionNodes.push(s),this.children=ef(this.children,r,r+o.length,t,s)}},e.prototype.update=function(t,e,n,r){return!(this.dirty==Nu||!t.sameMarkup(this.node))&&(this.updateInner(t,e,n,r),!0)},e.prototype.updateInner=function(t,e,n,r){this.updateOuterDeco(e),this.node=t,this.innerDeco=n,this.contentDOM&&this.updateChildren(r,this.posAtStart),this.dirty=Ou},e.prototype.updateOuterDeco=function(t){if(!Hu(t,this.outerDeco)){var e=1!=this.nodeDOM.nodeType,n=this.dom;this.dom=Vu(this.dom,this.nodeDOM,Lu(this.outerDeco,this.node,e),Lu(t,this.node,e)),this.dom!=n&&(n.pmViewDesc=null,this.dom.pmViewDesc=this),this.outerDeco=t}},e.prototype.selectNode=function(){this.nodeDOM.classList.add("ProseMirror-selectednode"),!this.contentDOM&&this.node.type.spec.draggable||(this.dom.draggable=!0)},e.prototype.deselectNode=function(){this.nodeDOM.classList.remove("ProseMirror-selectednode"),!this.contentDOM&&this.node.type.spec.draggable||this.dom.removeAttribute("draggable")},Object.defineProperties(e.prototype,n),e}(Tu);function Pu(t,e,n,r,o){return Wu(r,e,t),new Iu(null,t,e,n,r,r,r,o,0)}var Fu=function(t){function e(e,n,r,o,i,s,a){t.call(this,e,n,r,o,i,null,s,a)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.parseRule=function(){var t=this.nodeDOM.parentNode;while(t&&t!=this.dom&&!t.pmIsDeco)t=t.parentNode;return{skip:t||!0}},e.prototype.update=function(t,e){return!(this.dirty==Nu||this.dirty!=Ou&&!this.inParent()||!t.sameMarkup(this.node))&&(this.updateOuterDeco(e),this.dirty==Ou&&t.text==this.node.text||t.text==this.nodeDOM.nodeValue||(this.nodeDOM.nodeValue=t.text),this.node=t,this.dirty=Ou,!0)},e.prototype.inParent=function(){for(var t=this.parent.contentDOM,e=this.nodeDOM;e;e=e.parentNode)if(e==t)return!0;return!1},e.prototype.domFromPos=function(t){return{node:this.nodeDOM,offset:t}},e.prototype.localPosFromDOM=function(e,n,r){return e==this.nodeDOM?this.posAtStart+Math.min(n,this.node.text.length):t.prototype.localPosFromDOM.call(this,e,n,r)},e.prototype.ignoreMutation=function(t){return"characterData"!=t.type&&"selection"!=t.type},e.prototype.slice=function(t,n,r){var o=this.node.cut(t,n),i=document.createTextNode(o.text);return new e(this.parent,o,this.outerDeco,this.innerDeco,i,i,r)},e}(Iu),Bu=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.parseRule=function(){return{ignore:!0}},e.prototype.matchesHack=function(){return this.dirty==Ou},e}(Tu),$u=function(t){function e(e,n,r,o,i,s,a,c,h,p){t.call(this,e,n,r,o,i,s,a,h,p),this.spec=c}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.update=function(e,n,r,o){if(this.dirty==Nu)return!1;if(this.spec.update){var i=this.spec.update(e,n);return i&&this.updateInner(e,n,r,o),i}return!(!this.contentDOM&&!e.isLeaf)&&t.prototype.update.call(this,e,n,r,o)},e.prototype.selectNode=function(){this.spec.selectNode?this.spec.selectNode():t.prototype.selectNode.call(this)},e.prototype.deselectNode=function(){this.spec.deselectNode?this.spec.deselectNode():t.prototype.deselectNode.call(this)},e.prototype.setSelection=function(e,n,r,o){this.spec.setSelection?this.spec.setSelection(e,n,r):t.prototype.setSelection.call(this,e,n,r,o)},e.prototype.destroy=function(){this.spec.destroy&&this.spec.destroy(),t.prototype.destroy.call(this)},e.prototype.stopEvent=function(t){return!!this.spec.stopEvent&&this.spec.stopEvent(t)},e.prototype.ignoreMutation=function(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):t.prototype.ignoreMutation.call(this,e)},e}(Iu);function _u(t,e){for(var n=t.firstChild,r=0;r<e.length;r++){var o=e[r],i=o.dom;if(i.parentNode==t){while(i!=n)n=Ku(n);n=n.nextSibling}else t.insertBefore(i,n);if(o instanceof zu){var s=n?n.previousSibling:t.lastChild;_u(o.contentDOM,o.children),n=s?s.nextSibling:t.firstChild}}while(n)n=Ku(n)}function ju(t){t&&(this.nodeName=t)}ju.prototype=Object.create(null);var Ju=[new ju];function Lu(t,e,n){if(0==t.length)return Ju;for(var r=n?Ju[0]:new ju,o=[r],i=0;i<t.length;i++){var s=t[i].type.attrs,a=r;if(s)for(var c in s.nodeName&&o.push(a=new ju(s.nodeName)),s){var h=s[c];null!=h&&(n&&1==o.length&&o.push(a=r=new ju(e.isInline?"span":"div")),"class"==c?a.class=(a.class?a.class+" ":"")+h:"style"==c?a.style=(a.style?a.style+";":"")+h:"nodeName"!=c&&(a[c]=h))}}return o}function Vu(t,e,n,r){if(n==Ju&&r==Ju)return e;for(var o=e,i=0;i<r.length;i++){var s=r[i],a=n[i];if(i){var c=void 0;a&&a.nodeName==s.nodeName&&o!=t&&(c=o.parentNode)&&c.tagName.toLowerCase()==s.nodeName||(c=document.createElement(s.nodeName),c.pmIsDeco=!0,c.appendChild(o),a=Ju[0]),o=c}qu(o,a||Ju[0],s)}return o}function qu(t,e,n){for(var r in e)"class"==r||"style"==r||"nodeName"==r||r in n||t.removeAttribute(r);for(var o in n)"class"!=o&&"style"!=o&&"nodeName"!=o&&n[o]!=e[o]&&t.setAttribute(o,n[o]);if(e.class!=n.class){for(var i=e.class?e.class.split(" "):Au,s=n.class?n.class.split(" "):Au,a=0;a<i.length;a++)-1==s.indexOf(i[a])&&t.classList.remove(i[a]);for(var c=0;c<s.length;c++)-1==i.indexOf(s[c])&&t.classList.add(s[c])}if(e.style!=n.style){if(e.style){var h,p=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g;while(h=p.exec(e.style))t.style.removeProperty(h[1])}n.style&&(t.style.cssText+=n.style)}}function Wu(t,e,n){return Vu(t,t,Ju,Lu(e,n,1!=t.nodeType))}function Hu(t,e){if(t.length!=e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].type.eq(e[n].type))return!1;return!0}function Ku(t){var e=t.nextSibling;return t.parentNode.removeChild(t),e}var Uu=function(t,e){this.top=t,this.lock=e,this.index=0,this.stack=[],this.changed=!1;var n=Gu(t.node.content,t.children);this.preMatched=n.nodes,this.preMatchOffset=n.offset};function Gu(t,e){for(var n=[],r=t.childCount,o=e.length-1;r>0&&o>=0;o--){var i=e[o],s=i.node;if(s){if(s!=t.child(r-1))break;n.push(i),--r}}return{nodes:n.reverse(),offset:r}}function Xu(t,e){return t.type.side-e.type.side}function Yu(t,e,n,r){var o=e.locals(t),i=0;if(0!=o.length)for(var s=0,a=[],c=null,h=0;;){if(s<o.length&&o[s].to==i){var p=o[s++],l=void 0;while(s<o.length&&o[s].to==i)(l||(l=[p])).push(o[s++]);if(l){l.sort(Xu);for(var u=0;u<l.length;u++)n(l[u],h,!!c)}else n(p,h,!!c)}var f=void 0,d=void 0;if(c)d=-1,f=c,c=null;else{if(!(h<t.childCount))break;d=h,f=t.child(h++)}for(var m=0;m<a.length;m++)a[m].to<=i&&a.splice(m--,1);while(s<o.length&&o[s].from<=i&&o[s].to>i)a.push(o[s++]);var v=i+f.nodeSize;if(f.isText){var g=v;s<o.length&&o[s].from<g&&(g=o[s].from);for(var y=0;y<a.length;y++)a[y].to<g&&(g=a[y].to);g<v&&(c=f.cut(g-i),f=f.cut(0,g-i),v=g,d=-1)}r(f,a.length?a.slice():Au,e.forChild(i,f),d),i=v}else for(var w=0;w<t.childCount;w++){var x=t.child(w);r(x,o,e.forChild(i,x),w),i+=x.nodeSize}}function Zu(t){if("UL"==t.nodeName||"OL"==t.nodeName){var e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t).listStyle,t.style.cssText=e}}function Qu(t,e){for(;;){if(3==t.nodeType)return t;if(1==t.nodeType&&e>0){if(t.childNodes.length>e&&3==t.childNodes[e].nodeType)return t.childNodes[e];t=t.childNodes[e-1],e=Vl(t)}else{if(!(1==t.nodeType&&e<t.childNodes.length))return null;t=t.childNodes[e],e=0}}}function tf(t,e,n,r){for(var o=0,i=0;o<t.childCount&&i<=r;){var s=t.child(o++),a=i;if(i+=s.nodeSize,s.isText){var c=s.text;while(o<t.childCount){var h=t.child(o++);if(i+=h.nodeSize,!h.isText)break;c+=h.text}if(i>=n){var p=c.lastIndexOf(e,r-a);if(p>=0&&p+e.length+a>=n)return a+p}}}return-1}function ef(t,e,n,r,o){for(var i=[],s=0,a=0;s<t.length;s++){var c=t[s],h=a,p=a+=c.size;h>=n||p<=e?i.push(c):(h<e&&i.push(c.slice(0,e-h,r)),o&&(i.push(o),o=null),p>n&&i.push(c.slice(n-h,c.size,r)))}return i}function nf(t,e){var n=t.selection,r=n.$anchor,o=n.$head,i=e>0?r.max(o):r.min(o),s=i.parent.inlineContent?i.depth?t.doc.resolve(e>0?i.after():i.before()):null:i;return s&&_p.findFrom(s,e)}function rf(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function of(t,e,n){var r=t.state.selection;if(!(r instanceof Lp)){if(r instanceof qp&&r.node.isInline)return rf(t,new Lp(e>0?r.$to:r.$from));var o=nf(t.state,e);return!!o&&rf(t,o)}if(!r.empty||n.indexOf("s")>-1)return!1;if(t.endOfTextblock(e>0?"right":"left")){var i=nf(t.state,e);return!!(i&&i instanceof qp)&&rf(t,i)}if(!(Dl.mac&&n.indexOf("m")>-1)){var s,a=r.$head,c=a.textOffset?null:e<0?a.nodeBefore:a.nodeAfter;if(!c||c.isText)return!1;var h=e<0?a.pos-c.nodeSize:a.pos;return!!(c.isAtom||(s=t.docView.descAt(h))&&!s.contentDOM)&&(qp.isSelectable(c)?rf(t,new qp(e<0?t.state.doc.resolve(a.pos-c.nodeSize):a)):!!Dl.webkit&&rf(t,new Lp(t.state.doc.resolve(e<0?h:h+c.nodeSize))))}}function sf(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}function af(t){var e=t.pmViewDesc;return e&&0==e.size&&(t.nextSibling||"BR"!=t.nodeName)}function cf(t){var e=t.root.getSelection(),n=e.focusNode,r=e.focusOffset;if(n){var o,i,s=!1;for(Dl.gecko&&1==n.nodeType&&r<sf(n)&&af(n.childNodes[r])&&(s=!0);;)if(r>0){if(1!=n.nodeType)break;var a=n.childNodes[r-1];if(af(a))o=n,i=--r;else{if(3!=a.nodeType)break;n=a,r=n.nodeValue.length}}else{if(pf(n))break;var c=n.previousSibling;while(c&&af(c))o=n.parentNode,i=Bl(c),c=c.previousSibling;if(c)n=c,r=sf(n);else{if(n=n.parentNode,n==t.dom)break;r=0}}s?lf(t,e,n,r):o&&lf(t,e,o,i)}}function hf(t){var e=t.root.getSelection(),n=e.focusNode,r=e.focusOffset;if(n){for(var o,i,s=sf(n);;)if(r<s){if(1!=n.nodeType)break;var a=n.childNodes[r];if(!af(a))break;o=n,i=++r}else{if(pf(n))break;var c=n.nextSibling;while(c&&af(c))o=c.parentNode,i=Bl(c)+1,c=c.nextSibling;if(c)n=c,r=0,s=sf(n);else{if(n=n.parentNode,n==t.dom)break;r=s=0}}o&&lf(t,e,o,i)}}function pf(t){var e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function lf(t,e,n,r){if(Hl(e)){var o=document.createRange();o.setEnd(n,r),o.setStart(n,r),e.removeAllRanges(),e.addRange(o)}else e.extend&&e.extend(n,r);t.domObserver.setCurSelection()}function uf(t,e,n){var r=t.state.selection;if(r instanceof Lp&&!r.empty||n.indexOf("s")>-1)return!1;if(Dl.mac&&n.indexOf("m")>-1)return!1;var o=r.$from,i=r.$to;if(!o.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){var s=nf(t.state,e);if(s&&s instanceof qp)return rf(t,s)}if(!o.parent.inlineContent){var a=_p.findFrom(e<0?o:i,e);return!a||rf(t,a)}return!1}function ff(t,e){if(!(t.state.selection instanceof Lp))return!0;var n=t.state.selection,r=n.$head,o=n.$anchor,i=n.empty;if(!r.sameParent(o))return!0;if(!i)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;var s=!r.textOffset&&(e<0?r.nodeBefore:r.nodeAfter);if(s&&!s.isText){var a=t.state.tr;return e<0?a.delete(r.pos-s.nodeSize,r.pos):a.delete(r.pos,r.pos+s.nodeSize),t.dispatch(a),!0}return!1}function df(t,e,n){t.domObserver.stop(),e.contentEditable=n,t.domObserver.start()}function mf(t){if(Dl.chrome&&!(t.state.selection.$head.parentOffset>0)){var e=t.root.getSelection(),n=e.focusNode,r=e.focusOffset;if(n&&1==n.nodeType&&0==r&&n.firstChild&&"false"==n.firstChild.contentEditable){var o=n.firstChild;df(t,o,!0),setTimeout((function(){return df(t,o,!1)}),20)}}}function vf(t){var e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}function gf(t,e){var n=e.keyCode,r=vf(e);return 8==n||Dl.mac&&72==n&&"c"==r?ff(t,-1)||cf(t):46==n||Dl.mac&&68==n&&"c"==r?ff(t,1)||hf(t):13==n||27==n||(37==n?of(t,-1,r)||cf(t):39==n?of(t,1,r)||hf(t):38==n?uf(t,-1,r)||cf(t):40==n?mf(t)||uf(t,1,r)||hf(t):r==(Dl.mac?"m":"c")&&(66==n||73==n||89==n||90==n))}function yf(t,e){var n=t.root.getSelection(),r=t.state.doc;if(!n.focusNode)return null;var o=t.docView.nearestDesc(n.focusNode),i=o&&0==o.size,s=t.docView.posFromDOM(n.focusNode,n.focusOffset);if(s<0)return null;var a,c,h=r.resolve(s);if(Hl(n)){a=h;while(o&&!o.node)o=o.parent;if(o&&o.node.isAtom&&qp.isSelectable(o.node)&&o.parent&&(!o.node.isInline||!ql(n.focusNode,n.focusOffset,o.dom))){var p=o.posBefore;c=new qp(s==p?h:r.resolve(p))}}else{var l=t.docView.posFromDOM(n.anchorNode,n.anchorOffset);if(l<0)return null;a=r.resolve(l)}if(!c){var u="pointer"==e||t.state.selection.head<h.pos&&!i?1:-1;c=Tf(t,a,h,u)}return c}function wf(t,e){var n=t.state.selection;if(Mf(t,n),t.editable?t.hasFocus():Af(t)&&document.activeElement&&document.activeElement.contains(t.dom)){if(t.domObserver.disconnectSelection(),t.cursorWrapper)Cf(t);else{var r,o,i=n.anchor,s=n.head;!xf||n instanceof Lp||(n.$from.parent.inlineContent||(r=bf(t,n.from)),n.empty||n.$from.parent.inlineContent||(o=bf(t,n.to))),t.docView.setSelection(i,s,t.root,e),xf&&(r&&Sf(r),o&&Sf(o)),n.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&Of(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}Uu.prototype.getPreMatch=function(t){return t>=this.preMatchOffset?this.preMatched[t-this.preMatchOffset]:null},Uu.prototype.destroyBetween=function(t,e){if(t!=e){for(var n=t;n<e;n++)this.top.children[n].destroy();this.top.children.splice(t,e-t),this.changed=!0}},Uu.prototype.destroyRest=function(){this.destroyBetween(this.index,this.top.children.length)},Uu.prototype.syncToMarks=function(t,e,n){var r=0,o=this.stack.length>>1,i=Math.min(o,t.length);while(r<i&&(r==o-1?this.top:this.stack[r+1<<1]).matchesMark(t[r])&&!1!==t[r].type.spec.spanning)r++;while(r<o)this.destroyRest(),this.top.dirty=Ou,this.index=this.stack.pop(),this.top=this.stack.pop(),o--;while(o<t.length){this.stack.push(this.top,this.index+1);for(var s=-1,a=this.index;a<Math.min(this.index+3,this.top.children.length);a++)if(this.top.children[a].matchesMark(t[o])){s=a;break}if(s>-1)s>this.index&&(this.changed=!0,this.destroyBetween(this.index,s)),this.top=this.top.children[this.index];else{var c=zu.create(this.top,t[o],e,n);this.top.children.splice(this.index,0,c),this.top=c,this.changed=!0}this.index=0,o++}},Uu.prototype.findNodeMatch=function(t,e,n,r){var o=-1,i=r<0?void 0:this.getPreMatch(r),s=this.top.children;if(i&&i.matchesNode(t,e,n))o=s.indexOf(i);else for(var a=this.index,c=Math.min(s.length,a+5);a<c;a++){var h=s[a];if(h.matchesNode(t,e,n)&&this.preMatched.indexOf(h)<0){o=a;break}}return!(o<0)&&(this.destroyBetween(this.index,o),this.index++,!0)},Uu.prototype.updateNextNode=function(t,e,n,r,o){for(var i=this.index;i<this.top.children.length;i++){var s=this.top.children[i];if(s instanceof Iu){var a=this.preMatched.indexOf(s);if(a>-1&&a+this.preMatchOffset!=o)return!1;var c=s.dom,h=this.lock&&(c==this.lock||1==c.nodeType&&c.contains(this.lock.parentNode))&&!(t.isText&&s.node&&s.node.isText&&s.nodeDOM.nodeValue==t.text&&s.dirty!=Nu&&Hu(e,s.outerDeco));if(!h&&s.update(t,e,n,r))return this.destroyBetween(this.index,i),s.dom!=c&&(this.changed=!0),this.index++,!0;break}}return!1},Uu.prototype.addNode=function(t,e,n,r,o){this.top.children.splice(this.index++,0,Iu.create(this.top,t,e,n,r,o)),this.changed=!0},Uu.prototype.placeWidget=function(t,e,n){var r=this.index<this.top.children.length?this.top.children[this.index]:null;if(!r||!r.matchesWidget(t)||t!=r.widget&&r.widget.type.toDOM.parentNode){var o=new Du(this.top,t,e,n);this.top.children.splice(this.index++,0,o),this.changed=!0}else this.index++},Uu.prototype.addTextblockHacks=function(){var t=this.top.children[this.index-1];while(t instanceof zu)t=t.children[t.children.length-1];if(!t||!(t instanceof Fu)||/\n$/.test(t.node.text))if(this.index<this.top.children.length&&this.top.children[this.index].matchesHack())this.index++;else{var e=document.createElement("br");this.top.children.splice(this.index++,0,new Bu(this.top,Au,e,null)),this.changed=!0}};var xf=Dl.safari||Dl.chrome&&Dl.chrome_version<63;function bf(t,e){var n=t.docView.domFromPos(e),r=n.node,o=n.offset,i=o<r.childNodes.length?r.childNodes[o]:null,s=o?r.childNodes[o-1]:null;if(Dl.safari&&i&&"false"==i.contentEditable)return kf(i);if((!i||"false"==i.contentEditable)&&(!s||"false"==s.contentEditable)){if(i)return kf(i);if(s)return kf(s)}}function kf(t){return t.contentEditable="true",Dl.safari&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function Sf(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function Of(t){var e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.hideSelectionGuard);var n=t.root.getSelection(),r=n.anchorNode,o=n.anchorOffset;e.addEventListener("selectionchange",t.hideSelectionGuard=function(){n.anchorNode==r&&n.anchorOffset==o||(e.removeEventListener("selectionchange",t.hideSelectionGuard),t.dom.classList.remove("ProseMirror-hideselection"))})}function Cf(t){var e=t.root.getSelection(),n=document.createRange(),r=t.cursorWrapper.dom,o="IMG"==r.nodeName;o?n.setEnd(r.parentNode,Bl(r)+1):n.setEnd(r,0),n.collapse(!1),e.removeAllRanges(),e.addRange(n),!o&&!t.state.selection.visible&&Dl.ie&&Dl.ie_version<=11&&(r.disabled=!0,r.disabled=!1)}function Mf(t,e){if(e instanceof qp){var n=t.docView.descAt(e.from);n!=t.lastSelectedViewDesc&&(Nf(t),n&&n.selectNode(),t.lastSelectedViewDesc=n)}else Nf(t)}function Nf(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=null)}function Tf(t,e,n,r){return t.someProp("createSelectionBetween",(function(r){return r(t,e,n)}))||Lp.between(e,n,r)}function Ef(t){return(!t.editable||t.root.activeElement==t.dom)&&Af(t)}function Af(t){var e=t.root.getSelection();if(!e.anchorNode)return!1;try{return t.dom.contains(3==e.anchorNode.nodeType?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(3==e.focusNode.nodeType?e.focusNode.parentNode:e.focusNode))}catch(n){return!1}}function Df(t){var e=t.docView.domFromPos(t.state.selection.anchor),n=t.root.getSelection();return jl(e.node,e.offset,n.anchorNode,n.anchorOffset)}function Rf(t,e,n){var r=t.docView.parseRange(e,n),o=r.node,i=r.fromOffset,s=r.toOffset,a=r.from,c=r.to,h=t.root.getSelection(),p=null,l=h.anchorNode;if(l&&t.dom.contains(1==l.nodeType?l:l.parentNode)&&(p=[{node:l,offset:h.anchorOffset}],Hl(h)||p.push({node:h.focusNode,offset:h.focusOffset})),Dl.chrome&&8===t.lastKeyCode)for(var u=s;u>i;u--){var f=o.childNodes[u-1],d=f.pmViewDesc;if("BR"==f.nodeType&&!d){s=u;break}if(!d||d.size)break}var m=t.state.doc,v=t.someProp("domParser")||Le.fromSchema(t.state.schema),g=m.resolve(a),y=null,w=v.parse(o,{topNode:g.parent,topMatch:g.parent.contentMatchAt(g.index()),topOpen:!0,from:i,to:s,preserveWhitespace:!g.parent.type.spec.code||"full",editableContent:!0,findPositions:p,ruleFromNode:zf,context:g});if(p&&null!=p[0].pos){var x=p[0].pos,b=p[1]&&p[1].pos;null==b&&(b=x),y={anchor:x+a,head:b+a}}return{doc:w,sel:y,from:a,to:c}}function zf(t){var e=t.pmViewDesc;if(e)return e.parseRule();if("BR"==t.nodeName&&t.parentNode){if(Dl.safari&&/^(ul|ol)$/i.test(t.parentNode.nodeName)){var n=document.createElement("div");return n.appendChild(document.createElement("li")),{skip:n}}if(t.parentNode.lastChild==t||Dl.safari&&/^(tr|table)$/i.test(t.parentNode.nodeName))return{ignore:!0}}else if("IMG"==t.nodeName&&t.getAttribute("mark-placeholder"))return{ignore:!0}}function If(t,e,n,r,o){if(e<0){var i=t.lastSelectionTime>Date.now()-50?t.lastSelectionOrigin:null,s=yf(t,i);if(s&&!t.state.selection.eq(s)){var a=t.state.tr.setSelection(s);"pointer"==i?a.setMeta("pointer",!0):"key"==i&&a.scrollIntoView(),t.dispatch(a)}}else{var c=t.state.doc.resolve(e),h=c.sharedDepth(n);e=c.before(h+1),n=t.state.doc.resolve(n).after(h+1);var p,l,u=t.state.selection,f=Rf(t,e,n),d=t.state.doc,m=d.slice(f.from,f.to);8===t.lastKeyCode&&Date.now()-100<t.lastKeyCodeTime?(p=t.state.selection.to,l="end"):(p=t.state.selection.from,l="start"),t.lastKeyCode=null;var v=_f(m.content,f.doc.content,f.from,p,l);if(!v){if(!(r&&u instanceof Lp&&!u.empty&&u.$head.sameParent(u.$anchor))||t.composing||f.sel&&f.sel.anchor!=f.sel.head){if(f.sel){var g=Pf(t,t.state.doc,f.sel);g&&!g.eq(t.state.selection)&&t.dispatch(t.state.tr.setSelection(g))}return}v={start:u.from,endA:u.to,endB:u.to}}t.domChangeCount++,t.state.selection.from<t.state.selection.to&&v.start==v.endB&&t.state.selection instanceof Lp&&(v.start>t.state.selection.from&&v.start<=t.state.selection.from+2?v.start=t.state.selection.from:v.endA<t.state.selection.to&&v.endA>=t.state.selection.to-2&&(v.endB+=t.state.selection.to-v.endA,v.endA=t.state.selection.to)),Dl.ie&&Dl.ie_version<=11&&v.endB==v.start+1&&v.endA==v.start&&v.start>f.from&&" "==f.doc.textBetween(v.start-f.from-1,v.start-f.from+1)&&(v.start--,v.endA--,v.endB--);var y,w=f.doc.resolveNoCache(v.start-f.from),x=f.doc.resolveNoCache(v.endB-f.from),b=w.sameParent(x)&&w.parent.inlineContent;if((Dl.ios&&t.lastIOSEnter>Date.now()-100&&(!b||o.some((function(t){return"DIV"==t.nodeName||"P"==t.nodeName})))||!b&&w.pos<f.doc.content.size&&(y=_p.findFrom(f.doc.resolve(w.pos+1),1,!0))&&y.head==x.pos)&&t.someProp("handleKeyDown",(function(e){return e(t,Kl(13,"Enter"))})))t.lastIOSEnter=0;else if(t.state.selection.anchor>v.start&&Bf(d,v.start,v.endA,w,x)&&t.someProp("handleKeyDown",(function(e){return e(t,Kl(8,"Backspace"))})))Dl.android&&Dl.chrome&&t.domObserver.suppressSelectionUpdates();else{Dl.android&&!b&&w.start()!=x.start()&&0==x.parentOffset&&w.depth==x.depth&&f.sel&&f.sel.anchor==f.sel.head&&f.sel.head==v.endA&&(v.endB-=2,x=f.doc.resolveNoCache(v.endB-f.from),setTimeout((function(){t.someProp("handleKeyDown",(function(e){return e(t,Kl(13,"Enter"))}))}),20));var k,S,O,C,M=v.start,N=v.endA;if(b)if(w.pos==x.pos)Dl.ie&&Dl.ie_version<=11&&0==w.parentOffset&&(t.domObserver.suppressSelectionUpdates(),setTimeout((function(){return wf(t)}),20)),k=t.state.tr.delete(M,N),S=d.resolve(v.start).marksAcross(d.resolve(v.endA));else if(v.endA==v.endB&&(C=d.resolve(v.start))&&(O=Ff(w.parent.content.cut(w.parentOffset,x.parentOffset),C.parent.content.cut(C.parentOffset,v.endA-C.start()))))k=t.state.tr,"add"==O.type?k.addMark(M,N,O.mark):k.removeMark(M,N,O.mark);else if(w.parent.child(w.index()).isText&&w.index()==x.index()-(x.textOffset?0:1)){var T=w.parent.textBetween(w.parentOffset,x.parentOffset);if(t.someProp("handleTextInput",(function(e){return e(t,M,N,T)})))return;k=t.state.tr.insertText(T,M,N)}if(k||(k=t.state.tr.replace(M,N,f.doc.slice(v.start-f.from,v.endB-f.from))),f.sel){var E=Pf(t,k.doc,f.sel);E&&!(Dl.chrome&&Dl.android&&t.composing&&E.empty&&(E.head==M||E.head==k.mapping.map(N)-1)||Dl.ie&&E.empty&&E.head==M)&&k.setSelection(E)}S&&k.ensureMarks(S),t.dispatch(k.scrollIntoView())}}}function Pf(t,e,n){return Math.max(n.anchor,n.head)>e.content.size?null:Tf(t,e.resolve(n.anchor),e.resolve(n.head))}function Ff(t,e){for(var n,r,o,i=t.firstChild.marks,s=e.firstChild.marks,a=i,c=s,h=0;h<s.length;h++)a=s[h].removeFromSet(a);for(var p=0;p<i.length;p++)c=i[p].removeFromSet(c);if(1==a.length&&0==c.length)r=a[0],n="add",o=function(t){return t.mark(r.addToSet(t.marks))};else{if(0!=a.length||1!=c.length)return null;r=c[0],n="remove",o=function(t){return t.mark(r.removeFromSet(t.marks))}}for(var l=[],u=0;u<e.childCount;u++)l.push(o(e.child(u)));if(Bt.from(l).eq(t))return{mark:r,type:n}}function Bf(t,e,n,r,o){if(!r.parent.isTextblock||n-e<=o.pos-r.pos||$f(r,!0,!1)<o.pos)return!1;var i=t.resolve(e);if(i.parentOffset<i.parent.content.size||!i.parent.isTextblock)return!1;var s=t.resolve($f(i,!0,!0));return!(!s.parent.isTextblock||s.pos>n||$f(s,!0,!1)<n)&&r.parent.content.cut(r.parentOffset).eq(s.parent.content)}function $f(t,e,n){var r=t.depth,o=e?t.end():t.pos;while(r>0&&(e||t.indexAfter(r)==t.node(r).childCount))r--,o++,e=!1;if(n){var i=t.node(r).maybeChild(t.indexAfter(r));while(i&&!i.isLeaf)i=i.firstChild,o++}return o}function _f(t,e,n,r,o){var i=t.findDiffStart(e,n);if(null==i)return null;var s=t.findDiffEnd(e,n+t.size,n+e.size),a=s.a,c=s.b;if("end"==o){var h=Math.max(0,i-Math.min(a,c));r-=a+h-i}if(a<i&&t.size<e.size){var p=r<=i&&r>=a?i-r:0;i-=p,c=i+(c-a),a=i}else if(c<i){var l=r<=i&&r>=c?i-r:0;i-=l,a=i+(a-c),c=i}return{start:i,endA:a,endB:c}}function jf(t,e){var n=[],r=e.content,o=e.openStart,i=e.openEnd;while(o>1&&i>1&&1==r.childCount&&1==r.firstChild.childCount){o--,i--;var s=r.firstChild;n.push(s.type.name,s.type.hasRequiredAttrs()?s.attrs:null),r=s.content}var a=t.someProp("clipboardSerializer")||on.fromSchema(t.state.schema),c=Xf(),h=c.createElement("div");h.appendChild(a.serializeFragment(r,{document:c}));var p,l=h.firstChild;while(l&&1==l.nodeType&&(p=Uf[l.nodeName.toLowerCase()])){for(var u=p.length-1;u>=0;u--){var f=c.createElement(p[u]);while(h.firstChild)f.appendChild(h.firstChild);h.appendChild(f)}l=h.firstChild}l&&1==l.nodeType&&l.setAttribute("data-pm-slice",o+" "+i+" "+JSON.stringify(n));var d=t.someProp("clipboardTextSerializer",(function(t){return t(e)}))||e.content.textBetween(0,e.content.size,"\n\n");return{dom:h,text:d}}function Jf(t,e,n,r,o){var i,s,a=o.parent.type.spec.code;if(!n&&!e)return null;var c=e&&(r||a||!n);if(c){if(t.someProp("transformPastedText",(function(t){e=t(e)})),a)return new qt(Bt.from(t.state.schema.text(e)),0,0);var h=t.someProp("clipboardTextParser",(function(t){return t(e,o)}));h?s=h:(i=document.createElement("div"),e.trim().split(/(?:\r\n?|\n)+/).forEach((function(t){i.appendChild(document.createElement("p")).textContent=t})))}else t.someProp("transformPastedHTML",(function(t){n=t(n)})),i=Yf(n);var p=i&&i.querySelector("[data-pm-slice]"),l=p&&/^(\d+) (\d+) (.*)/.exec(p.getAttribute("data-pm-slice"));if(!s){var u=t.someProp("clipboardParser")||t.someProp("domParser")||Le.fromSchema(t.state.schema);s=u.parseSlice(i,{preserveWhitespace:!(!c&&!l),context:o})}return s=l?Zf(Kf(s,+l[1],+l[2]),l[3]):qt.maxOpen(Lf(s.content,o),!1),t.someProp("transformPasted",(function(t){s=t(s)})),s}function Lf(t,e){if(t.childCount<2)return t;for(var n=function(n){var r=e.node(n),o=r.contentMatchAt(e.index(n)),i=void 0,s=[];if(t.forEach((function(t){if(s){var e,n=o.findWrapping(t.type);if(!n)return s=null;if(e=s.length&&i.length&&qf(n,i,t,s[s.length-1],0))s[s.length-1]=e;else{s.length&&(s[s.length-1]=Wf(s[s.length-1],i.length));var r=Vf(t,n);s.push(r),o=o.matchType(r.type,r.attrs),i=n}}})),s)return{v:Bt.from(s)}},r=e.depth;r>=0;r--){var o=n(r);if(o)return o.v}return t}function Vf(t,e,n){void 0===n&&(n=0);for(var r=e.length-1;r>=n;r--)t=e[r].create(null,Bt.from(t));return t}function qf(t,e,n,r,o){if(o<t.length&&o<e.length&&t[o]==e[o]){var i=qf(t,e,n,r.lastChild,o+1);if(i)return r.copy(r.content.replaceChild(r.childCount-1,i));var s=r.contentMatchAt(r.childCount);if(s.matchType(o==t.length-1?n.type:t[o+1]))return r.copy(r.content.append(Bt.from(Vf(n,t,o+1))))}}function Wf(t,e){if(0==e)return t;var n=t.content.replaceChild(t.childCount-1,Wf(t.lastChild,e-1)),r=t.contentMatchAt(t.childCount).fillBefore(Bt.empty,!0);return t.copy(n.append(r))}function Hf(t,e,n,r,o,i){var s=e<0?t.firstChild:t.lastChild,a=s.content;return o<r-1&&(a=Hf(a,e,n,r,o+1,i)),o>=n&&(a=e<0?s.contentMatchAt(0).fillBefore(a,t.childCount>1||i<=o).append(a):a.append(s.contentMatchAt(s.childCount).fillBefore(Bt.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,s.copy(a))}function Kf(t,e,n){return e<t.openStart&&(t=new qt(Hf(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),n<t.openEnd&&(t=new qt(Hf(t.content,1,n,t.openEnd,0,0),t.openStart,n)),t}var Uf={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]},Gf=null;function Xf(){return Gf||(Gf=document.implementation.createHTMLDocument("title"))}function Yf(t){var e=/(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));var n,r=Xf().createElement("div"),o=/(?:<meta [^>]*>)*<([a-z][^>\s]+)/i.exec(t),i=0;(n=o&&Uf[o[1].toLowerCase()])&&(t=n.map((function(t){return"<"+t+">"})).join("")+t+n.map((function(t){return"</"+t+">"})).reverse().join(""),i=n.length),r.innerHTML=t;for(var s=0;s<i;s++)r=r.firstChild;return r}function Zf(t,e){if(!t.size)return t;var n,r=t.content.firstChild.type.schema;try{n=JSON.parse(e)}catch(h){return t}for(var o=t.content,i=t.openStart,s=t.openEnd,a=n.length-2;a>=0;a-=2){var c=r.nodes[n[a]];if(!c||c.hasRequiredAttrs())break;o=Bt.from(c.create(n[a+1],o)),i++,s++}return new qt(o,i,s)}var Qf={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},td=Dl.ie&&Dl.ie_version<=11,ed=function(){this.anchorNode=this.anchorOffset=this.focusNode=this.focusOffset=null};ed.prototype.set=function(t){this.anchorNode=t.anchorNode,this.anchorOffset=t.anchorOffset,this.focusNode=t.focusNode,this.focusOffset=t.focusOffset},ed.prototype.eq=function(t){return t.anchorNode==this.anchorNode&&t.anchorOffset==this.anchorOffset&&t.focusNode==this.focusNode&&t.focusOffset==this.focusOffset};var nd=function(t,e){var n=this;this.view=t,this.handleDOMChange=e,this.queue=[],this.flushingSoon=-1,this.observer=window.MutationObserver&&new window.MutationObserver((function(t){for(var e=0;e<t.length;e++)n.queue.push(t[e]);Dl.ie&&Dl.ie_version<=11&&t.some((function(t){return"childList"==t.type&&t.removedNodes.length||"characterData"==t.type&&t.oldValue.length>t.target.nodeValue.length}))?n.flushSoon():n.flush()})),this.currentSelection=new ed,td&&(this.onCharData=function(t){n.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),n.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.suppressingSelectionUpdates=!1};nd.prototype.flushSoon=function(){var t=this;this.flushingSoon<0&&(this.flushingSoon=window.setTimeout((function(){t.flushingSoon=-1,t.flush()}),20))},nd.prototype.forceFlush=function(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())},nd.prototype.start=function(){this.observer&&this.observer.observe(this.view.dom,Qf),td&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()},nd.prototype.stop=function(){var t=this;if(this.observer){var e=this.observer.takeRecords();if(e.length){for(var n=0;n<e.length;n++)this.queue.push(e[n]);window.setTimeout((function(){return t.flush()}),20)}this.observer.disconnect()}td&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()},nd.prototype.connectSelection=function(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)},nd.prototype.disconnectSelection=function(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)},nd.prototype.suppressSelectionUpdates=function(){var t=this;this.suppressingSelectionUpdates=!0,setTimeout((function(){return t.suppressingSelectionUpdates=!1}),50)},nd.prototype.onSelectionChange=function(){if(Ef(this.view)){if(this.suppressingSelectionUpdates)return wf(this.view);if(Dl.ie&&Dl.ie_version<=11&&!this.view.state.selection.empty){var t=this.view.root.getSelection();if(t.focusNode&&jl(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset))return this.flushSoon()}this.flush()}},nd.prototype.setCurSelection=function(){this.currentSelection.set(this.view.root.getSelection())},nd.prototype.ignoreSelectionChange=function(t){if(0==t.rangeCount)return!0;var e=t.getRangeAt(0).commonAncestorContainer,n=this.view.docView.nearestDesc(e);return n&&n.ignoreMutation({type:"selection",target:3==e.nodeType?e.parentNode:e})?(this.setCurSelection(),!0):void 0},nd.prototype.flush=function(){if(this.view.docView&&!(this.flushingSoon>-1)){var t=this.observer?this.observer.takeRecords():[];this.queue.length&&(t=this.queue.concat(t),this.queue.length=0);var e=this.view.root.getSelection(),n=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(e)&&Af(this.view)&&!this.ignoreSelectionChange(e),r=-1,o=-1,i=!1,s=[];if(this.view.editable)for(var a=0;a<t.length;a++){var c=this.registerMutation(t[a],s);c&&(r=r<0?c.from:Math.min(c.from,r),o=o<0?c.to:Math.max(c.to,o),c.typeOver&&(i=!0))}if(Dl.gecko&&s.length>1){var h=s.filter((function(t){return"BR"==t.nodeName}));if(2==h.length){var p=h[0],l=h[1];p.parentNode&&p.parentNode.parentNode==l.parentNode?l.remove():p.remove()}}(r>-1||n)&&(r>-1&&(this.view.docView.markDirty(r,o),od(this.view)),this.handleDOMChange(r,o,i,s),this.view.docView.dirty?this.view.updateState(this.view.state):this.currentSelection.eq(e)||wf(this.view))}},nd.prototype.registerMutation=function(t,e){if(e.indexOf(t.target)>-1)return null;var n=this.view.docView.nearestDesc(t.target);if("attributes"==t.type&&(n==this.view.docView||"contenteditable"==t.attributeName||"style"==t.attributeName&&!t.oldValue&&!t.target.getAttribute("style")))return null;if(!n||n.ignoreMutation(t))return null;if("childList"==t.type){var r=t.previousSibling,o=t.nextSibling;if(Dl.ie&&Dl.ie_version<=11&&t.addedNodes.length)for(var i=0;i<t.addedNodes.length;i++){var s=t.addedNodes[i],a=s.previousSibling,c=s.nextSibling;(!a||Array.prototype.indexOf.call(t.addedNodes,a)<0)&&(r=a),(!c||Array.prototype.indexOf.call(t.addedNodes,c)<0)&&(o=c)}for(var h=r&&r.parentNode==t.target?Bl(r)+1:0,p=n.localPosFromDOM(t.target,h,-1),l=o&&o.parentNode==t.target?Bl(o):t.target.childNodes.length,u=0;u<t.addedNodes.length;u++)e.push(t.addedNodes[u]);var f=n.localPosFromDOM(t.target,l,1);return{from:p,to:f}}return"attributes"==t.type?{from:n.posAtStart-n.border,to:n.posAtEnd+n.border}:{from:n.posAtStart,to:n.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}};var rd=!1;function od(t){rd||(rd=!0,"normal"==getComputedStyle(t.dom).whiteSpace&&console["warn"]("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."))}var id={},sd={};function ad(t){t.shiftKey=!1,t.mouseDown=null,t.lastKeyCode=null,t.lastKeyCodeTime=0,t.lastClick={time:0,x:0,y:0,type:""},t.lastSelectionOrigin=null,t.lastSelectionTime=0,t.lastIOSEnter=0,t.composing=!1,t.composingTimeout=null,t.compositionNodes=[],t.compositionEndedAt=-2e8,t.domObserver=new nd(t,(function(e,n,r,o){return If(t,e,n,r,o)})),t.domObserver.start(),t.domChangeCount=0,t.eventHandlers=Object.create(null);var e=function(e){var n=id[e];t.dom.addEventListener(e,t.eventHandlers[e]=function(e){!ud(t,e)||ld(t,e)||!t.editable&&e.type in sd||n(t,e)})};for(var n in id)e(n);Dl.safari&&t.dom.addEventListener("input",(function(){return null})),pd(t)}function cd(t,e){t.lastSelectionOrigin=e,t.lastSelectionTime=Date.now()}function hd(t){for(var e in t.domObserver.stop(),t.eventHandlers)t.dom.removeEventListener(e,t.eventHandlers[e]);clearTimeout(t.composingTimeout)}function pd(t){t.someProp("handleDOMEvents",(function(e){for(var n in e)t.eventHandlers[n]||t.dom.addEventListener(n,t.eventHandlers[n]=function(e){return ld(t,e)})}))}function ld(t,e){return t.someProp("handleDOMEvents",(function(n){var r=n[e.type];return!!r&&(r(t,e)||e.defaultPrevented)}))}function ud(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(var n=e.target;n!=t.dom;n=n.parentNode)if(!n||11==n.nodeType||n.pmViewDesc&&n.pmViewDesc.stopEvent(e))return!1;return!0}function fd(t,e){ld(t,e)||!id[e.type]||!t.editable&&e.type in sd||id[e.type](t,e)}function dd(t){return{left:t.clientX,top:t.clientY}}function md(t,e){var n=e.x-t.clientX,r=e.y-t.clientY;return n*n+r*r<100}function vd(t,e,n,r,o){if(-1==r)return!1;for(var i=t.state.doc.resolve(r),s=function(r){if(t.someProp(e,(function(e){return r>i.depth?e(t,n,i.nodeAfter,i.before(r),o,!0):e(t,n,i.node(r),i.before(r),o,!1)})))return{v:!0}},a=i.depth+1;a>0;a--){var c=s(a);if(c)return c.v}return!1}function gd(t,e,n){t.focused||t.focus();var r=t.state.tr.setSelection(e);"pointer"==n&&r.setMeta("pointer",!0),t.dispatch(r)}function yd(t,e){if(-1==e)return!1;var n=t.state.doc.resolve(e),r=n.nodeAfter;return!!(r&&r.isAtom&&qp.isSelectable(r))&&(gd(t,new qp(n),"pointer"),!0)}function wd(t,e){if(-1==e)return!1;var n,r,o=t.state.selection;o instanceof qp&&(n=o.node);for(var i=t.state.doc.resolve(e),s=i.depth+1;s>0;s--){var a=s>i.depth?i.nodeAfter:i.node(s);if(qp.isSelectable(a)){r=n&&o.$from.depth>0&&s>=o.$from.depth&&i.before(o.$from.depth+1)==o.$from.pos?i.before(o.$from.depth):i.before(s);break}}return null!=r&&(gd(t,qp.create(t.state.doc,r),"pointer"),!0)}function xd(t,e,n,r,o){return vd(t,"handleClickOn",e,n,r)||t.someProp("handleClick",(function(n){return n(t,e,r)}))||(o?wd(t,n):yd(t,n))}function bd(t,e,n,r){return vd(t,"handleDoubleClickOn",e,n,r)||t.someProp("handleDoubleClick",(function(n){return n(t,e,r)}))}function kd(t,e,n,r){return vd(t,"handleTripleClickOn",e,n,r)||t.someProp("handleTripleClick",(function(n){return n(t,e,r)}))||Sd(t,n)}function Sd(t,e){var n=t.state.doc;if(-1==e)return!!n.inlineContent&&(gd(t,Lp.create(n,0,n.content.size),"pointer"),!0);for(var r=n.resolve(e),o=r.depth+1;o>0;o--){var i=o>r.depth?r.nodeAfter:r.node(o),s=r.before(o);if(i.inlineContent)gd(t,Lp.create(n,s+1,s+1+i.content.size),"pointer");else{if(!qp.isSelectable(i))continue;gd(t,qp.create(n,s),"pointer")}return!0}}function Od(t){return Ad(t)}sd.keydown=function(t,e){if(t.shiftKey=16==e.keyCode||e.shiftKey,!Nd(t,e))if(t.domObserver.forceFlush(),t.lastKeyCode=e.keyCode,t.lastKeyCodeTime=Date.now(),!Dl.ios||13!=e.keyCode||e.ctrlKey||e.altKey||e.metaKey)t.someProp("handleKeyDown",(function(n){return n(t,e)}))||gf(t,e)?e.preventDefault():cd(t,"key");else{var n=Date.now();t.lastIOSEnter=n,setTimeout((function(){t.lastIOSEnter==n&&(t.someProp("handleKeyDown",(function(e){return e(t,Kl(13,"Enter"))})),t.lastIOSEnter=0)}),50)}},sd.keyup=function(t,e){16==e.keyCode&&(t.shiftKey=!1)},sd.keypress=function(t,e){if(!(Nd(t,e)||!e.charCode||e.ctrlKey&&!e.altKey||Dl.mac&&e.metaKey))if(t.someProp("handleKeyPress",(function(n){return n(t,e)})))e.preventDefault();else{var n=t.state.selection;if(!(n instanceof Lp)||!n.$from.sameParent(n.$to)){var r=String.fromCharCode(e.charCode);t.someProp("handleTextInput",(function(e){return e(t,n.$from.pos,n.$to.pos,r)}))||t.dispatch(t.state.tr.insertText(r).scrollIntoView()),e.preventDefault()}}};var Cd=Dl.mac?"metaKey":"ctrlKey";id.mousedown=function(t,e){t.shiftKey=e.shiftKey;var n=Od(t),r=Date.now(),o="singleClick";r-t.lastClick.time<500&&md(e,t.lastClick)&&!e[Cd]&&("singleClick"==t.lastClick.type?o="doubleClick":"doubleClick"==t.lastClick.type&&(o="tripleClick")),t.lastClick={time:r,x:e.clientX,y:e.clientY,type:o};var i=t.posAtCoords(dd(e));i&&("singleClick"==o?t.mouseDown=new Md(t,i,e,n):("doubleClick"==o?bd:kd)(t,i.pos,i.inside,e)?e.preventDefault():cd(t,"pointer"))};var Md=function(t,e,n,r){var o,i,s=this;if(this.view=t,this.startDoc=t.state.doc,this.pos=e,this.event=n,this.flushed=r,this.selectNode=n[Cd],this.allowDefault=n.shiftKey,e.inside>-1)o=t.state.doc.nodeAt(e.inside),i=e.inside;else{var a=t.state.doc.resolve(e.pos);o=a.parent,i=a.depth?a.before():0}this.mightDrag=null;var c=r?null:n.target,h=c?t.docView.nearestDesc(c,!0):null;this.target=h?h.dom:null,(o.type.spec.draggable&&!1!==o.type.spec.selectable||t.state.selection instanceof qp&&i==t.state.selection.from)&&(this.mightDrag={node:o,pos:i,addAttr:this.target&&!this.target.draggable,setUneditable:this.target&&Dl.gecko&&!this.target.hasAttribute("contentEditable")}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout((function(){return s.target.setAttribute("contentEditable","false")}),20),this.view.domObserver.start()),t.root.addEventListener("mouseup",this.up=this.up.bind(this)),t.root.addEventListener("mousemove",this.move=this.move.bind(this)),cd(t,"pointer")};function Nd(t,e){return!!t.composing||!!(Dl.safari&&Math.abs(e.timeStamp-t.compositionEndedAt)<500)&&(t.compositionEndedAt=-2e8,!0)}Md.prototype.done=function(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.view.mouseDown=null},Md.prototype.up=function(t){if(this.done(),this.view.dom.contains(3==t.target.nodeType?t.target.parentNode:t.target)){var e=this.pos;this.view.state.doc!=this.startDoc&&(e=this.view.posAtCoords(dd(t))),this.allowDefault||!e?cd(this.view,"pointer"):xd(this.view,e.pos,e.inside,t,this.selectNode)?t.preventDefault():this.flushed||Dl.safari&&this.mightDrag&&!this.mightDrag.node.isAtom||Dl.chrome&&!(this.view.state.selection instanceof Lp)&&(e.pos==this.view.state.selection.from||e.pos==this.view.state.selection.to)?(gd(this.view,_p.near(this.view.state.doc.resolve(e.pos)),"pointer"),t.preventDefault()):cd(this.view,"pointer")}},Md.prototype.move=function(t){!this.allowDefault&&(Math.abs(this.event.x-t.clientX)>4||Math.abs(this.event.y-t.clientY)>4)&&(this.allowDefault=!0),cd(this.view,"pointer")},id.touchdown=function(t){Od(t),cd(t,"pointer")},id.contextmenu=function(t){return Od(t)};var Td=Dl.android?5e3:-1;function Ed(t,e){clearTimeout(t.composingTimeout),e>-1&&(t.composingTimeout=setTimeout((function(){return Ad(t)}),e))}function Ad(t,e){t.domObserver.forceFlush(),t.composing=!1;while(t.compositionNodes.length>0)t.compositionNodes.pop().markParentsDirty();if(e||t.docView.dirty){var n=yf(t);return n&&!n.eq(t.state.selection)?t.dispatch(t.state.tr.setSelection(n)):t.updateState(t.state),!0}return!1}function Dd(t,e){if(t.dom.parentNode){var n=t.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(e),n.style.cssText="position: fixed; left: -10000px; top: 10px";var r=getSelection(),o=document.createRange();o.selectNodeContents(e),t.dom.blur(),r.removeAllRanges(),r.addRange(o),setTimeout((function(){n.parentNode&&n.parentNode.removeChild(n),t.focus()}),50)}}sd.compositionstart=sd.compositionupdate=function(t){if(!t.composing){t.domObserver.flush();var e=t.state,n=e.selection.$from;if(e.selection.empty&&(e.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some((function(t){return!1===t.type.spec.inclusive}))))t.markCursor=t.state.storedMarks||n.marks(),Ad(t,!0),t.markCursor=null;else if(Ad(t),Dl.gecko&&e.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length)for(var r=t.root.getSelection(),o=r.focusNode,i=r.focusOffset;o&&1==o.nodeType&&0!=i;){var s=i<0?o.lastChild:o.childNodes[i-1];if(!s)break;if(3==s.nodeType){r.collapse(s,s.nodeValue.length);break}o=s,i=-1}t.composing=!0}Ed(t,Td)},sd.compositionend=function(t,e){t.composing&&(t.composing=!1,t.compositionEndedAt=e.timeStamp,Ed(t,20))};var Rd=Dl.ie&&Dl.ie_version<15||Dl.ios&&Dl.webkit_version<604;function zd(t){return 0==t.openStart&&0==t.openEnd&&1==t.content.childCount?t.content.firstChild:null}function Id(t,e){if(t.dom.parentNode){var n=t.shiftKey||t.state.selection.$from.parent.type.spec.code,r=t.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus(),setTimeout((function(){t.focus(),r.parentNode&&r.parentNode.removeChild(r),n?Pd(t,r.value,null,e):Pd(t,r.textContent,r.innerHTML,e)}),50)}}function Pd(t,e,n,r){var o=Jf(t,e,n,t.shiftKey,t.state.selection.$from);if(!t.someProp("handlePaste",(function(e){return e(t,r,o||qt.empty)}))&&o){var i=zd(o),s=i?t.state.tr.replaceSelectionWith(i,t.shiftKey):t.state.tr.replaceSelection(o);t.dispatch(s.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste"))}}id.copy=sd.cut=function(t,e){var n=t.state.selection,r="cut"==e.type;if(!n.empty){var o=Rd?null:e.clipboardData,i=n.content(),s=jf(t,i),a=s.dom,c=s.text;o?(e.preventDefault(),o.clearData(),o.setData("text/html",a.innerHTML),o.setData("text/plain",c)):Dd(t,a),r&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))}},sd.paste=function(t,e){var n=Rd?null:e.clipboardData,r=n&&n.getData("text/html"),o=n&&n.getData("text/plain");n&&(r||o||n.files.length)?(Pd(t,o,r,e),e.preventDefault()):Id(t,e)};var Fd=function(t,e){this.slice=t,this.move=e},Bd=Dl.mac?"altKey":"ctrlKey";for(var $d in id.dragstart=function(t,e){var n=t.mouseDown;if(n&&n.done(),e.dataTransfer){var r=t.state.selection,o=r.empty?null:t.posAtCoords(dd(e));if(o&&o.pos>=r.from&&o.pos<=(r instanceof qp?r.to-1:r.to));else if(n&&n.mightDrag)t.dispatch(t.state.tr.setSelection(qp.create(t.state.doc,n.mightDrag.pos)));else if(e.target&&1==e.target.nodeType){var i=t.docView.nearestDesc(e.target,!0);if(!i||!i.node.type.spec.draggable||i==t.docView)return;t.dispatch(t.state.tr.setSelection(qp.create(t.state.doc,i.posBefore)))}var s=t.state.selection.content(),a=jf(t,s),c=a.dom,h=a.text;e.dataTransfer.clearData(),e.dataTransfer.setData(Rd?"Text":"text/html",c.innerHTML),Rd||e.dataTransfer.setData("text/plain",h),t.dragging=new Fd(s,!e[Bd])}},id.dragend=function(t){window.setTimeout((function(){return t.dragging=null}),50)},sd.dragover=sd.dragenter=function(t,e){return e.preventDefault()},sd.drop=function(t,e){var n=t.dragging;if(t.dragging=null,e.dataTransfer){var r=t.posAtCoords(dd(e));if(r){var o=t.state.doc.resolve(r.pos);if(o){var i=n&&n.slice||Jf(t,e.dataTransfer.getData(Rd?"Text":"text/plain"),Rd?null:e.dataTransfer.getData("text/html"),!1,o);if(t.someProp("handleDrop",(function(r){return r(t,e,i||qt.empty,n&&n.move)})))e.preventDefault();else if(i){e.preventDefault();var s=i?zn(t.state.doc,o.pos,i):o.pos;null==s&&(s=o.pos);var a=t.state.tr;n&&n.move&&a.deleteSelection();var c=a.mapping.map(s),h=0==i.openStart&&0==i.openEnd&&1==i.content.childCount,p=a.doc;if(h?a.replaceRangeWith(c,c,i.content.firstChild):a.replaceRange(c,c,i),!a.doc.eq(p)){var l=a.doc.resolve(c);h&&qp.isSelectable(i.content.firstChild)&&l.nodeAfter&&l.nodeAfter.sameMarkup(i.content.firstChild)?a.setSelection(new qp(l)):a.setSelection(Tf(t,l,a.doc.resolve(a.mapping.map(s)))),t.focus(),t.dispatch(a.setMeta("uiEvent","drop"))}}}}}},id.focus=function(t){t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout((function(){t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.root.getSelection())&&wf(t)}),20))},id.blur=function(t){t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),t.domObserver.currentSelection.set({}),t.focused=!1)},id.beforeinput=function(t,e){if(Dl.chrome&&Dl.android&&"deleteContentBackward"==e.inputType){var n=t.domChangeCount;setTimeout((function(){if(t.domChangeCount==n&&(t.dom.blur(),t.focus(),!t.someProp("handleKeyDown",(function(e){return e(t,Kl(8,"Backspace"))})))){var e=t.state.selection,r=e.$cursor;r&&r.pos>0&&t.dispatch(t.state.tr.delete(r.pos-1,r.pos).scrollIntoView())}}),50)}},sd)id[$d]=sd[$d];function _d(t,e){if(t==e)return!0;for(var n in t)if(t[n]!==e[n])return!1;for(var r in e)if(!(r in t))return!1;return!0}var jd=function(t,e){this.spec=e||Hd,this.side=this.spec.side||0,this.toDOM=t};jd.prototype.map=function(t,e,n,r){var o=t.mapResult(e.from+r,this.side<0?-1:1),i=o.pos,s=o.deleted;return s?null:new Vd(i-n,i-n,this)},jd.prototype.valid=function(){return!0},jd.prototype.eq=function(t){return this==t||t instanceof jd&&(this.spec.key&&this.spec.key==t.spec.key||this.toDOM==t.toDOM&&_d(this.spec,t.spec))};var Jd=function(t,e){this.spec=e||Hd,this.attrs=t};Jd.prototype.map=function(t,e,n,r){var o=t.map(e.from+r,this.spec.inclusiveStart?-1:1)-n,i=t.map(e.to+r,this.spec.inclusiveEnd?1:-1)-n;return o>=i?null:new Vd(o,i,this)},Jd.prototype.valid=function(t,e){return e.from<e.to},Jd.prototype.eq=function(t){return this==t||t instanceof Jd&&_d(this.attrs,t.attrs)&&_d(this.spec,t.spec)},Jd.is=function(t){return t.type instanceof Jd};var Ld=function(t,e){this.spec=e||Hd,this.attrs=t};Ld.prototype.map=function(t,e,n,r){var o=t.mapResult(e.from+r,1);if(o.deleted)return null;var i=t.mapResult(e.to+r,-1);return i.deleted||i.pos<=o.pos?null:new Vd(o.pos-n,i.pos-n,this)},Ld.prototype.valid=function(t,e){var n=t.content.findIndex(e.from),r=n.index,o=n.offset;return o==e.from&&o+t.child(r).nodeSize==e.to},Ld.prototype.eq=function(t){return this==t||t instanceof Ld&&_d(this.attrs,t.attrs)&&_d(this.spec,t.spec)};var Vd=function(t,e,n){this.from=t,this.to=e,this.type=n},qd={spec:{configurable:!0}};Vd.prototype.copy=function(t,e){return new Vd(t,e,this.type)},Vd.prototype.eq=function(t,e){return void 0===e&&(e=0),this.type.eq(t.type)&&this.from+e==t.from&&this.to+e==t.to},Vd.prototype.map=function(t,e,n){return this.type.map(t,this,e,n)},Vd.widget=function(t,e,n){return new Vd(t,t,new jd(e,n))},Vd.inline=function(t,e,n,r){return new Vd(t,e,new Jd(n,r))},Vd.node=function(t,e,n,r){return new Vd(t,e,new Ld(n,r))},qd.spec.get=function(){return this.type.spec},Object.defineProperties(Vd.prototype,qd);var Wd=[],Hd={},Kd=function(t,e){this.local=t&&t.length?t:Wd,this.children=e&&e.length?e:Wd};Kd.create=function(t,e){return e.length?em(e,t,0,Hd):Ud},Kd.prototype.find=function(t,e,n){var r=[];return this.findInner(null==t?0:t,null==e?1e9:e,r,0,n),r},Kd.prototype.findInner=function(t,e,n,r,o){for(var i=0;i<this.local.length;i++){var s=this.local[i];s.from<=e&&s.to>=t&&(!o||o(s.spec))&&n.push(s.copy(s.from+r,s.to+r))}for(var a=0;a<this.children.length;a+=3)if(this.children[a]<e&&this.children[a+1]>t){var c=this.children[a]+1;this.children[a+2].findInner(t-c,e-c,n,r+c,o)}},Kd.prototype.map=function(t,e,n){return this==Ud||0==t.maps.length?this:this.mapInner(t,e,0,0,n||Hd)},Kd.prototype.mapInner=function(t,e,n,r,o){for(var i,s=0;s<this.local.length;s++){var a=this.local[s].map(t,n,r);a&&a.type.valid(e,a)?(i||(i=[])).push(a):o.onRemove&&o.onRemove(this.local[s].spec)}return this.children.length?Xd(this.children,i,t,e,n,r,o):i?new Kd(i.sort(nm)):Ud},Kd.prototype.add=function(t,e){return e.length?this==Ud?Kd.create(t,e):this.addInner(t,e,0):this},Kd.prototype.addInner=function(t,e,n){var r,o=this,i=0;t.forEach((function(t,s){var a,c=s+n;if(a=Qd(e,t,c)){r||(r=o.children.slice());while(i<r.length&&r[i]<s)i+=3;r[i]==s?r[i+2]=r[i+2].addInner(t,a,c+1):r.splice(i,0,s,s+t.nodeSize,em(a,t,c+1,Hd)),i+=3}}));var s=Yd(i?tm(e):e,-n);return new Kd(s.length?this.local.concat(s).sort(nm):this.local,r||this.children)},Kd.prototype.remove=function(t){return 0==t.length||this==Ud?this:this.removeInner(t,0)},Kd.prototype.removeInner=function(t,e){for(var n=this.children,r=this.local,o=0;o<n.length;o+=3){for(var i=void 0,s=n[o]+e,a=n[o+1]+e,c=0,h=void 0;c<t.length;c++)(h=t[c])&&h.from>s&&h.to<a&&(t[c]=null,(i||(i=[])).push(h));if(i){n==this.children&&(n=this.children.slice());var p=n[o+2].removeInner(i,s+1);p!=Ud?n[o+2]=p:(n.splice(o,3),o-=3)}}if(r.length)for(var l=0,u=void 0;l<t.length;l++)if(u=t[l])for(var f=0;f<r.length;f++)r[f].eq(u,e)&&(r==this.local&&(r=this.local.slice()),r.splice(f--,1));return n==this.children&&r==this.local?this:r.length||n.length?new Kd(r,n):Ud},Kd.prototype.forChild=function(t,e){if(this==Ud)return this;if(e.isLeaf)return Kd.empty;for(var n,r,o=0;o<this.children.length;o+=3)if(this.children[o]>=t){this.children[o]==t&&(n=this.children[o+2]);break}for(var i=t+1,s=i+e.content.size,a=0;a<this.local.length;a++){var c=this.local[a];if(c.from<s&&c.to>i&&c.type instanceof Jd){var h=Math.max(i,c.from)-i,p=Math.min(s,c.to)-i;h<p&&(r||(r=[])).push(c.copy(h,p))}}if(r){var l=new Kd(r.sort(nm));return n?new Gd([l,n]):l}return n||Ud},Kd.prototype.eq=function(t){if(this==t)return!0;if(!(t instanceof Kd)||this.local.length!=t.local.length||this.children.length!=t.children.length)return!1;for(var e=0;e<this.local.length;e++)if(!this.local[e].eq(t.local[e]))return!1;for(var n=0;n<this.children.length;n+=3)if(this.children[n]!=t.children[n]||this.children[n+1]!=t.children[n+1]||!this.children[n+2].eq(t.children[n+2]))return!1;return!0},Kd.prototype.locals=function(t){return rm(this.localsInner(t))},Kd.prototype.localsInner=function(t){if(this==Ud)return Wd;if(t.inlineContent||!this.local.some(Jd.is))return this.local;for(var e=[],n=0;n<this.local.length;n++)this.local[n].type instanceof Jd||e.push(this.local[n]);return e};var Ud=new Kd;Kd.empty=Ud,Kd.removeOverlap=rm;var Gd=function(t){this.members=t};function Xd(t,e,n,r,o,i,s){for(var a=t.slice(),c=function(t,e,n,r){for(var s=0;s<a.length;s+=3){var c=a[s+1],h=void 0;-1==c||t>c+i||(e>=a[s]+i?a[s+1]=-1:n>=o&&(h=r-n-(e-t))&&(a[s]+=h,a[s+1]+=h))}},h=0;h<n.maps.length;h++)n.maps[h].forEach(c);for(var p=!1,l=0;l<a.length;l+=3)if(-1==a[l+1]){var u=n.map(a[l]+i),f=u-o;if(f<0||f>=r.content.size){p=!0;continue}var d=n.map(t[l+1]+i,-1),m=d-o,v=r.content.findIndex(f),g=v.index,y=v.offset,w=r.maybeChild(g);if(w&&y==f&&y+w.nodeSize==m){var x=a[l+2].mapInner(n,w,u+1,a[l]+i+1,s);x!=Ud?(a[l]=f,a[l+1]=m,a[l+2]=x):(a[l+1]=-2,p=!0)}else p=!0}if(p){var b=Zd(a,t,e||[],n,o,i,s),k=em(b,r,0,s);e=k.local;for(var S=0;S<a.length;S+=3)a[S+1]<0&&(a.splice(S,3),S-=3);for(var O=0,C=0;O<k.children.length;O+=3){var M=k.children[O];while(C<a.length&&a[C]<M)C+=3;a.splice(C,0,k.children[O],k.children[O+1],k.children[O+2])}}return new Kd(e&&e.sort(nm),a)}function Yd(t,e){if(!e||!t.length)return t;for(var n=[],r=0;r<t.length;r++){var o=t[r];n.push(new Vd(o.from+e,o.to+e,o.type))}return n}function Zd(t,e,n,r,o,i,s){function a(t,e){for(var i=0;i<t.local.length;i++){var c=t.local[i].map(r,o,e);c?n.push(c):s.onRemove&&s.onRemove(t.local[i].spec)}for(var h=0;h<t.children.length;h+=3)a(t.children[h+2],t.children[h]+e+1)}for(var c=0;c<t.length;c+=3)-1==t[c+1]&&a(t[c+2],e[c]+i+1);return n}function Qd(t,e,n){if(e.isLeaf)return null;for(var r=n+e.nodeSize,o=null,i=0,s=void 0;i<t.length;i++)(s=t[i])&&s.from>n&&s.to<r&&((o||(o=[])).push(s),t[i]=null);return o}function tm(t){for(var e=[],n=0;n<t.length;n++)null!=t[n]&&e.push(t[n]);return e}function em(t,e,n,r){var o=[],i=!1;e.forEach((function(e,s){var a=Qd(t,e,s+n);if(a){i=!0;var c=em(a,e,n+s+1,r);c!=Ud&&o.push(s,s+e.nodeSize,c)}}));for(var s=Yd(i?tm(t):t,-n).sort(nm),a=0;a<s.length;a++)s[a].type.valid(e,s[a])||(r.onRemove&&r.onRemove(s[a].spec),s.splice(a--,1));return s.length||o.length?new Kd(s,o):Ud}function nm(t,e){return t.from-e.from||t.to-e.to}function rm(t){for(var e=t,n=0;n<e.length-1;n++){var r=e[n];if(r.from!=r.to)for(var o=n+1;o<e.length;o++){var i=e[o];if(i.from!=r.from){i.from<r.to&&(e==t&&(e=t.slice()),e[n]=r.copy(r.from,i.from),om(e,o,r.copy(i.from,r.to)));break}i.to!=r.to&&(e==t&&(e=t.slice()),e[o]=i.copy(i.from,r.to),om(e,o+1,i.copy(r.to,i.to)))}}return e}function om(t,e,n){while(e<t.length&&nm(n,t[e])>0)e++;t.splice(e,0,n)}function im(t){var e=[];return t.someProp("decorations",(function(n){var r=n(t.state);r&&r!=Ud&&e.push(r)})),t.cursorWrapper&&e.push(Kd.create(t.state.doc,[t.cursorWrapper.deco])),Gd.from(e)}Gd.prototype.forChild=function(t,e){if(e.isLeaf)return Kd.empty;for(var n=[],r=0;r<this.members.length;r++){var o=this.members[r].forChild(t,e);o!=Ud&&(o instanceof Gd?n=n.concat(o.members):n.push(o))}return Gd.from(n)},Gd.prototype.eq=function(t){if(!(t instanceof Gd)||t.members.length!=this.members.length)return!1;for(var e=0;e<this.members.length;e++)if(!this.members[e].eq(t.members[e]))return!1;return!0},Gd.prototype.locals=function(t){for(var e,n=!0,r=0;r<this.members.length;r++){var o=this.members[r].localsInner(t);if(o.length)if(e){n&&(e=e.slice(),n=!1);for(var i=0;i<o.length;i++)e.push(o[i])}else e=o}return e?rm(n?e:e.sort(nm)):Wd},Gd.from=function(t){switch(t.length){case 0:return Ud;case 1:return t[0];default:return new Gd(t)}};var sm=function(t,e){this._props=e,this.state=e.state,this.dispatch=this.dispatch.bind(this),this._root=null,this.focused=!1,this.dom=t&&t.mount||document.createElement("div"),t&&(t.appendChild?t.appendChild(this.dom):t.apply?t(this.dom):t.mount&&(this.mounted=!0)),this.editable=pm(this),this.markCursor=null,this.cursorWrapper=null,hm(this),this.nodeViews=um(this),this.docView=Pu(this.state.doc,cm(this),im(this),this.dom,this),this.lastSelectedViewDesc=null,this.dragging=null,ad(this),this.pluginViews=[],this.updatePluginViews()},am={props:{configurable:!0},root:{configurable:!0}};function cm(t){var e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(t.editable),t.someProp("attributes",(function(n){if("function"==typeof n&&(n=n(t.state)),n)for(var r in n)"class"==r?e.class+=" "+n[r]:e[r]||"contenteditable"==r||"nodeName"==r||(e[r]=String(n[r]))})),[Vd.node(0,t.state.doc.content.size,e)]}function hm(t){if(t.markCursor){var e=document.createElement("img");e.setAttribute("mark-placeholder","true"),t.cursorWrapper={dom:e,deco:Vd.widget(t.state.selection.head,e,{raw:!0,marks:t.markCursor})}}else t.cursorWrapper=null}function pm(t){return!t.someProp("editable",(function(e){return!1===e(t.state)}))}function lm(t,e){var n=Math.min(t.$anchor.sharedDepth(t.head),e.$anchor.sharedDepth(e.head));return t.$anchor.start(n)!=e.$anchor.start(n)}function um(t){var e={};return t.someProp("nodeViews",(function(t){for(var n in t)Object.prototype.hasOwnProperty.call(e,n)||(e[n]=t[n])})),e}function fm(t,e){var n=0,r=0;for(var o in t){if(t[o]!=e[o])return!0;n++}for(var i in e)r++;return n!=r}function dm(t){var e=t.getSelection(),n=e.focusOffset,r=e.focusNode;return r&&1==r.nodeType?[r,n,r.childNodes[n-1],r.childNodes[n]]:null}function mm(t,e){var n=dm(e);if(!n||3==n[0].nodeType)return!1;for(var r=0;r<t.length;r++)if(n[r]!=t[r])return!0;return!1}am.props.get=function(){if(this._props.state!=this.state){var t=this._props;for(var e in this._props={},t)this._props[e]=t[e];this._props.state=this.state}return this._props},sm.prototype.update=function(t){t.handleDOMEvents!=this._props.handleDOMEvents&&pd(this),this._props=t,this.updateStateInner(t.state,!0)},sm.prototype.setProps=function(t){var e={};for(var n in this._props)e[n]=this._props[n];for(var r in e.state=this.state,t)e[r]=t[r];this.update(e)},sm.prototype.updateState=function(t){this.updateStateInner(t,this.state.plugins!=t.plugins)},sm.prototype.updateStateInner=function(t,e){var n=this,r=this.state,o=!1;if(this.state=t,e){var i=um(this);fm(i,this.nodeViews)&&(this.nodeViews=i,o=!0),pd(this)}this.editable=pm(this),hm(this);var s=im(this),a=cm(this),c=e?"reset":t.scrollToSelection>r.scrollToSelection?"to selection":"preserve",h=o||!this.docView.matchesNode(t.doc,a,s),p=h||!t.selection.eq(r.selection),l="preserve"==c&&p&&null==this.dom.style.overflowAnchor&&Zl(this);if(p){this.domObserver.stop();var u=h&&(Dl.ie||Dl.chrome)&&!this.composing&&!r.selection.empty&&!t.selection.empty&&lm(r.selection,t.selection);if(h){var f=Dl.chrome&&dm(this.root);!o&&this.docView.update(t.doc,a,s,this)||(this.docView.updateOuterDeco([]),this.docView.destroy(),this.docView=Pu(t.doc,a,s,this.dom,this)),f&&mm(f,this.root)&&(u=!0)}u||!(this.mouseDown&&this.domObserver.currentSelection.eq(this.root.getSelection())&&Df(this))?wf(this,u):(Mf(this,t.selection),this.domObserver.setCurSelection()),this.domObserver.start()}if(this.updatePluginViews(r),"reset"==c)this.dom.scrollTop=0;else if("to selection"==c){var d=this.root.getSelection().focusNode;this.someProp("handleScrollToSelection",(function(t){return t(n)}))||(t.selection instanceof qp?Yl(this,this.docView.domAfterPos(t.selection.from).getBoundingClientRect(),d):Yl(this,this.coordsAtPos(t.selection.head),d))}else l&&tu(l)},sm.prototype.destroyPluginViews=function(){var t;while(t=this.pluginViews.pop())t.destroy&&t.destroy()},sm.prototype.updatePluginViews=function(t){if(t&&t.plugins==this.state.plugins)for(var e=0;e<this.pluginViews.length;e++){var n=this.pluginViews[e];n.update&&n.update(this,t)}else{this.destroyPluginViews();for(var r=0;r<this.state.plugins.length;r++){var o=this.state.plugins[r];o.spec.view&&this.pluginViews.push(o.spec.view(this))}}},sm.prototype.someProp=function(t,e){var n,r=this._props&&this._props[t];if(null!=r&&(n=e?e(r):r))return n;var o=this.state.plugins;if(o)for(var i=0;i<o.length;i++){var s=o[i].props[t];if(null!=s&&(n=e?e(s):s))return n}},sm.prototype.hasFocus=function(){return this.root.activeElement==this.dom},sm.prototype.focus=function(){this.domObserver.stop(),this.editable&&ru(this.dom),wf(this),this.domObserver.start()},am.root.get=function(){var t=this._root;if(null==t)for(var e=this.dom.parentNode;e;e=e.parentNode)if(9==e.nodeType||11==e.nodeType&&e.host)return e.getSelection||(Object.getPrototypeOf(e).getSelection=function(){return document.getSelection()}),this._root=e;return t||document},sm.prototype.posAtCoords=function(t){return lu(this,t)},sm.prototype.coordsAtPos=function(t){return fu(this,t)},sm.prototype.domAtPos=function(t){return this.docView.domFromPos(t)},sm.prototype.nodeDOM=function(t){var e=this.docView.descAt(t);return e?e.nodeDOM:null},sm.prototype.posAtDOM=function(t,e,n){void 0===n&&(n=-1);var r=this.docView.posFromDOM(t,e,n);if(null==r)throw new RangeError("DOM position not inside the editor");return r},sm.prototype.endOfTextblock=function(t,e){return Su(this,e||this.state,t)},sm.prototype.destroy=function(){this.docView&&(hd(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],im(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null)},sm.prototype.dispatchEvent=function(t){return fd(this,t)},sm.prototype.dispatch=function(t){var e=this._props.dispatchTransaction;e?e.call(this,t):this.updateState(this.state.apply(t))},Object.defineProperties(sm.prototype,am);var vm=function(t){function e(e){t.call(this,e,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.map=function(n,r){var o=n.resolve(r.map(this.head));return e.valid(o)?new e(o):t.near(o)},e.prototype.content=function(){return qt.empty},e.prototype.eq=function(t){return t instanceof e&&t.head==this.head},e.prototype.toJSON=function(){return{type:"gapcursor",pos:this.head}},e.fromJSON=function(t,n){if("number"!=typeof n.pos)throw new RangeError("Invalid input for GapCursor.fromJSON");return new e(t.resolve(n.pos))},e.prototype.getBookmark=function(){return new gm(this.anchor)},e.valid=function(t){var e=t.parent;if(e.isTextblock||!ym(t)||!wm(t))return!1;var n=e.type.spec.allowGapCursor;if(null!=n)return n;var r=e.contentMatchAt(t.index()).defaultType;return r&&r.isTextblock},e.findFrom=function(t,n,r){t:for(;;){if(!r&&e.valid(t))return t;for(var o=t.pos,i=null,s=t.depth;;s--){var a=t.node(s);if(n>0?t.indexAfter(s)<a.childCount:t.index(s)>0){i=a.child(n>0?t.indexAfter(s):t.index(s)-1);break}if(0==s)return null;o+=n;var c=t.doc.resolve(o);if(e.valid(c))return c}for(;;){var h=n>0?i.firstChild:i.lastChild;if(!h){if(i.isAtom&&!i.isText&&!qp.isSelectable(i)){t=t.doc.resolve(o+i.nodeSize*n),r=!1;continue t}break}i=h,o+=n;var p=t.doc.resolve(o);if(e.valid(p))return p}return null}},e}(_p);vm.prototype.visible=!1,_p.jsonID("gapcursor",vm);var gm=function(t){this.pos=t};function ym(t){for(var e=t.depth;e>=0;e--){var n=t.index(e);if(0!=n)for(var r=t.node(e).child(n-1);;r=r.lastChild){if(0==r.childCount&&!r.inlineContent||r.isAtom||r.type.spec.isolating)return!0;if(r.inlineContent)return!1}}return!0}function wm(t){for(var e=t.depth;e>=0;e--){var n=t.indexAfter(e),r=t.node(e);if(n!=r.childCount)for(var o=r.child(n);;o=o.firstChild){if(0==o.childCount&&!o.inlineContent||o.isAtom||o.type.spec.isolating)return!0;if(o.inlineContent)return!1}}return!0}gm.prototype.map=function(t){return new gm(t.map(this.pos))},gm.prototype.resolve=function(t){var e=t.resolve(this.pos);return vm.valid(e)?new vm(e):_p.near(e)};var xm=function(){return new cl({props:{decorations:Om,createSelectionBetween:function(t,e,n){if(e.pos==n.pos&&vm.valid(n))return new vm(n)},handleClick:Sm,handleKeyDown:bm}})},bm=Al({ArrowLeft:km("horiz",-1),ArrowRight:km("horiz",1),ArrowUp:km("vert",-1),ArrowDown:km("vert",1)});function km(t,e){var n="vert"==t?e>0?"down":"up":e>0?"right":"left";return function(t,r,o){var i=t.selection,s=e>0?i.$to:i.$from,a=i.empty;if(i instanceof Lp){if(!o.endOfTextblock(n)||0==s.depth)return!1;a=!1,s=t.doc.resolve(e>0?s.after():s.before())}var c=vm.findFrom(s,e,a);return!!c&&(r&&r(t.tr.setSelection(new vm(c))),!0)}}function Sm(t,e,n){if(!t.editable)return!1;var r=t.state.doc.resolve(e);if(!vm.valid(r))return!1;var o=t.posAtCoords({left:n.clientX,top:n.clientY}),i=o.inside;return!(i>-1&&qp.isSelectable(t.state.doc.nodeAt(i)))&&(t.dispatch(t.state.tr.setSelection(new vm(r))),!0)}function Om(t){if(!(t.selection instanceof vm))return null;var e=document.createElement("div");return e.className="ProseMirror-gapcursor",Kd.create(t.doc,[Vd.widget(t.selection.head,e,{key:"gapcursor"})])}function Cm(t,e){return!t.selection.empty&&(e&&e(t.tr.deleteSelection().scrollIntoView()),!0)}function Mm(t,e,n){var r=t.selection,o=r.$cursor;if(!o||(n?!n.endOfTextblock("backward",t):o.parentOffset>0))return!1;var i=Em(o);if(!i){var s=o.blockRange(),a=s&&Nn(s);return null!=a&&(e&&e(t.tr.lift(s,a).scrollIntoView()),!0)}var c=i.nodeBefore;if(!c.type.spec.isolating&&Jm(t,i,e))return!0;if(0==o.parent.content.size&&(Nm(c,"end")||qp.isSelectable(c))){if(e){var h=t.tr.deleteRange(o.before(),o.after());h.setSelection(Nm(c,"end")?_p.findFrom(h.doc.resolve(h.mapping.map(i.pos,-1)),-1):qp.create(h.doc,i.pos-c.nodeSize)),e(h.scrollIntoView())}return!0}return!(!c.isAtom||i.depth!=o.depth-1)&&(e&&e(t.tr.delete(i.pos-c.nodeSize,i.pos).scrollIntoView()),!0)}function Nm(t,e){for(;t;t="start"==e?t.firstChild:t.lastChild)if(t.isTextblock)return!0;return!1}function Tm(t,e,n){var r=t.selection,o=r.$head,i=r.empty,s=o;if(!i)return!1;if(o.parent.isTextblock){if(n?!n.endOfTextblock("backward",t):o.parentOffset>0)return!1;s=Em(o)}var a=s&&s.nodeBefore;return!(!a||!qp.isSelectable(a))&&(e&&e(t.tr.setSelection(qp.create(t.doc,s.pos-a.nodeSize)).scrollIntoView()),!0)}function Em(t){if(!t.parent.type.spec.isolating)for(var e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}function Am(t,e,n){var r=t.selection,o=r.$cursor;if(!o||(n?!n.endOfTextblock("forward",t):o.parentOffset<o.parent.content.size))return!1;var i=Rm(o);if(!i)return!1;var s=i.nodeAfter;if(Jm(t,i,e))return!0;if(0==o.parent.content.size&&(Nm(s,"start")||qp.isSelectable(s))){if(e){var a=t.tr.deleteRange(o.before(),o.after());a.setSelection(Nm(s,"start")?_p.findFrom(a.doc.resolve(a.mapping.map(i.pos)),1):qp.create(a.doc,a.mapping.map(i.pos))),e(a.scrollIntoView())}return!0}return!(!s.isAtom||i.depth!=o.depth-1)&&(e&&e(t.tr.delete(i.pos,i.pos+s.nodeSize).scrollIntoView()),!0)}function Dm(t,e,n){var r=t.selection,o=r.$head,i=r.empty,s=o;if(!i)return!1;if(o.parent.isTextblock){if(n?!n.endOfTextblock("forward",t):o.parentOffset<o.parent.content.size)return!1;s=Rm(o)}var a=s&&s.nodeAfter;return!(!a||!qp.isSelectable(a))&&(e&&e(t.tr.setSelection(qp.create(t.doc,s.pos)).scrollIntoView()),!0)}function Rm(t){if(!t.parent.type.spec.isolating)for(var e=t.depth-1;e>=0;e--){var n=t.node(e);if(t.index(e)+1<n.childCount)return t.doc.resolve(t.after(e+1));if(n.type.spec.isolating)break}return null}function zm(t,e){var n=t.selection,r=n.$head,o=n.$anchor;return!(!r.parent.type.spec.code||!r.sameParent(o))&&(e&&e(t.tr.insertText("\n").scrollIntoView()),!0)}function Im(t){for(var e=0;e<t.edgeCount;e++){var n=t.edge(e),r=n.type;if(r.isTextblock&&!r.hasRequiredAttrs())return r}return null}function Pm(t,e){var n=t.selection,r=n.$head,o=n.$anchor;if(!r.parent.type.spec.code||!r.sameParent(o))return!1;var i=r.node(-1),s=r.indexAfter(-1),a=Im(i.contentMatchAt(s));if(!i.canReplaceWith(s,s,a))return!1;if(e){var c=r.after(),h=t.tr.replaceWith(c,c,a.createAndFill());h.setSelection(_p.near(h.doc.resolve(c),1)),e(h.scrollIntoView())}return!0}function Fm(t,e){var n=t.selection,r=n.$from,o=n.$to;if(n instanceof Hp||r.parent.inlineContent||o.parent.inlineContent)return!1;var i=Im(o.parent.contentMatchAt(o.indexAfter()));if(!i||!i.isTextblock)return!1;if(e){var s=(!r.parentOffset&&o.index()<o.parent.childCount?r:o).pos,a=t.tr.insert(s,i.createAndFill());a.setSelection(Lp.create(a.doc,s+1)),e(a.scrollIntoView())}return!0}function Bm(t,e){var n=t.selection,r=n.$cursor;if(!r||r.parent.content.size)return!1;if(r.depth>1&&r.after()!=r.end(-1)){var o=r.before();if(En(t.doc,o))return e&&e(t.tr.split(o).scrollIntoView()),!0}var i=r.blockRange(),s=i&&Nn(i);return null!=s&&(e&&e(t.tr.lift(i,s).scrollIntoView()),!0)}function $m(t,e){var n=t.selection,r=n.$from,o=n.$to;if(t.selection instanceof qp&&t.selection.node.isBlock)return!(!r.parentOffset||!En(t.doc,r.pos))&&(e&&e(t.tr.split(r.pos).scrollIntoView()),!0);if(!r.parent.isBlock)return!1;if(e){var i=o.parentOffset==o.parent.content.size,s=t.tr;(t.selection instanceof Lp||t.selection instanceof Hp)&&s.deleteSelection();var a=0==r.depth?null:Im(r.node(-1).contentMatchAt(r.indexAfter(-1))),c=i&&a?[{type:a}]:null,h=En(s.doc,s.mapping.map(r.pos),1,c);if(c||h||!En(s.doc,s.mapping.map(r.pos),1,a&&[{type:a}])||(c=[{type:a}],h=!0),h&&(s.split(s.mapping.map(r.pos),1,c),!i&&!r.parentOffset&&r.parent.type!=a)){var p=s.mapping.map(r.before()),l=s.doc.resolve(p);r.parent.canReplaceWith(l.index(),l.index()+1,a)&&s.setNodeMarkup(s.mapping.map(r.before()),a)}e(s.scrollIntoView())}return!0}function _m(t,e){return e&&e(t.tr.setSelection(new Hp(t.doc))),!0}function jm(t,e,n){var r=e.nodeBefore,o=e.nodeAfter,i=e.index();return!!(r&&o&&r.type.compatibleContent(o.type))&&(!r.content.size&&e.parent.canReplace(i-1,i)?(n&&n(t.tr.delete(e.pos-r.nodeSize,e.pos).scrollIntoView()),!0):!(!e.parent.canReplace(i,i+1)||!o.isTextblock&&!An(t.doc,e.pos))&&(n&&n(t.tr.clearIncompatible(e.pos,r.type,r.contentMatchAt(r.childCount)).join(e.pos).scrollIntoView()),!0))}function Jm(t,e,n){var r,o,i=e.nodeBefore,s=e.nodeAfter;if(i.type.spec.isolating||s.type.spec.isolating)return!1;if(jm(t,e,n))return!0;var a=e.parent.canReplace(e.index(),e.index()+1);if(a&&(r=(o=i.contentMatchAt(i.childCount)).findWrapping(s.type))&&o.matchType(r[0]||s.type).validEnd){if(n){for(var c=e.pos+s.nodeSize,h=Bt.empty,p=r.length-1;p>=0;p--)h=Bt.from(r[p].create(null,h));h=Bt.from(i.copy(h));var l=t.tr.step(new On(e.pos-1,c,e.pos,c,new qt(h,1,0),r.length,!0)),u=c+2*r.length;An(l.doc,u)&&l.join(u),n(l.scrollIntoView())}return!0}var f=_p.findFrom(e,1),d=f&&f.$from.blockRange(f.$to),m=d&&Nn(d);if(null!=m&&m>=e.depth)return n&&n(t.tr.lift(d,m).scrollIntoView()),!0;if(a&&s.isTextblock&&Nm(i,"end")){for(var v=i,g=[];;){if(g.push(v),v.isTextblock)break;v=v.lastChild}if(v.canReplace(v.childCount,v.childCount,s.content)){if(n){for(var y=Bt.empty,w=g.length-1;w>=0;w--)y=Bt.from(g[w].copy(y));var x=t.tr.step(new On(e.pos-g.length,e.pos+s.nodeSize,e.pos+1,e.pos+s.nodeSize-1,new qt(y,g.length,0),0,!0));n(x.scrollIntoView())}return!0}}return!1}function Lm(){var t=[],e=arguments.length;while(e--)t[e]=arguments[e];return function(e,n,r){for(var o=0;o<t.length;o++)if(t[o](e,n,r))return!0;return!1}}var Vm=Lm(Cm,Mm,Tm),qm=Lm(Cm,Am,Dm),Wm={Enter:Lm(zm,Fm,Bm,$m),"Mod-Enter":Pm,Backspace:Vm,"Mod-Backspace":Vm,Delete:qm,"Mod-Delete":qm,"Mod-a":_m},Hm={"Ctrl-h":Wm["Backspace"],"Alt-Backspace":Wm["Mod-Backspace"],"Ctrl-d":Wm["Delete"],"Ctrl-Alt-Backspace":Wm["Mod-Delete"],"Alt-Delete":Wm["Mod-Delete"],"Alt-d":Wm["Mod-Delete"]};for(var Km in Wm)Hm[Km]=Wm[Km];var Um="undefined"!=typeof navigator?/Mac/.test(navigator.platform):"undefined"!=typeof os&&"darwin"==os.platform(),Gm=Um?Hm:Wm,Xm=function(t,e){this.match=t,this.handler="string"==typeof e?Ym(e):e};function Ym(t){return function(e,n,r,o){var i=t;if(n[1]){var s=n[0].lastIndexOf(n[1]);i+=n[0].slice(s+n[1].length),r+=s;var a=r-o;a>0&&(i=n[0].slice(s-a,s)+i,r=o)}return e.tr.insertText(i,r,o)}}var Zm=500;function Qm(t){var e=t.rules,n=new cl({state:{init:function(){return null},apply:function(t,e){var n=t.getMeta(this);return n||(t.selectionSet||t.docChanged?null:e)}},props:{handleTextInput:function(t,r,o,i){return tv(t,r,o,i,e,n)},handleDOMEvents:{compositionend:function(t){setTimeout((function(){var r=t.state.selection,o=r.$cursor;o&&tv(t,o.pos,o.pos,"",e,n)}))}}},isInputRules:!0});return n}function tv(t,e,n,r,o,i){if(t.composing)return!1;var s=t.state,a=s.doc.resolve(e);if(a.parent.type.spec.code)return!1;for(var c=a.parent.textBetween(Math.max(0,a.parentOffset-Zm),a.parentOffset,null,"")+r,h=0;h<o.length;h++){var p=o[h].match.exec(c),l=p&&o[h].handler(s,p,e-(p[0].length-r.length),n);if(l)return t.dispatch(l.setMeta(i,{transform:l,from:e,to:n,text:r})),!0}return!1}function ev(t,e){for(var n=t.plugins,r=0;r<n.length;r++){var o=n[r],i=void 0;if(o.spec.isInputRules&&(i=o.getState(t))){if(e){for(var s=t.tr,a=i.transform,c=a.steps.length-1;c>=0;c--)s.step(a.steps[c].invert(a.docs[c]));if(i.text){var h=s.doc.resolve(i.from).marks();s.replaceWith(i.from,i.to,t.schema.text(i.text,h))}else s.delete(i.from,i.to);e(s)}return!0}}return!1}new Xm(/--$/,""),new Xm(/\.\.\.$/,""),new Xm(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(")$/,""),new Xm(/"$/,""),new Xm(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(')$/,""),new Xm(/'$/,"");function nv(t,e,n){for(var r=0;;r++){if(r==t.childCount||r==e.childCount)return t.childCount==e.childCount?null:n;var o=t.child(r),i=e.child(r);if(o!=i){if(!o.sameMarkup(i))return n;if(o.isText&&o.text!=i.text){for(var s=0;o.text[s]==i.text[s];s++)n++;return n}if(o.content.size||i.content.size){var a=nv(o.content,i.content,n+1);if(null!=a)return a}n+=o.nodeSize}else n+=o.nodeSize}}function rv(t,e,n,r){for(var o=t.childCount,i=e.childCount;;){if(0==o||0==i)return o==i?null:{a:n,b:r};var s=t.child(--o),a=e.child(--i),c=s.nodeSize;if(s!=a){if(!s.sameMarkup(a))return{a:n,b:r};if(s.isText&&s.text!=a.text){var h=0,p=Math.min(s.text.length,a.text.length);while(h<p&&s.text[s.text.length-h-1]==a.text[a.text.length-h-1])h++,n--,r--;return{a:n,b:r}}if(s.content.size||a.content.size){var l=rv(s.content,a.content,n-1,r-1);if(l)return l}n-=c,r-=c}else n-=c,r-=c}}var ov=function(t,e){if(this.content=t,this.size=e||0,null==e)for(var n=0;n<t.length;n++)this.size+=t[n].nodeSize},iv={firstChild:{configurable:!0},lastChild:{configurable:!0},childCount:{configurable:!0}};ov.prototype.nodesBetween=function(t,e,n,r,o){void 0===r&&(r=0);for(var i=0,s=0;s<e;i++){var a=this.content[i],c=s+a.nodeSize;if(c>t&&!1!==n(a,r+s,o,i)&&a.content.size){var h=s+1;a.nodesBetween(Math.max(0,t-h),Math.min(a.content.size,e-h),n,r+h)}s=c}},ov.prototype.descendants=function(t){this.nodesBetween(0,this.size,t)},ov.prototype.textBetween=function(t,e,n,r){var o="",i=!0;return this.nodesBetween(t,e,(function(s,a){s.isText?(o+=s.text.slice(Math.max(t,a)-a,e-a),i=!n):s.isLeaf&&r?(o+=r,i=!n):!i&&s.isBlock&&(o+=n,i=!0)}),0),o},ov.prototype.append=function(t){if(!t.size)return this;if(!this.size)return t;var e=this.lastChild,n=t.firstChild,r=this.content.slice(),o=0;for(e.isText&&e.sameMarkup(n)&&(r[r.length-1]=e.withText(e.text+n.text),o=1);o<t.content.length;o++)r.push(t.content[o]);return new ov(r,this.size+t.size)},ov.prototype.cut=function(t,e){if(null==e&&(e=this.size),0==t&&e==this.size)return this;var n=[],r=0;if(e>t)for(var o=0,i=0;i<e;o++){var s=this.content[o],a=i+s.nodeSize;a>t&&((i<t||a>e)&&(s=s.isText?s.cut(Math.max(0,t-i),Math.min(s.text.length,e-i)):s.cut(Math.max(0,t-i-1),Math.min(s.content.size,e-i-1))),n.push(s),r+=s.nodeSize),i=a}return new ov(n,r)},ov.prototype.cutByIndex=function(t,e){return t==e?ov.empty:0==t&&e==this.content.length?this:new ov(this.content.slice(t,e))},ov.prototype.replaceChild=function(t,e){var n=this.content[t];if(n==e)return this;var r=this.content.slice(),o=this.size+e.nodeSize-n.nodeSize;return r[t]=e,new ov(r,o)},ov.prototype.addToStart=function(t){return new ov([t].concat(this.content),this.size+t.nodeSize)},ov.prototype.addToEnd=function(t){return new ov(this.content.concat(t),this.size+t.nodeSize)},ov.prototype.eq=function(t){if(this.content.length!=t.content.length)return!1;for(var e=0;e<this.content.length;e++)if(!this.content[e].eq(t.content[e]))return!1;return!0},iv.firstChild.get=function(){return this.content.length?this.content[0]:null},iv.lastChild.get=function(){return this.content.length?this.content[this.content.length-1]:null},iv.childCount.get=function(){return this.content.length},ov.prototype.child=function(t){var e=this.content[t];if(!e)throw new RangeError("Index "+t+" out of range for "+this);return e},ov.prototype.maybeChild=function(t){return this.content[t]},ov.prototype.forEach=function(t){for(var e=0,n=0;e<this.content.length;e++){var r=this.content[e];t(r,n,e),n+=r.nodeSize}},ov.prototype.findDiffStart=function(t,e){return void 0===e&&(e=0),nv(this,t,e)},ov.prototype.findDiffEnd=function(t,e,n){return void 0===e&&(e=this.size),void 0===n&&(n=t.size),rv(this,t,e,n)},ov.prototype.findIndex=function(t,e){if(void 0===e&&(e=-1),0==t)return av(0,t);if(t==this.size)return av(this.content.length,t);if(t>this.size||t<0)throw new RangeError("Position "+t+" outside of fragment ("+this+")");for(var n=0,r=0;;n++){var o=this.child(n),i=r+o.nodeSize;if(i>=t)return i==t||e>0?av(n+1,i):av(n,r);r=i}},ov.prototype.toString=function(){return"<"+this.toStringInner()+">"},ov.prototype.toStringInner=function(){return this.content.join(", ")},ov.prototype.toJSON=function(){return this.content.length?this.content.map((function(t){return t.toJSON()})):null},ov.fromJSON=function(t,e){if(!e)return ov.empty;if(!Array.isArray(e))throw new RangeError("Invalid input for Fragment.fromJSON");return new ov(e.map(t.nodeFromJSON))},ov.fromArray=function(t){if(!t.length)return ov.empty;for(var e,n=0,r=0;r<t.length;r++){var o=t[r];n+=o.nodeSize,r&&o.isText&&t[r-1].sameMarkup(o)?(e||(e=t.slice(0,r)),e[e.length-1]=o.withText(e[e.length-1].text+o.text)):e&&e.push(o)}return new ov(e||t,n)},ov.from=function(t){if(!t)return ov.empty;if(t instanceof ov)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new ov([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))},Object.defineProperties(ov.prototype,iv);var sv={index:0,offset:0};function av(t,e){return sv.index=t,sv.offset=e,sv}function cv(t,e){if(t===e)return!0;if(!t||"object"!=typeof t||!e||"object"!=typeof e)return!1;var n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(var r=0;r<t.length;r++)if(!cv(t[r],e[r]))return!1}else{for(var o in t)if(!(o in e)||!cv(t[o],e[o]))return!1;for(var i in e)if(!(i in t))return!1}return!0}ov.empty=new ov([],0);var hv=function(t,e){this.type=t,this.attrs=e};function pv(t){var e=Error.call(this,t);return e.__proto__=pv.prototype,e}hv.prototype.addToSet=function(t){for(var e,n=!1,r=0;r<t.length;r++){var o=t[r];if(this.eq(o))return t;if(this.type.excludes(o.type))e||(e=t.slice(0,r));else{if(o.type.excludes(this.type))return t;!n&&o.type.rank>this.type.rank&&(e||(e=t.slice(0,r)),e.push(this),n=!0),e&&e.push(o)}}return e||(e=t.slice()),n||e.push(this),e},hv.prototype.removeFromSet=function(t){for(var e=0;e<t.length;e++)if(this.eq(t[e]))return t.slice(0,e).concat(t.slice(e+1));return t},hv.prototype.isInSet=function(t){for(var e=0;e<t.length;e++)if(this.eq(t[e]))return!0;return!1},hv.prototype.eq=function(t){return this==t||this.type==t.type&&cv(this.attrs,t.attrs)},hv.prototype.toJSON=function(){var t={type:this.type.name};for(var e in this.attrs){t.attrs=this.attrs;break}return t},hv.fromJSON=function(t,e){if(!e)throw new RangeError("Invalid input for Mark.fromJSON");var n=t.marks[e.type];if(!n)throw new RangeError("There is no mark type "+e.type+" in this schema");return n.create(e.attrs)},hv.sameSet=function(t,e){if(t==e)return!0;if(t.length!=e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].eq(e[n]))return!1;return!0},hv.setFrom=function(t){if(!t||0==t.length)return hv.none;if(t instanceof hv)return[t];var e=t.slice();return e.sort((function(t,e){return t.type.rank-e.type.rank})),e},hv.none=[],pv.prototype=Object.create(Error.prototype),pv.prototype.constructor=pv,pv.prototype.name="ReplaceError";var lv=function(t,e,n){this.content=t,this.openStart=e,this.openEnd=n},uv={size:{configurable:!0}};function fv(t,e,n){var r=t.findIndex(e),o=r.index,i=r.offset,s=t.maybeChild(o),a=t.findIndex(n),c=a.index,h=a.offset;if(i==e||s.isText){if(h!=n&&!t.child(c).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(o!=c)throw new RangeError("Removing non-flat range");return t.replaceChild(o,s.copy(fv(s.content,e-i-1,n-i-1)))}function dv(t,e,n,r){var o=t.findIndex(e),i=o.index,s=o.offset,a=t.maybeChild(i);if(s==e||a.isText)return r&&!r.canReplace(i,i,n)?null:t.cut(0,e).append(n).append(t.cut(e));var c=dv(a.content,e-s-1,n);return c&&t.replaceChild(i,a.copy(c))}function mv(t,e,n){if(n.openStart>t.depth)throw new pv("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new pv("Inconsistent open depths");return vv(t,e,n,0)}function vv(t,e,n,r){var o=t.index(r),i=t.node(r);if(o==e.index(r)&&r<t.depth-n.openStart){var s=vv(t,e,n,r+1);return i.copy(i.content.replaceChild(o,s))}if(n.content.size){if(n.openStart||n.openEnd||t.depth!=r||e.depth!=r){var a=Ov(n,t),c=a.start,h=a.end;return bv(i,kv(t,c,h,e,r))}var p=t.parent,l=p.content;return bv(p,l.cut(0,t.parentOffset).append(n.content).append(l.cut(e.parentOffset)))}return bv(i,Sv(t,e,r))}function gv(t,e){if(!e.type.compatibleContent(t.type))throw new pv("Cannot join "+e.type.name+" onto "+t.type.name)}function yv(t,e,n){var r=t.node(n);return gv(r,e.node(n)),r}function wv(t,e){var n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function xv(t,e,n,r){var o=(e||t).node(n),i=0,s=e?e.index(n):o.childCount;t&&(i=t.index(n),t.depth>n?i++:t.textOffset&&(wv(t.nodeAfter,r),i++));for(var a=i;a<s;a++)wv(o.child(a),r);e&&e.depth==n&&e.textOffset&&wv(e.nodeBefore,r)}function bv(t,e){if(!t.type.validContent(e))throw new pv("Invalid content for node "+t.type.name);return t.copy(e)}function kv(t,e,n,r,o){var i=t.depth>o&&yv(t,e,o+1),s=r.depth>o&&yv(n,r,o+1),a=[];return xv(null,t,o,a),i&&s&&e.index(o)==n.index(o)?(gv(i,s),wv(bv(i,kv(t,e,n,r,o+1)),a)):(i&&wv(bv(i,Sv(t,e,o+1)),a),xv(e,n,o,a),s&&wv(bv(s,Sv(n,r,o+1)),a)),xv(r,null,o,a),new ov(a)}function Sv(t,e,n){var r=[];if(xv(null,t,n,r),t.depth>n){var o=yv(t,e,n+1);wv(bv(o,Sv(t,e,n+1)),r)}return xv(e,null,n,r),new ov(r)}function Ov(t,e){for(var n=e.depth-t.openStart,r=e.node(n),o=r.copy(t.content),i=n-1;i>=0;i--)o=e.node(i).copy(ov.from(o));return{start:o.resolveNoCache(t.openStart+n),end:o.resolveNoCache(o.content.size-t.openEnd-n)}}uv.size.get=function(){return this.content.size-this.openStart-this.openEnd},lv.prototype.insertAt=function(t,e){var n=dv(this.content,t+this.openStart,e,null);return n&&new lv(n,this.openStart,this.openEnd)},lv.prototype.removeBetween=function(t,e){return new lv(fv(this.content,t+this.openStart,e+this.openStart),this.openStart,this.openEnd)},lv.prototype.eq=function(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd},lv.prototype.toString=function(){return this.content+"("+this.openStart+","+this.openEnd+")"},lv.prototype.toJSON=function(){if(!this.content.size)return null;var t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t},lv.fromJSON=function(t,e){if(!e)return lv.empty;var n=e.openStart||0,r=e.openEnd||0;if("number"!=typeof n||"number"!=typeof r)throw new RangeError("Invalid input for Slice.fromJSON");return new lv(ov.fromJSON(t,e.content),e.openStart||0,e.openEnd||0)},lv.maxOpen=function(t,e){void 0===e&&(e=!0);for(var n=0,r=0,o=t.firstChild;o&&!o.isLeaf&&(e||!o.type.spec.isolating);o=o.firstChild)n++;for(var i=t.lastChild;i&&!i.isLeaf&&(e||!i.type.spec.isolating);i=i.lastChild)r++;return new lv(t,n,r)},Object.defineProperties(lv.prototype,uv),lv.empty=new lv(ov.empty,0,0);var Cv=function(t,e,n){this.pos=t,this.path=e,this.depth=e.length/3-1,this.parentOffset=n},Mv={parent:{configurable:!0},doc:{configurable:!0},textOffset:{configurable:!0},nodeAfter:{configurable:!0},nodeBefore:{configurable:!0}};Cv.prototype.resolveDepth=function(t){return null==t?this.depth:t<0?this.depth+t:t},Mv.parent.get=function(){return this.node(this.depth)},Mv.doc.get=function(){return this.node(0)},Cv.prototype.node=function(t){return this.path[3*this.resolveDepth(t)]},Cv.prototype.index=function(t){return this.path[3*this.resolveDepth(t)+1]},Cv.prototype.indexAfter=function(t){return t=this.resolveDepth(t),this.index(t)+(t!=this.depth||this.textOffset?1:0)},Cv.prototype.start=function(t){return t=this.resolveDepth(t),0==t?0:this.path[3*t-1]+1},Cv.prototype.end=function(t){return t=this.resolveDepth(t),this.start(t)+this.node(t).content.size},Cv.prototype.before=function(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position before the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]},Cv.prototype.after=function(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position after the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]+this.path[3*t].nodeSize},Mv.textOffset.get=function(){return this.pos-this.path[this.path.length-1]},Mv.nodeAfter.get=function(){var t=this.parent,e=this.index(this.depth);if(e==t.childCount)return null;var n=this.pos-this.path[this.path.length-1],r=t.child(e);return n?t.child(e).cut(n):r},Mv.nodeBefore.get=function(){var t=this.index(this.depth),e=this.pos-this.path[this.path.length-1];return e?this.parent.child(t).cut(0,e):0==t?null:this.parent.child(t-1)},Cv.prototype.marks=function(){var t=this.parent,e=this.index();if(0==t.content.size)return hv.none;if(this.textOffset)return t.child(e).marks;var n=t.maybeChild(e-1),r=t.maybeChild(e);if(!n){var o=n;n=r,r=o}for(var i=n.marks,s=0;s<i.length;s++)!1!==i[s].type.spec.inclusive||r&&i[s].isInSet(r.marks)||(i=i[s--].removeFromSet(i));return i},Cv.prototype.marksAcross=function(t){var e=this.parent.maybeChild(this.index());if(!e||!e.isInline)return null;for(var n=e.marks,r=t.parent.maybeChild(t.index()),o=0;o<n.length;o++)!1!==n[o].type.spec.inclusive||r&&n[o].isInSet(r.marks)||(n=n[o--].removeFromSet(n));return n},Cv.prototype.sharedDepth=function(t){for(var e=this.depth;e>0;e--)if(this.start(e)<=t&&this.end(e)>=t)return e;return 0},Cv.prototype.blockRange=function(t,e){if(void 0===t&&(t=this),t.pos<this.pos)return t.blockRange(this);for(var n=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);n>=0;n--)if(t.pos<=this.end(n)&&(!e||e(this.node(n))))return new Av(this,t,n)},Cv.prototype.sameParent=function(t){return this.pos-this.parentOffset==t.pos-t.parentOffset},Cv.prototype.max=function(t){return t.pos>this.pos?t:this},Cv.prototype.min=function(t){return t.pos<this.pos?t:this},Cv.prototype.toString=function(){for(var t="",e=1;e<=this.depth;e++)t+=(t?"/":"")+this.node(e).type.name+"_"+this.index(e-1);return t+":"+this.parentOffset},Cv.resolve=function(t,e){if(!(e>=0&&e<=t.content.size))throw new RangeError("Position "+e+" out of range");for(var n=[],r=0,o=e,i=t;;){var s=i.content.findIndex(o),a=s.index,c=s.offset,h=o-c;if(n.push(i,a,r+c),!h)break;if(i=i.child(a),i.isText)break;o=h-1,r+=c+1}return new Cv(e,n,o)},Cv.resolveCached=function(t,e){for(var n=0;n<Nv.length;n++){var r=Nv[n];if(r.pos==e&&r.doc==t)return r}var o=Nv[Tv]=Cv.resolve(t,e);return Tv=(Tv+1)%Ev,o},Object.defineProperties(Cv.prototype,Mv);var Nv=[],Tv=0,Ev=12,Av=function(t,e,n){this.$from=t,this.$to=e,this.depth=n},Dv={start:{configurable:!0},end:{configurable:!0},parent:{configurable:!0},startIndex:{configurable:!0},endIndex:{configurable:!0}};Dv.start.get=function(){return this.$from.before(this.depth+1)},Dv.end.get=function(){return this.$to.after(this.depth+1)},Dv.parent.get=function(){return this.$from.node(this.depth)},Dv.startIndex.get=function(){return this.$from.index(this.depth)},Dv.endIndex.get=function(){return this.$to.indexAfter(this.depth)},Object.defineProperties(Av.prototype,Dv);var Rv=Object.create(null),zv=function(t,e,n,r){this.type=t,this.attrs=e,this.content=n||ov.empty,this.marks=r||hv.none},Iv={nodeSize:{configurable:!0},childCount:{configurable:!0},textContent:{configurable:!0},firstChild:{configurable:!0},lastChild:{configurable:!0},isBlock:{configurable:!0},isTextblock:{configurable:!0},inlineContent:{configurable:!0},isInline:{configurable:!0},isText:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};Iv.nodeSize.get=function(){return this.isLeaf?1:2+this.content.size},Iv.childCount.get=function(){return this.content.childCount},zv.prototype.child=function(t){return this.content.child(t)},zv.prototype.maybeChild=function(t){return this.content.maybeChild(t)},zv.prototype.forEach=function(t){this.content.forEach(t)},zv.prototype.nodesBetween=function(t,e,n,r){void 0===r&&(r=0),this.content.nodesBetween(t,e,n,r,this)},zv.prototype.descendants=function(t){this.nodesBetween(0,this.content.size,t)},Iv.textContent.get=function(){return this.textBetween(0,this.content.size,"")},zv.prototype.textBetween=function(t,e,n,r){return this.content.textBetween(t,e,n,r)},Iv.firstChild.get=function(){return this.content.firstChild},Iv.lastChild.get=function(){return this.content.lastChild},zv.prototype.eq=function(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)},zv.prototype.sameMarkup=function(t){return this.hasMarkup(t.type,t.attrs,t.marks)},zv.prototype.hasMarkup=function(t,e,n){return this.type==t&&cv(this.attrs,e||t.defaultAttrs||Rv)&&hv.sameSet(this.marks,n||hv.none)},zv.prototype.copy=function(t){return void 0===t&&(t=null),t==this.content?this:new this.constructor(this.type,this.attrs,t,this.marks)},zv.prototype.mark=function(t){return t==this.marks?this:new this.constructor(this.type,this.attrs,this.content,t)},zv.prototype.cut=function(t,e){return 0==t&&e==this.content.size?this:this.copy(this.content.cut(t,e))},zv.prototype.slice=function(t,e,n){if(void 0===e&&(e=this.content.size),void 0===n&&(n=!1),t==e)return lv.empty;var r=this.resolve(t),o=this.resolve(e),i=n?0:r.sharedDepth(e),s=r.start(i),a=r.node(i),c=a.content.cut(r.pos-s,o.pos-s);return new lv(c,r.depth-i,o.depth-i)},zv.prototype.replace=function(t,e,n){return mv(this.resolve(t),this.resolve(e),n)},zv.prototype.nodeAt=function(t){for(var e=this;;){var n=e.content.findIndex(t),r=n.index,o=n.offset;if(e=e.maybeChild(r),!e)return null;if(o==t||e.isText)return e;t-=o+1}},zv.prototype.childAfter=function(t){var e=this.content.findIndex(t),n=e.index,r=e.offset;return{node:this.content.maybeChild(n),index:n,offset:r}},zv.prototype.childBefore=function(t){if(0==t)return{node:null,index:0,offset:0};var e=this.content.findIndex(t),n=e.index,r=e.offset;if(r<t)return{node:this.content.child(n),index:n,offset:r};var o=this.content.child(n-1);return{node:o,index:n-1,offset:r-o.nodeSize}},zv.prototype.resolve=function(t){return Cv.resolveCached(this,t)},zv.prototype.resolveNoCache=function(t){return Cv.resolve(this,t)},zv.prototype.rangeHasMark=function(t,e,n){var r=!1;return e>t&&this.nodesBetween(t,e,(function(t){return n.isInSet(t.marks)&&(r=!0),!r})),r},Iv.isBlock.get=function(){return this.type.isBlock},Iv.isTextblock.get=function(){return this.type.isTextblock},Iv.inlineContent.get=function(){return this.type.inlineContent},Iv.isInline.get=function(){return this.type.isInline},Iv.isText.get=function(){return this.type.isText},Iv.isLeaf.get=function(){return this.type.isLeaf},Iv.isAtom.get=function(){return this.type.isAtom},zv.prototype.toString=function(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);var t=this.type.name;return this.content.size&&(t+="("+this.content.toStringInner()+")"),Fv(this.marks,t)},zv.prototype.contentMatchAt=function(t){var e=this.type.contentMatch.matchFragment(this.content,0,t);if(!e)throw new Error("Called contentMatchAt on a node with invalid content");return e},zv.prototype.canReplace=function(t,e,n,r,o){void 0===n&&(n=ov.empty),void 0===r&&(r=0),void 0===o&&(o=n.childCount);var i=this.contentMatchAt(t).matchFragment(n,r,o),s=i&&i.matchFragment(this.content,e);if(!s||!s.validEnd)return!1;for(var a=r;a<o;a++)if(!this.type.allowsMarks(n.child(a).marks))return!1;return!0},zv.prototype.canReplaceWith=function(t,e,n,r){if(r&&!this.type.allowsMarks(r))return!1;var o=this.contentMatchAt(t).matchType(n),i=o&&o.matchFragment(this.content,e);return!!i&&i.validEnd},zv.prototype.canAppend=function(t){return t.content.size?this.canReplace(this.childCount,this.childCount,t.content):this.type.compatibleContent(t.type)},zv.prototype.check=function(){if(!this.type.validContent(this.content))throw new RangeError("Invalid content for node "+this.type.name+": "+this.content.toString().slice(0,50));this.content.forEach((function(t){return t.check()}))},zv.prototype.toJSON=function(){var t={type:this.type.name};for(var e in this.attrs){t.attrs=this.attrs;break}return this.content.size&&(t.content=this.content.toJSON()),this.marks.length&&(t.marks=this.marks.map((function(t){return t.toJSON()}))),t},zv.fromJSON=function(t,e){if(!e)throw new RangeError("Invalid input for Node.fromJSON");var n=null;if(e.marks){if(!Array.isArray(e.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=e.marks.map(t.markFromJSON)}if("text"==e.type){if("string"!=typeof e.text)throw new RangeError("Invalid text node in JSON");return t.text(e.text,n)}var r=ov.fromJSON(t,e.content);return t.nodeType(e.type).create(e.attrs,r,n)},Object.defineProperties(zv.prototype,Iv);var Pv=function(t){function e(e,n,r,o){if(t.call(this,e,n,null,o),!r)throw new RangeError("Empty text nodes are not allowed");this.text=r}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={textContent:{configurable:!0},nodeSize:{configurable:!0}};return e.prototype.toString=function(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):Fv(this.marks,JSON.stringify(this.text))},n.textContent.get=function(){return this.text},e.prototype.textBetween=function(t,e){return this.text.slice(t,e)},n.nodeSize.get=function(){return this.text.length},e.prototype.mark=function(t){return t==this.marks?this:new e(this.type,this.attrs,this.text,t)},e.prototype.withText=function(t){return t==this.text?this:new e(this.type,this.attrs,t,this.marks)},e.prototype.cut=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=this.text.length),0==t&&e==this.text.length?this:this.withText(this.text.slice(t,e))},e.prototype.eq=function(t){return this.sameMarkup(t)&&this.text==t.text},e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.text=this.text,e},Object.defineProperties(e.prototype,n),e}(zv);function Fv(t,e){for(var n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}var Bv=function(t){this.validEnd=t,this.next=[],this.wrapCache=[]},$v={inlineContent:{configurable:!0},defaultType:{configurable:!0},edgeCount:{configurable:!0}};Bv.parse=function(t,e){var n=new _v(t,e);if(null==n.next)return Bv.empty;var r=Jv(n);n.next&&n.err("Unexpected trailing text");var o=Yv(Uv(r));return Zv(o,n),o},Bv.prototype.matchType=function(t){for(var e=0;e<this.next.length;e+=2)if(this.next[e]==t)return this.next[e+1];return null},Bv.prototype.matchFragment=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=t.childCount);for(var r=this,o=e;r&&o<n;o++)r=r.matchType(t.child(o).type);return r},$v.inlineContent.get=function(){var t=this.next[0];return!!t&&t.isInline},$v.defaultType.get=function(){for(var t=0;t<this.next.length;t+=2){var e=this.next[t];if(!e.isText&&!e.hasRequiredAttrs())return e}},Bv.prototype.compatible=function(t){for(var e=0;e<this.next.length;e+=2)for(var n=0;n<t.next.length;n+=2)if(this.next[e]==t.next[n])return!0;return!1},Bv.prototype.fillBefore=function(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=0);var r=[this];function o(i,s){var a=i.matchFragment(t,n);if(a&&(!e||a.validEnd))return ov.from(s.map((function(t){return t.createAndFill()})));for(var c=0;c<i.next.length;c+=2){var h=i.next[c],p=i.next[c+1];if(!h.isText&&!h.hasRequiredAttrs()&&-1==r.indexOf(p)){r.push(p);var l=o(p,s.concat(h));if(l)return l}}}return o(this,[])},Bv.prototype.findWrapping=function(t){for(var e=0;e<this.wrapCache.length;e+=2)if(this.wrapCache[e]==t)return this.wrapCache[e+1];var n=this.computeWrapping(t);return this.wrapCache.push(t,n),n},Bv.prototype.computeWrapping=function(t){var e=Object.create(null),n=[{match:this,type:null,via:null}];while(n.length){var r=n.shift(),o=r.match;if(o.matchType(t)){for(var i=[],s=r;s.type;s=s.via)i.push(s.type);return i.reverse()}for(var a=0;a<o.next.length;a+=2){var c=o.next[a];c.isLeaf||c.hasRequiredAttrs()||c.name in e||r.type&&!o.next[a+1].validEnd||(n.push({match:c.contentMatch,type:c,via:r}),e[c.name]=!0)}}},$v.edgeCount.get=function(){return this.next.length>>1},Bv.prototype.edge=function(t){var e=t<<1;if(e>=this.next.length)throw new RangeError("There's no "+t+"th edge in this content match");return{type:this.next[e],next:this.next[e+1]}},Bv.prototype.toString=function(){var t=[];function e(n){t.push(n);for(var r=1;r<n.next.length;r+=2)-1==t.indexOf(n.next[r])&&e(n.next[r])}return e(this),t.map((function(e,n){for(var r=n+(e.validEnd?"*":" ")+" ",o=0;o<e.next.length;o+=2)r+=(o?", ":"")+e.next[o].name+"->"+t.indexOf(e.next[o+1]);return r})).join("\n")},Object.defineProperties(Bv.prototype,$v),Bv.empty=new Bv(!0);var _v=function(t,e){this.string=t,this.nodeTypes=e,this.inline=null,this.pos=0,this.tokens=t.split(/\s*(?=\b|\W|$)/),""==this.tokens[this.tokens.length-1]&&this.tokens.pop(),""==this.tokens[0]&&this.tokens.unshift()},jv={next:{configurable:!0}};function Jv(t){var e=[];do{e.push(Lv(t))}while(t.eat("|"));return 1==e.length?e[0]:{type:"choice",exprs:e}}function Lv(t){var e=[];do{e.push(Vv(t))}while(t.next&&")"!=t.next&&"|"!=t.next);return 1==e.length?e[0]:{type:"seq",exprs:e}}function Vv(t){for(var e=Kv(t);;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else{if(!t.eat("{"))break;e=Wv(t,e)}return e}function qv(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");var e=Number(t.next);return t.pos++,e}function Wv(t,e){var n=qv(t),r=n;return t.eat(",")&&(r="}"!=t.next?qv(t):-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:e}}function Hv(t,e){var n=t.nodeTypes,r=n[e];if(r)return[r];var o=[];for(var i in n){var s=n[i];s.groups.indexOf(e)>-1&&o.push(s)}return 0==o.length&&t.err("No node type or group '"+e+"' found"),o}function Kv(t){if(t.eat("(")){var e=Jv(t);return t.eat(")")||t.err("Missing closing paren"),e}if(!/\W/.test(t.next)){var n=Hv(t,t.next).map((function(e){return null==t.inline?t.inline=e.isInline:t.inline!=e.isInline&&t.err("Mixing inline and block content"),{type:"name",value:e}}));return t.pos++,1==n.length?n[0]:{type:"choice",exprs:n}}t.err("Unexpected token '"+t.next+"'")}function Uv(t){var e=[[]];return o(i(t,0),n()),e;function n(){return e.push([])-1}function r(t,n,r){var o={term:r,to:n};return e[t].push(o),o}function o(t,e){t.forEach((function(t){return t.to=e}))}function i(t,e){if("choice"==t.type)return t.exprs.reduce((function(t,n){return t.concat(i(n,e))}),[]);if("seq"==t.type)for(var s=0;;s++){var a=i(t.exprs[s],e);if(s==t.exprs.length-1)return a;o(a,e=n())}else{if("star"==t.type){var c=n();return r(e,c),o(i(t.expr,c),c),[r(c)]}if("plus"==t.type){var h=n();return o(i(t.expr,e),h),o(i(t.expr,h),h),[r(h)]}if("opt"==t.type)return[r(e)].concat(i(t.expr,e));if("range"==t.type){for(var p=e,l=0;l<t.min;l++){var u=n();o(i(t.expr,p),u),p=u}if(-1==t.max)o(i(t.expr,p),p);else for(var f=t.min;f<t.max;f++){var d=n();r(p,d),o(i(t.expr,p),d),p=d}return[r(p)]}if("name"==t.type)return[r(e,null,t.value)]}}}function Gv(t,e){return e-t}function Xv(t,e){var n=[];return r(e),n.sort(Gv);function r(e){var o=t[e];if(1==o.length&&!o[0].term)return r(o[0].to);n.push(e);for(var i=0;i<o.length;i++){var s=o[i],a=s.term,c=s.to;a||-1!=n.indexOf(c)||r(c)}}}function Yv(t){var e=Object.create(null);return n(Xv(t,0));function n(r){var o=[];r.forEach((function(e){t[e].forEach((function(e){var n=e.term,r=e.to;if(n){var i=o.indexOf(n),s=i>-1&&o[i+1];Xv(t,r).forEach((function(t){s||o.push(n,s=[]),-1==s.indexOf(t)&&s.push(t)}))}}))}));for(var i=e[r.join(",")]=new Bv(r.indexOf(t.length-1)>-1),s=0;s<o.length;s+=2){var a=o[s+1].sort(Gv);i.next.push(o[s],e[a.join(",")]||n(a))}return i}}function Zv(t,e){for(var n=0,r=[t];n<r.length;n++){for(var o=r[n],i=!o.validEnd,s=[],a=0;a<o.next.length;a+=2){var c=o.next[a],h=o.next[a+1];s.push(c.name),!i||c.isText||c.hasRequiredAttrs()||(i=!1),-1==r.indexOf(h)&&r.push(h)}i&&e.err("Only non-generatable nodes ("+s.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function Qv(t){var e=Object.create(null);for(var n in t){var r=t[n];if(!r.hasDefault)return null;e[n]=r.default}return e}function tg(t,e){var n=Object.create(null);for(var r in t){var o=e&&e[r];if(void 0===o){var i=t[r];if(!i.hasDefault)throw new RangeError("No value supplied for attribute "+r);o=i.default}n[r]=o}return n}function eg(t){var e=Object.create(null);if(t)for(var n in t)e[n]=new og(t[n]);return e}jv.next.get=function(){return this.tokens[this.pos]},_v.prototype.eat=function(t){return this.next==t&&(this.pos++||!0)},_v.prototype.err=function(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")},Object.defineProperties(_v.prototype,jv);var ng=function(t,e,n){this.name=t,this.schema=e,this.spec=n,this.groups=n.group?n.group.split(" "):[],this.attrs=eg(n.attrs),this.defaultAttrs=Qv(this.attrs),this.contentMatch=null,this.markSet=null,this.inlineContent=null,this.isBlock=!(n.inline||"text"==t),this.isText="text"==t},rg={isInline:{configurable:!0},isTextblock:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};rg.isInline.get=function(){return!this.isBlock},rg.isTextblock.get=function(){return this.isBlock&&this.inlineContent},rg.isLeaf.get=function(){return this.contentMatch==Bv.empty},rg.isAtom.get=function(){return this.isLeaf||this.spec.atom},ng.prototype.hasRequiredAttrs=function(){for(var t in this.attrs)if(this.attrs[t].isRequired)return!0;return!1},ng.prototype.compatibleContent=function(t){return this==t||this.contentMatch.compatible(t.contentMatch)},ng.prototype.computeAttrs=function(t){return!t&&this.defaultAttrs?this.defaultAttrs:tg(this.attrs,t)},ng.prototype.create=function(t,e,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new zv(this,this.computeAttrs(t),ov.from(e),hv.setFrom(n))},ng.prototype.createChecked=function(t,e,n){if(e=ov.from(e),!this.validContent(e))throw new RangeError("Invalid content for node "+this.name);return new zv(this,this.computeAttrs(t),e,hv.setFrom(n))},ng.prototype.createAndFill=function(t,e,n){if(t=this.computeAttrs(t),e=ov.from(e),e.size){var r=this.contentMatch.fillBefore(e);if(!r)return null;e=r.append(e)}var o=this.contentMatch.matchFragment(e).fillBefore(ov.empty,!0);return o?new zv(this,t,e.append(o),hv.setFrom(n)):null},ng.prototype.validContent=function(t){var e=this.contentMatch.matchFragment(t);if(!e||!e.validEnd)return!1;for(var n=0;n<t.childCount;n++)if(!this.allowsMarks(t.child(n).marks))return!1;return!0},ng.prototype.allowsMarkType=function(t){return null==this.markSet||this.markSet.indexOf(t)>-1},ng.prototype.allowsMarks=function(t){if(null==this.markSet)return!0;for(var e=0;e<t.length;e++)if(!this.allowsMarkType(t[e].type))return!1;return!0},ng.prototype.allowedMarks=function(t){if(null==this.markSet)return t;for(var e,n=0;n<t.length;n++)this.allowsMarkType(t[n].type)?e&&e.push(t[n]):e||(e=t.slice(0,n));return e?e.length?e:hv.empty:t},ng.compile=function(t,e){var n=Object.create(null);t.forEach((function(t,r){return n[t]=new ng(t,e,r)}));var r=e.spec.topNode||"doc";if(!n[r])throw new RangeError("Schema is missing its top node type ('"+r+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(var o in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n},Object.defineProperties(ng.prototype,rg);var og=function(t){this.hasDefault=Object.prototype.hasOwnProperty.call(t,"default"),this.default=t.default},ig={isRequired:{configurable:!0}};ig.isRequired.get=function(){return!this.hasDefault},Object.defineProperties(og.prototype,ig);var sg=function(t,e,n,r){this.name=t,this.schema=n,this.spec=r,this.attrs=eg(r.attrs),this.rank=e,this.excluded=null;var o=Qv(this.attrs);this.instance=o&&new hv(this,o)};sg.prototype.create=function(t){return!t&&this.instance?this.instance:new hv(this,tg(this.attrs,t))},sg.compile=function(t,e){var n=Object.create(null),r=0;return t.forEach((function(t,o){return n[t]=new sg(t,r++,e,o)})),n},sg.prototype.removeFromSet=function(t){for(var e=0;e<t.length;e++)if(t[e].type==this)return t.slice(0,e).concat(t.slice(e+1));return t},sg.prototype.isInSet=function(t){for(var e=0;e<t.length;e++)if(t[e].type==this)return t[e]},sg.prototype.excludes=function(t){return this.excluded.indexOf(t)>-1};var ag=function(t){for(var e in this.spec={},t)this.spec[e]=t[e];this.spec.nodes=c.from(t.nodes),this.spec.marks=c.from(t.marks),this.nodes=ng.compile(this.spec.nodes,this),this.marks=sg.compile(this.spec.marks,this);var n=Object.create(null);for(var r in this.nodes){if(r in this.marks)throw new RangeError(r+" can not be both a node and a mark");var o=this.nodes[r],i=o.spec.content||"",s=o.spec.marks;o.contentMatch=n[i]||(n[i]=Bv.parse(i,this.nodes)),o.inlineContent=o.contentMatch.inlineContent,o.markSet="_"==s?null:s?cg(this,s.split(" ")):""!=s&&o.inlineContent?null:[]}for(var a in this.marks){var h=this.marks[a],p=h.spec.excludes;h.excluded=null==p?[h]:""==p?[]:cg(this,p.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached=Object.create(null),this.cached.wrappings=Object.create(null)};function cg(t,e){for(var n=[],r=0;r<e.length;r++){var o=e[r],i=t.marks[o],s=i;if(i)n.push(i);else for(var a in t.marks){var c=t.marks[a];("_"==o||c.spec.group&&c.spec.group.split(" ").indexOf(o)>-1)&&n.push(s=c)}if(!s)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return n}ag.prototype.node=function(t,e,n,r){if("string"==typeof t)t=this.nodeType(t);else{if(!(t instanceof ng))throw new RangeError("Invalid node type: "+t);if(t.schema!=this)throw new RangeError("Node type from different schema used ("+t.name+")")}return t.createChecked(e,n,r)},ag.prototype.text=function(t,e){var n=this.nodes.text;return new Pv(n,n.defaultAttrs,t,hv.setFrom(e))},ag.prototype.mark=function(t,e){return"string"==typeof t&&(t=this.marks[t]),t.create(e)},ag.prototype.nodeFromJSON=function(t){return zv.fromJSON(this,t)},ag.prototype.markFromJSON=function(t){return hv.fromJSON(this,t)},ag.prototype.nodeType=function(t){var e=this.nodes[t];if(!e)throw new RangeError("Unknown node type: "+t);return e};var hg=function(t,e){var n=this;this.schema=t,this.rules=e,this.tags=[],this.styles=[],e.forEach((function(t){t.tag?n.tags.push(t):t.style&&n.styles.push(t)})),this.normalizeLists=!this.tags.some((function(e){if(!/^(ul|ol)\b/.test(e.tag)||!e.node)return!1;var n=t.nodes[e.node];return n.contentMatch.matchType(n)}))};hg.prototype.parse=function(t,e){void 0===e&&(e={});var n=new yg(this,e,!1);return n.addAll(t,null,e.from,e.to),n.finish()},hg.prototype.parseSlice=function(t,e){void 0===e&&(e={});var n=new yg(this,e,!0);return n.addAll(t,null,e.from,e.to),lv.maxOpen(n.finish())},hg.prototype.matchTag=function(t,e){for(var n=0;n<this.tags.length;n++){var r=this.tags[n];if(bg(t,r.tag)&&(void 0===r.namespace||t.namespaceURI==r.namespace)&&(!r.context||e.matchesContext(r.context))){if(r.getAttrs){var o=r.getAttrs(t);if(!1===o)continue;r.attrs=o}return r}}},hg.prototype.matchStyle=function(t,e,n){for(var r=0;r<this.styles.length;r++){var o=this.styles[r];if(!(0!=o.style.indexOf(t)||o.context&&!n.matchesContext(o.context)||o.style.length>t.length&&(61!=o.style.charCodeAt(t.length)||o.style.slice(t.length+1)!=e))){if(o.getAttrs){var i=o.getAttrs(e);if(!1===i)continue;o.attrs=i}return o}}},hg.schemaRules=function(t){var e=[];function n(t){for(var n=null==t.priority?50:t.priority,r=0;r<e.length;r++){var o=e[r],i=null==o.priority?50:o.priority;if(i<n)break}e.splice(r,0,t)}var r=function(e){var r=t.marks[e].spec.parseDOM;r&&r.forEach((function(t){n(t=Sg(t)),t.mark=e}))};for(var o in t.marks)r(o);var i=function(e){var r=t.nodes[s].spec.parseDOM;r&&r.forEach((function(t){n(t=Sg(t)),t.node=s}))};for(var s in t.nodes)i();return e},hg.fromSchema=function(t){return t.cached.domParser||(t.cached.domParser=new hg(t,hg.schemaRules(t)))};var pg={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},lg={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},ug={ol:!0,ul:!0},fg=1,dg=2,mg=4;function vg(t){return(t?fg:0)|("full"===t?dg:0)}var gg=function(t,e,n,r,o,i,s){this.type=t,this.attrs=e,this.solid=o,this.match=i||(s&mg?null:t.contentMatch),this.options=s,this.content=[],this.marks=n,this.activeMarks=hv.none,this.pendingMarks=r};gg.prototype.findWrapping=function(t){if(!this.match){if(!this.type)return[];var e=this.type.contentMatch.fillBefore(ov.from(t));if(!e){var n,r=this.type.contentMatch;return(n=r.findWrapping(t.type))?(this.match=r,n):null}this.match=this.type.contentMatch.matchFragment(e)}return this.match.findWrapping(t.type)},gg.prototype.finish=function(t){if(!(this.options&fg)){var e,n=this.content[this.content.length-1];n&&n.isText&&(e=/[ \t\r\n\u000c]+$/.exec(n.text))&&(n.text.length==e[0].length?this.content.pop():this.content[this.content.length-1]=n.withText(n.text.slice(0,n.text.length-e[0].length)))}var r=ov.from(this.content);return!t&&this.match&&(r=r.append(this.match.fillBefore(ov.empty,!0))),this.type?this.type.create(this.attrs,r,this.marks):r},gg.prototype.applyPending=function(t){for(var e=0,n=this.pendingMarks;e<n.length;e++){var r=n[e];(this.type?this.type.allowsMarkType(r.type):Og(r.type,t))&&!r.isInSet(this.activeMarks)&&(this.activeMarks=r.addToSet(this.activeMarks),this.pendingMarks=r.removeFromSet(this.pendingMarks))}};var yg=function(t,e,n){this.parser=t,this.options=e,this.isOpen=n;var r,o=e.topNode,i=vg(e.preserveWhitespace)|(n?mg:0);r=o?new gg(o.type,o.attrs,hv.none,hv.none,!0,e.topMatch||o.type.contentMatch,i):new gg(n?null:t.schema.topNodeType,null,hv.none,hv.none,!0,null,i),this.nodes=[r],this.open=0,this.find=e.findPositions,this.needsBlock=!1},wg={top:{configurable:!0},currentPos:{configurable:!0}};function xg(t){for(var e=t.firstChild,n=null;e;e=e.nextSibling){var r=1==e.nodeType?e.nodeName.toLowerCase():null;r&&ug.hasOwnProperty(r)&&n?(n.appendChild(e),e=n):"li"==r?n=e:r&&(n=null)}}function bg(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function kg(t){var e,n=/\s*([\w-]+)\s*:\s*([^;]+)/g,r=[];while(e=n.exec(t))r.push(e[1],e[2].trim());return r}function Sg(t){var e={};for(var n in t)e[n]=t[n];return e}function Og(t,e){var n=e.schema.nodes,r=function(r){var o=n[r];if(o.allowsMarkType(t)){var i=[],s=function(t){i.push(t);for(var n=0;n<t.edgeCount;n++){var r=t.edge(n),o=r.type,a=r.next;if(o==e)return!0;if(i.indexOf(a)<0&&s(a))return!0}};return s(o.contentMatch)?{v:!0}:void 0}};for(var o in n){var i=r(o);if(i)return i.v}}wg.top.get=function(){return this.nodes[this.open]},yg.prototype.addDOM=function(t){if(3==t.nodeType)this.addTextNode(t);else if(1==t.nodeType){var e=t.getAttribute("style"),n=e?this.readStyles(kg(e)):null,r=this.top;if(null!=n)for(var o=0;o<n.length;o++)this.addPendingMark(n[o]);if(this.addElement(t),null!=n)for(var i=0;i<n.length;i++)this.removePendingMark(n[i],r)}},yg.prototype.addTextNode=function(t){var e=t.nodeValue,n=this.top;if((n.type?n.type.inlineContent:n.content.length&&n.content[0].isInline)||/[^ \t\r\n\u000c]/.test(e)){if(n.options&fg)n.options&dg||(e=e.replace(/\r?\n|\r/g," "));else if(e=e.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(e)&&this.open==this.nodes.length-1){var r=n.content[n.content.length-1],o=t.previousSibling;(!r||o&&"BR"==o.nodeName||r.isText&&/[ \t\r\n\u000c]$/.test(r.text))&&(e=e.slice(1))}e&&this.insertNode(this.parser.schema.text(e)),this.findInText(t)}else this.findInside(t)},yg.prototype.addElement=function(t){var e=t.nodeName.toLowerCase();ug.hasOwnProperty(e)&&this.normalizeLists&&xg(t);var n=this.options.ruleFromNode&&this.options.ruleFromNode(t)||this.parser.matchTag(t,this);if(n?n.ignore:lg.hasOwnProperty(e))this.findInside(t);else if(!n||n.skip||n.closeParent){n&&n.closeParent?this.open=Math.max(0,this.open-1):n&&n.skip.nodeType&&(t=n.skip);var r,o=this.top,i=this.needsBlock;if(pg.hasOwnProperty(e))r=!0,o.type||(this.needsBlock=!0);else if(!t.firstChild)return void this.leafFallback(t);this.addAll(t),r&&this.sync(o),this.needsBlock=i}else this.addElementByRule(t,n)},yg.prototype.leafFallback=function(t){"BR"==t.nodeName&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(t.ownerDocument.createTextNode("\n"))},yg.prototype.readStyles=function(t){for(var e=hv.none,n=0;n<t.length;n+=2){var r=this.parser.matchStyle(t[n],t[n+1],this);if(r){if(r.ignore)return null;e=this.parser.schema.marks[r.mark].create(r.attrs).addToSet(e)}}return e},yg.prototype.addElementByRule=function(t,e){var n,r,o,i,s=this;e.node?(r=this.parser.schema.nodes[e.node],r.isLeaf?this.insertNode(r.create(e.attrs))||this.leafFallback(t):n=this.enter(r,e.attrs,e.preserveWhitespace)):(o=this.parser.schema.marks[e.mark],i=o.create(e.attrs),this.addPendingMark(i));var a=this.top;if(r&&r.isLeaf)this.findInside(t);else if(e.getContent)this.findInside(t),e.getContent(t,this.parser.schema).forEach((function(t){return s.insertNode(t)}));else{var c=e.contentElement;"string"==typeof c?c=t.querySelector(c):"function"==typeof c&&(c=c(t)),c||(c=t),this.findAround(t,c,!0),this.addAll(c,n)}n&&(this.sync(a),this.open--),i&&this.removePendingMark(i,a)},yg.prototype.addAll=function(t,e,n,r){for(var o=n||0,i=n?t.childNodes[n]:t.firstChild,s=null==r?null:t.childNodes[r];i!=s;i=i.nextSibling,++o)this.findAtPoint(t,o),this.addDOM(i),e&&pg.hasOwnProperty(i.nodeName.toLowerCase())&&this.sync(e);this.findAtPoint(t,o)},yg.prototype.findPlace=function(t){for(var e,n,r=this.open;r>=0;r--){var o=this.nodes[r],i=o.findWrapping(t);if(i&&(!e||e.length>i.length)&&(e=i,n=o,!i.length))break;if(o.solid)break}if(!e)return!1;this.sync(n);for(var s=0;s<e.length;s++)this.enterInner(e[s],null,!1);return!0},yg.prototype.insertNode=function(t){if(t.isInline&&this.needsBlock&&!this.top.type){var e=this.textblockFromContext();e&&this.enterInner(e)}if(this.findPlace(t)){this.closeExtra();var n=this.top;n.applyPending(t.type),n.match&&(n.match=n.match.matchType(t.type));for(var r=n.activeMarks,o=0;o<t.marks.length;o++)n.type&&!n.type.allowsMarkType(t.marks[o].type)||(r=t.marks[o].addToSet(r));return n.content.push(t.mark(r)),!0}return!1},yg.prototype.enter=function(t,e,n){var r=this.findPlace(t.create(e));return r&&this.enterInner(t,e,!0,n),r},yg.prototype.enterInner=function(t,e,n,r){this.closeExtra();var o=this.top;o.applyPending(t),o.match=o.match&&o.match.matchType(t,e);var i=null==r?o.options&~mg:vg(r);o.options&mg&&0==o.content.length&&(i|=mg),this.nodes.push(new gg(t,e,o.activeMarks,o.pendingMarks,n,null,i)),this.open++},yg.prototype.closeExtra=function(t){var e=this.nodes.length-1;if(e>this.open){for(;e>this.open;e--)this.nodes[e-1].content.push(this.nodes[e].finish(t));this.nodes.length=this.open+1}},yg.prototype.finish=function(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)},yg.prototype.sync=function(t){for(var e=this.open;e>=0;e--)if(this.nodes[e]==t)return void(this.open=e)},wg.currentPos.get=function(){this.closeExtra();for(var t=0,e=this.open;e>=0;e--){for(var n=this.nodes[e].content,r=n.length-1;r>=0;r--)t+=n[r].nodeSize;e&&t++}return t},yg.prototype.findAtPoint=function(t,e){if(this.find)for(var n=0;n<this.find.length;n++)this.find[n].node==t&&this.find[n].offset==e&&(this.find[n].pos=this.currentPos)},yg.prototype.findInside=function(t){if(this.find)for(var e=0;e<this.find.length;e++)null==this.find[e].pos&&1==t.nodeType&&t.contains(this.find[e].node)&&(this.find[e].pos=this.currentPos)},yg.prototype.findAround=function(t,e,n){if(t!=e&&this.find)for(var r=0;r<this.find.length;r++)if(null==this.find[r].pos&&1==t.nodeType&&t.contains(this.find[r].node)){var o=e.compareDocumentPosition(this.find[r].node);o&(n?2:4)&&(this.find[r].pos=this.currentPos)}},yg.prototype.findInText=function(t){if(this.find)for(var e=0;e<this.find.length;e++)this.find[e].node==t&&(this.find[e].pos=this.currentPos-(t.nodeValue.length-this.find[e].offset))},yg.prototype.matchesContext=function(t){var e=this;if(t.indexOf("|")>-1)return t.split(/\s*\|\s*/).some(this.matchesContext,this);var n=t.split("/"),r=this.options.context,o=!this.isOpen&&(!r||r.parent.type==this.nodes[0].type),i=-(r?r.depth+1:0)+(o?0:1),s=function(t,a){for(;t>=0;t--){var c=n[t];if(""==c){if(t==n.length-1||0==t)continue;for(;a>=i;a--)if(s(t-1,a))return!0;return!1}var h=a>0||0==a&&o?e.nodes[a].type:r&&a>=i?r.node(a-i).type:null;if(!h||h.name!=c&&-1==h.groups.indexOf(c))return!1;a--}return!0};return s(n.length-1,this.open)},yg.prototype.textblockFromContext=function(){var t=this.options.context;if(t)for(var e=t.depth;e>=0;e--){var n=t.node(e).contentMatchAt(t.indexAfter(e)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(var r in this.parser.schema.nodes){var o=this.parser.schema.nodes[r];if(o.isTextblock&&o.defaultAttrs)return o}},yg.prototype.addPendingMark=function(t){this.top.pendingMarks=t.addToSet(this.top.pendingMarks)},yg.prototype.removePendingMark=function(t,e){for(var n=this.open;n>=0;n--){var r=this.nodes[n],o=r.pendingMarks.lastIndexOf(t);if(o>-1?r.pendingMarks=t.removeFromSet(r.pendingMarks):r.activeMarks=t.removeFromSet(r.activeMarks),r==e)break}},Object.defineProperties(yg.prototype,wg);var Cg=function(t,e){this.nodes=t||{},this.marks=e||{}};function Mg(t){var e={};for(var n in t){var r=t[n].spec.toDOM;r&&(e[n]=r)}return e}function Ng(t){return t.document||window.document}Cg.prototype.serializeFragment=function(t,e,n){var r=this;void 0===e&&(e={}),n||(n=Ng(e).createDocumentFragment());var o=n,i=null;return t.forEach((function(t){if(i||t.marks.length){i||(i=[]);var n=0,s=0;while(n<i.length&&s<t.marks.length){var a=t.marks[s];if(r.marks[a.type.name]){if(!a.eq(i[n])||!1===a.type.spec.spanning)break;n+=2,s++}else s++}while(n<i.length)o=i.pop(),i.pop();while(s<t.marks.length){var c=t.marks[s++],h=r.serializeMark(c,t.isInline,e);h&&(i.push(c,o),o.appendChild(h.dom),o=h.contentDOM||h.dom)}}o.appendChild(r.serializeNode(t,e))})),n},Cg.prototype.serializeNode=function(t,e){void 0===e&&(e={});var n=Cg.renderSpec(Ng(e),this.nodes[t.type.name](t)),r=n.dom,o=n.contentDOM;if(o){if(t.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");e.onContent?e.onContent(t,o,e):this.serializeFragment(t.content,e,o)}return r},Cg.prototype.serializeNodeAndMarks=function(t,e){void 0===e&&(e={});for(var n=this.serializeNode(t,e),r=t.marks.length-1;r>=0;r--){var o=this.serializeMark(t.marks[r],t.isInline,e);o&&((o.contentDOM||o.dom).appendChild(n),n=o.dom)}return n},Cg.prototype.serializeMark=function(t,e,n){void 0===n&&(n={});var r=this.marks[t.type.name];return r&&Cg.renderSpec(Ng(n),r(t,e))},Cg.renderSpec=function(t,e,n){if(void 0===n&&(n=null),"string"==typeof e)return{dom:t.createTextNode(e)};if(null!=e.nodeType)return{dom:e};var r=e[0],o=r.indexOf(" ");o>0&&(n=r.slice(0,o),r=r.slice(o+1));var i=null,s=n?t.createElementNS(n,r):t.createElement(r),a=e[1],c=1;if(a&&"object"==typeof a&&null==a.nodeType&&!Array.isArray(a))for(var h in c=2,a)if(null!=a[h]){var p=h.indexOf(" ");p>0?s.setAttributeNS(h.slice(0,p),h.slice(p+1),a[h]):s.setAttribute(h,a[h])}for(var l=c;l<e.length;l++){var u=e[l];if(0===u){if(l<e.length-1||l>c)throw new RangeError("Content hole must be the only child of its parent node");return{dom:s,contentDOM:s}}var f=Cg.renderSpec(t,u,n),d=f.dom,m=f.contentDOM;if(s.appendChild(d),m){if(i)throw new RangeError("Multiple content holes");i=m}}return{dom:s,contentDOM:i}},Cg.fromSchema=function(t){return t.cached.domSerializer||(t.cached.domSerializer=new Cg(this.nodesFromSchema(t),this.marksFromSchema(t)))},Cg.nodesFromSchema=function(t){var e=Mg(t.nodes);return e.text||(e.text=function(t){return t.text}),e},Cg.marksFromSchema=function(t){return Mg(t.marks)};var Tg=Object.create(null),Eg=function(t,e,n){this.ranges=n||[new Dg(t.min(e),t.max(e))],this.$anchor=t,this.$head=e},Ag={anchor:{configurable:!0},head:{configurable:!0},from:{configurable:!0},to:{configurable:!0},$from:{configurable:!0},$to:{configurable:!0},empty:{configurable:!0}};Ag.anchor.get=function(){return this.$anchor.pos},Ag.head.get=function(){return this.$head.pos},Ag.from.get=function(){return this.$from.pos},Ag.to.get=function(){return this.$to.pos},Ag.$from.get=function(){return this.ranges[0].$from},Ag.$to.get=function(){return this.ranges[0].$to},Ag.empty.get=function(){for(var t=this.ranges,e=0;e<t.length;e++)if(t[e].$from.pos!=t[e].$to.pos)return!1;return!0},Eg.prototype.content=function(){return this.$from.node(0).slice(this.from,this.to,!0)},Eg.prototype.replace=function(t,e){void 0===e&&(e=lv.empty);for(var n=e.content.lastChild,r=null,o=0;o<e.openEnd;o++)r=n,n=n.lastChild;for(var i=t.steps.length,s=this.ranges,a=0;a<s.length;a++){var c=s[a],h=c.$from,p=c.$to,l=t.mapping.slice(i);t.replaceRange(l.map(h.pos),l.map(p.pos),a?lv.empty:e),0==a&&_g(t,i,(n?n.isInline:r&&r.isTextblock)?-1:1)}},Eg.prototype.replaceWith=function(t,e){for(var n=t.steps.length,r=this.ranges,o=0;o<r.length;o++){var i=r[o],s=i.$from,a=i.$to,c=t.mapping.slice(n),h=c.map(s.pos),p=c.map(a.pos);o?t.deleteRange(h,p):(t.replaceRangeWith(h,p,e),_g(t,n,e.isInline?-1:1))}},Eg.findFrom=function(t,e,n){var r=t.parent.inlineContent?new Rg(t):$g(t.node(0),t.parent,t.pos,t.index(),e,n);if(r)return r;for(var o=t.depth-1;o>=0;o--){var i=e<0?$g(t.node(0),t.node(o),t.before(o+1),t.index(o),e,n):$g(t.node(0),t.node(o),t.after(o+1),t.index(o)+1,e,n);if(i)return i}},Eg.near=function(t,e){return void 0===e&&(e=1),this.findFrom(t,e)||this.findFrom(t,-e)||new Fg(t.node(0))},Eg.atStart=function(t){return $g(t,t,0,0,1)||new Fg(t)},Eg.atEnd=function(t){return $g(t,t,t.content.size,t.childCount,-1)||new Fg(t)},Eg.fromJSON=function(t,e){if(!e||!e.type)throw new RangeError("Invalid input for Selection.fromJSON");var n=Tg[e.type];if(!n)throw new RangeError("No selection type "+e.type+" defined");return n.fromJSON(t,e)},Eg.jsonID=function(t,e){if(t in Tg)throw new RangeError("Duplicate use of selection JSON ID "+t);return Tg[t]=e,e.prototype.jsonID=t,e},Eg.prototype.getBookmark=function(){return Rg.between(this.$anchor,this.$head).getBookmark()},Object.defineProperties(Eg.prototype,Ag),Eg.prototype.visible=!0;var Dg=function(t,e){this.$from=t,this.$to=e},Rg=function(t){function e(e,n){void 0===n&&(n=e),t.call(this,e,n)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={$cursor:{configurable:!0}};return n.$cursor.get=function(){return this.$anchor.pos==this.$head.pos?this.$head:null},e.prototype.map=function(n,r){var o=n.resolve(r.map(this.head));if(!o.parent.inlineContent)return t.near(o);var i=n.resolve(r.map(this.anchor));return new e(i.parent.inlineContent?i:o,o)},e.prototype.replace=function(e,n){if(void 0===n&&(n=lv.empty),t.prototype.replace.call(this,e,n),n==lv.empty){var r=this.$from.marksAcross(this.$to);r&&e.ensureMarks(r)}},e.prototype.eq=function(t){return t instanceof e&&t.anchor==this.anchor&&t.head==this.head},e.prototype.getBookmark=function(){return new zg(this.anchor,this.head)},e.prototype.toJSON=function(){return{type:"text",anchor:this.anchor,head:this.head}},e.fromJSON=function(t,n){if("number"!=typeof n.anchor||"number"!=typeof n.head)throw new RangeError("Invalid input for TextSelection.fromJSON");return new e(t.resolve(n.anchor),t.resolve(n.head))},e.create=function(t,e,n){void 0===n&&(n=e);var r=t.resolve(e);return new this(r,n==e?r:t.resolve(n))},e.between=function(n,r,o){var i=n.pos-r.pos;if(o&&!i||(o=i>=0?1:-1),!r.parent.inlineContent){var s=t.findFrom(r,o,!0)||t.findFrom(r,-o,!0);if(!s)return t.near(r,o);r=s.$head}return n.parent.inlineContent||(0==i?n=r:(n=(t.findFrom(n,-o,!0)||t.findFrom(n,o,!0)).$anchor,n.pos<r.pos!=i<0&&(n=r))),new e(n,r)},Object.defineProperties(e.prototype,n),e}(Eg);Eg.jsonID("text",Rg);var zg=function(t,e){this.anchor=t,this.head=e};zg.prototype.map=function(t){return new zg(t.map(this.anchor),t.map(this.head))},zg.prototype.resolve=function(t){return Rg.between(t.resolve(this.anchor),t.resolve(this.head))};var Ig=function(t){function e(e){var n=e.nodeAfter,r=e.node(0).resolve(e.pos+n.nodeSize);t.call(this,e,r),this.node=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.map=function(n,r){var o=r.mapResult(this.anchor),i=o.deleted,s=o.pos,a=n.resolve(s);return i?t.near(a):new e(a)},e.prototype.content=function(){return new lv(ov.from(this.node),0,0)},e.prototype.eq=function(t){return t instanceof e&&t.anchor==this.anchor},e.prototype.toJSON=function(){return{type:"node",anchor:this.anchor}},e.prototype.getBookmark=function(){return new Pg(this.anchor)},e.fromJSON=function(t,n){if("number"!=typeof n.anchor)throw new RangeError("Invalid input for NodeSelection.fromJSON");return new e(t.resolve(n.anchor))},e.create=function(t,e){return new this(t.resolve(e))},e.isSelectable=function(t){return!t.isText&&!1!==t.type.spec.selectable},e}(Eg);Ig.prototype.visible=!1,Eg.jsonID("node",Ig);var Pg=function(t){this.anchor=t};Pg.prototype.map=function(t){var e=t.mapResult(this.anchor),n=e.deleted,r=e.pos;return n?new zg(r,r):new Pg(r)},Pg.prototype.resolve=function(t){var e=t.resolve(this.anchor),n=e.nodeAfter;return n&&Ig.isSelectable(n)?new Ig(e):Eg.near(e)};var Fg=function(t){function e(e){t.call(this,e.resolve(0),e.resolve(e.content.size))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.replace=function(e,n){if(void 0===n&&(n=lv.empty),n==lv.empty){e.delete(0,e.doc.content.size);var r=t.atStart(e.doc);r.eq(e.selection)||e.setSelection(r)}else t.prototype.replace.call(this,e,n)},e.prototype.toJSON=function(){return{type:"all"}},e.fromJSON=function(t){return new e(t)},e.prototype.map=function(t){return new e(t)},e.prototype.eq=function(t){return t instanceof e},e.prototype.getBookmark=function(){return Bg},e}(Eg);Eg.jsonID("all",Fg);var Bg={map:function(){return this},resolve:function(t){return new Fg(t)}};function $g(t,e,n,r,o,i){if(e.inlineContent)return Rg.create(t,n);for(var s=r-(o>0?0:1);o>0?s<e.childCount:s>=0;s+=o){var a=e.child(s);if(a.isAtom){if(!i&&Ig.isSelectable(a))return Ig.create(t,n-(o<0?a.nodeSize:0))}else{var c=$g(t,a,n+o,o<0?a.childCount:0,o,i);if(c)return c}n+=a.nodeSize*o}}function _g(t,e,n){var r=t.steps.length-1;if(!(r<e)){var o=t.steps[r];if(o instanceof Sn||o instanceof On){var i,s=t.mapping.maps[r];s.forEach((function(t,e,n,r){null==i&&(i=r)})),t.setSelection(Eg.near(t.doc.resolve(i),n))}}}var jg=1,Jg=2,Lg=4,Vg=function(t){function e(e){t.call(this,e.doc),this.time=Date.now(),this.curSelection=e.selection,this.curSelectionFor=0,this.storedMarks=e.storedMarks,this.updated=0,this.meta=Object.create(null)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={selection:{configurable:!0},selectionSet:{configurable:!0},storedMarksSet:{configurable:!0},isGeneric:{configurable:!0},scrolledIntoView:{configurable:!0}};return n.selection.get=function(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection},e.prototype.setSelection=function(t){if(t.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=t,this.curSelectionFor=this.steps.length,this.updated=(this.updated|jg)&~Jg,this.storedMarks=null,this},n.selectionSet.get=function(){return(this.updated&jg)>0},e.prototype.setStoredMarks=function(t){return this.storedMarks=t,this.updated|=Jg,this},e.prototype.ensureMarks=function(t){return hv.sameSet(this.storedMarks||this.selection.$from.marks(),t)||this.setStoredMarks(t),this},e.prototype.addStoredMark=function(t){return this.ensureMarks(t.addToSet(this.storedMarks||this.selection.$head.marks()))},e.prototype.removeStoredMark=function(t){return this.ensureMarks(t.removeFromSet(this.storedMarks||this.selection.$head.marks()))},n.storedMarksSet.get=function(){return(this.updated&Jg)>0},e.prototype.addStep=function(e,n){t.prototype.addStep.call(this,e,n),this.updated=this.updated&~Jg,this.storedMarks=null},e.prototype.setTime=function(t){return this.time=t,this},e.prototype.replaceSelection=function(t){return this.selection.replace(this,t),this},e.prototype.replaceSelectionWith=function(t,e){var n=this.selection;return!1!==e&&(t=t.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||hv.none))),n.replaceWith(this,t),this},e.prototype.deleteSelection=function(){return this.selection.replace(this),this},e.prototype.insertText=function(t,e,n){void 0===n&&(n=e);var r=this.doc.type.schema;if(null==e)return t?this.replaceSelectionWith(r.text(t),!0):this.deleteSelection();if(!t)return this.deleteRange(e,n);var o=this.storedMarks;if(!o){var i=this.doc.resolve(e);o=n==e?i.marks():i.marksAcross(this.doc.resolve(n))}return this.replaceRangeWith(e,n,r.text(t,o)),this.selection.empty||this.setSelection(Eg.near(this.selection.$to)),this},e.prototype.setMeta=function(t,e){return this.meta["string"==typeof t?t:t.key]=e,this},e.prototype.getMeta=function(t){return this.meta["string"==typeof t?t:t.key]},n.isGeneric.get=function(){for(var t in this.meta)return!1;return!0},e.prototype.scrollIntoView=function(){return this.updated|=Lg,this},n.scrolledIntoView.get=function(){return(this.updated&Lg)>0},Object.defineProperties(e.prototype,n),e}(gn);function qg(t,e){return e&&t?t.bind(e):t}var Wg=function(t,e,n){this.name=t,this.init=qg(e.init,n),this.apply=qg(e.apply,n)},Hg=[new Wg("doc",{init:function(t){return t.doc||t.schema.topNodeType.createAndFill()},apply:function(t){return t.doc}}),new Wg("selection",{init:function(t,e){return t.selection||Eg.atStart(e.doc)},apply:function(t){return t.selection}}),new Wg("storedMarks",{init:function(t){return t.storedMarks||null},apply:function(t,e,n,r){return r.selection.$cursor?t.storedMarks:null}}),new Wg("scrollToSelection",{init:function(){return 0},apply:function(t,e){return t.scrolledIntoView?e+1:e}})],Kg=function(t,e){var n=this;this.schema=t,this.fields=Hg.concat(),this.plugins=[],this.pluginsByKey=Object.create(null),e&&e.forEach((function(t){if(n.pluginsByKey[t.key])throw new RangeError("Adding different instances of a keyed plugin ("+t.key+")");n.plugins.push(t),n.pluginsByKey[t.key]=t,t.spec.state&&n.fields.push(new Wg(t.key,t.spec.state,t))}))},Ug=function(t){this.config=t},Gg={schema:{configurable:!0},plugins:{configurable:!0},tr:{configurable:!0}};Gg.schema.get=function(){return this.config.schema},Gg.plugins.get=function(){return this.config.plugins},Ug.prototype.apply=function(t){return this.applyTransaction(t).state},Ug.prototype.filterTransaction=function(t,e){void 0===e&&(e=-1);for(var n=0;n<this.config.plugins.length;n++)if(n!=e){var r=this.config.plugins[n];if(r.spec.filterTransaction&&!r.spec.filterTransaction.call(r,t,this))return!1}return!0},Ug.prototype.applyTransaction=function(t){if(!this.filterTransaction(t))return{state:this,transactions:[]};for(var e=[t],n=this.applyInner(t),r=null;;){for(var o=!1,i=0;i<this.config.plugins.length;i++){var s=this.config.plugins[i];if(s.spec.appendTransaction){var a=r?r[i].n:0,c=r?r[i].state:this,h=a<e.length&&s.spec.appendTransaction.call(s,a?e.slice(a):e,c,n);if(h&&n.filterTransaction(h,i)){if(h.setMeta("appendedTransaction",t),!r){r=[];for(var p=0;p<this.config.plugins.length;p++)r.push(p<i?{state:n,n:e.length}:{state:this,n:0})}e.push(h),n=n.applyInner(h),o=!0}r&&(r[i]={state:n,n:e.length})}}if(!o)return{state:n,transactions:e}}},Ug.prototype.applyInner=function(t){if(!t.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");for(var e=new Ug(this.config),n=this.config.fields,r=0;r<n.length;r++){var o=n[r];e[o.name]=o.apply(t,this[o.name],this,e)}for(var i=0;i<Xg.length;i++)Xg[i](this,t,e);return e},Gg.tr.get=function(){return new Vg(this)},Ug.create=function(t){for(var e=new Kg(t.doc?t.doc.type.schema:t.schema,t.plugins),n=new Ug(e),r=0;r<e.fields.length;r++)n[e.fields[r].name]=e.fields[r].init(t,n);return n},Ug.prototype.reconfigure=function(t){for(var e=new Kg(this.schema,t.plugins),n=e.fields,r=new Ug(e),o=0;o<n.length;o++){var i=n[o].name;r[i]=this.hasOwnProperty(i)?this[i]:n[o].init(t,r)}return r},Ug.prototype.toJSON=function(t){var e={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(e.storedMarks=this.storedMarks.map((function(t){return t.toJSON()}))),t&&"object"==typeof t)for(var n in t){if("doc"==n||"selection"==n)throw new RangeError("The JSON fields `doc` and `selection` are reserved");var r=t[n],o=r.spec.state;o&&o.toJSON&&(e[n]=o.toJSON.call(r,this[r.key]))}return e},Ug.fromJSON=function(t,e,n){if(!e)throw new RangeError("Invalid input for EditorState.fromJSON");if(!t.schema)throw new RangeError("Required config field 'schema' missing");var r=new Kg(t.schema,t.plugins),o=new Ug(r);return r.fields.forEach((function(r){if("doc"==r.name)o.doc=zv.fromJSON(t.schema,e.doc);else if("selection"==r.name)o.selection=Eg.fromJSON(o.doc,e.selection);else if("storedMarks"==r.name)e.storedMarks&&(o.storedMarks=e.storedMarks.map(t.schema.markFromJSON));else{if(n)for(var i in n){var s=n[i],a=s.spec.state;if(s.key==r.name&&a&&a.fromJSON&&Object.prototype.hasOwnProperty.call(e,i))return void(o[r.name]=a.fromJSON.call(s,t,e[i],o))}o[r.name]=r.init(t,o)}})),o},Ug.addApplyListener=function(t){Xg.push(t)},Ug.removeApplyListener=function(t){var e=Xg.indexOf(t);e>-1&&Xg.splice(e,1)},Object.defineProperties(Ug.prototype,Gg);var Xg=[];function Yg(t,e,n){for(var r in t){var o=t[r];o instanceof Function?o=o.bind(e):"handleDOMEvents"==r&&(o=Yg(o,e,{})),n[r]=o}return n}var Zg=function(t){this.props={},t.props&&Yg(t.props,this,this.props),this.spec=t,this.key=t.key?t.key.key:ty("plugin")};Zg.prototype.getState=function(t){return t[this.key]};var Qg=Object.create(null);function ty(t){return t in Qg?t+"$"+ ++Qg[t]:(Qg[t]=0,t+"$")}var ey=function(t){void 0===t&&(t="key"),this.key=ty(t)};
/*!
    * tiptap-utils v1.13.0
    * (c) 2021 berdosis GbR (limited liability)
    * @license MIT
    */
function ny(t,e){return e?t.createChecked(null,e):t.createAndFill()}function ry(t){if(t.cached.tableNodeTypes)return t.cached.tableNodeTypes;const e={};return Object.keys(t.nodes).forEach(n=>{const r=t.nodes[n];r.spec.tableRole&&(e[r.spec.tableRole]=r)}),t.cached.tableNodeTypes=e,e}function oy(t,e,n,r,o){const i=ry(t),s=[],a=[];for(let h=0;h<n;h+=1){const t=ny(i.cell,o);if(t&&a.push(t),r){const t=ny(i.header_cell,o);t&&s.push(t)}}const c=[];for(let h=0;h<e;h+=1)c.push(i.row.createChecked(null,r&&0===h?s:a));return i.table.createChecked(null,c)}function iy(t,e){return Array.isArray(t)&&t.indexOf(e.type)>-1||e.type===t}function sy(t,e){for(let n=t.depth;n>0;n-=1){const r=t.node(n);if(e(r))return{pos:n>0?t.before(n):0,start:t.start(n),depth:n,node:r}}}function ay(t){return e=>sy(e.$from,t)}function cy(t){return t instanceof Ig}function hy(t){return function(e){if(cy(e)){const{node:n}=e,{$from:r}=e;if(iy(t,n))return{node:n,pos:r.pos,depth:r.depth}}}}function py(t,e){const{from:n,to:r}=t.selection;let o=[];t.doc.nodesBetween(n,r,t=>{o=[...o,...t.marks]});const i=o.find(t=>t.type.name===e.name);return i?i.attrs:{}}function ly(t=null,e=null){if(!t||!e)return!1;const n=t.parent.childAfter(t.parentOffset);if(!n.node)return!1;const r=n.node.marks.find(t=>t.type===e);if(!r)return!1;let o=t.index(),i=t.start()+n.offset,s=o+1,a=i+n.node.nodeSize;while(o>0&&r.isInSet(t.parent.child(o-1).marks))o-=1,i-=t.parent.child(o).nodeSize;while(s<t.parent.childCount&&r.isInSet(t.parent.child(s).marks))a+=t.parent.child(s).nodeSize,s+=1;return{from:i,to:a}}function uy(t,e){const{from:n,to:r}=t.selection;let o=[];t.doc.nodesBetween(n,r,t=>{o=[...o,t]});const i=o.reverse().find(t=>t.type.name===e.name);return i?i.attrs:{}}function fy(t,e){const{from:n,$from:r,to:o,empty:i}=t.selection;return i?!!e.isInSet(t.storedMarks||r.marks()):!!t.doc.rangeHasMark(n,o,e)}function dy(t,e,n={}){const r=t=>t.type===e,o=hy(e)(t.selection)||ay(r)(t.selection);return Object.keys(n).length&&o?o.node.hasMarkup(e,{...o.node.attrs,...n}):!!o}ey.prototype.get=function(t){return t.config.pluginsByKey[this.key]},ey.prototype.getState=function(t){return t[this.key]};var my=n("2b0e");function vy(t){this.content=t}vy.prototype={constructor:vy,find:function(t){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===t)return e;return-1},get:function(t){var e=this.find(t);return-1==e?void 0:this.content[e+1]},update:function(t,e,n){var r=n&&n!=t?this.remove(n):this,o=r.find(t),i=r.content.slice();return-1==o?i.push(n||t,e):(i[o+1]=e,n&&(i[o]=n)),new vy(i)},remove:function(t){var e=this.find(t);if(-1==e)return this;var n=this.content.slice();return n.splice(e,2),new vy(n)},addToStart:function(t,e){return new vy([t,e].concat(this.remove(t).content))},addToEnd:function(t,e){var n=this.remove(t).content.slice();return n.push(t,e),new vy(n)},addBefore:function(t,e,n){var r=this.remove(e),o=r.content.slice(),i=r.find(t);return o.splice(-1==i?o.length:i,0,e,n),new vy(o)},forEach:function(t){for(var e=0;e<this.content.length;e+=2)t(this.content[e],this.content[e+1])},prepend:function(t){return t=vy.from(t),t.size?new vy(t.content.concat(this.subtract(t).content)):this},append:function(t){return t=vy.from(t),t.size?new vy(this.subtract(t).content.concat(t.content)):this},subtract:function(t){var e=this;t=vy.from(t);for(var n=0;n<t.content.length;n+=2)e=e.remove(t.content[n]);return e},get size(){return this.content.length>>1}},vy.from=function(t){if(t instanceof vy)return t;var e=[];if(t)for(var n in t)e.push(n,t[n]);return new vy(e)};var gy=vy,yy=gy;function wy(t,e,n){for(var r=0;;r++){if(r==t.childCount||r==e.childCount)return t.childCount==e.childCount?null:n;var o=t.child(r),i=e.child(r);if(o!=i){if(!o.sameMarkup(i))return n;if(o.isText&&o.text!=i.text){for(var s=0;o.text[s]==i.text[s];s++)n++;return n}if(o.content.size||i.content.size){var a=wy(o.content,i.content,n+1);if(null!=a)return a}n+=o.nodeSize}else n+=o.nodeSize}}function xy(t,e,n,r){for(var o=t.childCount,i=e.childCount;;){if(0==o||0==i)return o==i?null:{a:n,b:r};var s=t.child(--o),a=e.child(--i),c=s.nodeSize;if(s!=a){if(!s.sameMarkup(a))return{a:n,b:r};if(s.isText&&s.text!=a.text){var h=0,p=Math.min(s.text.length,a.text.length);while(h<p&&s.text[s.text.length-h-1]==a.text[a.text.length-h-1])h++,n--,r--;return{a:n,b:r}}if(s.content.size||a.content.size){var l=xy(s.content,a.content,n-1,r-1);if(l)return l}n-=c,r-=c}else n-=c,r-=c}}var by=function(t,e){if(this.content=t,this.size=e||0,null==e)for(var n=0;n<t.length;n++)this.size+=t[n].nodeSize},ky={firstChild:{configurable:!0},lastChild:{configurable:!0},childCount:{configurable:!0}};by.prototype.nodesBetween=function(t,e,n,r,o){void 0===r&&(r=0);for(var i=0,s=0;s<e;i++){var a=this.content[i],c=s+a.nodeSize;if(c>t&&!1!==n(a,r+s,o,i)&&a.content.size){var h=s+1;a.nodesBetween(Math.max(0,t-h),Math.min(a.content.size,e-h),n,r+h)}s=c}},by.prototype.descendants=function(t){this.nodesBetween(0,this.size,t)},by.prototype.textBetween=function(t,e,n,r){var o="",i=!0;return this.nodesBetween(t,e,(function(s,a){s.isText?(o+=s.text.slice(Math.max(t,a)-a,e-a),i=!n):s.isLeaf&&r?(o+=r,i=!n):!i&&s.isBlock&&(o+=n,i=!0)}),0),o},by.prototype.append=function(t){if(!t.size)return this;if(!this.size)return t;var e=this.lastChild,n=t.firstChild,r=this.content.slice(),o=0;for(e.isText&&e.sameMarkup(n)&&(r[r.length-1]=e.withText(e.text+n.text),o=1);o<t.content.length;o++)r.push(t.content[o]);return new by(r,this.size+t.size)},by.prototype.cut=function(t,e){if(null==e&&(e=this.size),0==t&&e==this.size)return this;var n=[],r=0;if(e>t)for(var o=0,i=0;i<e;o++){var s=this.content[o],a=i+s.nodeSize;a>t&&((i<t||a>e)&&(s=s.isText?s.cut(Math.max(0,t-i),Math.min(s.text.length,e-i)):s.cut(Math.max(0,t-i-1),Math.min(s.content.size,e-i-1))),n.push(s),r+=s.nodeSize),i=a}return new by(n,r)},by.prototype.cutByIndex=function(t,e){return t==e?by.empty:0==t&&e==this.content.length?this:new by(this.content.slice(t,e))},by.prototype.replaceChild=function(t,e){var n=this.content[t];if(n==e)return this;var r=this.content.slice(),o=this.size+e.nodeSize-n.nodeSize;return r[t]=e,new by(r,o)},by.prototype.addToStart=function(t){return new by([t].concat(this.content),this.size+t.nodeSize)},by.prototype.addToEnd=function(t){return new by(this.content.concat(t),this.size+t.nodeSize)},by.prototype.eq=function(t){if(this.content.length!=t.content.length)return!1;for(var e=0;e<this.content.length;e++)if(!this.content[e].eq(t.content[e]))return!1;return!0},ky.firstChild.get=function(){return this.content.length?this.content[0]:null},ky.lastChild.get=function(){return this.content.length?this.content[this.content.length-1]:null},ky.childCount.get=function(){return this.content.length},by.prototype.child=function(t){var e=this.content[t];if(!e)throw new RangeError("Index "+t+" out of range for "+this);return e},by.prototype.maybeChild=function(t){return this.content[t]},by.prototype.forEach=function(t){for(var e=0,n=0;e<this.content.length;e++){var r=this.content[e];t(r,n,e),n+=r.nodeSize}},by.prototype.findDiffStart=function(t,e){return void 0===e&&(e=0),wy(this,t,e)},by.prototype.findDiffEnd=function(t,e,n){return void 0===e&&(e=this.size),void 0===n&&(n=t.size),xy(this,t,e,n)},by.prototype.findIndex=function(t,e){if(void 0===e&&(e=-1),0==t)return Oy(0,t);if(t==this.size)return Oy(this.content.length,t);if(t>this.size||t<0)throw new RangeError("Position "+t+" outside of fragment ("+this+")");for(var n=0,r=0;;n++){var o=this.child(n),i=r+o.nodeSize;if(i>=t)return i==t||e>0?Oy(n+1,i):Oy(n,r);r=i}},by.prototype.toString=function(){return"<"+this.toStringInner()+">"},by.prototype.toStringInner=function(){return this.content.join(", ")},by.prototype.toJSON=function(){return this.content.length?this.content.map((function(t){return t.toJSON()})):null},by.fromJSON=function(t,e){if(!e)return by.empty;if(!Array.isArray(e))throw new RangeError("Invalid input for Fragment.fromJSON");return new by(e.map(t.nodeFromJSON))},by.fromArray=function(t){if(!t.length)return by.empty;for(var e,n=0,r=0;r<t.length;r++){var o=t[r];n+=o.nodeSize,r&&o.isText&&t[r-1].sameMarkup(o)?(e||(e=t.slice(0,r)),e[e.length-1]=o.withText(e[e.length-1].text+o.text)):e&&e.push(o)}return new by(e||t,n)},by.from=function(t){if(!t)return by.empty;if(t instanceof by)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new by([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))},Object.defineProperties(by.prototype,ky);var Sy={index:0,offset:0};function Oy(t,e){return Sy.index=t,Sy.offset=e,Sy}function Cy(t,e){if(t===e)return!0;if(!t||"object"!=typeof t||!e||"object"!=typeof e)return!1;var n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(var r=0;r<t.length;r++)if(!Cy(t[r],e[r]))return!1}else{for(var o in t)if(!(o in e)||!Cy(t[o],e[o]))return!1;for(var i in e)if(!(i in t))return!1}return!0}by.empty=new by([],0);var My=function(t,e){this.type=t,this.attrs=e};function Ny(t){var e=Error.call(this,t);return e.__proto__=Ny.prototype,e}My.prototype.addToSet=function(t){for(var e,n=!1,r=0;r<t.length;r++){var o=t[r];if(this.eq(o))return t;if(this.type.excludes(o.type))e||(e=t.slice(0,r));else{if(o.type.excludes(this.type))return t;!n&&o.type.rank>this.type.rank&&(e||(e=t.slice(0,r)),e.push(this),n=!0),e&&e.push(o)}}return e||(e=t.slice()),n||e.push(this),e},My.prototype.removeFromSet=function(t){for(var e=0;e<t.length;e++)if(this.eq(t[e]))return t.slice(0,e).concat(t.slice(e+1));return t},My.prototype.isInSet=function(t){for(var e=0;e<t.length;e++)if(this.eq(t[e]))return!0;return!1},My.prototype.eq=function(t){return this==t||this.type==t.type&&Cy(this.attrs,t.attrs)},My.prototype.toJSON=function(){var t={type:this.type.name};for(var e in this.attrs){t.attrs=this.attrs;break}return t},My.fromJSON=function(t,e){if(!e)throw new RangeError("Invalid input for Mark.fromJSON");var n=t.marks[e.type];if(!n)throw new RangeError("There is no mark type "+e.type+" in this schema");return n.create(e.attrs)},My.sameSet=function(t,e){if(t==e)return!0;if(t.length!=e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].eq(e[n]))return!1;return!0},My.setFrom=function(t){if(!t||0==t.length)return My.none;if(t instanceof My)return[t];var e=t.slice();return e.sort((function(t,e){return t.type.rank-e.type.rank})),e},My.none=[],Ny.prototype=Object.create(Error.prototype),Ny.prototype.constructor=Ny,Ny.prototype.name="ReplaceError";var Ty=function(t,e,n){this.content=t,this.openStart=e,this.openEnd=n},Ey={size:{configurable:!0}};function Ay(t,e,n){var r=t.findIndex(e),o=r.index,i=r.offset,s=t.maybeChild(o),a=t.findIndex(n),c=a.index,h=a.offset;if(i==e||s.isText){if(h!=n&&!t.child(c).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(o!=c)throw new RangeError("Removing non-flat range");return t.replaceChild(o,s.copy(Ay(s.content,e-i-1,n-i-1)))}function Dy(t,e,n,r){var o=t.findIndex(e),i=o.index,s=o.offset,a=t.maybeChild(i);if(s==e||a.isText)return r&&!r.canReplace(i,i,n)?null:t.cut(0,e).append(n).append(t.cut(e));var c=Dy(a.content,e-s-1,n);return c&&t.replaceChild(i,a.copy(c))}function Ry(t,e,n){if(n.openStart>t.depth)throw new Ny("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new Ny("Inconsistent open depths");return zy(t,e,n,0)}function zy(t,e,n,r){var o=t.index(r),i=t.node(r);if(o==e.index(r)&&r<t.depth-n.openStart){var s=zy(t,e,n,r+1);return i.copy(i.content.replaceChild(o,s))}if(n.content.size){if(n.openStart||n.openEnd||t.depth!=r||e.depth!=r){var a=Jy(n,t),c=a.start,h=a.end;return $y(i,_y(t,c,h,e,r))}var p=t.parent,l=p.content;return $y(p,l.cut(0,t.parentOffset).append(n.content).append(l.cut(e.parentOffset)))}return $y(i,jy(t,e,r))}function Iy(t,e){if(!e.type.compatibleContent(t.type))throw new Ny("Cannot join "+e.type.name+" onto "+t.type.name)}function Py(t,e,n){var r=t.node(n);return Iy(r,e.node(n)),r}function Fy(t,e){var n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function By(t,e,n,r){var o=(e||t).node(n),i=0,s=e?e.index(n):o.childCount;t&&(i=t.index(n),t.depth>n?i++:t.textOffset&&(Fy(t.nodeAfter,r),i++));for(var a=i;a<s;a++)Fy(o.child(a),r);e&&e.depth==n&&e.textOffset&&Fy(e.nodeBefore,r)}function $y(t,e){if(!t.type.validContent(e))throw new Ny("Invalid content for node "+t.type.name);return t.copy(e)}function _y(t,e,n,r,o){var i=t.depth>o&&Py(t,e,o+1),s=r.depth>o&&Py(n,r,o+1),a=[];return By(null,t,o,a),i&&s&&e.index(o)==n.index(o)?(Iy(i,s),Fy($y(i,_y(t,e,n,r,o+1)),a)):(i&&Fy($y(i,jy(t,e,o+1)),a),By(e,n,o,a),s&&Fy($y(s,jy(n,r,o+1)),a)),By(r,null,o,a),new by(a)}function jy(t,e,n){var r=[];if(By(null,t,n,r),t.depth>n){var o=Py(t,e,n+1);Fy($y(o,jy(t,e,n+1)),r)}return By(e,null,n,r),new by(r)}function Jy(t,e){for(var n=e.depth-t.openStart,r=e.node(n),o=r.copy(t.content),i=n-1;i>=0;i--)o=e.node(i).copy(by.from(o));return{start:o.resolveNoCache(t.openStart+n),end:o.resolveNoCache(o.content.size-t.openEnd-n)}}Ey.size.get=function(){return this.content.size-this.openStart-this.openEnd},Ty.prototype.insertAt=function(t,e){var n=Dy(this.content,t+this.openStart,e,null);return n&&new Ty(n,this.openStart,this.openEnd)},Ty.prototype.removeBetween=function(t,e){return new Ty(Ay(this.content,t+this.openStart,e+this.openStart),this.openStart,this.openEnd)},Ty.prototype.eq=function(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd},Ty.prototype.toString=function(){return this.content+"("+this.openStart+","+this.openEnd+")"},Ty.prototype.toJSON=function(){if(!this.content.size)return null;var t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t},Ty.fromJSON=function(t,e){if(!e)return Ty.empty;var n=e.openStart||0,r=e.openEnd||0;if("number"!=typeof n||"number"!=typeof r)throw new RangeError("Invalid input for Slice.fromJSON");return new Ty(by.fromJSON(t,e.content),n,r)},Ty.maxOpen=function(t,e){void 0===e&&(e=!0);for(var n=0,r=0,o=t.firstChild;o&&!o.isLeaf&&(e||!o.type.spec.isolating);o=o.firstChild)n++;for(var i=t.lastChild;i&&!i.isLeaf&&(e||!i.type.spec.isolating);i=i.lastChild)r++;return new Ty(t,n,r)},Object.defineProperties(Ty.prototype,Ey),Ty.empty=new Ty(by.empty,0,0);var Ly=function(t,e,n){this.pos=t,this.path=e,this.depth=e.length/3-1,this.parentOffset=n},Vy={parent:{configurable:!0},doc:{configurable:!0},textOffset:{configurable:!0},nodeAfter:{configurable:!0},nodeBefore:{configurable:!0}};Ly.prototype.resolveDepth=function(t){return null==t?this.depth:t<0?this.depth+t:t},Vy.parent.get=function(){return this.node(this.depth)},Vy.doc.get=function(){return this.node(0)},Ly.prototype.node=function(t){return this.path[3*this.resolveDepth(t)]},Ly.prototype.index=function(t){return this.path[3*this.resolveDepth(t)+1]},Ly.prototype.indexAfter=function(t){return t=this.resolveDepth(t),this.index(t)+(t!=this.depth||this.textOffset?1:0)},Ly.prototype.start=function(t){return t=this.resolveDepth(t),0==t?0:this.path[3*t-1]+1},Ly.prototype.end=function(t){return t=this.resolveDepth(t),this.start(t)+this.node(t).content.size},Ly.prototype.before=function(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position before the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]},Ly.prototype.after=function(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position after the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]+this.path[3*t].nodeSize},Vy.textOffset.get=function(){return this.pos-this.path[this.path.length-1]},Vy.nodeAfter.get=function(){var t=this.parent,e=this.index(this.depth);if(e==t.childCount)return null;var n=this.pos-this.path[this.path.length-1],r=t.child(e);return n?t.child(e).cut(n):r},Vy.nodeBefore.get=function(){var t=this.index(this.depth),e=this.pos-this.path[this.path.length-1];return e?this.parent.child(t).cut(0,e):0==t?null:this.parent.child(t-1)},Ly.prototype.posAtIndex=function(t,e){e=this.resolveDepth(e);for(var n=this.path[3*e],r=0==e?0:this.path[3*e-1]+1,o=0;o<t;o++)r+=n.child(o).nodeSize;return r},Ly.prototype.marks=function(){var t=this.parent,e=this.index();if(0==t.content.size)return My.none;if(this.textOffset)return t.child(e).marks;var n=t.maybeChild(e-1),r=t.maybeChild(e);if(!n){var o=n;n=r,r=o}for(var i=n.marks,s=0;s<i.length;s++)!1!==i[s].type.spec.inclusive||r&&i[s].isInSet(r.marks)||(i=i[s--].removeFromSet(i));return i},Ly.prototype.marksAcross=function(t){var e=this.parent.maybeChild(this.index());if(!e||!e.isInline)return null;for(var n=e.marks,r=t.parent.maybeChild(t.index()),o=0;o<n.length;o++)!1!==n[o].type.spec.inclusive||r&&n[o].isInSet(r.marks)||(n=n[o--].removeFromSet(n));return n},Ly.prototype.sharedDepth=function(t){for(var e=this.depth;e>0;e--)if(this.start(e)<=t&&this.end(e)>=t)return e;return 0},Ly.prototype.blockRange=function(t,e){if(void 0===t&&(t=this),t.pos<this.pos)return t.blockRange(this);for(var n=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);n>=0;n--)if(t.pos<=this.end(n)&&(!e||e(this.node(n))))return new Ky(this,t,n)},Ly.prototype.sameParent=function(t){return this.pos-this.parentOffset==t.pos-t.parentOffset},Ly.prototype.max=function(t){return t.pos>this.pos?t:this},Ly.prototype.min=function(t){return t.pos<this.pos?t:this},Ly.prototype.toString=function(){for(var t="",e=1;e<=this.depth;e++)t+=(t?"/":"")+this.node(e).type.name+"_"+this.index(e-1);return t+":"+this.parentOffset},Ly.resolve=function(t,e){if(!(e>=0&&e<=t.content.size))throw new RangeError("Position "+e+" out of range");for(var n=[],r=0,o=e,i=t;;){var s=i.content.findIndex(o),a=s.index,c=s.offset,h=o-c;if(n.push(i,a,r+c),!h)break;if(i=i.child(a),i.isText)break;o=h-1,r+=c+1}return new Ly(e,n,o)},Ly.resolveCached=function(t,e){for(var n=0;n<qy.length;n++){var r=qy[n];if(r.pos==e&&r.doc==t)return r}var o=qy[Wy]=Ly.resolve(t,e);return Wy=(Wy+1)%Hy,o},Object.defineProperties(Ly.prototype,Vy);var qy=[],Wy=0,Hy=12,Ky=function(t,e,n){this.$from=t,this.$to=e,this.depth=n},Uy={start:{configurable:!0},end:{configurable:!0},parent:{configurable:!0},startIndex:{configurable:!0},endIndex:{configurable:!0}};Uy.start.get=function(){return this.$from.before(this.depth+1)},Uy.end.get=function(){return this.$to.after(this.depth+1)},Uy.parent.get=function(){return this.$from.node(this.depth)},Uy.startIndex.get=function(){return this.$from.index(this.depth)},Uy.endIndex.get=function(){return this.$to.indexAfter(this.depth)},Object.defineProperties(Ky.prototype,Uy);var Gy=Object.create(null),Xy=function(t,e,n,r){this.type=t,this.attrs=e,this.content=n||by.empty,this.marks=r||My.none},Yy={nodeSize:{configurable:!0},childCount:{configurable:!0},textContent:{configurable:!0},firstChild:{configurable:!0},lastChild:{configurable:!0},isBlock:{configurable:!0},isTextblock:{configurable:!0},inlineContent:{configurable:!0},isInline:{configurable:!0},isText:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};Yy.nodeSize.get=function(){return this.isLeaf?1:2+this.content.size},Yy.childCount.get=function(){return this.content.childCount},Xy.prototype.child=function(t){return this.content.child(t)},Xy.prototype.maybeChild=function(t){return this.content.maybeChild(t)},Xy.prototype.forEach=function(t){this.content.forEach(t)},Xy.prototype.nodesBetween=function(t,e,n,r){void 0===r&&(r=0),this.content.nodesBetween(t,e,n,r,this)},Xy.prototype.descendants=function(t){this.nodesBetween(0,this.content.size,t)},Yy.textContent.get=function(){return this.textBetween(0,this.content.size,"")},Xy.prototype.textBetween=function(t,e,n,r){return this.content.textBetween(t,e,n,r)},Yy.firstChild.get=function(){return this.content.firstChild},Yy.lastChild.get=function(){return this.content.lastChild},Xy.prototype.eq=function(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)},Xy.prototype.sameMarkup=function(t){return this.hasMarkup(t.type,t.attrs,t.marks)},Xy.prototype.hasMarkup=function(t,e,n){return this.type==t&&Cy(this.attrs,e||t.defaultAttrs||Gy)&&My.sameSet(this.marks,n||My.none)},Xy.prototype.copy=function(t){return void 0===t&&(t=null),t==this.content?this:new this.constructor(this.type,this.attrs,t,this.marks)},Xy.prototype.mark=function(t){return t==this.marks?this:new this.constructor(this.type,this.attrs,this.content,t)},Xy.prototype.cut=function(t,e){return 0==t&&e==this.content.size?this:this.copy(this.content.cut(t,e))},Xy.prototype.slice=function(t,e,n){if(void 0===e&&(e=this.content.size),void 0===n&&(n=!1),t==e)return Ty.empty;var r=this.resolve(t),o=this.resolve(e),i=n?0:r.sharedDepth(e),s=r.start(i),a=r.node(i),c=a.content.cut(r.pos-s,o.pos-s);return new Ty(c,r.depth-i,o.depth-i)},Xy.prototype.replace=function(t,e,n){return Ry(this.resolve(t),this.resolve(e),n)},Xy.prototype.nodeAt=function(t){for(var e=this;;){var n=e.content.findIndex(t),r=n.index,o=n.offset;if(e=e.maybeChild(r),!e)return null;if(o==t||e.isText)return e;t-=o+1}},Xy.prototype.childAfter=function(t){var e=this.content.findIndex(t),n=e.index,r=e.offset;return{node:this.content.maybeChild(n),index:n,offset:r}},Xy.prototype.childBefore=function(t){if(0==t)return{node:null,index:0,offset:0};var e=this.content.findIndex(t),n=e.index,r=e.offset;if(r<t)return{node:this.content.child(n),index:n,offset:r};var o=this.content.child(n-1);return{node:o,index:n-1,offset:r-o.nodeSize}},Xy.prototype.resolve=function(t){return Ly.resolveCached(this,t)},Xy.prototype.resolveNoCache=function(t){return Ly.resolve(this,t)},Xy.prototype.rangeHasMark=function(t,e,n){var r=!1;return e>t&&this.nodesBetween(t,e,(function(t){return n.isInSet(t.marks)&&(r=!0),!r})),r},Yy.isBlock.get=function(){return this.type.isBlock},Yy.isTextblock.get=function(){return this.type.isTextblock},Yy.inlineContent.get=function(){return this.type.inlineContent},Yy.isInline.get=function(){return this.type.isInline},Yy.isText.get=function(){return this.type.isText},Yy.isLeaf.get=function(){return this.type.isLeaf},Yy.isAtom.get=function(){return this.type.isAtom},Xy.prototype.toString=function(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);var t=this.type.name;return this.content.size&&(t+="("+this.content.toStringInner()+")"),Qy(this.marks,t)},Xy.prototype.contentMatchAt=function(t){var e=this.type.contentMatch.matchFragment(this.content,0,t);if(!e)throw new Error("Called contentMatchAt on a node with invalid content");return e},Xy.prototype.canReplace=function(t,e,n,r,o){void 0===n&&(n=by.empty),void 0===r&&(r=0),void 0===o&&(o=n.childCount);var i=this.contentMatchAt(t).matchFragment(n,r,o),s=i&&i.matchFragment(this.content,e);if(!s||!s.validEnd)return!1;for(var a=r;a<o;a++)if(!this.type.allowsMarks(n.child(a).marks))return!1;return!0},Xy.prototype.canReplaceWith=function(t,e,n,r){if(r&&!this.type.allowsMarks(r))return!1;var o=this.contentMatchAt(t).matchType(n),i=o&&o.matchFragment(this.content,e);return!!i&&i.validEnd},Xy.prototype.canAppend=function(t){return t.content.size?this.canReplace(this.childCount,this.childCount,t.content):this.type.compatibleContent(t.type)},Xy.prototype.check=function(){if(!this.type.validContent(this.content))throw new RangeError("Invalid content for node "+this.type.name+": "+this.content.toString().slice(0,50));for(var t=My.none,e=0;e<this.marks.length;e++)t=this.marks[e].addToSet(t);if(!My.sameSet(t,this.marks))throw new RangeError("Invalid collection of marks for node "+this.type.name+": "+this.marks.map((function(t){return t.type.name})));this.content.forEach((function(t){return t.check()}))},Xy.prototype.toJSON=function(){var t={type:this.type.name};for(var e in this.attrs){t.attrs=this.attrs;break}return this.content.size&&(t.content=this.content.toJSON()),this.marks.length&&(t.marks=this.marks.map((function(t){return t.toJSON()}))),t},Xy.fromJSON=function(t,e){if(!e)throw new RangeError("Invalid input for Node.fromJSON");var n=null;if(e.marks){if(!Array.isArray(e.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=e.marks.map(t.markFromJSON)}if("text"==e.type){if("string"!=typeof e.text)throw new RangeError("Invalid text node in JSON");return t.text(e.text,n)}var r=by.fromJSON(t,e.content);return t.nodeType(e.type).create(e.attrs,r,n)},Object.defineProperties(Xy.prototype,Yy);var Zy=function(t){function e(e,n,r,o){if(t.call(this,e,n,null,o),!r)throw new RangeError("Empty text nodes are not allowed");this.text=r}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={textContent:{configurable:!0},nodeSize:{configurable:!0}};return e.prototype.toString=function(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):Qy(this.marks,JSON.stringify(this.text))},n.textContent.get=function(){return this.text},e.prototype.textBetween=function(t,e){return this.text.slice(t,e)},n.nodeSize.get=function(){return this.text.length},e.prototype.mark=function(t){return t==this.marks?this:new e(this.type,this.attrs,this.text,t)},e.prototype.withText=function(t){return t==this.text?this:new e(this.type,this.attrs,t,this.marks)},e.prototype.cut=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=this.text.length),0==t&&e==this.text.length?this:this.withText(this.text.slice(t,e))},e.prototype.eq=function(t){return this.sameMarkup(t)&&this.text==t.text},e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.text=this.text,e},Object.defineProperties(e.prototype,n),e}(Xy);function Qy(t,e){for(var n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}var tw=function(t){this.validEnd=t,this.next=[],this.wrapCache=[]},ew={inlineContent:{configurable:!0},defaultType:{configurable:!0},edgeCount:{configurable:!0}};tw.parse=function(t,e){var n=new nw(t,e);if(null==n.next)return tw.empty;var r=ow(n);n.next&&n.err("Unexpected trailing text");var o=dw(lw(r));return mw(o,n),o},tw.prototype.matchType=function(t){for(var e=0;e<this.next.length;e+=2)if(this.next[e]==t)return this.next[e+1];return null},tw.prototype.matchFragment=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=t.childCount);for(var r=this,o=e;r&&o<n;o++)r=r.matchType(t.child(o).type);return r},ew.inlineContent.get=function(){var t=this.next[0];return!!t&&t.isInline},ew.defaultType.get=function(){for(var t=0;t<this.next.length;t+=2){var e=this.next[t];if(!e.isText&&!e.hasRequiredAttrs())return e}},tw.prototype.compatible=function(t){for(var e=0;e<this.next.length;e+=2)for(var n=0;n<t.next.length;n+=2)if(this.next[e]==t.next[n])return!0;return!1},tw.prototype.fillBefore=function(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=0);var r=[this];function o(i,s){var a=i.matchFragment(t,n);if(a&&(!e||a.validEnd))return by.from(s.map((function(t){return t.createAndFill()})));for(var c=0;c<i.next.length;c+=2){var h=i.next[c],p=i.next[c+1];if(!h.isText&&!h.hasRequiredAttrs()&&-1==r.indexOf(p)){r.push(p);var l=o(p,s.concat(h));if(l)return l}}}return o(this,[])},tw.prototype.findWrapping=function(t){for(var e=0;e<this.wrapCache.length;e+=2)if(this.wrapCache[e]==t)return this.wrapCache[e+1];var n=this.computeWrapping(t);return this.wrapCache.push(t,n),n},tw.prototype.computeWrapping=function(t){var e=Object.create(null),n=[{match:this,type:null,via:null}];while(n.length){var r=n.shift(),o=r.match;if(o.matchType(t)){for(var i=[],s=r;s.type;s=s.via)i.push(s.type);return i.reverse()}for(var a=0;a<o.next.length;a+=2){var c=o.next[a];c.isLeaf||c.hasRequiredAttrs()||c.name in e||r.type&&!o.next[a+1].validEnd||(n.push({match:c.contentMatch,type:c,via:r}),e[c.name]=!0)}}},ew.edgeCount.get=function(){return this.next.length>>1},tw.prototype.edge=function(t){var e=t<<1;if(e>=this.next.length)throw new RangeError("There's no "+t+"th edge in this content match");return{type:this.next[e],next:this.next[e+1]}},tw.prototype.toString=function(){var t=[];function e(n){t.push(n);for(var r=1;r<n.next.length;r+=2)-1==t.indexOf(n.next[r])&&e(n.next[r])}return e(this),t.map((function(e,n){for(var r=n+(e.validEnd?"*":" ")+" ",o=0;o<e.next.length;o+=2)r+=(o?", ":"")+e.next[o].name+"->"+t.indexOf(e.next[o+1]);return r})).join("\n")},Object.defineProperties(tw.prototype,ew),tw.empty=new tw(!0);var nw=function(t,e){this.string=t,this.nodeTypes=e,this.inline=null,this.pos=0,this.tokens=t.split(/\s*(?=\b|\W|$)/),""==this.tokens[this.tokens.length-1]&&this.tokens.pop(),""==this.tokens[0]&&this.tokens.shift()},rw={next:{configurable:!0}};function ow(t){var e=[];do{e.push(iw(t))}while(t.eat("|"));return 1==e.length?e[0]:{type:"choice",exprs:e}}function iw(t){var e=[];do{e.push(sw(t))}while(t.next&&")"!=t.next&&"|"!=t.next);return 1==e.length?e[0]:{type:"seq",exprs:e}}function sw(t){for(var e=pw(t);;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else{if(!t.eat("{"))break;e=cw(t,e)}return e}function aw(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");var e=Number(t.next);return t.pos++,e}function cw(t,e){var n=aw(t),r=n;return t.eat(",")&&(r="}"!=t.next?aw(t):-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:e}}function hw(t,e){var n=t.nodeTypes,r=n[e];if(r)return[r];var o=[];for(var i in n){var s=n[i];s.groups.indexOf(e)>-1&&o.push(s)}return 0==o.length&&t.err("No node type or group '"+e+"' found"),o}function pw(t){if(t.eat("(")){var e=ow(t);return t.eat(")")||t.err("Missing closing paren"),e}if(!/\W/.test(t.next)){var n=hw(t,t.next).map((function(e){return null==t.inline?t.inline=e.isInline:t.inline!=e.isInline&&t.err("Mixing inline and block content"),{type:"name",value:e}}));return t.pos++,1==n.length?n[0]:{type:"choice",exprs:n}}t.err("Unexpected token '"+t.next+"'")}function lw(t){var e=[[]];return o(i(t,0),n()),e;function n(){return e.push([])-1}function r(t,n,r){var o={term:r,to:n};return e[t].push(o),o}function o(t,e){t.forEach((function(t){return t.to=e}))}function i(t,e){if("choice"==t.type)return t.exprs.reduce((function(t,n){return t.concat(i(n,e))}),[]);if("seq"==t.type)for(var s=0;;s++){var a=i(t.exprs[s],e);if(s==t.exprs.length-1)return a;o(a,e=n())}else{if("star"==t.type){var c=n();return r(e,c),o(i(t.expr,c),c),[r(c)]}if("plus"==t.type){var h=n();return o(i(t.expr,e),h),o(i(t.expr,h),h),[r(h)]}if("opt"==t.type)return[r(e)].concat(i(t.expr,e));if("range"==t.type){for(var p=e,l=0;l<t.min;l++){var u=n();o(i(t.expr,p),u),p=u}if(-1==t.max)o(i(t.expr,p),p);else for(var f=t.min;f<t.max;f++){var d=n();r(p,d),o(i(t.expr,p),d),p=d}return[r(p)]}if("name"==t.type)return[r(e,null,t.value)]}}}function uw(t,e){return e-t}function fw(t,e){var n=[];return r(e),n.sort(uw);function r(e){var o=t[e];if(1==o.length&&!o[0].term)return r(o[0].to);n.push(e);for(var i=0;i<o.length;i++){var s=o[i],a=s.term,c=s.to;a||-1!=n.indexOf(c)||r(c)}}}function dw(t){var e=Object.create(null);return n(fw(t,0));function n(r){var o=[];r.forEach((function(e){t[e].forEach((function(e){var n=e.term,r=e.to;if(n){var i=o.indexOf(n),s=i>-1&&o[i+1];fw(t,r).forEach((function(t){s||o.push(n,s=[]),-1==s.indexOf(t)&&s.push(t)}))}}))}));for(var i=e[r.join(",")]=new tw(r.indexOf(t.length-1)>-1),s=0;s<o.length;s+=2){var a=o[s+1].sort(uw);i.next.push(o[s],e[a.join(",")]||n(a))}return i}}function mw(t,e){for(var n=0,r=[t];n<r.length;n++){for(var o=r[n],i=!o.validEnd,s=[],a=0;a<o.next.length;a+=2){var c=o.next[a],h=o.next[a+1];s.push(c.name),!i||c.isText||c.hasRequiredAttrs()||(i=!1),-1==r.indexOf(h)&&r.push(h)}i&&e.err("Only non-generatable nodes ("+s.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function vw(t){var e=Object.create(null);for(var n in t){var r=t[n];if(!r.hasDefault)return null;e[n]=r.default}return e}function gw(t,e){var n=Object.create(null);for(var r in t){var o=e&&e[r];if(void 0===o){var i=t[r];if(!i.hasDefault)throw new RangeError("No value supplied for attribute "+r);o=i.default}n[r]=o}return n}function yw(t){var e=Object.create(null);if(t)for(var n in t)e[n]=new bw(t[n]);return e}rw.next.get=function(){return this.tokens[this.pos]},nw.prototype.eat=function(t){return this.next==t&&(this.pos++||!0)},nw.prototype.err=function(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")},Object.defineProperties(nw.prototype,rw);var ww=function(t,e,n){this.name=t,this.schema=e,this.spec=n,this.groups=n.group?n.group.split(" "):[],this.attrs=yw(n.attrs),this.defaultAttrs=vw(this.attrs),this.contentMatch=null,this.markSet=null,this.inlineContent=null,this.isBlock=!(n.inline||"text"==t),this.isText="text"==t},xw={isInline:{configurable:!0},isTextblock:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};xw.isInline.get=function(){return!this.isBlock},xw.isTextblock.get=function(){return this.isBlock&&this.inlineContent},xw.isLeaf.get=function(){return this.contentMatch==tw.empty},xw.isAtom.get=function(){return this.isLeaf||this.spec.atom},ww.prototype.hasRequiredAttrs=function(){for(var t in this.attrs)if(this.attrs[t].isRequired)return!0;return!1},ww.prototype.compatibleContent=function(t){return this==t||this.contentMatch.compatible(t.contentMatch)},ww.prototype.computeAttrs=function(t){return!t&&this.defaultAttrs?this.defaultAttrs:gw(this.attrs,t)},ww.prototype.create=function(t,e,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Xy(this,this.computeAttrs(t),by.from(e),My.setFrom(n))},ww.prototype.createChecked=function(t,e,n){if(e=by.from(e),!this.validContent(e))throw new RangeError("Invalid content for node "+this.name);return new Xy(this,this.computeAttrs(t),e,My.setFrom(n))},ww.prototype.createAndFill=function(t,e,n){if(t=this.computeAttrs(t),e=by.from(e),e.size){var r=this.contentMatch.fillBefore(e);if(!r)return null;e=r.append(e)}var o=this.contentMatch.matchFragment(e).fillBefore(by.empty,!0);return o?new Xy(this,t,e.append(o),My.setFrom(n)):null},ww.prototype.validContent=function(t){var e=this.contentMatch.matchFragment(t);if(!e||!e.validEnd)return!1;for(var n=0;n<t.childCount;n++)if(!this.allowsMarks(t.child(n).marks))return!1;return!0},ww.prototype.allowsMarkType=function(t){return null==this.markSet||this.markSet.indexOf(t)>-1},ww.prototype.allowsMarks=function(t){if(null==this.markSet)return!0;for(var e=0;e<t.length;e++)if(!this.allowsMarkType(t[e].type))return!1;return!0},ww.prototype.allowedMarks=function(t){if(null==this.markSet)return t;for(var e,n=0;n<t.length;n++)this.allowsMarkType(t[n].type)?e&&e.push(t[n]):e||(e=t.slice(0,n));return e?e.length?e:My.empty:t},ww.compile=function(t,e){var n=Object.create(null);t.forEach((function(t,r){return n[t]=new ww(t,e,r)}));var r=e.spec.topNode||"doc";if(!n[r])throw new RangeError("Schema is missing its top node type ('"+r+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(var o in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n},Object.defineProperties(ww.prototype,xw);var bw=function(t){this.hasDefault=Object.prototype.hasOwnProperty.call(t,"default"),this.default=t.default},kw={isRequired:{configurable:!0}};kw.isRequired.get=function(){return!this.hasDefault},Object.defineProperties(bw.prototype,kw);var Sw=function(t,e,n,r){this.name=t,this.schema=n,this.spec=r,this.attrs=yw(r.attrs),this.rank=e,this.excluded=null;var o=vw(this.attrs);this.instance=o&&new My(this,o)};Sw.prototype.create=function(t){return!t&&this.instance?this.instance:new My(this,gw(this.attrs,t))},Sw.compile=function(t,e){var n=Object.create(null),r=0;return t.forEach((function(t,o){return n[t]=new Sw(t,r++,e,o)})),n},Sw.prototype.removeFromSet=function(t){for(var e=0;e<t.length;e++)t[e].type==this&&(t=t.slice(0,e).concat(t.slice(e+1)),e--);return t},Sw.prototype.isInSet=function(t){for(var e=0;e<t.length;e++)if(t[e].type==this)return t[e]},Sw.prototype.excludes=function(t){return this.excluded.indexOf(t)>-1};var Ow=function(t){for(var e in this.spec={},t)this.spec[e]=t[e];this.spec.nodes=yy.from(t.nodes),this.spec.marks=yy.from(t.marks),this.nodes=ww.compile(this.spec.nodes,this),this.marks=Sw.compile(this.spec.marks,this);var n=Object.create(null);for(var r in this.nodes){if(r in this.marks)throw new RangeError(r+" can not be both a node and a mark");var o=this.nodes[r],i=o.spec.content||"",s=o.spec.marks;o.contentMatch=n[i]||(n[i]=tw.parse(i,this.nodes)),o.inlineContent=o.contentMatch.inlineContent,o.markSet="_"==s?null:s?Cw(this,s.split(" ")):""!=s&&o.inlineContent?null:[]}for(var a in this.marks){var c=this.marks[a],h=c.spec.excludes;c.excluded=null==h?[c]:""==h?[]:Cw(this,h.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached=Object.create(null),this.cached.wrappings=Object.create(null)};function Cw(t,e){for(var n=[],r=0;r<e.length;r++){var o=e[r],i=t.marks[o],s=i;if(i)n.push(i);else for(var a in t.marks){var c=t.marks[a];("_"==o||c.spec.group&&c.spec.group.split(" ").indexOf(o)>-1)&&n.push(s=c)}if(!s)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return n}Ow.prototype.node=function(t,e,n,r){if("string"==typeof t)t=this.nodeType(t);else{if(!(t instanceof ww))throw new RangeError("Invalid node type: "+t);if(t.schema!=this)throw new RangeError("Node type from different schema used ("+t.name+")")}return t.createChecked(e,n,r)},Ow.prototype.text=function(t,e){var n=this.nodes.text;return new Zy(n,n.defaultAttrs,t,My.setFrom(e))},Ow.prototype.mark=function(t,e){return"string"==typeof t&&(t=this.marks[t]),t.create(e)},Ow.prototype.nodeFromJSON=function(t){return Xy.fromJSON(this,t)},Ow.prototype.markFromJSON=function(t){return My.fromJSON(this,t)},Ow.prototype.nodeType=function(t){var e=this.nodes[t];if(!e)throw new RangeError("Unknown node type: "+t);return e};var Mw=function(t,e){var n=this;this.schema=t,this.rules=e,this.tags=[],this.styles=[],e.forEach((function(t){t.tag?n.tags.push(t):t.style&&n.styles.push(t)})),this.normalizeLists=!this.tags.some((function(e){if(!/^(ul|ol)\b/.test(e.tag)||!e.node)return!1;var n=t.nodes[e.node];return n.contentMatch.matchType(n)}))};Mw.prototype.parse=function(t,e){void 0===e&&(e={});var n=new Pw(this,e,!1);return n.addAll(t,null,e.from,e.to),n.finish()},Mw.prototype.parseSlice=function(t,e){void 0===e&&(e={});var n=new Pw(this,e,!0);return n.addAll(t,null,e.from,e.to),Ty.maxOpen(n.finish())},Mw.prototype.matchTag=function(t,e,n){for(var r=n?this.tags.indexOf(n)+1:0;r<this.tags.length;r++){var o=this.tags[r];if($w(t,o.tag)&&(void 0===o.namespace||t.namespaceURI==o.namespace)&&(!o.context||e.matchesContext(o.context))){if(o.getAttrs){var i=o.getAttrs(t);if(!1===i)continue;o.attrs=i}return o}}},Mw.prototype.matchStyle=function(t,e,n,r){for(var o=r?this.styles.indexOf(r)+1:0;o<this.styles.length;o++){var i=this.styles[o];if(!(0!=i.style.indexOf(t)||i.context&&!n.matchesContext(i.context)||i.style.length>t.length&&(61!=i.style.charCodeAt(t.length)||i.style.slice(t.length+1)!=e))){if(i.getAttrs){var s=i.getAttrs(e);if(!1===s)continue;i.attrs=s}return i}}},Mw.schemaRules=function(t){var e=[];function n(t){for(var n=null==t.priority?50:t.priority,r=0;r<e.length;r++){var o=e[r],i=null==o.priority?50:o.priority;if(i<n)break}e.splice(r,0,t)}var r=function(e){var r=t.marks[e].spec.parseDOM;r&&r.forEach((function(t){n(t=jw(t)),t.mark=e}))};for(var o in t.marks)r(o);var i=function(e){var r=t.nodes[s].spec.parseDOM;r&&r.forEach((function(t){n(t=jw(t)),t.node=s}))};for(var s in t.nodes)i();return e},Mw.fromSchema=function(t){return t.cached.domParser||(t.cached.domParser=new Mw(t,Mw.schemaRules(t)))};var Nw={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},Tw={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},Ew={ol:!0,ul:!0},Aw=1,Dw=2,Rw=4;function zw(t){return(t?Aw:0)|("full"===t?Dw:0)}var Iw=function(t,e,n,r,o,i,s){this.type=t,this.attrs=e,this.solid=o,this.match=i||(s&Rw?null:t.contentMatch),this.options=s,this.content=[],this.marks=n,this.activeMarks=My.none,this.pendingMarks=r,this.stashMarks=[]};Iw.prototype.findWrapping=function(t){if(!this.match){if(!this.type)return[];var e=this.type.contentMatch.fillBefore(by.from(t));if(!e){var n,r=this.type.contentMatch;return(n=r.findWrapping(t.type))?(this.match=r,n):null}this.match=this.type.contentMatch.matchFragment(e)}return this.match.findWrapping(t.type)},Iw.prototype.finish=function(t){if(!(this.options&Aw)){var e,n=this.content[this.content.length-1];n&&n.isText&&(e=/[ \t\r\n\u000c]+$/.exec(n.text))&&(n.text.length==e[0].length?this.content.pop():this.content[this.content.length-1]=n.withText(n.text.slice(0,n.text.length-e[0].length)))}var r=by.from(this.content);return!t&&this.match&&(r=r.append(this.match.fillBefore(by.empty,!0))),this.type?this.type.create(this.attrs,r,this.marks):r},Iw.prototype.popFromStashMark=function(t){for(var e=this.stashMarks.length-1;e>=0;e--)if(t.eq(this.stashMarks[e]))return this.stashMarks.splice(e,1)[0]},Iw.prototype.applyPending=function(t){for(var e=0,n=this.pendingMarks;e<n.length;e++){var r=n[e];(this.type?this.type.allowsMarkType(r.type):Jw(r.type,t))&&!r.isInSet(this.activeMarks)&&(this.activeMarks=r.addToSet(this.activeMarks),this.pendingMarks=r.removeFromSet(this.pendingMarks))}};var Pw=function(t,e,n){this.parser=t,this.options=e,this.isOpen=n;var r,o=e.topNode,i=zw(e.preserveWhitespace)|(n?Rw:0);r=o?new Iw(o.type,o.attrs,My.none,My.none,!0,e.topMatch||o.type.contentMatch,i):new Iw(n?null:t.schema.topNodeType,null,My.none,My.none,!0,null,i),this.nodes=[r],this.open=0,this.find=e.findPositions,this.needsBlock=!1},Fw={top:{configurable:!0},currentPos:{configurable:!0}};function Bw(t){for(var e=t.firstChild,n=null;e;e=e.nextSibling){var r=1==e.nodeType?e.nodeName.toLowerCase():null;r&&Ew.hasOwnProperty(r)&&n?(n.appendChild(e),e=n):"li"==r?n=e:r&&(n=null)}}function $w(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function _w(t){var e,n=/\s*([\w-]+)\s*:\s*([^;]+)/g,r=[];while(e=n.exec(t))r.push(e[1],e[2].trim());return r}function jw(t){var e={};for(var n in t)e[n]=t[n];return e}function Jw(t,e){var n=e.schema.nodes,r=function(r){var o=n[r];if(o.allowsMarkType(t)){var i=[],s=function(t){i.push(t);for(var n=0;n<t.edgeCount;n++){var r=t.edge(n),o=r.type,a=r.next;if(o==e)return!0;if(i.indexOf(a)<0&&s(a))return!0}};return s(o.contentMatch)?{v:!0}:void 0}};for(var o in n){var i=r(o);if(i)return i.v}}function Lw(t,e){for(var n=0;n<e.length;n++)if(t.eq(e[n]))return e[n]}Fw.top.get=function(){return this.nodes[this.open]},Pw.prototype.addDOM=function(t){if(3==t.nodeType)this.addTextNode(t);else if(1==t.nodeType){var e=t.getAttribute("style"),n=e?this.readStyles(_w(e)):null,r=this.top;if(null!=n)for(var o=0;o<n.length;o++)this.addPendingMark(n[o]);if(this.addElement(t),null!=n)for(var i=0;i<n.length;i++)this.removePendingMark(n[i],r)}},Pw.prototype.addTextNode=function(t){var e=t.nodeValue,n=this.top;if(n.options&Dw||(n.type?n.type.inlineContent:n.content.length&&n.content[0].isInline)||/[^ \t\r\n\u000c]/.test(e)){if(n.options&Aw)e=n.options&Dw?e.replace(/\r\n?/g,"\n"):e.replace(/\r?\n|\r/g," ");else if(e=e.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(e)&&this.open==this.nodes.length-1){var r=n.content[n.content.length-1],o=t.previousSibling;(!r||o&&"BR"==o.nodeName||r.isText&&/[ \t\r\n\u000c]$/.test(r.text))&&(e=e.slice(1))}e&&this.insertNode(this.parser.schema.text(e)),this.findInText(t)}else this.findInside(t)},Pw.prototype.addElement=function(t,e){var n,r=t.nodeName.toLowerCase();Ew.hasOwnProperty(r)&&this.parser.normalizeLists&&Bw(t);var o=this.options.ruleFromNode&&this.options.ruleFromNode(t)||(n=this.parser.matchTag(t,this,e));if(o?o.ignore:Tw.hasOwnProperty(r))this.findInside(t),this.ignoreFallback(t);else if(!o||o.skip||o.closeParent){o&&o.closeParent?this.open=Math.max(0,this.open-1):o&&o.skip.nodeType&&(t=o.skip);var i,s=this.top,a=this.needsBlock;if(Nw.hasOwnProperty(r))i=!0,s.type||(this.needsBlock=!0);else if(!t.firstChild)return void this.leafFallback(t);this.addAll(t),i&&this.sync(s),this.needsBlock=a}else this.addElementByRule(t,o,!1===o.consuming?n:null)},Pw.prototype.leafFallback=function(t){"BR"==t.nodeName&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(t.ownerDocument.createTextNode("\n"))},Pw.prototype.ignoreFallback=function(t){"BR"!=t.nodeName||this.top.type&&this.top.type.inlineContent||this.findPlace(this.parser.schema.text("-"))},Pw.prototype.readStyles=function(t){var e=My.none;t:for(var n=0;n<t.length;n+=2)for(var r=null;;){var o=this.parser.matchStyle(t[n],t[n+1],this,r);if(!o)continue t;if(o.ignore)return null;if(e=this.parser.schema.marks[o.mark].create(o.attrs).addToSet(e),!1!==o.consuming)break;r=o}return e},Pw.prototype.addElementByRule=function(t,e,n){var r,o,i,s,a=this;e.node?(o=this.parser.schema.nodes[e.node],o.isLeaf?this.insertNode(o.create(e.attrs))||this.leafFallback(t):r=this.enter(o,e.attrs,e.preserveWhitespace)):(i=this.parser.schema.marks[e.mark],s=i.create(e.attrs),this.addPendingMark(s));var c=this.top;if(o&&o.isLeaf)this.findInside(t);else if(n)this.addElement(t,n);else if(e.getContent)this.findInside(t),e.getContent(t,this.parser.schema).forEach((function(t){return a.insertNode(t)}));else{var h=e.contentElement;"string"==typeof h?h=t.querySelector(h):"function"==typeof h&&(h=h(t)),h||(h=t),this.findAround(t,h,!0),this.addAll(h,r)}r&&(this.sync(c),this.open--),s&&this.removePendingMark(s,c)},Pw.prototype.addAll=function(t,e,n,r){for(var o=n||0,i=n?t.childNodes[n]:t.firstChild,s=null==r?null:t.childNodes[r];i!=s;i=i.nextSibling,++o)this.findAtPoint(t,o),this.addDOM(i),e&&Nw.hasOwnProperty(i.nodeName.toLowerCase())&&this.sync(e);this.findAtPoint(t,o)},Pw.prototype.findPlace=function(t){for(var e,n,r=this.open;r>=0;r--){var o=this.nodes[r],i=o.findWrapping(t);if(i&&(!e||e.length>i.length)&&(e=i,n=o,!i.length))break;if(o.solid)break}if(!e)return!1;this.sync(n);for(var s=0;s<e.length;s++)this.enterInner(e[s],null,!1);return!0},Pw.prototype.insertNode=function(t){if(t.isInline&&this.needsBlock&&!this.top.type){var e=this.textblockFromContext();e&&this.enterInner(e)}if(this.findPlace(t)){this.closeExtra();var n=this.top;n.applyPending(t.type),n.match&&(n.match=n.match.matchType(t.type));for(var r=n.activeMarks,o=0;o<t.marks.length;o++)n.type&&!n.type.allowsMarkType(t.marks[o].type)||(r=t.marks[o].addToSet(r));return n.content.push(t.mark(r)),!0}return!1},Pw.prototype.enter=function(t,e,n){var r=this.findPlace(t.create(e));return r&&this.enterInner(t,e,!0,n),r},Pw.prototype.enterInner=function(t,e,n,r){this.closeExtra();var o=this.top;o.applyPending(t),o.match=o.match&&o.match.matchType(t,e);var i=null==r?o.options&~Rw:zw(r);o.options&Rw&&0==o.content.length&&(i|=Rw),this.nodes.push(new Iw(t,e,o.activeMarks,o.pendingMarks,n,null,i)),this.open++},Pw.prototype.closeExtra=function(t){var e=this.nodes.length-1;if(e>this.open){for(;e>this.open;e--)this.nodes[e-1].content.push(this.nodes[e].finish(t));this.nodes.length=this.open+1}},Pw.prototype.finish=function(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)},Pw.prototype.sync=function(t){for(var e=this.open;e>=0;e--)if(this.nodes[e]==t)return void(this.open=e)},Fw.currentPos.get=function(){this.closeExtra();for(var t=0,e=this.open;e>=0;e--){for(var n=this.nodes[e].content,r=n.length-1;r>=0;r--)t+=n[r].nodeSize;e&&t++}return t},Pw.prototype.findAtPoint=function(t,e){if(this.find)for(var n=0;n<this.find.length;n++)this.find[n].node==t&&this.find[n].offset==e&&(this.find[n].pos=this.currentPos)},Pw.prototype.findInside=function(t){if(this.find)for(var e=0;e<this.find.length;e++)null==this.find[e].pos&&1==t.nodeType&&t.contains(this.find[e].node)&&(this.find[e].pos=this.currentPos)},Pw.prototype.findAround=function(t,e,n){if(t!=e&&this.find)for(var r=0;r<this.find.length;r++)if(null==this.find[r].pos&&1==t.nodeType&&t.contains(this.find[r].node)){var o=e.compareDocumentPosition(this.find[r].node);o&(n?2:4)&&(this.find[r].pos=this.currentPos)}},Pw.prototype.findInText=function(t){if(this.find)for(var e=0;e<this.find.length;e++)this.find[e].node==t&&(this.find[e].pos=this.currentPos-(t.nodeValue.length-this.find[e].offset))},Pw.prototype.matchesContext=function(t){var e=this;if(t.indexOf("|")>-1)return t.split(/\s*\|\s*/).some(this.matchesContext,this);var n=t.split("/"),r=this.options.context,o=!this.isOpen&&(!r||r.parent.type==this.nodes[0].type),i=-(r?r.depth+1:0)+(o?0:1),s=function(t,a){for(;t>=0;t--){var c=n[t];if(""==c){if(t==n.length-1||0==t)continue;for(;a>=i;a--)if(s(t-1,a))return!0;return!1}var h=a>0||0==a&&o?e.nodes[a].type:r&&a>=i?r.node(a-i).type:null;if(!h||h.name!=c&&-1==h.groups.indexOf(c))return!1;a--}return!0};return s(n.length-1,this.open)},Pw.prototype.textblockFromContext=function(){var t=this.options.context;if(t)for(var e=t.depth;e>=0;e--){var n=t.node(e).contentMatchAt(t.indexAfter(e)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(var r in this.parser.schema.nodes){var o=this.parser.schema.nodes[r];if(o.isTextblock&&o.defaultAttrs)return o}},Pw.prototype.addPendingMark=function(t){var e=Lw(t,this.top.pendingMarks);e&&this.top.stashMarks.push(e),this.top.pendingMarks=t.addToSet(this.top.pendingMarks)},Pw.prototype.removePendingMark=function(t,e){for(var n=this.open;n>=0;n--){var r=this.nodes[n],o=r.pendingMarks.lastIndexOf(t);if(o>-1)r.pendingMarks=t.removeFromSet(r.pendingMarks);else{r.activeMarks=t.removeFromSet(r.activeMarks);var i=r.popFromStashMark(t);i&&r.type&&r.type.allowsMarkType(i.type)&&(r.activeMarks=i.addToSet(r.activeMarks))}if(r==e)break}},Object.defineProperties(Pw.prototype,Fw);var Vw=function(t,e){this.nodes=t||{},this.marks=e||{}};function qw(t){var e={};for(var n in t){var r=t[n].spec.toDOM;r&&(e[n]=r)}return e}function Ww(t){return t.document||window.document}Vw.prototype.serializeFragment=function(t,e,n){var r=this;void 0===e&&(e={}),n||(n=Ww(e).createDocumentFragment());var o=n,i=null;return t.forEach((function(t){if(i||t.marks.length){i||(i=[]);var n=0,s=0;while(n<i.length&&s<t.marks.length){var a=t.marks[s];if(r.marks[a.type.name]){if(!a.eq(i[n])||!1===a.type.spec.spanning)break;n+=2,s++}else s++}while(n<i.length)o=i.pop(),i.pop();while(s<t.marks.length){var c=t.marks[s++],h=r.serializeMark(c,t.isInline,e);h&&(i.push(c,o),o.appendChild(h.dom),o=h.contentDOM||h.dom)}}o.appendChild(r.serializeNode(t,e))})),n},Vw.prototype.serializeNode=function(t,e){void 0===e&&(e={});var n=Vw.renderSpec(Ww(e),this.nodes[t.type.name](t)),r=n.dom,o=n.contentDOM;if(o){if(t.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");e.onContent?e.onContent(t,o,e):this.serializeFragment(t.content,e,o)}return r},Vw.prototype.serializeNodeAndMarks=function(t,e){void 0===e&&(e={});for(var n=this.serializeNode(t,e),r=t.marks.length-1;r>=0;r--){var o=this.serializeMark(t.marks[r],t.isInline,e);o&&((o.contentDOM||o.dom).appendChild(n),n=o.dom)}return n},Vw.prototype.serializeMark=function(t,e,n){void 0===n&&(n={});var r=this.marks[t.type.name];return r&&Vw.renderSpec(Ww(n),r(t,e))},Vw.renderSpec=function(t,e,n){if(void 0===n&&(n=null),"string"==typeof e)return{dom:t.createTextNode(e)};if(null!=e.nodeType)return{dom:e};if(e.dom&&null!=e.dom.nodeType)return e;var r=e[0],o=r.indexOf(" ");o>0&&(n=r.slice(0,o),r=r.slice(o+1));var i=null,s=n?t.createElementNS(n,r):t.createElement(r),a=e[1],c=1;if(a&&"object"==typeof a&&null==a.nodeType&&!Array.isArray(a))for(var h in c=2,a)if(null!=a[h]){var p=h.indexOf(" ");p>0?s.setAttributeNS(h.slice(0,p),h.slice(p+1),a[h]):s.setAttribute(h,a[h])}for(var l=c;l<e.length;l++){var u=e[l];if(0===u){if(l<e.length-1||l>c)throw new RangeError("Content hole must be the only child of its parent node");return{dom:s,contentDOM:s}}var f=Vw.renderSpec(t,u,n),d=f.dom,m=f.contentDOM;if(s.appendChild(d),m){if(i)throw new RangeError("Multiple content holes");i=m}}return{dom:s,contentDOM:i}},Vw.fromSchema=function(t){return t.cached.domSerializer||(t.cached.domSerializer=new Vw(this.nodesFromSchema(t),this.marksFromSchema(t)))},Vw.nodesFromSchema=function(t){var e=qw(t.nodes);return e.text||(e.text=function(t){return t.text}),e},Vw.marksFromSchema=function(t){return qw(t.marks)};var Hw=65535,Kw=Math.pow(2,16);function Uw(t,e){return t+e*Kw}function Gw(t){return t&Hw}function Xw(t){return(t-(t&Hw))/Kw}var Yw=function(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=null),this.pos=t,this.deleted=e,this.recover=n},Zw=function(t,e){void 0===e&&(e=!1),this.ranges=t,this.inverted=e};Zw.prototype.recover=function(t){var e=0,n=Gw(t);if(!this.inverted)for(var r=0;r<n;r++)e+=this.ranges[3*r+2]-this.ranges[3*r+1];return this.ranges[3*n]+e+Xw(t)},Zw.prototype.mapResult=function(t,e){return void 0===e&&(e=1),this._map(t,e,!1)},Zw.prototype.map=function(t,e){return void 0===e&&(e=1),this._map(t,e,!0)},Zw.prototype._map=function(t,e,n){for(var r=0,o=this.inverted?2:1,i=this.inverted?1:2,s=0;s<this.ranges.length;s+=3){var a=this.ranges[s]-(this.inverted?r:0);if(a>t)break;var c=this.ranges[s+o],h=this.ranges[s+i],p=a+c;if(t<=p){var l=c?t==a?-1:t==p?1:e:e,u=a+r+(l<0?0:h);if(n)return u;var f=t==(e<0?a:p)?null:Uw(s/3,t-a);return new Yw(u,e<0?t!=a:t!=p,f)}r+=h-c}return n?t+r:new Yw(t+r)},Zw.prototype.touches=function(t,e){for(var n=0,r=Gw(e),o=this.inverted?2:1,i=this.inverted?1:2,s=0;s<this.ranges.length;s+=3){var a=this.ranges[s]-(this.inverted?n:0);if(a>t)break;var c=this.ranges[s+o],h=a+c;if(t<=h&&s==3*r)return!0;n+=this.ranges[s+i]-c}return!1},Zw.prototype.forEach=function(t){for(var e=this.inverted?2:1,n=this.inverted?1:2,r=0,o=0;r<this.ranges.length;r+=3){var i=this.ranges[r],s=i-(this.inverted?o:0),a=i+(this.inverted?0:o),c=this.ranges[r+e],h=this.ranges[r+n];t(s,s+c,a,a+h),o+=h-c}},Zw.prototype.invert=function(){return new Zw(this.ranges,!this.inverted)},Zw.prototype.toString=function(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)},Zw.offset=function(t){return 0==t?Zw.empty:new Zw(t<0?[0,-t,0]:[0,0,t])},Zw.empty=new Zw([]);var Qw=function(t,e,n,r){this.maps=t||[],this.from=n||0,this.to=null==r?this.maps.length:r,this.mirror=e};function tx(t){var e=Error.call(this,t);return e.__proto__=tx.prototype,e}Qw.prototype.slice=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=this.maps.length),new Qw(this.maps,this.mirror,t,e)},Qw.prototype.copy=function(){return new Qw(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)},Qw.prototype.appendMap=function(t,e){this.to=this.maps.push(t),null!=e&&this.setMirror(this.maps.length-1,e)},Qw.prototype.appendMapping=function(t){for(var e=0,n=this.maps.length;e<t.maps.length;e++){var r=t.getMirror(e);this.appendMap(t.maps[e],null!=r&&r<e?n+r:null)}},Qw.prototype.getMirror=function(t){if(this.mirror)for(var e=0;e<this.mirror.length;e++)if(this.mirror[e]==t)return this.mirror[e+(e%2?-1:1)]},Qw.prototype.setMirror=function(t,e){this.mirror||(this.mirror=[]),this.mirror.push(t,e)},Qw.prototype.appendMappingInverted=function(t){for(var e=t.maps.length-1,n=this.maps.length+t.maps.length;e>=0;e--){var r=t.getMirror(e);this.appendMap(t.maps[e].invert(),null!=r&&r>e?n-r-1:null)}},Qw.prototype.invert=function(){var t=new Qw;return t.appendMappingInverted(this),t},Qw.prototype.map=function(t,e){if(void 0===e&&(e=1),this.mirror)return this._map(t,e,!0);for(var n=this.from;n<this.to;n++)t=this.maps[n].map(t,e);return t},Qw.prototype.mapResult=function(t,e){return void 0===e&&(e=1),this._map(t,e,!1)},Qw.prototype._map=function(t,e,n){for(var r=!1,o=this.from;o<this.to;o++){var i=this.maps[o],s=i.mapResult(t,e);if(null!=s.recover){var a=this.getMirror(o);if(null!=a&&a>o&&a<this.to){o=a,t=this.maps[a].recover(s.recover);continue}}s.deleted&&(r=!0),t=s.pos}return n?t:new Yw(t,r)},tx.prototype=Object.create(Error.prototype),tx.prototype.constructor=tx,tx.prototype.name="TransformError";var ex=function(t){this.doc=t,this.steps=[],this.docs=[],this.mapping=new Qw},nx={before:{configurable:!0},docChanged:{configurable:!0}};function rx(){throw new Error("Override me")}nx.before.get=function(){return this.docs.length?this.docs[0]:this.doc},ex.prototype.step=function(t){var e=this.maybeStep(t);if(e.failed)throw new tx(e.failed);return this},ex.prototype.maybeStep=function(t){var e=t.apply(this.doc);return e.failed||this.addStep(t,e.doc),e},nx.docChanged.get=function(){return this.steps.length>0},ex.prototype.addStep=function(t,e){this.docs.push(this.doc),this.steps.push(t),this.mapping.appendMap(t.getMap()),this.doc=e},Object.defineProperties(ex.prototype,nx);var ox=Object.create(null),ix=function(){};ix.prototype.apply=function(t){return rx()},ix.prototype.getMap=function(){return Zw.empty},ix.prototype.invert=function(t){return rx()},ix.prototype.map=function(t){return rx()},ix.prototype.merge=function(t){return null},ix.prototype.toJSON=function(){return rx()},ix.fromJSON=function(t,e){if(!e||!e.stepType)throw new RangeError("Invalid input for Step.fromJSON");var n=ox[e.stepType];if(!n)throw new RangeError("No step type "+e.stepType+" defined");return n.fromJSON(t,e)},ix.jsonID=function(t,e){if(t in ox)throw new RangeError("Duplicate use of step JSON ID "+t);return ox[t]=e,e.prototype.jsonID=t,e};var sx=function(t,e){this.doc=t,this.failed=e};sx.ok=function(t){return new sx(t,null)},sx.fail=function(t){return new sx(null,t)},sx.fromReplace=function(t,e,n,r){try{return sx.ok(t.replace(e,n,r))}catch(o){if(o instanceof Ny)return sx.fail(o.message);throw o}};var ax=function(t){function e(e,n,r,o){t.call(this),this.from=e,this.to=n,this.slice=r,this.structure=!!o}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(t){return this.structure&&hx(t,this.from,this.to)?sx.fail("Structure replace would overwrite content"):sx.fromReplace(t,this.from,this.to,this.slice)},e.prototype.getMap=function(){return new Zw([this.from,this.to-this.from,this.slice.size])},e.prototype.invert=function(t){return new e(this.from,this.from+this.slice.size,t.slice(this.from,this.to))},e.prototype.map=function(t){var n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return n.deleted&&r.deleted?null:new e(n.pos,Math.max(n.pos,r.pos),this.slice)},e.prototype.merge=function(t){if(!(t instanceof e)||t.structure||this.structure)return null;if(this.from+this.slice.size!=t.from||this.slice.openEnd||t.slice.openStart){if(t.to!=this.from||this.slice.openStart||t.slice.openEnd)return null;var n=this.slice.size+t.slice.size==0?Ty.empty:new Ty(t.slice.content.append(this.slice.content),t.slice.openStart,this.slice.openEnd);return new e(t.from,this.to,n,this.structure)}var r=this.slice.size+t.slice.size==0?Ty.empty:new Ty(this.slice.content.append(t.slice.content),this.slice.openStart,t.slice.openEnd);return new e(this.from,this.to+(t.to-t.from),r,this.structure)},e.prototype.toJSON=function(){var t={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t},e.fromJSON=function(t,n){if("number"!=typeof n.from||"number"!=typeof n.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new e(n.from,n.to,Ty.fromJSON(t,n.slice),!!n.structure)},e}(ix);ix.jsonID("replace",ax);var cx=function(t){function e(e,n,r,o,i,s,a){t.call(this),this.from=e,this.to=n,this.gapFrom=r,this.gapTo=o,this.slice=i,this.insert=s,this.structure=!!a}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(t){if(this.structure&&(hx(t,this.from,this.gapFrom)||hx(t,this.gapTo,this.to)))return sx.fail("Structure gap-replace would overwrite content");var e=t.slice(this.gapFrom,this.gapTo);if(e.openStart||e.openEnd)return sx.fail("Gap is not a flat range");var n=this.slice.insertAt(this.insert,e.content);return n?sx.fromReplace(t,this.from,this.to,n):sx.fail("Content does not fit in gap")},e.prototype.getMap=function(){return new Zw([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])},e.prototype.invert=function(t){var n=this.gapTo-this.gapFrom;return new e(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)},e.prototype.map=function(t){var n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1),o=t.map(this.gapFrom,-1),i=t.map(this.gapTo,1);return n.deleted&&r.deleted||o<n.pos||i>r.pos?null:new e(n.pos,r.pos,o,i,this.slice,this.insert,this.structure)},e.prototype.toJSON=function(){var t={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t},e.fromJSON=function(t,n){if("number"!=typeof n.from||"number"!=typeof n.to||"number"!=typeof n.gapFrom||"number"!=typeof n.gapTo||"number"!=typeof n.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new e(n.from,n.to,n.gapFrom,n.gapTo,Ty.fromJSON(t,n.slice),n.insert,!!n.structure)},e}(ix);function hx(t,e,n){var r=t.resolve(e),o=n-e,i=r.depth;while(o>0&&i>0&&r.indexAfter(i)==r.node(i).childCount)i--,o--;if(o>0){var s=r.node(i).maybeChild(r.indexAfter(i));while(o>0){if(!s||s.isLeaf)return!0;s=s.firstChild,o--}}return!1}function px(t,e,n){return(0==e||t.canReplace(e,t.childCount))&&(n==t.childCount||t.canReplace(0,n))}function lx(t){for(var e=t.parent,n=e.content.cutByIndex(t.startIndex,t.endIndex),r=t.depth;;--r){var o=t.$from.node(r),i=t.$from.index(r),s=t.$to.indexAfter(r);if(r<t.depth&&o.canReplace(i,s,n))return r;if(0==r||o.type.spec.isolating||!px(o,i,s))break}}function ux(t,e,n,r){void 0===r&&(r=t);var o=dx(t,e),i=o&&mx(r,e);return i?o.map(fx).concat({type:e,attrs:n}).concat(i.map(fx)):null}function fx(t){return{type:t,attrs:null}}function dx(t,e){var n=t.parent,r=t.startIndex,o=t.endIndex,i=n.contentMatchAt(r).findWrapping(e);if(!i)return null;var s=i.length?i[0]:e;return n.canReplaceWith(r,o,s)?i:null}function mx(t,e){var n=t.parent,r=t.startIndex,o=t.endIndex,i=n.child(r),s=e.contentMatch.findWrapping(i.type);if(!s)return null;for(var a=s.length?s[s.length-1]:e,c=a.contentMatch,h=r;c&&h<o;h++)c=c.matchType(n.child(h).type);return c&&c.validEnd?s:null}function vx(t,e,n){var r=t.resolve(e),o=r.index();return r.parent.canReplaceWith(o,o+1,n)}function gx(t,e,n,r){void 0===n&&(n=1);var o=t.resolve(e),i=o.depth-n,s=r&&r[r.length-1]||o.parent;if(i<0||o.parent.type.spec.isolating||!o.parent.canReplace(o.index(),o.parent.childCount)||!s.type.validContent(o.parent.content.cutByIndex(o.index(),o.parent.childCount)))return!1;for(var a=o.depth-1,c=n-2;a>i;a--,c--){var h=o.node(a),p=o.index(a);if(h.type.spec.isolating)return!1;var l=h.content.cutByIndex(p,h.childCount),u=r&&r[c]||h;if(u!=h&&(l=l.replaceChild(0,u.type.create(u.attrs))),!h.canReplace(p+1,h.childCount)||!u.type.validContent(l))return!1}var f=o.indexAfter(i),d=r&&r[0];return o.node(i).canReplaceWith(f,f,d?d.type:o.node(i+1).type)}function yx(t,e){var n=t.resolve(e),r=n.index();return wx(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(r,r+1)}function wx(t,e){return t&&e&&!t.isLeaf&&t.canAppend(e)}function xx(t,e,n){var r=t.resolve(e);if(r.parent.canReplaceWith(r.index(),r.index(),n))return e;if(0==r.parentOffset)for(var o=r.depth-1;o>=0;o--){var i=r.index(o);if(r.node(o).canReplaceWith(i,i,n))return r.before(o+1);if(i>0)return null}if(r.parentOffset==r.parent.content.size)for(var s=r.depth-1;s>=0;s--){var a=r.indexAfter(s);if(r.node(s).canReplaceWith(a,a,n))return r.after(s+1);if(a<r.node(s).childCount)return null}}function bx(t,e,n){for(var r=[],o=0;o<t.childCount;o++){var i=t.child(o);i.content.size&&(i=i.copy(bx(i.content,e,i))),i.isInline&&(i=e(i,n,o)),r.push(i)}return by.fromArray(r)}ix.jsonID("replaceAround",cx),ex.prototype.lift=function(t,e){for(var n=t.$from,r=t.$to,o=t.depth,i=n.before(o+1),s=r.after(o+1),a=i,c=s,h=by.empty,p=0,l=o,u=!1;l>e;l--)u||n.index(l)>0?(u=!0,h=by.from(n.node(l).copy(h)),p++):a--;for(var f=by.empty,d=0,m=o,v=!1;m>e;m--)v||r.after(m+1)<r.end(m)?(v=!0,f=by.from(r.node(m).copy(f)),d++):c++;return this.step(new cx(a,c,i,s,new Ty(h.append(f),p,d),h.size-p,!0))},ex.prototype.wrap=function(t,e){for(var n=by.empty,r=e.length-1;r>=0;r--)n=by.from(e[r].type.create(e[r].attrs,n));var o=t.start,i=t.end;return this.step(new cx(o,i,o,i,new Ty(n,0,0),e.length,!0))},ex.prototype.setBlockType=function(t,e,n,r){var o=this;if(void 0===e&&(e=t),!n.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");var i=this.steps.length;return this.doc.nodesBetween(t,e,(function(t,e){if(t.isTextblock&&!t.hasMarkup(n,r)&&vx(o.doc,o.mapping.slice(i).map(e),n)){o.clearIncompatible(o.mapping.slice(i).map(e,1),n);var s=o.mapping.slice(i),a=s.map(e,1),c=s.map(e+t.nodeSize,1);return o.step(new cx(a,c,a+1,c-1,new Ty(by.from(n.create(r,null,t.marks)),0,0),1,!0)),!1}})),this},ex.prototype.setNodeMarkup=function(t,e,n,r){var o=this.doc.nodeAt(t);if(!o)throw new RangeError("No node at given position");e||(e=o.type);var i=e.create(n,null,r||o.marks);if(o.isLeaf)return this.replaceWith(t,t+o.nodeSize,i);if(!e.validContent(o.content))throw new RangeError("Invalid content for node type "+e.name);return this.step(new cx(t,t+o.nodeSize,t+1,t+o.nodeSize-1,new Ty(by.from(i),0,0),1,!0))},ex.prototype.split=function(t,e,n){void 0===e&&(e=1);for(var r=this.doc.resolve(t),o=by.empty,i=by.empty,s=r.depth,a=r.depth-e,c=e-1;s>a;s--,c--){o=by.from(r.node(s).copy(o));var h=n&&n[c];i=by.from(h?h.type.create(h.attrs,i):r.node(s).copy(i))}return this.step(new ax(t,t,new Ty(o.append(i),e,e),!0))},ex.prototype.join=function(t,e){void 0===e&&(e=1);var n=new ax(t-e,t+e,Ty.empty,!0);return this.step(n)};var kx=function(t){function e(e,n,r){t.call(this),this.from=e,this.to=n,this.mark=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(t){var e=this,n=t.slice(this.from,this.to),r=t.resolve(this.from),o=r.node(r.sharedDepth(this.to)),i=new Ty(bx(n.content,(function(t,n){return t.isAtom&&n.type.allowsMarkType(e.mark.type)?t.mark(e.mark.addToSet(t.marks)):t}),o),n.openStart,n.openEnd);return sx.fromReplace(t,this.from,this.to,i)},e.prototype.invert=function(){return new Sx(this.from,this.to,this.mark)},e.prototype.map=function(t){var n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new e(n.pos,r.pos,this.mark)},e.prototype.merge=function(t){if(t instanceof e&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from)return new e(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark)},e.prototype.toJSON=function(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},e.fromJSON=function(t,n){if("number"!=typeof n.from||"number"!=typeof n.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new e(n.from,n.to,t.markFromJSON(n.mark))},e}(ix);ix.jsonID("addMark",kx);var Sx=function(t){function e(e,n,r){t.call(this),this.from=e,this.to=n,this.mark=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(t){var e=this,n=t.slice(this.from,this.to),r=new Ty(bx(n.content,(function(t){return t.mark(e.mark.removeFromSet(t.marks))})),n.openStart,n.openEnd);return sx.fromReplace(t,this.from,this.to,r)},e.prototype.invert=function(){return new kx(this.from,this.to,this.mark)},e.prototype.map=function(t){var n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new e(n.pos,r.pos,this.mark)},e.prototype.merge=function(t){if(t instanceof e&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from)return new e(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark)},e.prototype.toJSON=function(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},e.fromJSON=function(t,n){if("number"!=typeof n.from||"number"!=typeof n.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new e(n.from,n.to,t.markFromJSON(n.mark))},e}(ix);function Ox(t,e,n,r){if(void 0===n&&(n=e),void 0===r&&(r=Ty.empty),e==n&&!r.size)return null;var o=t.resolve(e),i=t.resolve(n);return Cx(o,i,r)?new ax(e,n,r):new Mx(o,i,r).fit()}function Cx(t,e,n){return!n.openStart&&!n.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),n.content)}ix.jsonID("removeMark",Sx),ex.prototype.addMark=function(t,e,n){var r=this,o=[],i=[],s=null,a=null;return this.doc.nodesBetween(t,e,(function(r,c,h){if(r.isInline){var p=r.marks;if(!n.isInSet(p)&&h.type.allowsMarkType(n.type)){for(var l=Math.max(c,t),u=Math.min(c+r.nodeSize,e),f=n.addToSet(p),d=0;d<p.length;d++)p[d].isInSet(f)||(s&&s.to==l&&s.mark.eq(p[d])?s.to=u:o.push(s=new Sx(l,u,p[d])));a&&a.to==l?a.to=u:i.push(a=new kx(l,u,n))}}})),o.forEach((function(t){return r.step(t)})),i.forEach((function(t){return r.step(t)})),this},ex.prototype.removeMark=function(t,e,n){var r=this;void 0===n&&(n=null);var o=[],i=0;return this.doc.nodesBetween(t,e,(function(r,s){if(r.isInline){i++;var a=null;if(n instanceof Sw){var c,h=r.marks;while(c=n.isInSet(h))(a||(a=[])).push(c),h=c.removeFromSet(h)}else n?n.isInSet(r.marks)&&(a=[n]):a=r.marks;if(a&&a.length)for(var p=Math.min(s+r.nodeSize,e),l=0;l<a.length;l++){for(var u=a[l],f=void 0,d=0;d<o.length;d++){var m=o[d];m.step==i-1&&u.eq(o[d].style)&&(f=m)}f?(f.to=p,f.step=i):o.push({style:u,from:Math.max(s,t),to:p,step:i})}}})),o.forEach((function(t){return r.step(new Sx(t.from,t.to,t.style))})),this},ex.prototype.clearIncompatible=function(t,e,n){void 0===n&&(n=e.contentMatch);for(var r=this.doc.nodeAt(t),o=[],i=t+1,s=0;s<r.childCount;s++){var a=r.child(s),c=i+a.nodeSize,h=n.matchType(a.type,a.attrs);if(h){n=h;for(var p=0;p<a.marks.length;p++)e.allowsMarkType(a.marks[p].type)||this.step(new Sx(i,c,a.marks[p]))}else o.push(new ax(i,c,Ty.empty));i=c}if(!n.validEnd){var l=n.fillBefore(by.empty,!0);this.replace(i,i,new Ty(l,0,0))}for(var u=o.length-1;u>=0;u--)this.step(o[u]);return this},ex.prototype.replace=function(t,e,n){void 0===e&&(e=t),void 0===n&&(n=Ty.empty);var r=Ox(this.doc,t,e,n);return r&&this.step(r),this},ex.prototype.replaceWith=function(t,e,n){return this.replace(t,e,new Ty(by.from(n),0,0))},ex.prototype.delete=function(t,e){return this.replace(t,e,Ty.empty)},ex.prototype.insert=function(t,e){return this.replaceWith(t,t,e)};var Mx=function(t,e,n){this.$to=e,this.$from=t,this.unplaced=n,this.frontier=[];for(var r=0;r<=t.depth;r++){var o=t.node(r);this.frontier.push({type:o.type,match:o.contentMatchAt(t.indexAfter(r))})}this.placed=by.empty;for(var i=t.depth;i>0;i--)this.placed=by.from(t.node(i).copy(this.placed))},Nx={depth:{configurable:!0}};function Tx(t,e,n){return 0==e?t.cutByIndex(n):t.replaceChild(0,t.firstChild.copy(Tx(t.firstChild.content,e-1,n)))}function Ex(t,e,n){return 0==e?t.append(n):t.replaceChild(t.childCount-1,t.lastChild.copy(Ex(t.lastChild.content,e-1,n)))}function Ax(t,e){for(var n=0;n<e;n++)t=t.firstChild.content;return t}function Dx(t,e,n){if(e<=0)return t;var r=t.content;return e>1&&(r=r.replaceChild(0,Dx(r.firstChild,e-1,1==r.childCount?n-1:0))),e>0&&(r=t.type.contentMatch.fillBefore(r).append(r),n<=0&&(r=r.append(t.type.contentMatch.matchFragment(r).fillBefore(by.empty,!0)))),t.copy(r)}function Rx(t,e,n,r,o){var i=t.node(e),s=o?t.indexAfter(e):t.index(e);if(s==i.childCount&&!n.compatibleContent(i.type))return null;var a=r.fillBefore(i.content,!0,s);return a&&!zx(n,i.content,s)?a:null}function zx(t,e,n){for(var r=n;r<e.childCount;r++)if(!t.allowsMarks(e.child(r).marks))return!0;return!1}function Ix(t,e,n,r,o){if(e<n){var i=t.firstChild;t=t.replaceChild(0,i.copy(Ix(i.content,e+1,n,r,i)))}if(e>r){var s=o.contentMatchAt(0),a=s.fillBefore(t).append(t);t=a.append(s.matchFragment(a).fillBefore(by.empty,!0))}return t}function Px(t,e){for(var n=[],r=Math.min(t.depth,e.depth),o=r;o>=0;o--){var i=t.start(o);if(i<t.pos-(t.depth-o)||e.end(o)>e.pos+(e.depth-o)||t.node(o).type.spec.isolating||e.node(o).type.spec.isolating)break;i==e.start(o)&&n.push(o)}return n}Nx.depth.get=function(){return this.frontier.length-1},Mx.prototype.fit=function(){while(this.unplaced.size){var t=this.findFittable();t?this.placeNodes(t):this.openMore()||this.dropNode()}var e=this.mustMoveInline(),n=this.placed.size-this.depth-this.$from.depth,r=this.$from,o=this.close(e<0?this.$to:r.doc.resolve(e));if(!o)return null;var i=this.placed,s=r.depth,a=o.depth;while(s&&a&&1==i.childCount)i=i.firstChild.content,s--,a--;var c=new Ty(i,s,a);return e>-1?new cx(r.pos,e,this.$to.pos,this.$to.end(),c,n):c.size||r.pos!=this.$to.pos?new ax(r.pos,o.pos,c):void 0},Mx.prototype.findFittable=function(){for(var t=1;t<=2;t++)for(var e=this.unplaced.openStart;e>=0;e--){var n=void 0,r=void 0;e?(r=Ax(this.unplaced.content,e-1).firstChild,n=r.content):n=this.unplaced.content;for(var o=n.firstChild,i=this.depth;i>=0;i--){var s=this.frontier[i],a=s.type,c=s.match,h=void 0,p=void 0;if(1==t&&(o?c.matchType(o.type)||(p=c.fillBefore(by.from(o),!1)):a.compatibleContent(r.type)))return{sliceDepth:e,frontierDepth:i,parent:r,inject:p};if(2==t&&o&&(h=c.findWrapping(o.type)))return{sliceDepth:e,frontierDepth:i,parent:r,wrap:h};if(r&&c.matchType(r.type))break}}},Mx.prototype.openMore=function(){var t=this.unplaced,e=t.content,n=t.openStart,r=t.openEnd,o=Ax(e,n);return!(!o.childCount||o.firstChild.isLeaf)&&(this.unplaced=new Ty(e,n+1,Math.max(r,o.size+n>=e.size-r?n+1:0)),!0)},Mx.prototype.dropNode=function(){var t=this.unplaced,e=t.content,n=t.openStart,r=t.openEnd,o=Ax(e,n);if(o.childCount<=1&&n>0){var i=e.size-n<=n+o.size;this.unplaced=new Ty(Tx(e,n-1,1),n-1,i?n-1:r)}else this.unplaced=new Ty(Tx(e,n,1),n,r)},Mx.prototype.placeNodes=function(t){var e=t.sliceDepth,n=t.frontierDepth,r=t.parent,o=t.inject,i=t.wrap;while(this.depth>n)this.closeFrontierNode();if(i)for(var s=0;s<i.length;s++)this.openFrontierNode(i[s]);var a=this.unplaced,c=r?r.content:a.content,h=a.openStart-e,p=0,l=[],u=this.frontier[n],f=u.match,d=u.type;if(o){for(var m=0;m<o.childCount;m++)l.push(o.child(m));f=f.matchFragment(o)}var v=c.size+e-(a.content.size-a.openEnd);while(p<c.childCount){var g=c.child(p),y=f.matchType(g.type);if(!y)break;p++,(p>1||0==h||g.content.size)&&(f=y,l.push(Dx(g.mark(d.allowedMarks(g.marks)),1==p?h:0,p==c.childCount?v:-1)))}var w=p==c.childCount;w||(v=-1),this.placed=Ex(this.placed,n,by.from(l)),this.frontier[n].match=f,w&&v<0&&r&&r.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(var x=0,b=c;x<v;x++){var k=b.lastChild;this.frontier.push({type:k.type,match:k.contentMatchAt(k.childCount)}),b=k.content}this.unplaced=w?0==e?Ty.empty:new Ty(Tx(a.content,e-1,1),e-1,v<0?a.openEnd:e-1):new Ty(Tx(a.content,e,p),a.openStart,a.openEnd)},Mx.prototype.mustMoveInline=function(){if(!this.$to.parent.isTextblock||this.$to.end()==this.$to.pos)return-1;var t,e=this.frontier[this.depth];if(!e.type.isTextblock||!Rx(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;var n=this.$to,r=n.depth,o=this.$to.after(r);while(r>1&&o==this.$to.end(--r))++o;return o},Mx.prototype.findCloseLevel=function(t){t:for(var e=Math.min(this.depth,t.depth);e>=0;e--){var n=this.frontier[e],r=n.match,o=n.type,i=e<t.depth&&t.end(e+1)==t.pos+(t.depth-(e+1)),s=Rx(t,e,o,r,i);if(s){for(var a=e-1;a>=0;a--){var c=this.frontier[a],h=c.match,p=c.type,l=Rx(t,a,p,h,!0);if(!l||l.childCount)continue t}return{depth:e,fit:s,move:i?t.doc.resolve(t.after(e+1)):t}}}},Mx.prototype.close=function(t){var e=this.findCloseLevel(t);if(!e)return null;while(this.depth>e.depth)this.closeFrontierNode();e.fit.childCount&&(this.placed=Ex(this.placed,e.depth,e.fit)),t=e.move;for(var n=e.depth+1;n<=t.depth;n++){var r=t.node(n),o=r.type.contentMatch.fillBefore(r.content,!0,t.index(n));this.openFrontierNode(r.type,r.attrs,o)}return t},Mx.prototype.openFrontierNode=function(t,e,n){var r=this.frontier[this.depth];r.match=r.match.matchType(t),this.placed=Ex(this.placed,this.depth,by.from(t.create(e,n))),this.frontier.push({type:t,match:t.contentMatch})},Mx.prototype.closeFrontierNode=function(){var t=this.frontier.pop(),e=t.match.fillBefore(by.empty,!0);e.childCount&&(this.placed=Ex(this.placed,this.frontier.length,e))},Object.defineProperties(Mx.prototype,Nx),ex.prototype.replaceRange=function(t,e,n){if(!n.size)return this.deleteRange(t,e);var r=this.doc.resolve(t),o=this.doc.resolve(e);if(Cx(r,o,n))return this.step(new ax(t,e,n));var i=Px(r,this.doc.resolve(e));0==i[i.length-1]&&i.pop();var s=-(r.depth+1);i.unshift(s);for(var a=r.depth,c=r.pos-1;a>0;a--,c--){var h=r.node(a).type.spec;if(h.defining||h.isolating)break;i.indexOf(a)>-1?s=a:r.before(a)==c&&i.splice(1,0,-a)}for(var p=i.indexOf(s),l=[],u=n.openStart,f=n.content,d=0;;d++){var m=f.firstChild;if(l.push(m),d==n.openStart)break;f=m.content}u>0&&l[u-1].type.spec.defining&&r.node(p).type!=l[u-1].type?u-=1:u>=2&&l[u-1].isTextblock&&l[u-2].type.spec.defining&&r.node(p).type!=l[u-2].type&&(u-=2);for(var v=n.openStart;v>=0;v--){var g=(v+u+1)%(n.openStart+1),y=l[g];if(y)for(var w=0;w<i.length;w++){var x=i[(w+p)%i.length],b=!0;x<0&&(b=!1,x=-x);var k=r.node(x-1),S=r.index(x-1);if(k.canReplaceWith(S,S,y.type,y.marks))return this.replace(r.before(x),b?o.after(x):e,new Ty(Ix(n.content,0,n.openStart,g),g,n.openEnd))}}for(var O=this.steps.length,C=i.length-1;C>=0;C--){if(this.replace(t,e,n),this.steps.length>O)break;var M=i[C];M<0||(t=r.before(M),e=o.after(M))}return this},ex.prototype.replaceRangeWith=function(t,e,n){if(!n.isInline&&t==e&&this.doc.resolve(t).parent.content.size){var r=xx(this.doc,t,n.type);null!=r&&(t=e=r)}return this.replaceRange(t,e,new Ty(by.from(n),0,0))},ex.prototype.deleteRange=function(t,e){for(var n=this.doc.resolve(t),r=this.doc.resolve(e),o=Px(n,r),i=0;i<o.length;i++){var s=o[i],a=i==o.length-1;if(a&&0==s||n.node(s).type.contentMatch.validEnd)return this.delete(n.start(s),r.end(s));if(s>0&&(a||n.node(s-1).canReplace(n.index(s-1),r.indexAfter(s-1))))return this.delete(n.before(s),r.after(s))}for(var c=1;c<=n.depth&&c<=r.depth;c++)if(t-n.start(c)==n.depth-c&&e>n.end(c)&&r.end(c)-e!=r.depth-c)return this.delete(n.before(c),e);return this.delete(t,e)};var Fx=Object.create(null),Bx=function(t,e,n){this.ranges=n||[new _x(t.min(e),t.max(e))],this.$anchor=t,this.$head=e},$x={anchor:{configurable:!0},head:{configurable:!0},from:{configurable:!0},to:{configurable:!0},$from:{configurable:!0},$to:{configurable:!0},empty:{configurable:!0}};$x.anchor.get=function(){return this.$anchor.pos},$x.head.get=function(){return this.$head.pos},$x.from.get=function(){return this.$from.pos},$x.to.get=function(){return this.$to.pos},$x.$from.get=function(){return this.ranges[0].$from},$x.$to.get=function(){return this.ranges[0].$to},$x.empty.get=function(){for(var t=this.ranges,e=0;e<t.length;e++)if(t[e].$from.pos!=t[e].$to.pos)return!1;return!0},Bx.prototype.content=function(){return this.$from.node(0).slice(this.from,this.to,!0)},Bx.prototype.replace=function(t,e){void 0===e&&(e=Ty.empty);for(var n=e.content.lastChild,r=null,o=0;o<e.openEnd;o++)r=n,n=n.lastChild;for(var i=t.steps.length,s=this.ranges,a=0;a<s.length;a++){var c=s[a],h=c.$from,p=c.$to,l=t.mapping.slice(i);t.replaceRange(l.map(h.pos),l.map(p.pos),a?Ty.empty:e),0==a&&Kx(t,i,(n?n.isInline:r&&r.isTextblock)?-1:1)}},Bx.prototype.replaceWith=function(t,e){for(var n=t.steps.length,r=this.ranges,o=0;o<r.length;o++){var i=r[o],s=i.$from,a=i.$to,c=t.mapping.slice(n),h=c.map(s.pos),p=c.map(a.pos);o?t.deleteRange(h,p):(t.replaceRangeWith(h,p,e),Kx(t,n,e.isInline?-1:1))}},Bx.findFrom=function(t,e,n){var r=t.parent.inlineContent?new jx(t):Hx(t.node(0),t.parent,t.pos,t.index(),e,n);if(r)return r;for(var o=t.depth-1;o>=0;o--){var i=e<0?Hx(t.node(0),t.node(o),t.before(o+1),t.index(o),e,n):Hx(t.node(0),t.node(o),t.after(o+1),t.index(o)+1,e,n);if(i)return i}},Bx.near=function(t,e){return void 0===e&&(e=1),this.findFrom(t,e)||this.findFrom(t,-e)||new qx(t.node(0))},Bx.atStart=function(t){return Hx(t,t,0,0,1)||new qx(t)},Bx.atEnd=function(t){return Hx(t,t,t.content.size,t.childCount,-1)||new qx(t)},Bx.fromJSON=function(t,e){if(!e||!e.type)throw new RangeError("Invalid input for Selection.fromJSON");var n=Fx[e.type];if(!n)throw new RangeError("No selection type "+e.type+" defined");return n.fromJSON(t,e)},Bx.jsonID=function(t,e){if(t in Fx)throw new RangeError("Duplicate use of selection JSON ID "+t);return Fx[t]=e,e.prototype.jsonID=t,e},Bx.prototype.getBookmark=function(){return jx.between(this.$anchor,this.$head).getBookmark()},Object.defineProperties(Bx.prototype,$x),Bx.prototype.visible=!0;var _x=function(t,e){this.$from=t,this.$to=e},jx=function(t){function e(e,n){void 0===n&&(n=e),t.call(this,e,n)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={$cursor:{configurable:!0}};return n.$cursor.get=function(){return this.$anchor.pos==this.$head.pos?this.$head:null},e.prototype.map=function(n,r){var o=n.resolve(r.map(this.head));if(!o.parent.inlineContent)return t.near(o);var i=n.resolve(r.map(this.anchor));return new e(i.parent.inlineContent?i:o,o)},e.prototype.replace=function(e,n){if(void 0===n&&(n=Ty.empty),t.prototype.replace.call(this,e,n),n==Ty.empty){var r=this.$from.marksAcross(this.$to);r&&e.ensureMarks(r)}},e.prototype.eq=function(t){return t instanceof e&&t.anchor==this.anchor&&t.head==this.head},e.prototype.getBookmark=function(){return new Jx(this.anchor,this.head)},e.prototype.toJSON=function(){return{type:"text",anchor:this.anchor,head:this.head}},e.fromJSON=function(t,n){if("number"!=typeof n.anchor||"number"!=typeof n.head)throw new RangeError("Invalid input for TextSelection.fromJSON");return new e(t.resolve(n.anchor),t.resolve(n.head))},e.create=function(t,e,n){void 0===n&&(n=e);var r=t.resolve(e);return new this(r,n==e?r:t.resolve(n))},e.between=function(n,r,o){var i=n.pos-r.pos;if(o&&!i||(o=i>=0?1:-1),!r.parent.inlineContent){var s=t.findFrom(r,o,!0)||t.findFrom(r,-o,!0);if(!s)return t.near(r,o);r=s.$head}return n.parent.inlineContent||(0==i?n=r:(n=(t.findFrom(n,-o,!0)||t.findFrom(n,o,!0)).$anchor,n.pos<r.pos!=i<0&&(n=r))),new e(n,r)},Object.defineProperties(e.prototype,n),e}(Bx);Bx.jsonID("text",jx);var Jx=function(t,e){this.anchor=t,this.head=e};Jx.prototype.map=function(t){return new Jx(t.map(this.anchor),t.map(this.head))},Jx.prototype.resolve=function(t){return jx.between(t.resolve(this.anchor),t.resolve(this.head))};var Lx=function(t){function e(e){var n=e.nodeAfter,r=e.node(0).resolve(e.pos+n.nodeSize);t.call(this,e,r),this.node=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.map=function(n,r){var o=r.mapResult(this.anchor),i=o.deleted,s=o.pos,a=n.resolve(s);return i?t.near(a):new e(a)},e.prototype.content=function(){return new Ty(by.from(this.node),0,0)},e.prototype.eq=function(t){return t instanceof e&&t.anchor==this.anchor},e.prototype.toJSON=function(){return{type:"node",anchor:this.anchor}},e.prototype.getBookmark=function(){return new Vx(this.anchor)},e.fromJSON=function(t,n){if("number"!=typeof n.anchor)throw new RangeError("Invalid input for NodeSelection.fromJSON");return new e(t.resolve(n.anchor))},e.create=function(t,e){return new this(t.resolve(e))},e.isSelectable=function(t){return!t.isText&&!1!==t.type.spec.selectable},e}(Bx);Lx.prototype.visible=!1,Bx.jsonID("node",Lx);var Vx=function(t){this.anchor=t};Vx.prototype.map=function(t){var e=t.mapResult(this.anchor),n=e.deleted,r=e.pos;return n?new Jx(r,r):new Vx(r)},Vx.prototype.resolve=function(t){var e=t.resolve(this.anchor),n=e.nodeAfter;return n&&Lx.isSelectable(n)?new Lx(e):Bx.near(e)};var qx=function(t){function e(e){t.call(this,e.resolve(0),e.resolve(e.content.size))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.replace=function(e,n){if(void 0===n&&(n=Ty.empty),n==Ty.empty){e.delete(0,e.doc.content.size);var r=t.atStart(e.doc);r.eq(e.selection)||e.setSelection(r)}else t.prototype.replace.call(this,e,n)},e.prototype.toJSON=function(){return{type:"all"}},e.fromJSON=function(t){return new e(t)},e.prototype.map=function(t){return new e(t)},e.prototype.eq=function(t){return t instanceof e},e.prototype.getBookmark=function(){return Wx},e}(Bx);Bx.jsonID("all",qx);var Wx={map:function(){return this},resolve:function(t){return new qx(t)}};function Hx(t,e,n,r,o,i){if(e.inlineContent)return jx.create(t,n);for(var s=r-(o>0?0:1);o>0?s<e.childCount:s>=0;s+=o){var a=e.child(s);if(a.isAtom){if(!i&&Lx.isSelectable(a))return Lx.create(t,n-(o<0?a.nodeSize:0))}else{var c=Hx(t,a,n+o,o<0?a.childCount:0,o,i);if(c)return c}n+=a.nodeSize*o}}function Kx(t,e,n){var r=t.steps.length-1;if(!(r<e)){var o=t.steps[r];if(o instanceof ax||o instanceof cx){var i,s=t.mapping.maps[r];s.forEach((function(t,e,n,r){null==i&&(i=r)})),t.setSelection(Bx.near(t.doc.resolve(i),n))}}}var Ux=1,Gx=2,Xx=4,Yx=function(t){function e(e){t.call(this,e.doc),this.time=Date.now(),this.curSelection=e.selection,this.curSelectionFor=0,this.storedMarks=e.storedMarks,this.updated=0,this.meta=Object.create(null)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={selection:{configurable:!0},selectionSet:{configurable:!0},storedMarksSet:{configurable:!0},isGeneric:{configurable:!0},scrolledIntoView:{configurable:!0}};return n.selection.get=function(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection},e.prototype.setSelection=function(t){if(t.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=t,this.curSelectionFor=this.steps.length,this.updated=(this.updated|Ux)&~Gx,this.storedMarks=null,this},n.selectionSet.get=function(){return(this.updated&Ux)>0},e.prototype.setStoredMarks=function(t){return this.storedMarks=t,this.updated|=Gx,this},e.prototype.ensureMarks=function(t){return My.sameSet(this.storedMarks||this.selection.$from.marks(),t)||this.setStoredMarks(t),this},e.prototype.addStoredMark=function(t){return this.ensureMarks(t.addToSet(this.storedMarks||this.selection.$head.marks()))},e.prototype.removeStoredMark=function(t){return this.ensureMarks(t.removeFromSet(this.storedMarks||this.selection.$head.marks()))},n.storedMarksSet.get=function(){return(this.updated&Gx)>0},e.prototype.addStep=function(e,n){t.prototype.addStep.call(this,e,n),this.updated=this.updated&~Gx,this.storedMarks=null},e.prototype.setTime=function(t){return this.time=t,this},e.prototype.replaceSelection=function(t){return this.selection.replace(this,t),this},e.prototype.replaceSelectionWith=function(t,e){var n=this.selection;return!1!==e&&(t=t.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||My.none))),n.replaceWith(this,t),this},e.prototype.deleteSelection=function(){return this.selection.replace(this),this},e.prototype.insertText=function(t,e,n){void 0===n&&(n=e);var r=this.doc.type.schema;if(null==e)return t?this.replaceSelectionWith(r.text(t),!0):this.deleteSelection();if(!t)return this.deleteRange(e,n);var o=this.storedMarks;if(!o){var i=this.doc.resolve(e);o=n==e?i.marks():i.marksAcross(this.doc.resolve(n))}return this.replaceRangeWith(e,n,r.text(t,o)),this.selection.empty||this.setSelection(Bx.near(this.selection.$to)),this},e.prototype.setMeta=function(t,e){return this.meta["string"==typeof t?t:t.key]=e,this},e.prototype.getMeta=function(t){return this.meta["string"==typeof t?t:t.key]},n.isGeneric.get=function(){for(var t in this.meta)return!1;return!0},e.prototype.scrollIntoView=function(){return this.updated|=Xx,this},n.scrolledIntoView.get=function(){return(this.updated&Xx)>0},Object.defineProperties(e.prototype,n),e}(ex);function Zx(t,e){return e&&t?t.bind(e):t}var Qx=function(t,e,n){this.name=t,this.init=Zx(e.init,n),this.apply=Zx(e.apply,n)},tb=[new Qx("doc",{init:function(t){return t.doc||t.schema.topNodeType.createAndFill()},apply:function(t){return t.doc}}),new Qx("selection",{init:function(t,e){return t.selection||Bx.atStart(e.doc)},apply:function(t){return t.selection}}),new Qx("storedMarks",{init:function(t){return t.storedMarks||null},apply:function(t,e,n,r){return r.selection.$cursor?t.storedMarks:null}}),new Qx("scrollToSelection",{init:function(){return 0},apply:function(t,e){return t.scrolledIntoView?e+1:e}})],eb=function(t,e){var n=this;this.schema=t,this.fields=tb.concat(),this.plugins=[],this.pluginsByKey=Object.create(null),e&&e.forEach((function(t){if(n.pluginsByKey[t.key])throw new RangeError("Adding different instances of a keyed plugin ("+t.key+")");n.plugins.push(t),n.pluginsByKey[t.key]=t,t.spec.state&&n.fields.push(new Qx(t.key,t.spec.state,t))}))},nb=function(t){this.config=t},rb={schema:{configurable:!0},plugins:{configurable:!0},tr:{configurable:!0}};rb.schema.get=function(){return this.config.schema},rb.plugins.get=function(){return this.config.plugins},nb.prototype.apply=function(t){return this.applyTransaction(t).state},nb.prototype.filterTransaction=function(t,e){void 0===e&&(e=-1);for(var n=0;n<this.config.plugins.length;n++)if(n!=e){var r=this.config.plugins[n];if(r.spec.filterTransaction&&!r.spec.filterTransaction.call(r,t,this))return!1}return!0},nb.prototype.applyTransaction=function(t){if(!this.filterTransaction(t))return{state:this,transactions:[]};for(var e=[t],n=this.applyInner(t),r=null;;){for(var o=!1,i=0;i<this.config.plugins.length;i++){var s=this.config.plugins[i];if(s.spec.appendTransaction){var a=r?r[i].n:0,c=r?r[i].state:this,h=a<e.length&&s.spec.appendTransaction.call(s,a?e.slice(a):e,c,n);if(h&&n.filterTransaction(h,i)){if(h.setMeta("appendedTransaction",t),!r){r=[];for(var p=0;p<this.config.plugins.length;p++)r.push(p<i?{state:n,n:e.length}:{state:this,n:0})}e.push(h),n=n.applyInner(h),o=!0}r&&(r[i]={state:n,n:e.length})}}if(!o)return{state:n,transactions:e}}},nb.prototype.applyInner=function(t){if(!t.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");for(var e=new nb(this.config),n=this.config.fields,r=0;r<n.length;r++){var o=n[r];e[o.name]=o.apply(t,this[o.name],this,e)}for(var i=0;i<ob.length;i++)ob[i](this,t,e);return e},rb.tr.get=function(){return new Yx(this)},nb.create=function(t){for(var e=new eb(t.doc?t.doc.type.schema:t.schema,t.plugins),n=new nb(e),r=0;r<e.fields.length;r++)n[e.fields[r].name]=e.fields[r].init(t,n);return n},nb.prototype.reconfigure=function(t){for(var e=new eb(this.schema,t.plugins),n=e.fields,r=new nb(e),o=0;o<n.length;o++){var i=n[o].name;r[i]=this.hasOwnProperty(i)?this[i]:n[o].init(t,r)}return r},nb.prototype.toJSON=function(t){var e={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(e.storedMarks=this.storedMarks.map((function(t){return t.toJSON()}))),t&&"object"==typeof t)for(var n in t){if("doc"==n||"selection"==n)throw new RangeError("The JSON fields `doc` and `selection` are reserved");var r=t[n],o=r.spec.state;o&&o.toJSON&&(e[n]=o.toJSON.call(r,this[r.key]))}return e},nb.fromJSON=function(t,e,n){if(!e)throw new RangeError("Invalid input for EditorState.fromJSON");if(!t.schema)throw new RangeError("Required config field 'schema' missing");var r=new eb(t.schema,t.plugins),o=new nb(r);return r.fields.forEach((function(r){if("doc"==r.name)o.doc=Xy.fromJSON(t.schema,e.doc);else if("selection"==r.name)o.selection=Bx.fromJSON(o.doc,e.selection);else if("storedMarks"==r.name)e.storedMarks&&(o.storedMarks=e.storedMarks.map(t.schema.markFromJSON));else{if(n)for(var i in n){var s=n[i],a=s.spec.state;if(s.key==r.name&&a&&a.fromJSON&&Object.prototype.hasOwnProperty.call(e,i))return void(o[r.name]=a.fromJSON.call(s,t,e[i],o))}o[r.name]=r.init(t,o)}})),o},nb.addApplyListener=function(t){ob.push(t)},nb.removeApplyListener=function(t){var e=ob.indexOf(t);e>-1&&ob.splice(e,1)},Object.defineProperties(nb.prototype,rb);var ob=[];function ib(t,e,n){for(var r in t){var o=t[r];o instanceof Function?o=o.bind(e):"handleDOMEvents"==r&&(o=ib(o,e,{})),n[r]=o}return n}var sb=function(t){this.props={},t.props&&ib(t.props,this,this.props),this.spec=t,this.key=t.key?t.key.key:cb("plugin")};sb.prototype.getState=function(t){return t[this.key]};var ab=Object.create(null);function cb(t){return t in ab?t+"$"+ ++ab[t]:(ab[t]=0,t+"$")}var hb=function(t){void 0===t&&(t="key"),this.key=cb(t)};function pb(t,e){return!t.selection.empty&&(e&&e(t.tr.deleteSelection().scrollIntoView()),!0)}function lb(t,e,n){var r=t.selection,o=r.$cursor;if(!o||(n?!n.endOfTextblock("backward",t):o.parentOffset>0))return!1;var i=db(o);if(!i){var s=o.blockRange(),a=s&&lx(s);return null!=a&&(e&&e(t.tr.lift(s,a).scrollIntoView()),!0)}var c=i.nodeBefore;if(!c.type.spec.isolating&&Nb(t,i,e))return!0;if(0==o.parent.content.size&&(ub(c,"end")||Lx.isSelectable(c))){if(e){var h=t.tr.deleteRange(o.before(),o.after());h.setSelection(ub(c,"end")?Bx.findFrom(h.doc.resolve(h.mapping.map(i.pos,-1)),-1):Lx.create(h.doc,i.pos-c.nodeSize)),e(h.scrollIntoView())}return!0}return!(!c.isAtom||i.depth!=o.depth-1)&&(e&&e(t.tr.delete(i.pos-c.nodeSize,i.pos).scrollIntoView()),!0)}function ub(t,e){for(;t;t="start"==e?t.firstChild:t.lastChild)if(t.isTextblock)return!0;return!1}function fb(t,e,n){var r=t.selection,o=r.$head,i=r.empty,s=o;if(!i)return!1;if(o.parent.isTextblock){if(n?!n.endOfTextblock("backward",t):o.parentOffset>0)return!1;s=db(o)}var a=s&&s.nodeBefore;return!(!a||!Lx.isSelectable(a))&&(e&&e(t.tr.setSelection(Lx.create(t.doc,s.pos-a.nodeSize)).scrollIntoView()),!0)}function db(t){if(!t.parent.type.spec.isolating)for(var e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}function mb(t,e,n){var r=t.selection,o=r.$cursor;if(!o||(n?!n.endOfTextblock("forward",t):o.parentOffset<o.parent.content.size))return!1;var i=gb(o);if(!i)return!1;var s=i.nodeAfter;if(Nb(t,i,e))return!0;if(0==o.parent.content.size&&(ub(s,"start")||Lx.isSelectable(s))){if(e){var a=t.tr.deleteRange(o.before(),o.after());a.setSelection(ub(s,"start")?Bx.findFrom(a.doc.resolve(a.mapping.map(i.pos)),1):Lx.create(a.doc,a.mapping.map(i.pos))),e(a.scrollIntoView())}return!0}return!(!s.isAtom||i.depth!=o.depth-1)&&(e&&e(t.tr.delete(i.pos,i.pos+s.nodeSize).scrollIntoView()),!0)}function vb(t,e,n){var r=t.selection,o=r.$head,i=r.empty,s=o;if(!i)return!1;if(o.parent.isTextblock){if(n?!n.endOfTextblock("forward",t):o.parentOffset<o.parent.content.size)return!1;s=gb(o)}var a=s&&s.nodeAfter;return!(!a||!Lx.isSelectable(a))&&(e&&e(t.tr.setSelection(Lx.create(t.doc,s.pos)).scrollIntoView()),!0)}function gb(t){if(!t.parent.type.spec.isolating)for(var e=t.depth-1;e>=0;e--){var n=t.node(e);if(t.index(e)+1<n.childCount)return t.doc.resolve(t.after(e+1));if(n.type.spec.isolating)break}return null}function yb(t,e){var n=t.selection,r=n.$from,o=n.$to,i=r.blockRange(o),s=i&&lx(i);return null!=s&&(e&&e(t.tr.lift(i,s).scrollIntoView()),!0)}function wb(t,e){var n=t.selection,r=n.$head,o=n.$anchor;return!(!r.parent.type.spec.code||!r.sameParent(o))&&(e&&e(t.tr.insertText("\n").scrollIntoView()),!0)}function xb(t){for(var e=0;e<t.edgeCount;e++){var n=t.edge(e),r=n.type;if(r.isTextblock&&!r.hasRequiredAttrs())return r}return null}function bb(t,e){var n=t.selection,r=n.$head,o=n.$anchor;if(!r.parent.type.spec.code||!r.sameParent(o))return!1;var i=r.node(-1),s=r.indexAfter(-1),a=xb(i.contentMatchAt(s));if(!i.canReplaceWith(s,s,a))return!1;if(e){var c=r.after(),h=t.tr.replaceWith(c,c,a.createAndFill());h.setSelection(Bx.near(h.doc.resolve(c),1)),e(h.scrollIntoView())}return!0}function kb(t,e){var n=t.selection,r=n.$from,o=n.$to;if(n instanceof qx||r.parent.inlineContent||o.parent.inlineContent)return!1;var i=xb(o.parent.contentMatchAt(o.indexAfter()));if(!i||!i.isTextblock)return!1;if(e){var s=(!r.parentOffset&&o.index()<o.parent.childCount?r:o).pos,a=t.tr.insert(s,i.createAndFill());a.setSelection(jx.create(a.doc,s+1)),e(a.scrollIntoView())}return!0}function Sb(t,e){var n=t.selection,r=n.$cursor;if(!r||r.parent.content.size)return!1;if(r.depth>1&&r.after()!=r.end(-1)){var o=r.before();if(gx(t.doc,o))return e&&e(t.tr.split(o).scrollIntoView()),!0}var i=r.blockRange(),s=i&&lx(i);return null!=s&&(e&&e(t.tr.lift(i,s).scrollIntoView()),!0)}function Ob(t,e){var n=t.selection,r=n.$from,o=n.$to;if(t.selection instanceof Lx&&t.selection.node.isBlock)return!(!r.parentOffset||!gx(t.doc,r.pos))&&(e&&e(t.tr.split(r.pos).scrollIntoView()),!0);if(!r.parent.isBlock)return!1;if(e){var i=o.parentOffset==o.parent.content.size,s=t.tr;(t.selection instanceof jx||t.selection instanceof qx)&&s.deleteSelection();var a=0==r.depth?null:xb(r.node(-1).contentMatchAt(r.indexAfter(-1))),c=i&&a?[{type:a}]:null,h=gx(s.doc,s.mapping.map(r.pos),1,c);if(c||h||!gx(s.doc,s.mapping.map(r.pos),1,a&&[{type:a}])||(c=[{type:a}],h=!0),h&&(s.split(s.mapping.map(r.pos),1,c),!i&&!r.parentOffset&&r.parent.type!=a)){var p=s.mapping.map(r.before()),l=s.doc.resolve(p);r.parent.canReplaceWith(l.index(),l.index()+1,a)&&s.setNodeMarkup(s.mapping.map(r.before()),a)}e(s.scrollIntoView())}return!0}function Cb(t,e){return e&&e(t.tr.setSelection(new qx(t.doc))),!0}function Mb(t,e,n){var r=e.nodeBefore,o=e.nodeAfter,i=e.index();return!!(r&&o&&r.type.compatibleContent(o.type))&&(!r.content.size&&e.parent.canReplace(i-1,i)?(n&&n(t.tr.delete(e.pos-r.nodeSize,e.pos).scrollIntoView()),!0):!(!e.parent.canReplace(i,i+1)||!o.isTextblock&&!yx(t.doc,e.pos))&&(n&&n(t.tr.clearIncompatible(e.pos,r.type,r.contentMatchAt(r.childCount)).join(e.pos).scrollIntoView()),!0))}function Nb(t,e,n){var r,o,i=e.nodeBefore,s=e.nodeAfter;if(i.type.spec.isolating||s.type.spec.isolating)return!1;if(Mb(t,e,n))return!0;var a=e.parent.canReplace(e.index(),e.index()+1);if(a&&(r=(o=i.contentMatchAt(i.childCount)).findWrapping(s.type))&&o.matchType(r[0]||s.type).validEnd){if(n){for(var c=e.pos+s.nodeSize,h=by.empty,p=r.length-1;p>=0;p--)h=by.from(r[p].create(null,h));h=by.from(i.copy(h));var l=t.tr.step(new cx(e.pos-1,c,e.pos,c,new Ty(h,1,0),r.length,!0)),u=c+2*r.length;yx(l.doc,u)&&l.join(u),n(l.scrollIntoView())}return!0}var f=Bx.findFrom(e,1),d=f&&f.$from.blockRange(f.$to),m=d&&lx(d);if(null!=m&&m>=e.depth)return n&&n(t.tr.lift(d,m).scrollIntoView()),!0;if(a&&s.isTextblock&&ub(i,"end")){for(var v=i,g=[];;){if(g.push(v),v.isTextblock)break;v=v.lastChild}if(v.canReplace(v.childCount,v.childCount,s.content)){if(n){for(var y=by.empty,w=g.length-1;w>=0;w--)y=by.from(g[w].copy(y));var x=t.tr.step(new cx(e.pos-g.length,e.pos+s.nodeSize,e.pos+1,e.pos+s.nodeSize-1,new Ty(y,g.length,0),0,!0));n(x.scrollIntoView())}return!0}}return!1}function Tb(t,e){return function(n,r){var o=n.selection,i=o.$from,s=o.$to,a=i.blockRange(s),c=a&&ux(a,t,e);return!!c&&(r&&r(n.tr.wrap(a,c).scrollIntoView()),!0)}}function Eb(t,e){return function(n,r){var o=n.selection,i=o.from,s=o.to,a=!1;return n.doc.nodesBetween(i,s,(function(r,o){if(a)return!1;if(r.isTextblock&&!r.hasMarkup(t,e))if(r.type==t)a=!0;else{var i=n.doc.resolve(o),s=i.index();a=i.parent.canReplaceWith(s,s+1,t)}})),!!a&&(r&&r(n.tr.setBlockType(i,s,t,e).scrollIntoView()),!0)}}function Ab(t,e,n){for(var r=function(r){var o=e[r],i=o.$from,s=o.$to,a=0==i.depth&&t.type.allowsMarkType(n);if(t.nodesBetween(i.pos,s.pos,(function(t){if(a)return!1;a=t.inlineContent&&t.type.allowsMarkType(n)})),a)return{v:!0}},o=0;o<e.length;o++){var i=r(o);if(i)return i.v}return!1}function Db(t,e){return function(n,r){var o=n.selection,i=o.empty,s=o.$cursor,a=o.ranges;if(i&&!s||!Ab(n.doc,a,t))return!1;if(r)if(s)t.isInSet(n.storedMarks||s.marks())?r(n.tr.removeStoredMark(t)):r(n.tr.addStoredMark(t.create(e)));else{for(var c=!1,h=n.tr,p=0;!c&&p<a.length;p++){var l=a[p],u=l.$from,f=l.$to;c=n.doc.rangeHasMark(u.pos,f.pos,t)}for(var d=0;d<a.length;d++){var m=a[d],v=m.$from,g=m.$to;if(c)h.removeMark(v.pos,g.pos,t);else{var y=v.pos,w=g.pos,x=v.nodeAfter,b=g.nodeBefore,k=x&&x.isText?/^\s*/.exec(x.text)[0].length:0,S=b&&b.isText?/\s*$/.exec(b.text)[0].length:0;y+k<w&&(y+=k,w-=S),h.addMark(y,w,t.create(e))}}r(h.scrollIntoView())}return!0}}function Rb(){var t=[],e=arguments.length;while(e--)t[e]=arguments[e];return function(e,n,r){for(var o=0;o<t.length;o++)if(t[o](e,n,r))return!0;return!1}}hb.prototype.get=function(t){return t.config.pluginsByKey[this.key]},hb.prototype.getState=function(t){return t[this.key]};var zb=Rb(pb,lb,fb),Ib=Rb(pb,mb,vb),Pb={Enter:Rb(wb,kb,Sb,Ob),"Mod-Enter":bb,Backspace:zb,"Mod-Backspace":zb,Delete:Ib,"Mod-Delete":Ib,"Mod-a":Cb},Fb={"Ctrl-h":Pb["Backspace"],"Alt-Backspace":Pb["Mod-Backspace"],"Ctrl-d":Pb["Delete"],"Ctrl-Alt-Backspace":Pb["Mod-Delete"],"Alt-Delete":Pb["Mod-Delete"],"Alt-d":Pb["Mod-Delete"]};for(var Bb in Pb)Fb[Bb]=Pb[Bb];"undefined"!=typeof navigator?/Mac/.test(navigator.platform):"undefined"!=typeof os&&os.platform();function $b(t,e){return function(n,r){var o=n.selection,i=o.$from,s=o.$to,a=i.blockRange(s),c=!1,h=a;if(!a)return!1;if(a.depth>=2&&i.node(a.depth-1).type.compatibleContent(t)&&0==a.startIndex){if(0==i.index(a.depth-1))return!1;var p=n.doc.resolve(a.start-2);h=new Ky(p,p,a.depth),a.endIndex<a.parent.childCount&&(a=new Ky(i,n.doc.resolve(s.end(a.depth)),a.depth)),c=!0}var l=ux(h,t,e,a);return!!l&&(r&&r(_b(n.tr,a,l,c,t).scrollIntoView()),!0)}}function _b(t,e,n,r,o){for(var i=by.empty,s=n.length-1;s>=0;s--)i=by.from(n[s].type.create(n[s].attrs,i));t.step(new cx(e.start-(r?2:0),e.end,e.start,e.end,new Ty(i,0,0),n.length,!0));for(var a=0,c=0;c<n.length;c++)n[c].type==o&&(a=c+1);for(var h=n.length-a,p=e.start+n.length-(r?2:0),l=e.parent,u=e.startIndex,f=e.endIndex,d=!0;u<f;u++,d=!1)!d&&gx(t.doc,p,h)&&(t.split(p,h),p+=2*h),p+=l.child(u).nodeSize;return t}function jb(t){return function(e,n){var r=e.selection,o=r.$from,i=r.$to,s=r.node;if(s&&s.isBlock||o.depth<2||!o.sameParent(i))return!1;var a=o.node(-1);if(a.type!=t)return!1;if(0==o.parent.content.size&&o.node(-1).childCount==o.indexAfter(-1)){if(2==o.depth||o.node(-3).type!=t||o.index(-2)!=o.node(-2).childCount-1)return!1;if(n){for(var c=by.empty,h=o.index(-1)>0,p=o.depth-(h?1:2);p>=o.depth-3;p--)c=by.from(o.node(p).copy(c));c=c.append(by.from(t.createAndFill()));var l=e.tr.replace(o.before(h?null:-1),o.after(-3),new Ty(c,h?3:2,2));l.setSelection(e.selection.constructor.near(l.doc.resolve(o.pos+(h?3:2)))),n(l.scrollIntoView())}return!0}var u=i.pos==o.end()?a.contentMatchAt(0).defaultType:null,f=e.tr.delete(o.pos,i.pos),d=u&&[null,{type:u}];return!!gx(f.doc,o.pos,2,d)&&(n&&n(f.split(o.pos,2,d).scrollIntoView()),!0)}}function Jb(t){return function(e,n){var r=e.selection,o=r.$from,i=r.$to,s=o.blockRange(i,(function(e){return e.childCount&&e.firstChild.type==t}));return!!s&&(!n||(o.node(s.depth-1).type==t?Lb(e,n,t,s):Vb(e,n,s)))}}function Lb(t,e,n,r){var o=t.tr,i=r.end,s=r.$to.end(r.depth);return i<s&&(o.step(new cx(i-1,s,i,s,new Ty(by.from(n.create(null,r.parent.copy())),1,0),1,!0)),r=new Ky(o.doc.resolve(r.$from.pos),o.doc.resolve(s),r.depth)),e(o.lift(r,lx(r)).scrollIntoView()),!0}function Vb(t,e,n){for(var r=t.tr,o=n.parent,i=n.end,s=n.endIndex-1,a=n.startIndex;s>a;s--)i-=o.child(s).nodeSize,r.delete(i-1,i+1);var c=r.doc.resolve(n.start),h=c.nodeAfter,p=0==n.startIndex,l=n.endIndex==o.childCount,u=c.node(-1),f=c.index(-1);if(!u.canReplace(f+(p?0:1),f+1,h.content.append(l?by.empty:by.from(o))))return!1;var d=c.pos,m=d+h.nodeSize;return r.step(new cx(d-(p?1:0),m+(l?1:0),d+1,m-1,new Ty((p?by.empty:by.from(o.copy(by.empty))).append(l?by.empty:by.from(o.copy(by.empty))),p?0:1,l?0:1),p?0:1)),e(r.scrollIntoView()),!0}function qb(t){return function(e,n){var r=e.selection,o=r.$from,i=r.$to,s=o.blockRange(i,(function(e){return e.childCount&&e.firstChild.type==t}));if(!s)return!1;var a=s.startIndex;if(0==a)return!1;var c=s.parent,h=c.child(a-1);if(h.type!=t)return!1;if(n){var p=h.lastChild&&h.lastChild.type==c.type,l=by.from(p?t.create():null),u=new Ty(by.from(t.create(null,by.from(c.type.create(null,l)))),p?3:1,0),f=s.start,d=s.end;n(e.tr.step(new cx(f-(p?3:1),d,f,d,u,1,!0)).scrollIntoView())}return!0}}var Wb=function(t,e){this.match=t,this.handler="string"==typeof e?Hb(e):e};function Hb(t){return function(e,n,r,o){var i=t;if(n[1]){var s=n[0].lastIndexOf(n[1]);i+=n[0].slice(s+n[1].length),r+=s;var a=r-o;a>0&&(i=n[0].slice(s-a,s)+i,r=o)}return e.tr.insertText(i,r,o)}}new Wb(/--$/,""),new Wb(/\.\.\.$/,""),new Wb(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(")$/,""),new Wb(/"$/,""),new Wb(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(')$/,""),new Wb(/'$/,"");function Kb(t,e,n,r){return new Wb(t,(function(t,o,i,s){var a=n instanceof Function?n(o):n,c=t.tr.delete(i,s),h=c.doc.resolve(i),p=h.blockRange(),l=p&&ux(p,e,a);if(!l)return null;c.wrap(p,l);var u=c.doc.resolve(i-1).nodeBefore;return u&&u.type==e&&yx(c.doc,i-1)&&(!r||r(o,u))&&c.join(i-1),c}))}function Ub(t,e,n){return new Wb(t,(function(t,r,o,i){var s=t.doc.resolve(o),a=n instanceof Function?n(r):n;return s.node(-1).canReplaceWith(s.index(-1),s.indexAfter(-1),e)?t.tr.delete(o,i).setBlockType(o,o,e,a):null}))}
/*!
    * tiptap-utils v1.13.0
    * (c) 2021 berdosis GbR (limited liability)
    * @license MIT
    */function Gb(t,e){return Array.isArray(t)&&t.indexOf(e.type)>-1||e.type===t}function Xb(t,e){for(let n=t.depth;n>0;n-=1){const r=t.node(n);if(e(r))return{pos:n>0?t.before(n):0,start:t.start(n),depth:n,node:r}}}function Yb(t){return e=>Xb(e.$from,t)}function Zb(t){return t instanceof Lx}function Qb(t){return function(e){if(Zb(e)){const{node:n}=e,{$from:r}=e;if(Gb(t,n))return{node:n,pos:r.pos,depth:r.depth}}}}function tk(t=null,e=null){if(!t||!e)return!1;const n=t.parent.childAfter(t.parentOffset);if(!n.node)return!1;const r=n.node.marks.find(t=>t.type===e);if(!r)return!1;let o=t.index(),i=t.start()+n.offset,s=o+1,a=i+n.node.nodeSize;while(o>0&&r.isInSet(t.parent.child(o-1).marks))o-=1,i-=t.parent.child(o).nodeSize;while(s<t.parent.childCount&&r.isInSet(t.parent.child(s).marks))a+=t.parent.child(s).nodeSize,s+=1;return{from:i,to:a}}function ek(t,e,n={}){const r=t=>t.type===e,o=Qb(e)(t.selection)||Yb(r)(t.selection);return Object.keys(n).length&&o?o.node.hasMarkup(e,{...o.node.attrs,...n}):!!o}
/*!
    * tiptap-commands v1.17.0
    * (c) 2021 berdosis GbR (limited liability)
    * @license MIT
    */function nk(t,e,n){let r=[];return n.doc.nodesBetween(t,e,(t,e)=>{r=[...r,...t.marks.map(n=>({start:e,end:e+t.nodeSize,mark:n}))]}),r}function rk(t,e,n){return new Wb(t,(t,r,o,i)=>{const s=n instanceof Function?n(r):n,{tr:a}=t,c=r.length-1;let h=i,p=o;if(r[c]){const n=o+r[0].indexOf(r[c-1]),s=n+r[c-1].length-1,l=n+r[c-1].lastIndexOf(r[c]),u=l+r[c].length,f=nk(o,i,t).filter(t=>{const{excluded:n}=t.mark.type;return n.find(t=>t.name===e.name)}).filter(t=>t.end>n);if(f.length)return!1;u<s&&a.delete(u,s),l>n&&a.delete(n,l),p=n,h=p+r[c].length}return a.addMark(p,h,e.create(s)),a.removeStoredMark(e),a})}function ok(t,e,n){return new Wb(t,(t,r,o,i)=>{const s=n instanceof Function?n(r):n,{tr:a}=t;return r[0]&&a.replaceWith(o-1,i,e.create(s)),a})}function ik(t,e,n){const r=o=>{const i=[];return o.forEach(o=>{if(o.isText){const{text:r}=o;let s,a=0;do{if(s=t.exec(r),s){const t=s.index,r=t+s[0].length,c=n instanceof Function?n(s[0]):n;t>0&&i.push(o.cut(a,t)),i.push(o.cut(t,r).mark(e.create(c).addToSet(o.marks))),a=r}}while(s);a<r.length&&i.push(o.cut(a))}else i.push(o.copy(r(o.content)))}),by.fromArray(i)};return new sb({props:{transformPasted:t=>new Ty(r(t.content),t.openStart,t.openEnd)}})}function sk(t,e,n){const r=(o,i)=>{const s=[];return o.forEach(o=>{if(o.isText){const{text:r,marks:a}=o;let c,h=0;const p=!!a.filter(t=>"link"===t.type.name)[0];while(!p&&null!==(c=t.exec(r)))if(i&&i.type.allowsMarkType(e)&&c[1]){const t=c.index,r=t+c[0].length,i=t+c[0].indexOf(c[1]),a=i+c[1].length,p=n instanceof Function?n(c):n;t>0&&s.push(o.cut(h,t)),s.push(o.cut(i,a).mark(e.create(p).addToSet(o.marks))),h=r}h<r.length&&s.push(o.cut(h))}else s.push(o.copy(r(o.content,o)))}),by.fromArray(s)};return new sb({props:{transformPasted:t=>new Ty(r(t.content),t.openStart,t.openEnd)}})}function ak(t){return(e,n)=>{const{tr:r,selection:o}=e;let{from:i,to:s}=o;const{$from:a,empty:c}=o;if(c){const e=tk(a,t);i=e.from,s=e.to}return r.removeMark(i,s,t),n(r)}}function ck(t,e,n=1,r){const o=t.resolve(e),i=o.depth-n,s=r&&r[r.length-1]||o.parent;if(i<0||o.parent.type.spec.isolating||!o.parent.canReplace(o.index(),o.parent.childCount)||!s.type.validContent(o.parent.content.cutByIndex(o.index(),o.parent.childCount)))return!1;for(let h=o.depth-1,p=n-2;h>i;h--,p--){const t=o.node(h),e=o.index(h);if(t.type.spec.isolating)return!1;let n=t.content.cutByIndex(e,t.childCount);const i=r&&r[p]||t;if(i!=t&&(n=n.replaceChild(0,i.type.create(i.attrs))),!t.canReplace(e+1,t.childCount))return!1}const a=o.indexAfter(i),c=r&&r[0];return o.node(i).canReplaceWith(a,a,c?c.type:o.node(i+1).type)}function hk(t){return function(e,n){const{$from:r,$to:o,node:i}=e.selection;if(i&&i.isBlock||r.depth<2||!r.sameParent(o))return!1;const s=r.node(-1);if(s.type!=t)return!1;if(0==r.parent.content.size){if(2==r.depth||r.node(-3).type!=t||r.index(-2)!=r.node(-2).childCount-1)return!1;if(n){let o=by.empty;const i=r.index(-1)>0;for(let t=r.depth-(i?1:2);t>=r.depth-3;t--)o=by.from(r.node(t).copy(o));o=o.append(by.from(t.createAndFill()));const s=e.tr.replace(r.before(i?null:-1),r.after(-3),new Ty(o,i?3:2,2));s.setSelection(e.selection.constructor.near(s.doc.resolve(r.pos+(i?3:2)))),n(s.scrollIntoView())}return!0}const a=o.pos==r.end()?s.contentMatchAt(r.indexAfter(-1)).defaultType:null,c=e.tr.delete(r.pos,o.pos);let h=a&&[{type:t},{type:a}];return h||(h=[{type:t},null]),!!ck(c.doc,r.pos,2,h)&&(n&&n(c.split(r.pos,2,h).scrollIntoView()),!0)}}function pk(t,e,n={}){return(r,o,i)=>{const s=ek(r,t,n);return s?Eb(e)(r,o,i):Eb(t,n)(r,o,i)}}function lk(t,e){return t.type===e.nodes.bullet_list||t.type===e.nodes.ordered_list||t.type===e.nodes.todo_list}function uk(t,e){return(n,r,o)=>{const{schema:i,selection:s}=n,{$from:a,$to:c}=s,h=a.blockRange(c);if(!h)return!1;const p=Yb(t=>lk(t,i))(s);if(h.depth>=1&&p&&h.depth-p.depth<=1){if(p.node.type===t)return Jb(e)(n,r,o);if(lk(p.node,i)&&t.validContent(p.node.content)){const{tr:e}=n;return e.setNodeMarkup(p.pos,t),r&&r(e),!1}}return $b(t)(n,r,o)}}function fk(t,e={}){return(n,r,o)=>{const i=ek(n,t,e);return i?yb(n,r):Tb(t,e)(n,r,o)}}function dk(t,e){return(n,r)=>{const{tr:o,selection:i,doc:s}=n,{ranges:a,empty:c}=i;if(c){const{from:n,to:r}=tk(i.$from,t);s.rangeHasMark(n,r,t)&&o.removeMark(n,r,t),o.addMark(n,r,t.create(e))}else a.forEach(n=>{const{$to:r,$from:i}=n;s.rangeHasMark(i.pos,r.pos,t)&&o.removeMark(i.pos,r.pos,t),o.addMark(i.pos,r.pos,t.create(e))});return r(o)}}
/*!
    * tiptap v1.32.1
    * (c) 2021 berdosis GbR (limited liability)
    * @license MIT
    */function mk(t){return t.replace(/(?:^\w|[A-Z]|\b\w)/g,(t,e)=>0===e?t.toLowerCase():t.toUpperCase()).replace(/\s+/g,"")}class vk{constructor(t,{editor:e,extension:n,parent:r,node:o,view:i,decorations:s,getPos:a}){this.component=t,this.editor=e,this.extension=n,this.parent=r,this.node=o,this.view=i,this.decorations=s,this.isNode=!!this.node.marks,this.isMark=!this.isNode,this.getPos=this.isMark?this.getMarkPos:a,this.captureEvents=!0,this.dom=this.createDOM(),this.contentDOM=this.vm.$refs.content}createDOM(){const t=my["default"].extend(this.component),e={editor:this.editor,node:this.node,view:this.view,getPos:()=>this.getPos(),decorations:this.decorations,selected:!1,options:this.extension.options,updateAttrs:t=>this.updateAttrs(t)};return"function"===typeof this.extension.setSelection&&(this.setSelection=this.extension.setSelection),"function"===typeof this.extension.update&&(this.update=this.extension.update),this.vm=new t({parent:this.parent,propsData:e}).$mount(),this.vm.$el}update(t,e){return t.type===this.node.type&&(t===this.node&&this.decorations===e||(this.node=t,this.decorations=e,this.updateComponentProps({node:t,decorations:e})),!0)}updateComponentProps(t){if(!this.vm._props)return;const e=my["default"].config.silent;my["default"].config.silent=!0,Object.entries(t).forEach(([t,e])=>{this.vm._props[t]=e}),my["default"].config.silent=e}updateAttrs(t){if(!this.view.editable)return;const{state:e}=this.view,{type:n}=this.node,r=this.getPos(),o={...this.node.attrs,...t},i=this.isMark?e.tr.removeMark(r.from,r.to,n).addMark(r.from,r.to,n.create(o)):e.tr.setNodeMarkup(r,null,o);this.view.dispatch(i)}ignoreMutation(t){return"selection"!==t.type&&(!this.contentDOM||!this.contentDOM.contains(t.target))}stopEvent(t){if("function"===typeof this.extension.stopEvent)return this.extension.stopEvent(t);const e=!!this.extension.schema.draggable;if(e&&"mousedown"===t.type){const e=t.target.closest&&t.target.closest("[data-drag-handle]"),n=e&&(this.dom===e||this.dom.contains(e));n&&(this.captureEvents=!1,document.addEventListener("dragend",()=>{this.captureEvents=!0},{once:!0}))}const n="copy"===t.type,r="paste"===t.type,o="cut"===t.type,i=t.type.startsWith("drag")||"drop"===t.type;return!(e&&i||n||r||o)&&this.captureEvents}selectNode(){this.updateComponentProps({selected:!0})}deselectNode(){this.updateComponentProps({selected:!1})}getMarkPos(){const t=this.view.posAtDOM(this.dom),e=this.view.state.doc.resolve(t),n=ly(e,this.node.type);return n}destroy(){this.vm.$destroy()}}class gk{on(t,e){return this._callbacks=this._callbacks||{},this._callbacks[t]||(this._callbacks[t]=[]),this._callbacks[t].push(e),this}emit(t,...e){this._callbacks=this._callbacks||{};const n=this._callbacks[t];return n&&n.forEach(t=>t.apply(this,e)),this}off(t,e){if(arguments.length){const n=this._callbacks?this._callbacks[t]:null;n&&(e?this._callbacks[t]=n.filter(t=>t!==e):delete this._callbacks[t])}else this._callbacks={};return this}}class yk{constructor(t={}){this.options={...this.defaultOptions,...t}}init(){return null}bindEditor(t=null){this.editor=t}get name(){return null}get type(){return"extension"}get defaultOptions(){return{}}get plugins(){return[]}inputRules(){return[]}pasteRules(){return[]}keys(){return{}}}class wk{constructor(t=[],e){t.forEach(t=>{t.bindEditor(e),t.init()}),this.extensions=t}get nodes(){return this.extensions.filter(t=>"node"===t.type).reduce((t,{name:e,schema:n})=>({...t,[e]:n}),{})}get options(){const{view:t}=this;return this.extensions.reduce((e,n)=>({...e,[n.name]:new Proxy(n.options,{set(e,n,r){const o=e[n]!==r;return Object.assign(e,{[n]:r}),o&&t.updateState(t.state),!0}})}),{})}get marks(){return this.extensions.filter(t=>"mark"===t.type).reduce((t,{name:e,schema:n})=>({...t,[e]:n}),{})}get plugins(){return this.extensions.filter(t=>t.plugins).reduce((t,{plugins:e})=>[...t,...e],[])}keymaps({schema:t}){const e=this.extensions.filter(t=>["extension"].includes(t.type)).filter(t=>t.keys).map(e=>e.keys({schema:t})),n=this.extensions.filter(t=>["node","mark"].includes(t.type)).filter(t=>t.keys).map(e=>e.keys({type:t[e.type+"s"][e.name],schema:t}));return[...e,...n].map(t=>El(t))}inputRules({schema:t,excludedExtensions:e}){if(!(e instanceof Array)&&e)return[];const n=e instanceof Array?this.extensions.filter(t=>!e.includes(t.name)):this.extensions,r=n.filter(t=>["extension"].includes(t.type)).filter(t=>t.inputRules).map(e=>e.inputRules({schema:t})),o=n.filter(t=>["node","mark"].includes(t.type)).filter(t=>t.inputRules).map(e=>e.inputRules({type:t[e.type+"s"][e.name],schema:t}));return[...r,...o].reduce((t,e)=>[...t,...e],[])}pasteRules({schema:t,excludedExtensions:e}){if(!(e instanceof Array)&&e)return[];const n=e instanceof Array?this.extensions.filter(t=>!e.includes(t.name)):this.extensions,r=n.filter(t=>["extension"].includes(t.type)).filter(t=>t.pasteRules).map(e=>e.pasteRules({schema:t})),o=n.filter(t=>["node","mark"].includes(t.type)).filter(t=>t.pasteRules).map(e=>e.pasteRules({type:t[e.type+"s"][e.name],schema:t}));return[...r,...o].reduce((t,e)=>[...t,...e],[])}commands({schema:t,view:e}){return this.extensions.filter(t=>t.commands).reduce((n,r)=>{const{name:o,type:i}=r,s={},a=r.commands({schema:t,...["node","mark"].includes(i)?{type:t[i+"s"][o]}:{}}),c=(t,n)=>!!e.editable&&(e.focus(),t(n)(e.state,e.dispatch,e)),h=(t,e)=>{Array.isArray(e)?s[t]=t=>e.forEach(e=>c(e,t)):"function"===typeof e&&(s[t]=t=>c(e,t))};return"object"===typeof a?Object.entries(a).forEach(([t,e])=>{h(t,e)}):h(o,a),{...n,...s}},{})}}function xk(t){{const e=document.createElement("style");e.type="text/css",e.textContent=t;const{head:n}=document,{firstChild:r}=n;r?n.insertBefore(e,r):n.appendChild(e)}}class bk extends yk{constructor(t={}){super(t)}get type(){return"mark"}get view(){return null}get schema(){return null}command(){return()=>{}}}function kk(t=0,e=0,n=0){return Math.min(Math.max(parseInt(t,10),e),n)}class Sk extends yk{constructor(t={}){super(t)}get type(){return"node"}get view(){return null}get schema(){return null}command(){return()=>{}}}class Ok extends Sk{get name(){return"doc"}get schema(){return{content:"block+"}}}class Ck extends Sk{get name(){return"paragraph"}get schema(){return{content:"inline*",group:"block",draggable:!1,parseDOM:[{tag:"p"}],toDOM:()=>["p",0]}}commands({type:t}){return()=>Eb(t)}}class Mk extends Sk{get name(){return"text"}get schema(){return{group:"inline"}}}var Nk='.ProseMirror {\n  position: relative;\n}\n\n.ProseMirror {\n  word-wrap: break-word;\n  white-space: pre-wrap;\n  -webkit-font-variant-ligatures: none;\n  font-variant-ligatures: none;\n}\n\n.ProseMirror pre {\n  white-space: pre-wrap;\n}\n\n.ProseMirror-gapcursor {\n  display: none;\n  pointer-events: none;\n  position: absolute;\n}\n\n.ProseMirror-gapcursor:after {\n  content: "";\n  display: block;\n  position: absolute;\n  top: -2px;\n  width: 20px;\n  border-top: 1px solid black;\n  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;\n}\n\n@keyframes ProseMirror-cursor-blink {\n  to {\n    visibility: hidden;\n  }\n}\n\n.ProseMirror-hideselection *::selection {\n  background: transparent;\n}\n\n.ProseMirror-hideselection *::-moz-selection {\n  background: transparent;\n}\n\n.ProseMirror-hideselection * {\n  caret-color: transparent;\n}\n\n.ProseMirror-focused .ProseMirror-gapcursor {\n  display: block;\n}\n';class Tk extends gk{constructor(t={}){super(),this.defaultOptions={editorProps:{},editable:!0,autoFocus:null,extensions:[],content:"",topNode:"doc",emptyDocument:{type:"doc",content:[{type:"paragraph"}]},useBuiltInExtensions:!0,disableInputRules:!1,disablePasteRules:!1,dropCursor:{},enableDropCursor:!0,enableGapCursor:!0,parseOptions:{},injectCSS:!0,onInit:()=>{},onTransaction:()=>{},onUpdate:()=>{},onFocus:()=>{},onBlur:()=>{},onPaste:()=>{},onDrop:()=>{}},this.events=["init","transaction","update","focus","blur","paste","drop"],this.init(t)}init(t={}){this.setOptions({...this.defaultOptions,...t}),this.focused=!1,this.selection={from:0,to:0},this.element=document.createElement("div"),this.extensions=this.createExtensions(),this.nodes=this.createNodes(),this.marks=this.createMarks(),this.schema=this.createSchema(),this.plugins=this.createPlugins(),this.keymaps=this.createKeymaps(),this.inputRules=this.createInputRules(),this.pasteRules=this.createPasteRules(),this.view=this.createView(),this.commands=this.createCommands(),this.setActiveNodesAndMarks(),this.options.injectCSS&&xk(Nk),null!==this.options.autoFocus&&this.focus(this.options.autoFocus),this.events.forEach(t=>{this.on(t,this.options[mk("on "+t)]||(()=>{}))}),this.emit("init",{view:this.view,state:this.state}),this.extensions.view=this.view}setOptions(t){this.options={...this.options,...t},this.view&&this.state&&this.view.updateState(this.state)}get builtInExtensions(){return this.options.useBuiltInExtensions?[new Ok,new Mk,new Ck]:[]}get state(){return this.view?this.view.state:null}createExtensions(){return new wk([...this.builtInExtensions,...this.options.extensions],this)}createPlugins(){return this.extensions.plugins}createKeymaps(){return this.extensions.keymaps({schema:this.schema})}createInputRules(){return this.extensions.inputRules({schema:this.schema,excludedExtensions:this.options.disableInputRules})}createPasteRules(){return this.extensions.pasteRules({schema:this.schema,excludedExtensions:this.options.disablePasteRules})}createCommands(){return this.extensions.commands({schema:this.schema,view:this.view})}createNodes(){return this.extensions.nodes}createMarks(){return this.extensions.marks}createSchema(){return new vp({topNode:this.options.topNode,nodes:this.nodes,marks:this.marks})}createState(){return mr.create({schema:this.schema,doc:this.createDocument(this.options.content),plugins:[...this.plugins,Qm({rules:this.inputRules}),...this.pasteRules,...this.keymaps,El({Backspace:ev}),El(Gm),...this.options.enableDropCursor?[ul(this.options.dropCursor)]:[],...this.options.enableGapCursor?[xm()]:[],new wr({key:new kr("editable"),props:{editable:()=>this.options.editable}}),new wr({props:{attributes:{tabindex:0},handleDOMEvents:{focus:(t,e)=>{this.focused=!0,this.emit("focus",{event:e,state:t.state,view:t});const n=this.state.tr.setMeta("focused",!0);this.view.dispatch(n)},blur:(t,e)=>{this.focused=!1,this.emit("blur",{event:e,state:t.state,view:t});const n=this.state.tr.setMeta("focused",!1);this.view.dispatch(n)}}}}),new wr({props:this.options.editorProps})]})}createDocument(t,e=this.options.parseOptions){if(null===t)return this.schema.nodeFromJSON(this.options.emptyDocument);if("object"===typeof t)try{return this.schema.nodeFromJSON(t)}catch(n){return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",n),this.schema.nodeFromJSON(this.options.emptyDocument)}if("string"===typeof t){const n=`<div>${t}</div>`,r=new window.DOMParser,o=r.parseFromString(n,"text/html").body.firstElementChild;return yp.fromSchema(this.schema).parse(o,e)}return!1}createView(){return new rh(this.element,{state:this.createState(),handlePaste:(...t)=>{this.emit("paste",...t)},handleDrop:(...t)=>{this.emit("drop",...t)},dispatchTransaction:this.dispatchTransaction.bind(this)})}setParentComponent(t=null){t&&this.view.setProps({nodeViews:this.initNodeViews({parent:t,extensions:[...this.builtInExtensions,...this.options.extensions]})})}initNodeViews({parent:t,extensions:e}){return e.filter(t=>["node","mark"].includes(t.type)).filter(t=>t.view).reduce((e,n)=>{const r=(e,r,o,i)=>{const s=n.view;return new vk(s,{editor:this,extension:n,parent:t,node:e,view:r,getPos:o,decorations:i})};return{...e,[n.name]:r}},{})}dispatchTransaction(t){const e=this.state.apply(t);this.view.updateState(e),this.selection={from:this.state.selection.from,to:this.state.selection.to},this.setActiveNodesAndMarks(),this.emit("transaction",{getHTML:this.getHTML.bind(this),getJSON:this.getJSON.bind(this),state:this.state,transaction:t}),t.docChanged&&!t.getMeta("preventUpdate")&&this.emitUpdate(t)}emitUpdate(t){this.emit("update",{getHTML:this.getHTML.bind(this),getJSON:this.getJSON.bind(this),state:this.state,transaction:t})}resolveSelection(t=null){if(this.selection&&null===t)return this.selection;if("start"===t||!0===t)return{from:0,to:0};if("end"===t){const{doc:t}=this.state;return{from:t.content.size,to:t.content.size}}return{from:t,to:t}}focus(t=null){if(this.view.focused&&null===t||!1===t)return;const{from:e,to:n}=this.resolveSelection(t);this.setSelection(e,n),setTimeout(()=>this.view.focus(),10)}setSelection(t=0,e=0){const{doc:n,tr:r}=this.state,o=kk(t,0,n.content.size),i=kk(e,0,n.content.size),s=Qn.create(n,o,i),a=r.setSelection(s);this.view.dispatch(a)}blur(){this.view.dom.blur()}getSchemaJSON(){return JSON.parse(JSON.stringify({nodes:this.extensions.nodes,marks:this.extensions.marks}))}getHTML(){const t=document.createElement("div"),e=Pp.fromSchema(this.schema).serializeFragment(this.state.doc.content);return t.appendChild(e),t.innerHTML}getJSON(){return this.state.doc.toJSON()}setContent(t={},e=!1,n){const{doc:r,tr:o}=this.state,i=this.createDocument(t,n),s=Qn.create(r,0,r.content.size),a=o.setSelection(s).replaceSelectionWith(i,!1).setMeta("preventUpdate",!e);this.view.dispatch(a)}clearContent(t=!1){this.setContent(this.options.emptyDocument,t)}setActiveNodesAndMarks(){this.activeMarks=Object.entries(this.schema.marks).reduce((t,[e,n])=>({...t,[e]:(t={})=>fy(this.state,n,t)}),{}),this.activeMarkAttrs=Object.entries(this.schema.marks).reduce((t,[e,n])=>({...t,[e]:py(this.state,n)}),{}),this.activeNodes=Object.entries(this.schema.nodes).reduce((t,[e,n])=>({...t,[e]:(t={})=>dy(this.state,n,t)}),{})}getMarkAttrs(t=null){return this.activeMarkAttrs[t]}getNodeAttrs(t=null){return{...uy(this.state,this.schema.nodes[t])}}get isActive(){return Object.entries({...this.activeMarks,...this.activeNodes}).reduce((t,[e,n])=>({...t,[e]:(t={})=>n(t)}),{})}registerPlugin(t=null,e){const n="function"===typeof e?e(t,this.state.plugins):[t,...this.state.plugins],r=this.state.reconfigure({plugins:n});this.view.updateState(r)}unregisterPlugin(t=null){if(!t||!this.view.docView)return;const e=this.state.reconfigure({plugins:this.state.plugins.filter(e=>!e.key.startsWith(t+"$"))});this.view.updateState(e)}destroy(){this.view&&this.view.destroy()}}var Ek={props:{editor:{default:null,type:Object}},watch:{editor:{immediate:!0,handler(t){t&&t.element&&this.$nextTick(()=>{this.$el.appendChild(t.element.firstChild),t.setParentComponent(this)})}}},render(t){return t("div")},beforeDestroy(){this.editor.element=this.$el}};class Ak{constructor({options:t}){this.options=t,this.preventHide=!1,this.mousedownHandler=this.handleClick.bind(this),this.options.element.addEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.blurHandler=()=>{this.preventHide?this.preventHide=!1:this.options.editor.emit("menubar:focusUpdate",!1)},this.options.editor.on("blur",this.blurHandler)}handleClick(){this.preventHide=!0}destroy(){this.options.element.removeEventListener("mousedown",this.mousedownHandler),this.options.editor.off("blur",this.blurHandler)}}function Dk(t){return new wr({key:new kr("menu_bar"),view(e){return new Ak({editorView:e,options:t})}})}var Rk={props:{editor:{default:null,type:Object}},data(){return{focused:!1}},watch:{editor:{immediate:!0,handler(t){t&&this.$nextTick(()=>{t.registerPlugin(Dk({editor:t,element:this.$el})),this.focused=t.focused,t.on("focus",()=>{this.focused=!0}),t.on("menubar:focusUpdate",t=>{this.focused=t})})}}},render(){return this.editor?this.$scopedSlots.default({focused:this.focused,focus:this.editor.focus,commands:this.editor.commands,isActive:this.editor.isActive,getMarkAttrs:this.editor.getMarkAttrs.bind(this.editor),getNodeAttrs:this.editor.getNodeAttrs.bind(this.editor)}):null}};function zk(t,e,n){const r=document.createRange();return r.setEnd(t,null==n?t.nodeValue.length:n),r.setStart(t,Math.max(e,0)),r}function Ik(t,e){const n=t.getClientRects();return n.length?n[e<0?0:n.length-1]:t.getBoundingClientRect()}function Pk(t,e,n=!1){const{node:r,offset:o}=t.docView.domFromPos(e);let i,s;if(3===r.nodeType)n&&o<r.nodeValue.length?(s=Ik(zk(r,o-1,o),-1),i="right"):o<r.nodeValue.length&&(s=Ik(zk(r,o,o+1),-1),i="left");else if(r.firstChild){if(o<r.childNodes.length){const t=r.childNodes[o];s=Ik(3===t.nodeType?zk(t):t,-1),i="left"}if((!s||s.top===s.bottom)&&o){const t=r.childNodes[o-1];s=Ik(3===t.nodeType?zk(t):t,1),i="right"}}else s=r.getBoundingClientRect(),i="left";const a=s[i];return{top:s.top,bottom:s.bottom,left:a,right:a}}class Fk{constructor({options:t,editorView:e}){this.options={element:null,keepInBounds:!0,onUpdate:()=>!1,...t},this.editorView=e,this.isActive=!1,this.left=0,this.bottom=0,this.top=0,this.preventHide=!1,this.mousedownHandler=this.handleClick.bind(this),this.options.element.addEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.focusHandler=({view:t})=>{this.update(t)},this.options.editor.on("focus",this.focusHandler),this.blurHandler=({event:t})=>{this.preventHide?this.preventHide=!1:this.hide(t)},this.options.editor.on("blur",this.blurHandler)}handleClick(){this.preventHide=!0}update(t,e){const{state:n}=t;if(t.composing)return;if(e&&e.doc.eq(n.doc)&&e.selection.eq(n.selection))return;if(n.selection.empty)return void this.hide();const{from:r,to:o}=n.selection,i=Pk(t,r),s=Pk(t,o,!0),a=this.options.element.offsetParent;if(!a)return void this.hide();const c=a.getBoundingClientRect(),h=this.options.element.getBoundingClientRect(),p=(i.left+s.left)/2-c.left;this.left=Math.round(this.options.keepInBounds?Math.min(c.width-h.width/2,Math.max(p,h.width/2)):p),this.bottom=Math.round(c.bottom-i.top),this.top=Math.round(s.bottom-c.top),this.isActive=!0,this.sendUpdate()}sendUpdate(){this.options.onUpdate({isActive:this.isActive,left:this.left,bottom:this.bottom,top:this.top})}hide(t){t&&t.relatedTarget&&this.options.element.parentNode&&this.options.element.parentNode.contains(t.relatedTarget)||(this.isActive=!1,this.sendUpdate())}destroy(){this.options.element.removeEventListener("mousedown",this.mousedownHandler),this.options.editor.off("focus",this.focusHandler),this.options.editor.off("blur",this.blurHandler)}}function Bk(t){return new wr({key:new kr("menu_bubble"),view(e){return new Fk({editorView:e,options:t})}})}var $k={props:{editor:{default:null,type:Object},keepInBounds:{default:!0,type:Boolean}},data(){return{menu:{isActive:!1,left:0,bottom:0}}},watch:{editor:{immediate:!0,handler(t){t&&this.$nextTick(()=>{t.registerPlugin(Bk({editor:t,element:this.$el,keepInBounds:this.keepInBounds,onUpdate:t=>{t.isActive&&!1===this.menu.isActive?this.$emit("show",t):t.isActive||!0!==this.menu.isActive||this.$emit("hide",t),this.menu=t}}))})}}},render(){return this.editor?this.$scopedSlots.default({focused:this.editor.view.focused,focus:this.editor.focus,commands:this.editor.commands,isActive:this.editor.isActive,getMarkAttrs:this.editor.getMarkAttrs.bind(this.editor),getNodeAttrs:this.editor.getNodeAttrs.bind(this.editor),menu:this.menu}):null},beforeDestroy(){this.editor.unregisterPlugin("menu_bubble")}};class _k{constructor({options:t,editorView:e}){this.options={resizeObserver:!0,element:null,onUpdate:()=>!1,...t},this.preventHide=!1,this.editorView=e,this.isActive=!1,this.top=0,this.mousedownHandler=this.handleClick.bind(this),this.options.element.addEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.focusHandler=({view:t})=>{this.update(t)},this.options.editor.on("focus",this.focusHandler),this.blurHandler=({event:t})=>{this.preventHide?this.preventHide=!1:this.hide(t)},this.options.editor.on("blur",this.blurHandler),this.options.resizeObserver&&window.ResizeObserver&&(this.resizeObserver=new ResizeObserver(()=>{this.isActive&&this.update(this.editorView)}),this.resizeObserver.observe(this.editorView.dom))}handleClick(){this.preventHide=!0}update(t,e){const{state:n}=t;if(e&&e.doc.eq(n.doc)&&e.selection.eq(n.selection))return;if(!n.selection.empty)return void this.hide();const r=t.domAtPos(n.selection.anchor),o="<br>"===r.node.innerHTML&&"P"===r.node.tagName&&r.node.parentNode===t.dom;if(!o)return void this.hide();const i=this.options.element.offsetParent;if(!i)return void this.hide();const s=i.getBoundingClientRect(),a=t.coordsAtPos(n.selection.anchor),c=a.top-s.top;this.isActive=!0,this.top=c,this.sendUpdate()}sendUpdate(){this.options.onUpdate({isActive:this.isActive,top:this.top})}hide(t){t&&t.relatedTarget&&this.options.element.parentNode&&this.options.element.parentNode.contains(t.relatedTarget)||(this.isActive=!1,this.sendUpdate())}destroy(){this.options.element.removeEventListener("mousedown",this.mousedownHandler),this.resizeObserver&&this.resizeObserver.unobserve(this.editorView.dom),this.options.editor.off("focus",this.focusHandler),this.options.editor.off("blur",this.blurHandler)}}function jk(t){return new wr({key:new kr("floating_menu"),view(e){return new _k({editorView:e,options:t})}})}var Jk={props:{editor:{default:null,type:Object}},data(){return{menu:{isActive:!1,left:0,bottom:0}}},watch:{editor:{immediate:!0,handler(t){t&&this.$nextTick(()=>{t.registerPlugin(jk({editor:t,element:this.$el,onUpdate:t=>{t.isActive&&!1===this.menu.isActive?this.$emit("show",t):t.isActive||!0!==this.menu.isActive||this.$emit("hide",t),this.menu=t}}))})}}},render(){return this.editor?this.$scopedSlots.default({focused:this.editor.view.focused,focus:this.editor.focus,commands:this.editor.commands,isActive:this.editor.isActive,getMarkAttrs:this.editor.getMarkAttrs.bind(this.editor),getNodeAttrs:this.editor.getNodeAttrs.bind(this.editor),menu:this.menu}):null},beforeDestroy(){this.editor.unregisterPlugin("floating_menu")}};n("3ce4");function Lk(t,e,n){for(var r=0;;r++){if(r==t.childCount||r==e.childCount)return t.childCount==e.childCount?null:n;var o=t.child(r),i=e.child(r);if(o!=i){if(!o.sameMarkup(i))return n;if(o.isText&&o.text!=i.text){for(var s=0;o.text[s]==i.text[s];s++)n++;return n}if(o.content.size||i.content.size){var a=Lk(o.content,i.content,n+1);if(null!=a)return a}n+=o.nodeSize}else n+=o.nodeSize}}function Vk(t,e,n,r){for(var o=t.childCount,i=e.childCount;;){if(0==o||0==i)return o==i?null:{a:n,b:r};var s=t.child(--o),a=e.child(--i),c=s.nodeSize;if(s!=a){if(!s.sameMarkup(a))return{a:n,b:r};if(s.isText&&s.text!=a.text){var h=0,p=Math.min(s.text.length,a.text.length);while(h<p&&s.text[s.text.length-h-1]==a.text[a.text.length-h-1])h++,n--,r--;return{a:n,b:r}}if(s.content.size||a.content.size){var l=Vk(s.content,a.content,n-1,r-1);if(l)return l}n-=c,r-=c}else n-=c,r-=c}}var qk=function(t,e){if(this.content=t,this.size=e||0,null==e)for(var n=0;n<t.length;n++)this.size+=t[n].nodeSize},Wk={firstChild:{configurable:!0},lastChild:{configurable:!0},childCount:{configurable:!0}};qk.prototype.nodesBetween=function(t,e,n,r,o){void 0===r&&(r=0);for(var i=0,s=0;s<e;i++){var a=this.content[i],c=s+a.nodeSize;if(c>t&&!1!==n(a,r+s,o,i)&&a.content.size){var h=s+1;a.nodesBetween(Math.max(0,t-h),Math.min(a.content.size,e-h),n,r+h)}s=c}},qk.prototype.descendants=function(t){this.nodesBetween(0,this.size,t)},qk.prototype.textBetween=function(t,e,n,r){var o="",i=!0;return this.nodesBetween(t,e,(function(s,a){s.isText?(o+=s.text.slice(Math.max(t,a)-a,e-a),i=!n):s.isLeaf&&r?(o+=r,i=!n):!i&&s.isBlock&&(o+=n,i=!0)}),0),o},qk.prototype.append=function(t){if(!t.size)return this;if(!this.size)return t;var e=this.lastChild,n=t.firstChild,r=this.content.slice(),o=0;for(e.isText&&e.sameMarkup(n)&&(r[r.length-1]=e.withText(e.text+n.text),o=1);o<t.content.length;o++)r.push(t.content[o]);return new qk(r,this.size+t.size)},qk.prototype.cut=function(t,e){if(null==e&&(e=this.size),0==t&&e==this.size)return this;var n=[],r=0;if(e>t)for(var o=0,i=0;i<e;o++){var s=this.content[o],a=i+s.nodeSize;a>t&&((i<t||a>e)&&(s=s.isText?s.cut(Math.max(0,t-i),Math.min(s.text.length,e-i)):s.cut(Math.max(0,t-i-1),Math.min(s.content.size,e-i-1))),n.push(s),r+=s.nodeSize),i=a}return new qk(n,r)},qk.prototype.cutByIndex=function(t,e){return t==e?qk.empty:0==t&&e==this.content.length?this:new qk(this.content.slice(t,e))},qk.prototype.replaceChild=function(t,e){var n=this.content[t];if(n==e)return this;var r=this.content.slice(),o=this.size+e.nodeSize-n.nodeSize;return r[t]=e,new qk(r,o)},qk.prototype.addToStart=function(t){return new qk([t].concat(this.content),this.size+t.nodeSize)},qk.prototype.addToEnd=function(t){return new qk(this.content.concat(t),this.size+t.nodeSize)},qk.prototype.eq=function(t){if(this.content.length!=t.content.length)return!1;for(var e=0;e<this.content.length;e++)if(!this.content[e].eq(t.content[e]))return!1;return!0},Wk.firstChild.get=function(){return this.content.length?this.content[0]:null},Wk.lastChild.get=function(){return this.content.length?this.content[this.content.length-1]:null},Wk.childCount.get=function(){return this.content.length},qk.prototype.child=function(t){var e=this.content[t];if(!e)throw new RangeError("Index "+t+" out of range for "+this);return e},qk.prototype.maybeChild=function(t){return this.content[t]},qk.prototype.forEach=function(t){for(var e=0,n=0;e<this.content.length;e++){var r=this.content[e];t(r,n,e),n+=r.nodeSize}},qk.prototype.findDiffStart=function(t,e){return void 0===e&&(e=0),Lk(this,t,e)},qk.prototype.findDiffEnd=function(t,e,n){return void 0===e&&(e=this.size),void 0===n&&(n=t.size),Vk(this,t,e,n)},qk.prototype.findIndex=function(t,e){if(void 0===e&&(e=-1),0==t)return Kk(0,t);if(t==this.size)return Kk(this.content.length,t);if(t>this.size||t<0)throw new RangeError("Position "+t+" outside of fragment ("+this+")");for(var n=0,r=0;;n++){var o=this.child(n),i=r+o.nodeSize;if(i>=t)return i==t||e>0?Kk(n+1,i):Kk(n,r);r=i}},qk.prototype.toString=function(){return"<"+this.toStringInner()+">"},qk.prototype.toStringInner=function(){return this.content.join(", ")},qk.prototype.toJSON=function(){return this.content.length?this.content.map((function(t){return t.toJSON()})):null},qk.fromJSON=function(t,e){if(!e)return qk.empty;if(!Array.isArray(e))throw new RangeError("Invalid input for Fragment.fromJSON");return new qk(e.map(t.nodeFromJSON))},qk.fromArray=function(t){if(!t.length)return qk.empty;for(var e,n=0,r=0;r<t.length;r++){var o=t[r];n+=o.nodeSize,r&&o.isText&&t[r-1].sameMarkup(o)?(e||(e=t.slice(0,r)),e[e.length-1]=o.withText(e[e.length-1].text+o.text)):e&&e.push(o)}return new qk(e||t,n)},qk.from=function(t){if(!t)return qk.empty;if(t instanceof qk)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new qk([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))},Object.defineProperties(qk.prototype,Wk);var Hk={index:0,offset:0};function Kk(t,e){return Hk.index=t,Hk.offset=e,Hk}function Uk(t,e){if(t===e)return!0;if(!t||"object"!=typeof t||!e||"object"!=typeof e)return!1;var n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(var r=0;r<t.length;r++)if(!Uk(t[r],e[r]))return!1}else{for(var o in t)if(!(o in e)||!Uk(t[o],e[o]))return!1;for(var i in e)if(!(i in t))return!1}return!0}qk.empty=new qk([],0);var Gk=function(t,e){this.type=t,this.attrs=e};function Xk(t){var e=Error.call(this,t);return e.__proto__=Xk.prototype,e}Gk.prototype.addToSet=function(t){for(var e,n=!1,r=0;r<t.length;r++){var o=t[r];if(this.eq(o))return t;if(this.type.excludes(o.type))e||(e=t.slice(0,r));else{if(o.type.excludes(this.type))return t;!n&&o.type.rank>this.type.rank&&(e||(e=t.slice(0,r)),e.push(this),n=!0),e&&e.push(o)}}return e||(e=t.slice()),n||e.push(this),e},Gk.prototype.removeFromSet=function(t){for(var e=0;e<t.length;e++)if(this.eq(t[e]))return t.slice(0,e).concat(t.slice(e+1));return t},Gk.prototype.isInSet=function(t){for(var e=0;e<t.length;e++)if(this.eq(t[e]))return!0;return!1},Gk.prototype.eq=function(t){return this==t||this.type==t.type&&Uk(this.attrs,t.attrs)},Gk.prototype.toJSON=function(){var t={type:this.type.name};for(var e in this.attrs){t.attrs=this.attrs;break}return t},Gk.fromJSON=function(t,e){if(!e)throw new RangeError("Invalid input for Mark.fromJSON");var n=t.marks[e.type];if(!n)throw new RangeError("There is no mark type "+e.type+" in this schema");return n.create(e.attrs)},Gk.sameSet=function(t,e){if(t==e)return!0;if(t.length!=e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].eq(e[n]))return!1;return!0},Gk.setFrom=function(t){if(!t||0==t.length)return Gk.none;if(t instanceof Gk)return[t];var e=t.slice();return e.sort((function(t,e){return t.type.rank-e.type.rank})),e},Gk.none=[],Xk.prototype=Object.create(Error.prototype),Xk.prototype.constructor=Xk,Xk.prototype.name="ReplaceError";var Yk=function(t,e,n){this.content=t,this.openStart=e,this.openEnd=n},Zk={size:{configurable:!0}};function Qk(t,e,n){var r=t.findIndex(e),o=r.index,i=r.offset,s=t.maybeChild(o),a=t.findIndex(n),c=a.index,h=a.offset;if(i==e||s.isText){if(h!=n&&!t.child(c).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(o!=c)throw new RangeError("Removing non-flat range");return t.replaceChild(o,s.copy(Qk(s.content,e-i-1,n-i-1)))}function tS(t,e,n,r){var o=t.findIndex(e),i=o.index,s=o.offset,a=t.maybeChild(i);if(s==e||a.isText)return r&&!r.canReplace(i,i,n)?null:t.cut(0,e).append(n).append(t.cut(e));var c=tS(a.content,e-s-1,n);return c&&t.replaceChild(i,a.copy(c))}function eS(t,e,n){if(n.openStart>t.depth)throw new Xk("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new Xk("Inconsistent open depths");return nS(t,e,n,0)}function nS(t,e,n,r){var o=t.index(r),i=t.node(r);if(o==e.index(r)&&r<t.depth-n.openStart){var s=nS(t,e,n,r+1);return i.copy(i.content.replaceChild(o,s))}if(n.content.size){if(n.openStart||n.openEnd||t.depth!=r||e.depth!=r){var a=pS(n,t),c=a.start,h=a.end;return aS(i,cS(t,c,h,e,r))}var p=t.parent,l=p.content;return aS(p,l.cut(0,t.parentOffset).append(n.content).append(l.cut(e.parentOffset)))}return aS(i,hS(t,e,r))}function rS(t,e){if(!e.type.compatibleContent(t.type))throw new Xk("Cannot join "+e.type.name+" onto "+t.type.name)}function oS(t,e,n){var r=t.node(n);return rS(r,e.node(n)),r}function iS(t,e){var n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function sS(t,e,n,r){var o=(e||t).node(n),i=0,s=e?e.index(n):o.childCount;t&&(i=t.index(n),t.depth>n?i++:t.textOffset&&(iS(t.nodeAfter,r),i++));for(var a=i;a<s;a++)iS(o.child(a),r);e&&e.depth==n&&e.textOffset&&iS(e.nodeBefore,r)}function aS(t,e){if(!t.type.validContent(e))throw new Xk("Invalid content for node "+t.type.name);return t.copy(e)}function cS(t,e,n,r,o){var i=t.depth>o&&oS(t,e,o+1),s=r.depth>o&&oS(n,r,o+1),a=[];return sS(null,t,o,a),i&&s&&e.index(o)==n.index(o)?(rS(i,s),iS(aS(i,cS(t,e,n,r,o+1)),a)):(i&&iS(aS(i,hS(t,e,o+1)),a),sS(e,n,o,a),s&&iS(aS(s,hS(n,r,o+1)),a)),sS(r,null,o,a),new qk(a)}function hS(t,e,n){var r=[];if(sS(null,t,n,r),t.depth>n){var o=oS(t,e,n+1);iS(aS(o,hS(t,e,n+1)),r)}return sS(e,null,n,r),new qk(r)}function pS(t,e){for(var n=e.depth-t.openStart,r=e.node(n),o=r.copy(t.content),i=n-1;i>=0;i--)o=e.node(i).copy(qk.from(o));return{start:o.resolveNoCache(t.openStart+n),end:o.resolveNoCache(o.content.size-t.openEnd-n)}}Zk.size.get=function(){return this.content.size-this.openStart-this.openEnd},Yk.prototype.insertAt=function(t,e){var n=tS(this.content,t+this.openStart,e,null);return n&&new Yk(n,this.openStart,this.openEnd)},Yk.prototype.removeBetween=function(t,e){return new Yk(Qk(this.content,t+this.openStart,e+this.openStart),this.openStart,this.openEnd)},Yk.prototype.eq=function(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd},Yk.prototype.toString=function(){return this.content+"("+this.openStart+","+this.openEnd+")"},Yk.prototype.toJSON=function(){if(!this.content.size)return null;var t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t},Yk.fromJSON=function(t,e){if(!e)return Yk.empty;var n=e.openStart||0,r=e.openEnd||0;if("number"!=typeof n||"number"!=typeof r)throw new RangeError("Invalid input for Slice.fromJSON");return new Yk(qk.fromJSON(t,e.content),e.openStart||0,e.openEnd||0)},Yk.maxOpen=function(t,e){void 0===e&&(e=!0);for(var n=0,r=0,o=t.firstChild;o&&!o.isLeaf&&(e||!o.type.spec.isolating);o=o.firstChild)n++;for(var i=t.lastChild;i&&!i.isLeaf&&(e||!i.type.spec.isolating);i=i.lastChild)r++;return new Yk(t,n,r)},Object.defineProperties(Yk.prototype,Zk),Yk.empty=new Yk(qk.empty,0,0);var lS=function(t,e,n){this.pos=t,this.path=e,this.depth=e.length/3-1,this.parentOffset=n},uS={parent:{configurable:!0},doc:{configurable:!0},textOffset:{configurable:!0},nodeAfter:{configurable:!0},nodeBefore:{configurable:!0}};lS.prototype.resolveDepth=function(t){return null==t?this.depth:t<0?this.depth+t:t},uS.parent.get=function(){return this.node(this.depth)},uS.doc.get=function(){return this.node(0)},lS.prototype.node=function(t){return this.path[3*this.resolveDepth(t)]},lS.prototype.index=function(t){return this.path[3*this.resolveDepth(t)+1]},lS.prototype.indexAfter=function(t){return t=this.resolveDepth(t),this.index(t)+(t!=this.depth||this.textOffset?1:0)},lS.prototype.start=function(t){return t=this.resolveDepth(t),0==t?0:this.path[3*t-1]+1},lS.prototype.end=function(t){return t=this.resolveDepth(t),this.start(t)+this.node(t).content.size},lS.prototype.before=function(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position before the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]},lS.prototype.after=function(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position after the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]+this.path[3*t].nodeSize},uS.textOffset.get=function(){return this.pos-this.path[this.path.length-1]},uS.nodeAfter.get=function(){var t=this.parent,e=this.index(this.depth);if(e==t.childCount)return null;var n=this.pos-this.path[this.path.length-1],r=t.child(e);return n?t.child(e).cut(n):r},uS.nodeBefore.get=function(){var t=this.index(this.depth),e=this.pos-this.path[this.path.length-1];return e?this.parent.child(t).cut(0,e):0==t?null:this.parent.child(t-1)},lS.prototype.marks=function(){var t=this.parent,e=this.index();if(0==t.content.size)return Gk.none;if(this.textOffset)return t.child(e).marks;var n=t.maybeChild(e-1),r=t.maybeChild(e);if(!n){var o=n;n=r,r=o}for(var i=n.marks,s=0;s<i.length;s++)!1!==i[s].type.spec.inclusive||r&&i[s].isInSet(r.marks)||(i=i[s--].removeFromSet(i));return i},lS.prototype.marksAcross=function(t){var e=this.parent.maybeChild(this.index());if(!e||!e.isInline)return null;for(var n=e.marks,r=t.parent.maybeChild(t.index()),o=0;o<n.length;o++)!1!==n[o].type.spec.inclusive||r&&n[o].isInSet(r.marks)||(n=n[o--].removeFromSet(n));return n},lS.prototype.sharedDepth=function(t){for(var e=this.depth;e>0;e--)if(this.start(e)<=t&&this.end(e)>=t)return e;return 0},lS.prototype.blockRange=function(t,e){if(void 0===t&&(t=this),t.pos<this.pos)return t.blockRange(this);for(var n=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);n>=0;n--)if(t.pos<=this.end(n)&&(!e||e(this.node(n))))return new vS(this,t,n)},lS.prototype.sameParent=function(t){return this.pos-this.parentOffset==t.pos-t.parentOffset},lS.prototype.max=function(t){return t.pos>this.pos?t:this},lS.prototype.min=function(t){return t.pos<this.pos?t:this},lS.prototype.toString=function(){for(var t="",e=1;e<=this.depth;e++)t+=(t?"/":"")+this.node(e).type.name+"_"+this.index(e-1);return t+":"+this.parentOffset},lS.resolve=function(t,e){if(!(e>=0&&e<=t.content.size))throw new RangeError("Position "+e+" out of range");for(var n=[],r=0,o=e,i=t;;){var s=i.content.findIndex(o),a=s.index,c=s.offset,h=o-c;if(n.push(i,a,r+c),!h)break;if(i=i.child(a),i.isText)break;o=h-1,r+=c+1}return new lS(e,n,o)},lS.resolveCached=function(t,e){for(var n=0;n<fS.length;n++){var r=fS[n];if(r.pos==e&&r.doc==t)return r}var o=fS[dS]=lS.resolve(t,e);return dS=(dS+1)%mS,o},Object.defineProperties(lS.prototype,uS);var fS=[],dS=0,mS=12,vS=function(t,e,n){this.$from=t,this.$to=e,this.depth=n},gS={start:{configurable:!0},end:{configurable:!0},parent:{configurable:!0},startIndex:{configurable:!0},endIndex:{configurable:!0}};gS.start.get=function(){return this.$from.before(this.depth+1)},gS.end.get=function(){return this.$to.after(this.depth+1)},gS.parent.get=function(){return this.$from.node(this.depth)},gS.startIndex.get=function(){return this.$from.index(this.depth)},gS.endIndex.get=function(){return this.$to.indexAfter(this.depth)},Object.defineProperties(vS.prototype,gS);var yS=Object.create(null),wS=function(t,e,n,r){this.type=t,this.attrs=e,this.content=n||qk.empty,this.marks=r||Gk.none},xS={nodeSize:{configurable:!0},childCount:{configurable:!0},textContent:{configurable:!0},firstChild:{configurable:!0},lastChild:{configurable:!0},isBlock:{configurable:!0},isTextblock:{configurable:!0},inlineContent:{configurable:!0},isInline:{configurable:!0},isText:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};xS.nodeSize.get=function(){return this.isLeaf?1:2+this.content.size},xS.childCount.get=function(){return this.content.childCount},wS.prototype.child=function(t){return this.content.child(t)},wS.prototype.maybeChild=function(t){return this.content.maybeChild(t)},wS.prototype.forEach=function(t){this.content.forEach(t)},wS.prototype.nodesBetween=function(t,e,n,r){void 0===r&&(r=0),this.content.nodesBetween(t,e,n,r,this)},wS.prototype.descendants=function(t){this.nodesBetween(0,this.content.size,t)},xS.textContent.get=function(){return this.textBetween(0,this.content.size,"")},wS.prototype.textBetween=function(t,e,n,r){return this.content.textBetween(t,e,n,r)},xS.firstChild.get=function(){return this.content.firstChild},xS.lastChild.get=function(){return this.content.lastChild},wS.prototype.eq=function(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)},wS.prototype.sameMarkup=function(t){return this.hasMarkup(t.type,t.attrs,t.marks)},wS.prototype.hasMarkup=function(t,e,n){return this.type==t&&Uk(this.attrs,e||t.defaultAttrs||yS)&&Gk.sameSet(this.marks,n||Gk.none)},wS.prototype.copy=function(t){return void 0===t&&(t=null),t==this.content?this:new this.constructor(this.type,this.attrs,t,this.marks)},wS.prototype.mark=function(t){return t==this.marks?this:new this.constructor(this.type,this.attrs,this.content,t)},wS.prototype.cut=function(t,e){return 0==t&&e==this.content.size?this:this.copy(this.content.cut(t,e))},wS.prototype.slice=function(t,e,n){if(void 0===e&&(e=this.content.size),void 0===n&&(n=!1),t==e)return Yk.empty;var r=this.resolve(t),o=this.resolve(e),i=n?0:r.sharedDepth(e),s=r.start(i),a=r.node(i),c=a.content.cut(r.pos-s,o.pos-s);return new Yk(c,r.depth-i,o.depth-i)},wS.prototype.replace=function(t,e,n){return eS(this.resolve(t),this.resolve(e),n)},wS.prototype.nodeAt=function(t){for(var e=this;;){var n=e.content.findIndex(t),r=n.index,o=n.offset;if(e=e.maybeChild(r),!e)return null;if(o==t||e.isText)return e;t-=o+1}},wS.prototype.childAfter=function(t){var e=this.content.findIndex(t),n=e.index,r=e.offset;return{node:this.content.maybeChild(n),index:n,offset:r}},wS.prototype.childBefore=function(t){if(0==t)return{node:null,index:0,offset:0};var e=this.content.findIndex(t),n=e.index,r=e.offset;if(r<t)return{node:this.content.child(n),index:n,offset:r};var o=this.content.child(n-1);return{node:o,index:n-1,offset:r-o.nodeSize}},wS.prototype.resolve=function(t){return lS.resolveCached(this,t)},wS.prototype.resolveNoCache=function(t){return lS.resolve(this,t)},wS.prototype.rangeHasMark=function(t,e,n){var r=!1;return e>t&&this.nodesBetween(t,e,(function(t){return n.isInSet(t.marks)&&(r=!0),!r})),r},xS.isBlock.get=function(){return this.type.isBlock},xS.isTextblock.get=function(){return this.type.isTextblock},xS.inlineContent.get=function(){return this.type.inlineContent},xS.isInline.get=function(){return this.type.isInline},xS.isText.get=function(){return this.type.isText},xS.isLeaf.get=function(){return this.type.isLeaf},xS.isAtom.get=function(){return this.type.isAtom},wS.prototype.toString=function(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);var t=this.type.name;return this.content.size&&(t+="("+this.content.toStringInner()+")"),kS(this.marks,t)},wS.prototype.contentMatchAt=function(t){var e=this.type.contentMatch.matchFragment(this.content,0,t);if(!e)throw new Error("Called contentMatchAt on a node with invalid content");return e},wS.prototype.canReplace=function(t,e,n,r,o){void 0===n&&(n=qk.empty),void 0===r&&(r=0),void 0===o&&(o=n.childCount);var i=this.contentMatchAt(t).matchFragment(n,r,o),s=i&&i.matchFragment(this.content,e);if(!s||!s.validEnd)return!1;for(var a=r;a<o;a++)if(!this.type.allowsMarks(n.child(a).marks))return!1;return!0},wS.prototype.canReplaceWith=function(t,e,n,r){if(r&&!this.type.allowsMarks(r))return!1;var o=this.contentMatchAt(t).matchType(n),i=o&&o.matchFragment(this.content,e);return!!i&&i.validEnd},wS.prototype.canAppend=function(t){return t.content.size?this.canReplace(this.childCount,this.childCount,t.content):this.type.compatibleContent(t.type)},wS.prototype.check=function(){if(!this.type.validContent(this.content))throw new RangeError("Invalid content for node "+this.type.name+": "+this.content.toString().slice(0,50));this.content.forEach((function(t){return t.check()}))},wS.prototype.toJSON=function(){var t={type:this.type.name};for(var e in this.attrs){t.attrs=this.attrs;break}return this.content.size&&(t.content=this.content.toJSON()),this.marks.length&&(t.marks=this.marks.map((function(t){return t.toJSON()}))),t},wS.fromJSON=function(t,e){if(!e)throw new RangeError("Invalid input for Node.fromJSON");var n=null;if(e.marks){if(!Array.isArray(e.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=e.marks.map(t.markFromJSON)}if("text"==e.type){if("string"!=typeof e.text)throw new RangeError("Invalid text node in JSON");return t.text(e.text,n)}var r=qk.fromJSON(t,e.content);return t.nodeType(e.type).create(e.attrs,r,n)},Object.defineProperties(wS.prototype,xS);var bS=function(t){function e(e,n,r,o){if(t.call(this,e,n,null,o),!r)throw new RangeError("Empty text nodes are not allowed");this.text=r}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={textContent:{configurable:!0},nodeSize:{configurable:!0}};return e.prototype.toString=function(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):kS(this.marks,JSON.stringify(this.text))},n.textContent.get=function(){return this.text},e.prototype.textBetween=function(t,e){return this.text.slice(t,e)},n.nodeSize.get=function(){return this.text.length},e.prototype.mark=function(t){return t==this.marks?this:new e(this.type,this.attrs,this.text,t)},e.prototype.withText=function(t){return t==this.text?this:new e(this.type,this.attrs,t,this.marks)},e.prototype.cut=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=this.text.length),0==t&&e==this.text.length?this:this.withText(this.text.slice(t,e))},e.prototype.eq=function(t){return this.sameMarkup(t)&&this.text==t.text},e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.text=this.text,e},Object.defineProperties(e.prototype,n),e}(wS);function kS(t,e){for(var n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}var SS=function(t){this.validEnd=t,this.next=[],this.wrapCache=[]},OS={inlineContent:{configurable:!0},defaultType:{configurable:!0},edgeCount:{configurable:!0}};SS.parse=function(t,e){var n=new CS(t,e);if(null==n.next)return SS.empty;var r=NS(n);n.next&&n.err("Unexpected trailing text");var o=BS(IS(r));return $S(o,n),o},SS.prototype.matchType=function(t){for(var e=0;e<this.next.length;e+=2)if(this.next[e]==t)return this.next[e+1];return null},SS.prototype.matchFragment=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=t.childCount);for(var r=this,o=e;r&&o<n;o++)r=r.matchType(t.child(o).type);return r},OS.inlineContent.get=function(){var t=this.next[0];return!!t&&t.isInline},OS.defaultType.get=function(){for(var t=0;t<this.next.length;t+=2){var e=this.next[t];if(!e.isText&&!e.hasRequiredAttrs())return e}},SS.prototype.compatible=function(t){for(var e=0;e<this.next.length;e+=2)for(var n=0;n<t.next.length;n+=2)if(this.next[e]==t.next[n])return!0;return!1},SS.prototype.fillBefore=function(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=0);var r=[this];function o(i,s){var a=i.matchFragment(t,n);if(a&&(!e||a.validEnd))return qk.from(s.map((function(t){return t.createAndFill()})));for(var c=0;c<i.next.length;c+=2){var h=i.next[c],p=i.next[c+1];if(!h.isText&&!h.hasRequiredAttrs()&&-1==r.indexOf(p)){r.push(p);var l=o(p,s.concat(h));if(l)return l}}}return o(this,[])},SS.prototype.findWrapping=function(t){for(var e=0;e<this.wrapCache.length;e+=2)if(this.wrapCache[e]==t)return this.wrapCache[e+1];var n=this.computeWrapping(t);return this.wrapCache.push(t,n),n},SS.prototype.computeWrapping=function(t){var e=Object.create(null),n=[{match:this,type:null,via:null}];while(n.length){var r=n.shift(),o=r.match;if(o.matchType(t)){for(var i=[],s=r;s.type;s=s.via)i.push(s.type);return i.reverse()}for(var a=0;a<o.next.length;a+=2){var c=o.next[a];c.isLeaf||c.hasRequiredAttrs()||c.name in e||r.type&&!o.next[a+1].validEnd||(n.push({match:c.contentMatch,type:c,via:r}),e[c.name]=!0)}}},OS.edgeCount.get=function(){return this.next.length>>1},SS.prototype.edge=function(t){var e=t<<1;if(e>=this.next.length)throw new RangeError("There's no "+t+"th edge in this content match");return{type:this.next[e],next:this.next[e+1]}},SS.prototype.toString=function(){var t=[];function e(n){t.push(n);for(var r=1;r<n.next.length;r+=2)-1==t.indexOf(n.next[r])&&e(n.next[r])}return e(this),t.map((function(e,n){for(var r=n+(e.validEnd?"*":" ")+" ",o=0;o<e.next.length;o+=2)r+=(o?", ":"")+e.next[o].name+"->"+t.indexOf(e.next[o+1]);return r})).join("\n")},Object.defineProperties(SS.prototype,OS),SS.empty=new SS(!0);var CS=function(t,e){this.string=t,this.nodeTypes=e,this.inline=null,this.pos=0,this.tokens=t.split(/\s*(?=\b|\W|$)/),""==this.tokens[this.tokens.length-1]&&this.tokens.pop(),""==this.tokens[0]&&this.tokens.unshift()},MS={next:{configurable:!0}};function NS(t){var e=[];do{e.push(TS(t))}while(t.eat("|"));return 1==e.length?e[0]:{type:"choice",exprs:e}}function TS(t){var e=[];do{e.push(ES(t))}while(t.next&&")"!=t.next&&"|"!=t.next);return 1==e.length?e[0]:{type:"seq",exprs:e}}function ES(t){for(var e=zS(t);;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else{if(!t.eat("{"))break;e=DS(t,e)}return e}function AS(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");var e=Number(t.next);return t.pos++,e}function DS(t,e){var n=AS(t),r=n;return t.eat(",")&&(r="}"!=t.next?AS(t):-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:e}}function RS(t,e){var n=t.nodeTypes,r=n[e];if(r)return[r];var o=[];for(var i in n){var s=n[i];s.groups.indexOf(e)>-1&&o.push(s)}return 0==o.length&&t.err("No node type or group '"+e+"' found"),o}function zS(t){if(t.eat("(")){var e=NS(t);return t.eat(")")||t.err("Missing closing paren"),e}if(!/\W/.test(t.next)){var n=RS(t,t.next).map((function(e){return null==t.inline?t.inline=e.isInline:t.inline!=e.isInline&&t.err("Mixing inline and block content"),{type:"name",value:e}}));return t.pos++,1==n.length?n[0]:{type:"choice",exprs:n}}t.err("Unexpected token '"+t.next+"'")}function IS(t){var e=[[]];return o(i(t,0),n()),e;function n(){return e.push([])-1}function r(t,n,r){var o={term:r,to:n};return e[t].push(o),o}function o(t,e){t.forEach((function(t){return t.to=e}))}function i(t,e){if("choice"==t.type)return t.exprs.reduce((function(t,n){return t.concat(i(n,e))}),[]);if("seq"==t.type)for(var s=0;;s++){var a=i(t.exprs[s],e);if(s==t.exprs.length-1)return a;o(a,e=n())}else{if("star"==t.type){var c=n();return r(e,c),o(i(t.expr,c),c),[r(c)]}if("plus"==t.type){var h=n();return o(i(t.expr,e),h),o(i(t.expr,h),h),[r(h)]}if("opt"==t.type)return[r(e)].concat(i(t.expr,e));if("range"==t.type){for(var p=e,l=0;l<t.min;l++){var u=n();o(i(t.expr,p),u),p=u}if(-1==t.max)o(i(t.expr,p),p);else for(var f=t.min;f<t.max;f++){var d=n();r(p,d),o(i(t.expr,p),d),p=d}return[r(p)]}if("name"==t.type)return[r(e,null,t.value)]}}}function PS(t,e){return e-t}function FS(t,e){var n=[];return r(e),n.sort(PS);function r(e){var o=t[e];if(1==o.length&&!o[0].term)return r(o[0].to);n.push(e);for(var i=0;i<o.length;i++){var s=o[i],a=s.term,c=s.to;a||-1!=n.indexOf(c)||r(c)}}}function BS(t){var e=Object.create(null);return n(FS(t,0));function n(r){var o=[];r.forEach((function(e){t[e].forEach((function(e){var n=e.term,r=e.to;if(n){var i=o.indexOf(n),s=i>-1&&o[i+1];FS(t,r).forEach((function(t){s||o.push(n,s=[]),-1==s.indexOf(t)&&s.push(t)}))}}))}));for(var i=e[r.join(",")]=new SS(r.indexOf(t.length-1)>-1),s=0;s<o.length;s+=2){var a=o[s+1].sort(PS);i.next.push(o[s],e[a.join(",")]||n(a))}return i}}function $S(t,e){for(var n=0,r=[t];n<r.length;n++){for(var o=r[n],i=!o.validEnd,s=[],a=0;a<o.next.length;a+=2){var c=o.next[a],h=o.next[a+1];s.push(c.name),!i||c.isText||c.hasRequiredAttrs()||(i=!1),-1==r.indexOf(h)&&r.push(h)}i&&e.err("Only non-generatable nodes ("+s.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function _S(t){var e=Object.create(null);for(var n in t){var r=t[n];if(!r.hasDefault)return null;e[n]=r.default}return e}function jS(t,e){var n=Object.create(null);for(var r in t){var o=e&&e[r];if(void 0===o){var i=t[r];if(!i.hasDefault)throw new RangeError("No value supplied for attribute "+r);o=i.default}n[r]=o}return n}function JS(t){var e=Object.create(null);if(t)for(var n in t)e[n]=new qS(t[n]);return e}MS.next.get=function(){return this.tokens[this.pos]},CS.prototype.eat=function(t){return this.next==t&&(this.pos++||!0)},CS.prototype.err=function(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")},Object.defineProperties(CS.prototype,MS);var LS=function(t,e,n){this.name=t,this.schema=e,this.spec=n,this.groups=n.group?n.group.split(" "):[],this.attrs=JS(n.attrs),this.defaultAttrs=_S(this.attrs),this.contentMatch=null,this.markSet=null,this.inlineContent=null,this.isBlock=!(n.inline||"text"==t),this.isText="text"==t},VS={isInline:{configurable:!0},isTextblock:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};VS.isInline.get=function(){return!this.isBlock},VS.isTextblock.get=function(){return this.isBlock&&this.inlineContent},VS.isLeaf.get=function(){return this.contentMatch==SS.empty},VS.isAtom.get=function(){return this.isLeaf||this.spec.atom},LS.prototype.hasRequiredAttrs=function(){for(var t in this.attrs)if(this.attrs[t].isRequired)return!0;return!1},LS.prototype.compatibleContent=function(t){return this==t||this.contentMatch.compatible(t.contentMatch)},LS.prototype.computeAttrs=function(t){return!t&&this.defaultAttrs?this.defaultAttrs:jS(this.attrs,t)},LS.prototype.create=function(t,e,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new wS(this,this.computeAttrs(t),qk.from(e),Gk.setFrom(n))},LS.prototype.createChecked=function(t,e,n){if(e=qk.from(e),!this.validContent(e))throw new RangeError("Invalid content for node "+this.name);return new wS(this,this.computeAttrs(t),e,Gk.setFrom(n))},LS.prototype.createAndFill=function(t,e,n){if(t=this.computeAttrs(t),e=qk.from(e),e.size){var r=this.contentMatch.fillBefore(e);if(!r)return null;e=r.append(e)}var o=this.contentMatch.matchFragment(e).fillBefore(qk.empty,!0);return o?new wS(this,t,e.append(o),Gk.setFrom(n)):null},LS.prototype.validContent=function(t){var e=this.contentMatch.matchFragment(t);if(!e||!e.validEnd)return!1;for(var n=0;n<t.childCount;n++)if(!this.allowsMarks(t.child(n).marks))return!1;return!0},LS.prototype.allowsMarkType=function(t){return null==this.markSet||this.markSet.indexOf(t)>-1},LS.prototype.allowsMarks=function(t){if(null==this.markSet)return!0;for(var e=0;e<t.length;e++)if(!this.allowsMarkType(t[e].type))return!1;return!0},LS.prototype.allowedMarks=function(t){if(null==this.markSet)return t;for(var e,n=0;n<t.length;n++)this.allowsMarkType(t[n].type)?e&&e.push(t[n]):e||(e=t.slice(0,n));return e?e.length?e:Gk.empty:t},LS.compile=function(t,e){var n=Object.create(null);t.forEach((function(t,r){return n[t]=new LS(t,e,r)}));var r=e.spec.topNode||"doc";if(!n[r])throw new RangeError("Schema is missing its top node type ('"+r+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(var o in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n},Object.defineProperties(LS.prototype,VS);var qS=function(t){this.hasDefault=Object.prototype.hasOwnProperty.call(t,"default"),this.default=t.default},WS={isRequired:{configurable:!0}};WS.isRequired.get=function(){return!this.hasDefault},Object.defineProperties(qS.prototype,WS);var HS=function(t,e,n,r){this.name=t,this.schema=n,this.spec=r,this.attrs=JS(r.attrs),this.rank=e,this.excluded=null;var o=_S(this.attrs);this.instance=o&&new Gk(this,o)};HS.prototype.create=function(t){return!t&&this.instance?this.instance:new Gk(this,jS(this.attrs,t))},HS.compile=function(t,e){var n=Object.create(null),r=0;return t.forEach((function(t,o){return n[t]=new HS(t,r++,e,o)})),n},HS.prototype.removeFromSet=function(t){for(var e=0;e<t.length;e++)if(t[e].type==this)return t.slice(0,e).concat(t.slice(e+1));return t},HS.prototype.isInSet=function(t){for(var e=0;e<t.length;e++)if(t[e].type==this)return t[e]},HS.prototype.excludes=function(t){return this.excluded.indexOf(t)>-1};var KS=function(t){for(var e in this.spec={},t)this.spec[e]=t[e];this.spec.nodes=c.from(t.nodes),this.spec.marks=c.from(t.marks),this.nodes=LS.compile(this.spec.nodes,this),this.marks=HS.compile(this.spec.marks,this);var n=Object.create(null);for(var r in this.nodes){if(r in this.marks)throw new RangeError(r+" can not be both a node and a mark");var o=this.nodes[r],i=o.spec.content||"",s=o.spec.marks;o.contentMatch=n[i]||(n[i]=SS.parse(i,this.nodes)),o.inlineContent=o.contentMatch.inlineContent,o.markSet="_"==s?null:s?US(this,s.split(" ")):""!=s&&o.inlineContent?null:[]}for(var a in this.marks){var h=this.marks[a],p=h.spec.excludes;h.excluded=null==p?[h]:""==p?[]:US(this,p.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached=Object.create(null),this.cached.wrappings=Object.create(null)};function US(t,e){for(var n=[],r=0;r<e.length;r++){var o=e[r],i=t.marks[o],s=i;if(i)n.push(i);else for(var a in t.marks){var c=t.marks[a];("_"==o||c.spec.group&&c.spec.group.split(" ").indexOf(o)>-1)&&n.push(s=c)}if(!s)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return n}KS.prototype.node=function(t,e,n,r){if("string"==typeof t)t=this.nodeType(t);else{if(!(t instanceof LS))throw new RangeError("Invalid node type: "+t);if(t.schema!=this)throw new RangeError("Node type from different schema used ("+t.name+")")}return t.createChecked(e,n,r)},KS.prototype.text=function(t,e){var n=this.nodes.text;return new bS(n,n.defaultAttrs,t,Gk.setFrom(e))},KS.prototype.mark=function(t,e){return"string"==typeof t&&(t=this.marks[t]),t.create(e)},KS.prototype.nodeFromJSON=function(t){return wS.fromJSON(this,t)},KS.prototype.markFromJSON=function(t){return Gk.fromJSON(this,t)},KS.prototype.nodeType=function(t){var e=this.nodes[t];if(!e)throw new RangeError("Unknown node type: "+t);return e};var GS=function(t,e){var n=this;this.schema=t,this.rules=e,this.tags=[],this.styles=[],e.forEach((function(t){t.tag?n.tags.push(t):t.style&&n.styles.push(t)})),this.normalizeLists=!this.tags.some((function(e){if(!/^(ul|ol)\b/.test(e.tag)||!e.node)return!1;var n=t.nodes[e.node];return n.contentMatch.matchType(n)}))};GS.prototype.parse=function(t,e){void 0===e&&(e={});var n=new oO(this,e,!1);return n.addAll(t,null,e.from,e.to),n.finish()},GS.prototype.parseSlice=function(t,e){void 0===e&&(e={});var n=new oO(this,e,!0);return n.addAll(t,null,e.from,e.to),Yk.maxOpen(n.finish())},GS.prototype.matchTag=function(t,e){for(var n=0;n<this.tags.length;n++){var r=this.tags[n];if(aO(t,r.tag)&&(void 0===r.namespace||t.namespaceURI==r.namespace)&&(!r.context||e.matchesContext(r.context))){if(r.getAttrs){var o=r.getAttrs(t);if(!1===o)continue;r.attrs=o}return r}}},GS.prototype.matchStyle=function(t,e,n){for(var r=0;r<this.styles.length;r++){var o=this.styles[r];if(!(0!=o.style.indexOf(t)||o.context&&!n.matchesContext(o.context)||o.style.length>t.length&&(61!=o.style.charCodeAt(t.length)||o.style.slice(t.length+1)!=e))){if(o.getAttrs){var i=o.getAttrs(e);if(!1===i)continue;o.attrs=i}return o}}},GS.schemaRules=function(t){var e=[];function n(t){for(var n=null==t.priority?50:t.priority,r=0;r<e.length;r++){var o=e[r],i=null==o.priority?50:o.priority;if(i<n)break}e.splice(r,0,t)}var r=function(e){var r=t.marks[e].spec.parseDOM;r&&r.forEach((function(t){n(t=hO(t)),t.mark=e}))};for(var o in t.marks)r(o);var i=function(e){var r=t.nodes[s].spec.parseDOM;r&&r.forEach((function(t){n(t=hO(t)),t.node=s}))};for(var s in t.nodes)i();return e},GS.fromSchema=function(t){return t.cached.domParser||(t.cached.domParser=new GS(t,GS.schemaRules(t)))};var XS={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},YS={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},ZS={ol:!0,ul:!0},QS=1,tO=2,eO=4;function nO(t){return(t?QS:0)|("full"===t?tO:0)}var rO=function(t,e,n,r,o,i,s){this.type=t,this.attrs=e,this.solid=o,this.match=i||(s&eO?null:t.contentMatch),this.options=s,this.content=[],this.marks=n,this.activeMarks=Gk.none,this.pendingMarks=r};rO.prototype.findWrapping=function(t){if(!this.match){if(!this.type)return[];var e=this.type.contentMatch.fillBefore(qk.from(t));if(!e){var n,r=this.type.contentMatch;return(n=r.findWrapping(t.type))?(this.match=r,n):null}this.match=this.type.contentMatch.matchFragment(e)}return this.match.findWrapping(t.type)},rO.prototype.finish=function(t){if(!(this.options&QS)){var e,n=this.content[this.content.length-1];n&&n.isText&&(e=/[ \t\r\n\u000c]+$/.exec(n.text))&&(n.text.length==e[0].length?this.content.pop():this.content[this.content.length-1]=n.withText(n.text.slice(0,n.text.length-e[0].length)))}var r=qk.from(this.content);return!t&&this.match&&(r=r.append(this.match.fillBefore(qk.empty,!0))),this.type?this.type.create(this.attrs,r,this.marks):r},rO.prototype.applyPending=function(t){for(var e=0,n=this.pendingMarks;e<n.length;e++){var r=n[e];(this.type?this.type.allowsMarkType(r.type):pO(r.type,t))&&!r.isInSet(this.activeMarks)&&(this.activeMarks=r.addToSet(this.activeMarks),this.pendingMarks=r.removeFromSet(this.pendingMarks))}};var oO=function(t,e,n){this.parser=t,this.options=e,this.isOpen=n;var r,o=e.topNode,i=nO(e.preserveWhitespace)|(n?eO:0);r=o?new rO(o.type,o.attrs,Gk.none,Gk.none,!0,e.topMatch||o.type.contentMatch,i):new rO(n?null:t.schema.topNodeType,null,Gk.none,Gk.none,!0,null,i),this.nodes=[r],this.open=0,this.find=e.findPositions,this.needsBlock=!1},iO={top:{configurable:!0},currentPos:{configurable:!0}};function sO(t){for(var e=t.firstChild,n=null;e;e=e.nextSibling){var r=1==e.nodeType?e.nodeName.toLowerCase():null;r&&ZS.hasOwnProperty(r)&&n?(n.appendChild(e),e=n):"li"==r?n=e:r&&(n=null)}}function aO(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function cO(t){var e,n=/\s*([\w-]+)\s*:\s*([^;]+)/g,r=[];while(e=n.exec(t))r.push(e[1],e[2].trim());return r}function hO(t){var e={};for(var n in t)e[n]=t[n];return e}function pO(t,e){var n=e.schema.nodes,r=function(r){var o=n[r];if(o.allowsMarkType(t)){var i=[],s=function(t){i.push(t);for(var n=0;n<t.edgeCount;n++){var r=t.edge(n),o=r.type,a=r.next;if(o==e)return!0;if(i.indexOf(a)<0&&s(a))return!0}};return s(o.contentMatch)?{v:!0}:void 0}};for(var o in n){var i=r(o);if(i)return i.v}}iO.top.get=function(){return this.nodes[this.open]},oO.prototype.addDOM=function(t){if(3==t.nodeType)this.addTextNode(t);else if(1==t.nodeType){var e=t.getAttribute("style"),n=e?this.readStyles(cO(e)):null,r=this.top;if(null!=n)for(var o=0;o<n.length;o++)this.addPendingMark(n[o]);if(this.addElement(t),null!=n)for(var i=0;i<n.length;i++)this.removePendingMark(n[i],r)}},oO.prototype.addTextNode=function(t){var e=t.nodeValue,n=this.top;if((n.type?n.type.inlineContent:n.content.length&&n.content[0].isInline)||/[^ \t\r\n\u000c]/.test(e)){if(n.options&QS)n.options&tO||(e=e.replace(/\r?\n|\r/g," "));else if(e=e.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(e)&&this.open==this.nodes.length-1){var r=n.content[n.content.length-1],o=t.previousSibling;(!r||o&&"BR"==o.nodeName||r.isText&&/[ \t\r\n\u000c]$/.test(r.text))&&(e=e.slice(1))}e&&this.insertNode(this.parser.schema.text(e)),this.findInText(t)}else this.findInside(t)},oO.prototype.addElement=function(t){var e=t.nodeName.toLowerCase();ZS.hasOwnProperty(e)&&this.normalizeLists&&sO(t);var n=this.options.ruleFromNode&&this.options.ruleFromNode(t)||this.parser.matchTag(t,this);if(n?n.ignore:YS.hasOwnProperty(e))this.findInside(t);else if(!n||n.skip||n.closeParent){n&&n.closeParent?this.open=Math.max(0,this.open-1):n&&n.skip.nodeType&&(t=n.skip);var r,o=this.top,i=this.needsBlock;if(XS.hasOwnProperty(e))r=!0,o.type||(this.needsBlock=!0);else if(!t.firstChild)return void this.leafFallback(t);this.addAll(t),r&&this.sync(o),this.needsBlock=i}else this.addElementByRule(t,n)},oO.prototype.leafFallback=function(t){"BR"==t.nodeName&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(t.ownerDocument.createTextNode("\n"))},oO.prototype.readStyles=function(t){for(var e=Gk.none,n=0;n<t.length;n+=2){var r=this.parser.matchStyle(t[n],t[n+1],this);if(r){if(r.ignore)return null;e=this.parser.schema.marks[r.mark].create(r.attrs).addToSet(e)}}return e},oO.prototype.addElementByRule=function(t,e){var n,r,o,i,s=this;e.node?(r=this.parser.schema.nodes[e.node],r.isLeaf?this.insertNode(r.create(e.attrs))||this.leafFallback(t):n=this.enter(r,e.attrs,e.preserveWhitespace)):(o=this.parser.schema.marks[e.mark],i=o.create(e.attrs),this.addPendingMark(i));var a=this.top;if(r&&r.isLeaf)this.findInside(t);else if(e.getContent)this.findInside(t),e.getContent(t,this.parser.schema).forEach((function(t){return s.insertNode(t)}));else{var c=e.contentElement;"string"==typeof c?c=t.querySelector(c):"function"==typeof c&&(c=c(t)),c||(c=t),this.findAround(t,c,!0),this.addAll(c,n)}n&&(this.sync(a),this.open--),i&&this.removePendingMark(i,a)},oO.prototype.addAll=function(t,e,n,r){for(var o=n||0,i=n?t.childNodes[n]:t.firstChild,s=null==r?null:t.childNodes[r];i!=s;i=i.nextSibling,++o)this.findAtPoint(t,o),this.addDOM(i),e&&XS.hasOwnProperty(i.nodeName.toLowerCase())&&this.sync(e);this.findAtPoint(t,o)},oO.prototype.findPlace=function(t){for(var e,n,r=this.open;r>=0;r--){var o=this.nodes[r],i=o.findWrapping(t);if(i&&(!e||e.length>i.length)&&(e=i,n=o,!i.length))break;if(o.solid)break}if(!e)return!1;this.sync(n);for(var s=0;s<e.length;s++)this.enterInner(e[s],null,!1);return!0},oO.prototype.insertNode=function(t){if(t.isInline&&this.needsBlock&&!this.top.type){var e=this.textblockFromContext();e&&this.enterInner(e)}if(this.findPlace(t)){this.closeExtra();var n=this.top;n.applyPending(t.type),n.match&&(n.match=n.match.matchType(t.type));for(var r=n.activeMarks,o=0;o<t.marks.length;o++)n.type&&!n.type.allowsMarkType(t.marks[o].type)||(r=t.marks[o].addToSet(r));return n.content.push(t.mark(r)),!0}return!1},oO.prototype.enter=function(t,e,n){var r=this.findPlace(t.create(e));return r&&this.enterInner(t,e,!0,n),r},oO.prototype.enterInner=function(t,e,n,r){this.closeExtra();var o=this.top;o.applyPending(t),o.match=o.match&&o.match.matchType(t,e);var i=null==r?o.options&~eO:nO(r);o.options&eO&&0==o.content.length&&(i|=eO),this.nodes.push(new rO(t,e,o.activeMarks,o.pendingMarks,n,null,i)),this.open++},oO.prototype.closeExtra=function(t){var e=this.nodes.length-1;if(e>this.open){for(;e>this.open;e--)this.nodes[e-1].content.push(this.nodes[e].finish(t));this.nodes.length=this.open+1}},oO.prototype.finish=function(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)},oO.prototype.sync=function(t){for(var e=this.open;e>=0;e--)if(this.nodes[e]==t)return void(this.open=e)},iO.currentPos.get=function(){this.closeExtra();for(var t=0,e=this.open;e>=0;e--){for(var n=this.nodes[e].content,r=n.length-1;r>=0;r--)t+=n[r].nodeSize;e&&t++}return t},oO.prototype.findAtPoint=function(t,e){if(this.find)for(var n=0;n<this.find.length;n++)this.find[n].node==t&&this.find[n].offset==e&&(this.find[n].pos=this.currentPos)},oO.prototype.findInside=function(t){if(this.find)for(var e=0;e<this.find.length;e++)null==this.find[e].pos&&1==t.nodeType&&t.contains(this.find[e].node)&&(this.find[e].pos=this.currentPos)},oO.prototype.findAround=function(t,e,n){if(t!=e&&this.find)for(var r=0;r<this.find.length;r++)if(null==this.find[r].pos&&1==t.nodeType&&t.contains(this.find[r].node)){var o=e.compareDocumentPosition(this.find[r].node);o&(n?2:4)&&(this.find[r].pos=this.currentPos)}},oO.prototype.findInText=function(t){if(this.find)for(var e=0;e<this.find.length;e++)this.find[e].node==t&&(this.find[e].pos=this.currentPos-(t.nodeValue.length-this.find[e].offset))},oO.prototype.matchesContext=function(t){var e=this;if(t.indexOf("|")>-1)return t.split(/\s*\|\s*/).some(this.matchesContext,this);var n=t.split("/"),r=this.options.context,o=!this.isOpen&&(!r||r.parent.type==this.nodes[0].type),i=-(r?r.depth+1:0)+(o?0:1),s=function(t,a){for(;t>=0;t--){var c=n[t];if(""==c){if(t==n.length-1||0==t)continue;for(;a>=i;a--)if(s(t-1,a))return!0;return!1}var h=a>0||0==a&&o?e.nodes[a].type:r&&a>=i?r.node(a-i).type:null;if(!h||h.name!=c&&-1==h.groups.indexOf(c))return!1;a--}return!0};return s(n.length-1,this.open)},oO.prototype.textblockFromContext=function(){var t=this.options.context;if(t)for(var e=t.depth;e>=0;e--){var n=t.node(e).contentMatchAt(t.indexAfter(e)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(var r in this.parser.schema.nodes){var o=this.parser.schema.nodes[r];if(o.isTextblock&&o.defaultAttrs)return o}},oO.prototype.addPendingMark=function(t){this.top.pendingMarks=t.addToSet(this.top.pendingMarks)},oO.prototype.removePendingMark=function(t,e){for(var n=this.open;n>=0;n--){var r=this.nodes[n],o=r.pendingMarks.lastIndexOf(t);if(o>-1?r.pendingMarks=t.removeFromSet(r.pendingMarks):r.activeMarks=t.removeFromSet(r.activeMarks),r==e)break}},Object.defineProperties(oO.prototype,iO);var lO=function(t,e){this.nodes=t||{},this.marks=e||{}};function uO(t){var e={};for(var n in t){var r=t[n].spec.toDOM;r&&(e[n]=r)}return e}function fO(t){return t.document||window.document}lO.prototype.serializeFragment=function(t,e,n){var r=this;void 0===e&&(e={}),n||(n=fO(e).createDocumentFragment());var o=n,i=null;return t.forEach((function(t){if(i||t.marks.length){i||(i=[]);var n=0,s=0;while(n<i.length&&s<t.marks.length){var a=t.marks[s];if(r.marks[a.type.name]){if(!a.eq(i[n])||!1===a.type.spec.spanning)break;n+=2,s++}else s++}while(n<i.length)o=i.pop(),i.pop();while(s<t.marks.length){var c=t.marks[s++],h=r.serializeMark(c,t.isInline,e);h&&(i.push(c,o),o.appendChild(h.dom),o=h.contentDOM||h.dom)}}o.appendChild(r.serializeNode(t,e))})),n},lO.prototype.serializeNode=function(t,e){void 0===e&&(e={});var n=lO.renderSpec(fO(e),this.nodes[t.type.name](t)),r=n.dom,o=n.contentDOM;if(o){if(t.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");e.onContent?e.onContent(t,o,e):this.serializeFragment(t.content,e,o)}return r},lO.prototype.serializeNodeAndMarks=function(t,e){void 0===e&&(e={});for(var n=this.serializeNode(t,e),r=t.marks.length-1;r>=0;r--){var o=this.serializeMark(t.marks[r],t.isInline,e);o&&((o.contentDOM||o.dom).appendChild(n),n=o.dom)}return n},lO.prototype.serializeMark=function(t,e,n){void 0===n&&(n={});var r=this.marks[t.type.name];return r&&lO.renderSpec(fO(n),r(t,e))},lO.renderSpec=function(t,e,n){if(void 0===n&&(n=null),"string"==typeof e)return{dom:t.createTextNode(e)};if(null!=e.nodeType)return{dom:e};var r=e[0],o=r.indexOf(" ");o>0&&(n=r.slice(0,o),r=r.slice(o+1));var i=null,s=n?t.createElementNS(n,r):t.createElement(r),a=e[1],c=1;if(a&&"object"==typeof a&&null==a.nodeType&&!Array.isArray(a))for(var h in c=2,a)if(null!=a[h]){var p=h.indexOf(" ");p>0?s.setAttributeNS(h.slice(0,p),h.slice(p+1),a[h]):s.setAttribute(h,a[h])}for(var l=c;l<e.length;l++){var u=e[l];if(0===u){if(l<e.length-1||l>c)throw new RangeError("Content hole must be the only child of its parent node");return{dom:s,contentDOM:s}}var f=lO.renderSpec(t,u,n),d=f.dom,m=f.contentDOM;if(s.appendChild(d),m){if(i)throw new RangeError("Multiple content holes");i=m}}return{dom:s,contentDOM:i}},lO.fromSchema=function(t){return t.cached.domSerializer||(t.cached.domSerializer=new lO(this.nodesFromSchema(t),this.marksFromSchema(t)))},lO.nodesFromSchema=function(t){var e=uO(t.nodes);return e.text||(e.text=function(t){return t.text}),e},lO.marksFromSchema=function(t){return uO(t.marks)};var dO=65535,mO=Math.pow(2,16);function vO(t,e){return t+e*mO}function gO(t){return t&dO}function yO(t){return(t-(t&dO))/mO}var wO=function(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=null),this.pos=t,this.deleted=e,this.recover=n},xO=function(t,e){void 0===e&&(e=!1),this.ranges=t,this.inverted=e};xO.prototype.recover=function(t){var e=0,n=gO(t);if(!this.inverted)for(var r=0;r<n;r++)e+=this.ranges[3*r+2]-this.ranges[3*r+1];return this.ranges[3*n]+e+yO(t)},xO.prototype.mapResult=function(t,e){return void 0===e&&(e=1),this._map(t,e,!1)},xO.prototype.map=function(t,e){return void 0===e&&(e=1),this._map(t,e,!0)},xO.prototype._map=function(t,e,n){for(var r=0,o=this.inverted?2:1,i=this.inverted?1:2,s=0;s<this.ranges.length;s+=3){var a=this.ranges[s]-(this.inverted?r:0);if(a>t)break;var c=this.ranges[s+o],h=this.ranges[s+i],p=a+c;if(t<=p){var l=c?t==a?-1:t==p?1:e:e,u=a+r+(l<0?0:h);if(n)return u;var f=t==(e<0?a:p)?null:vO(s/3,t-a);return new wO(u,e<0?t!=a:t!=p,f)}r+=h-c}return n?t+r:new wO(t+r)},xO.prototype.touches=function(t,e){for(var n=0,r=gO(e),o=this.inverted?2:1,i=this.inverted?1:2,s=0;s<this.ranges.length;s+=3){var a=this.ranges[s]-(this.inverted?n:0);if(a>t)break;var c=this.ranges[s+o],h=a+c;if(t<=h&&s==3*r)return!0;n+=this.ranges[s+i]-c}return!1},xO.prototype.forEach=function(t){for(var e=this.inverted?2:1,n=this.inverted?1:2,r=0,o=0;r<this.ranges.length;r+=3){var i=this.ranges[r],s=i-(this.inverted?o:0),a=i+(this.inverted?0:o),c=this.ranges[r+e],h=this.ranges[r+n];t(s,s+c,a,a+h),o+=h-c}},xO.prototype.invert=function(){return new xO(this.ranges,!this.inverted)},xO.prototype.toString=function(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)},xO.offset=function(t){return 0==t?xO.empty:new xO(t<0?[0,-t,0]:[0,0,t])},xO.empty=new xO([]);var bO=function(t,e,n,r){this.maps=t||[],this.from=n||0,this.to=null==r?this.maps.length:r,this.mirror=e};function kO(t){var e=Error.call(this,t);return e.__proto__=kO.prototype,e}bO.prototype.slice=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=this.maps.length),new bO(this.maps,this.mirror,t,e)},bO.prototype.copy=function(){return new bO(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)},bO.prototype.appendMap=function(t,e){this.to=this.maps.push(t),null!=e&&this.setMirror(this.maps.length-1,e)},bO.prototype.appendMapping=function(t){for(var e=0,n=this.maps.length;e<t.maps.length;e++){var r=t.getMirror(e);this.appendMap(t.maps[e],null!=r&&r<e?n+r:null)}},bO.prototype.getMirror=function(t){if(this.mirror)for(var e=0;e<this.mirror.length;e++)if(this.mirror[e]==t)return this.mirror[e+(e%2?-1:1)]},bO.prototype.setMirror=function(t,e){this.mirror||(this.mirror=[]),this.mirror.push(t,e)},bO.prototype.appendMappingInverted=function(t){for(var e=t.maps.length-1,n=this.maps.length+t.maps.length;e>=0;e--){var r=t.getMirror(e);this.appendMap(t.maps[e].invert(),null!=r&&r>e?n-r-1:null)}},bO.prototype.invert=function(){var t=new bO;return t.appendMappingInverted(this),t},bO.prototype.map=function(t,e){if(void 0===e&&(e=1),this.mirror)return this._map(t,e,!0);for(var n=this.from;n<this.to;n++)t=this.maps[n].map(t,e);return t},bO.prototype.mapResult=function(t,e){return void 0===e&&(e=1),this._map(t,e,!1)},bO.prototype._map=function(t,e,n){for(var r=!1,o=this.from;o<this.to;o++){var i=this.maps[o],s=i.mapResult(t,e);if(null!=s.recover){var a=this.getMirror(o);if(null!=a&&a>o&&a<this.to){o=a,t=this.maps[a].recover(s.recover);continue}}s.deleted&&(r=!0),t=s.pos}return n?t:new wO(t,r)},kO.prototype=Object.create(Error.prototype),kO.prototype.constructor=kO,kO.prototype.name="TransformError";var SO=function(t){this.doc=t,this.steps=[],this.docs=[],this.mapping=new bO},OO={before:{configurable:!0},docChanged:{configurable:!0}};function CO(){throw new Error("Override me")}OO.before.get=function(){return this.docs.length?this.docs[0]:this.doc},SO.prototype.step=function(t){var e=this.maybeStep(t);if(e.failed)throw new kO(e.failed);return this},SO.prototype.maybeStep=function(t){var e=t.apply(this.doc);return e.failed||this.addStep(t,e.doc),e},OO.docChanged.get=function(){return this.steps.length>0},SO.prototype.addStep=function(t,e){this.docs.push(this.doc),this.steps.push(t),this.mapping.appendMap(t.getMap()),this.doc=e},Object.defineProperties(SO.prototype,OO);var MO=Object.create(null),NO=function(){};NO.prototype.apply=function(t){return CO()},NO.prototype.getMap=function(){return xO.empty},NO.prototype.invert=function(t){return CO()},NO.prototype.map=function(t){return CO()},NO.prototype.merge=function(t){return null},NO.prototype.toJSON=function(){return CO()},NO.fromJSON=function(t,e){if(!e||!e.stepType)throw new RangeError("Invalid input for Step.fromJSON");var n=MO[e.stepType];if(!n)throw new RangeError("No step type "+e.stepType+" defined");return n.fromJSON(t,e)},NO.jsonID=function(t,e){if(t in MO)throw new RangeError("Duplicate use of step JSON ID "+t);return MO[t]=e,e.prototype.jsonID=t,e};var TO=function(t,e){this.doc=t,this.failed=e};TO.ok=function(t){return new TO(t,null)},TO.fail=function(t){return new TO(null,t)},TO.fromReplace=function(t,e,n,r){try{return TO.ok(t.replace(e,n,r))}catch(o){if(o instanceof Xk)return TO.fail(o.message);throw o}};var EO=function(t){function e(e,n,r,o){t.call(this),this.from=e,this.to=n,this.slice=r,this.structure=!!o}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(t){return this.structure&&DO(t,this.from,this.to)?TO.fail("Structure replace would overwrite content"):TO.fromReplace(t,this.from,this.to,this.slice)},e.prototype.getMap=function(){return new xO([this.from,this.to-this.from,this.slice.size])},e.prototype.invert=function(t){return new e(this.from,this.from+this.slice.size,t.slice(this.from,this.to))},e.prototype.map=function(t){var n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return n.deleted&&r.deleted?null:new e(n.pos,Math.max(n.pos,r.pos),this.slice)},e.prototype.merge=function(t){if(!(t instanceof e)||t.structure!=this.structure)return null;if(this.from+this.slice.size!=t.from||this.slice.openEnd||t.slice.openStart){if(t.to!=this.from||this.slice.openStart||t.slice.openEnd)return null;var n=this.slice.size+t.slice.size==0?Yk.empty:new Yk(t.slice.content.append(this.slice.content),t.slice.openStart,this.slice.openEnd);return new e(t.from,this.to,n,this.structure)}var r=this.slice.size+t.slice.size==0?Yk.empty:new Yk(this.slice.content.append(t.slice.content),this.slice.openStart,t.slice.openEnd);return new e(this.from,this.to+(t.to-t.from),r,this.structure)},e.prototype.toJSON=function(){var t={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t},e.fromJSON=function(t,n){if("number"!=typeof n.from||"number"!=typeof n.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new e(n.from,n.to,Yk.fromJSON(t,n.slice),!!n.structure)},e}(NO);NO.jsonID("replace",EO);var AO=function(t){function e(e,n,r,o,i,s,a){t.call(this),this.from=e,this.to=n,this.gapFrom=r,this.gapTo=o,this.slice=i,this.insert=s,this.structure=!!a}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(t){if(this.structure&&(DO(t,this.from,this.gapFrom)||DO(t,this.gapTo,this.to)))return TO.fail("Structure gap-replace would overwrite content");var e=t.slice(this.gapFrom,this.gapTo);if(e.openStart||e.openEnd)return TO.fail("Gap is not a flat range");var n=this.slice.insertAt(this.insert,e.content);return n?TO.fromReplace(t,this.from,this.to,n):TO.fail("Content does not fit in gap")},e.prototype.getMap=function(){return new xO([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])},e.prototype.invert=function(t){var n=this.gapTo-this.gapFrom;return new e(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)},e.prototype.map=function(t){var n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1),o=t.map(this.gapFrom,-1),i=t.map(this.gapTo,1);return n.deleted&&r.deleted||o<n.pos||i>r.pos?null:new e(n.pos,r.pos,o,i,this.slice,this.insert,this.structure)},e.prototype.toJSON=function(){var t={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t},e.fromJSON=function(t,n){if("number"!=typeof n.from||"number"!=typeof n.to||"number"!=typeof n.gapFrom||"number"!=typeof n.gapTo||"number"!=typeof n.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new e(n.from,n.to,n.gapFrom,n.gapTo,Yk.fromJSON(t,n.slice),n.insert,!!n.structure)},e}(NO);function DO(t,e,n){var r=t.resolve(e),o=n-e,i=r.depth;while(o>0&&i>0&&r.indexAfter(i)==r.node(i).childCount)i--,o--;if(o>0){var s=r.node(i).maybeChild(r.indexAfter(i));while(o>0){if(!s||s.isLeaf)return!0;s=s.firstChild,o--}}return!1}function RO(t,e,n){var r=t.resolve(e),o=r.index();return r.parent.canReplaceWith(o,o+1,n)}function zO(t,e,n){var r=t.resolve(e);if(r.parent.canReplaceWith(r.index(),r.index(),n))return e;if(0==r.parentOffset)for(var o=r.depth-1;o>=0;o--){var i=r.index(o);if(r.node(o).canReplaceWith(i,i,n))return r.before(o+1);if(i>0)return null}if(r.parentOffset==r.parent.content.size)for(var s=r.depth-1;s>=0;s--){var a=r.indexAfter(s);if(r.node(s).canReplaceWith(a,a,n))return r.after(s+1);if(a<r.node(s).childCount)return null}}function IO(t,e,n){var r=t.resolve(e);if(!n.content.size)return e;for(var o=n.content,i=0;i<n.openStart;i++)o=o.firstChild.content;for(var s=1;s<=(0==n.openStart&&n.size?2:1);s++)for(var a=r.depth;a>=0;a--){var c=a==r.depth?0:r.pos<=(r.start(a+1)+r.end(a+1))/2?-1:1,h=r.index(a)+(c>0?1:0);if(1==s?r.node(a).canReplace(h,h,o):r.node(a).contentMatchAt(h).findWrapping(o.firstChild.type))return 0==c?r.pos:c<0?r.before(a+1):r.after(a+1)}return null}function PO(t,e,n){for(var r=[],o=0;o<t.childCount;o++){var i=t.child(o);i.content.size&&(i=i.copy(PO(i.content,e,i))),i.isInline&&(i=e(i,n,o)),r.push(i)}return qk.fromArray(r)}NO.jsonID("replaceAround",AO),SO.prototype.lift=function(t,e){for(var n=t.$from,r=t.$to,o=t.depth,i=n.before(o+1),s=r.after(o+1),a=i,c=s,h=qk.empty,p=0,l=o,u=!1;l>e;l--)u||n.index(l)>0?(u=!0,h=qk.from(n.node(l).copy(h)),p++):a--;for(var f=qk.empty,d=0,m=o,v=!1;m>e;m--)v||r.after(m+1)<r.end(m)?(v=!0,f=qk.from(r.node(m).copy(f)),d++):c++;return this.step(new AO(a,c,i,s,new Yk(h.append(f),p,d),h.size-p,!0))},SO.prototype.wrap=function(t,e){for(var n=qk.empty,r=e.length-1;r>=0;r--)n=qk.from(e[r].type.create(e[r].attrs,n));var o=t.start,i=t.end;return this.step(new AO(o,i,o,i,new Yk(n,0,0),e.length,!0))},SO.prototype.setBlockType=function(t,e,n,r){var o=this;if(void 0===e&&(e=t),!n.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");var i=this.steps.length;return this.doc.nodesBetween(t,e,(function(t,e){if(t.isTextblock&&!t.hasMarkup(n,r)&&RO(o.doc,o.mapping.slice(i).map(e),n)){o.clearIncompatible(o.mapping.slice(i).map(e,1),n);var s=o.mapping.slice(i),a=s.map(e,1),c=s.map(e+t.nodeSize,1);return o.step(new AO(a,c,a+1,c-1,new Yk(qk.from(n.create(r,null,t.marks)),0,0),1,!0)),!1}})),this},SO.prototype.setNodeMarkup=function(t,e,n,r){var o=this.doc.nodeAt(t);if(!o)throw new RangeError("No node at given position");e||(e=o.type);var i=e.create(n,null,r||o.marks);if(o.isLeaf)return this.replaceWith(t,t+o.nodeSize,i);if(!e.validContent(o.content))throw new RangeError("Invalid content for node type "+e.name);return this.step(new AO(t,t+o.nodeSize,t+1,t+o.nodeSize-1,new Yk(qk.from(i),0,0),1,!0))},SO.prototype.split=function(t,e,n){void 0===e&&(e=1);for(var r=this.doc.resolve(t),o=qk.empty,i=qk.empty,s=r.depth,a=r.depth-e,c=e-1;s>a;s--,c--){o=qk.from(r.node(s).copy(o));var h=n&&n[c];i=qk.from(h?h.type.create(h.attrs,i):r.node(s).copy(i))}return this.step(new EO(t,t,new Yk(o.append(i),e,e),!0))},SO.prototype.join=function(t,e){void 0===e&&(e=1);var n=new EO(t-e,t+e,Yk.empty,!0);return this.step(n)};var FO=function(t){function e(e,n,r){t.call(this),this.from=e,this.to=n,this.mark=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(t){var e=this,n=t.slice(this.from,this.to),r=t.resolve(this.from),o=r.node(r.sharedDepth(this.to)),i=new Yk(PO(n.content,(function(t,n){return n.type.allowsMarkType(e.mark.type)?t.mark(e.mark.addToSet(t.marks)):t}),o),n.openStart,n.openEnd);return TO.fromReplace(t,this.from,this.to,i)},e.prototype.invert=function(){return new BO(this.from,this.to,this.mark)},e.prototype.map=function(t){var n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new e(n.pos,r.pos,this.mark)},e.prototype.merge=function(t){if(t instanceof e&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from)return new e(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark)},e.prototype.toJSON=function(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},e.fromJSON=function(t,n){if("number"!=typeof n.from||"number"!=typeof n.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new e(n.from,n.to,t.markFromJSON(n.mark))},e}(NO);NO.jsonID("addMark",FO);var BO=function(t){function e(e,n,r){t.call(this),this.from=e,this.to=n,this.mark=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(t){var e=this,n=t.slice(this.from,this.to),r=new Yk(PO(n.content,(function(t){return t.mark(e.mark.removeFromSet(t.marks))})),n.openStart,n.openEnd);return TO.fromReplace(t,this.from,this.to,r)},e.prototype.invert=function(){return new FO(this.from,this.to,this.mark)},e.prototype.map=function(t){var n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new e(n.pos,r.pos,this.mark)},e.prototype.merge=function(t){if(t instanceof e&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from)return new e(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark)},e.prototype.toJSON=function(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},e.fromJSON=function(t,n){if("number"!=typeof n.from||"number"!=typeof n.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new e(n.from,n.to,t.markFromJSON(n.mark))},e}(NO);function $O(t,e,n,r){if(void 0===n&&(n=e),void 0===r&&(r=Yk.empty),e==n&&!r.size)return null;var o=t.resolve(e),i=t.resolve(n);return _O(o,i,r)?new EO(e,n,r):new jO(o,i,r).fit()}function _O(t,e,n){return!n.openStart&&!n.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),n.content)}NO.jsonID("removeMark",BO),SO.prototype.addMark=function(t,e,n){var r=this,o=[],i=[],s=null,a=null;return this.doc.nodesBetween(t,e,(function(r,c,h){if(r.isInline){var p=r.marks;if(!n.isInSet(p)&&h.type.allowsMarkType(n.type)){for(var l=Math.max(c,t),u=Math.min(c+r.nodeSize,e),f=n.addToSet(p),d=0;d<p.length;d++)p[d].isInSet(f)||(s&&s.to==l&&s.mark.eq(p[d])?s.to=u:o.push(s=new BO(l,u,p[d])));a&&a.to==l?a.to=u:i.push(a=new FO(l,u,n))}}})),o.forEach((function(t){return r.step(t)})),i.forEach((function(t){return r.step(t)})),this},SO.prototype.removeMark=function(t,e,n){var r=this;void 0===n&&(n=null);var o=[],i=0;return this.doc.nodesBetween(t,e,(function(r,s){if(r.isInline){i++;var a=null;if(n instanceof HS){var c=n.isInSet(r.marks);c&&(a=[c])}else n?n.isInSet(r.marks)&&(a=[n]):a=r.marks;if(a&&a.length)for(var h=Math.min(s+r.nodeSize,e),p=0;p<a.length;p++){for(var l=a[p],u=void 0,f=0;f<o.length;f++){var d=o[f];d.step==i-1&&l.eq(o[f].style)&&(u=d)}u?(u.to=h,u.step=i):o.push({style:l,from:Math.max(s,t),to:h,step:i})}}})),o.forEach((function(t){return r.step(new BO(t.from,t.to,t.style))})),this},SO.prototype.clearIncompatible=function(t,e,n){void 0===n&&(n=e.contentMatch);for(var r=this.doc.nodeAt(t),o=[],i=t+1,s=0;s<r.childCount;s++){var a=r.child(s),c=i+a.nodeSize,h=n.matchType(a.type,a.attrs);if(h){n=h;for(var p=0;p<a.marks.length;p++)e.allowsMarkType(a.marks[p].type)||this.step(new BO(i,c,a.marks[p]))}else o.push(new EO(i,c,Yk.empty));i=c}if(!n.validEnd){var l=n.fillBefore(qk.empty,!0);this.replace(i,i,new Yk(l,0,0))}for(var u=o.length-1;u>=0;u--)this.step(o[u]);return this},SO.prototype.replace=function(t,e,n){void 0===e&&(e=t),void 0===n&&(n=Yk.empty);var r=$O(this.doc,t,e,n);return r&&this.step(r),this},SO.prototype.replaceWith=function(t,e,n){return this.replace(t,e,new Yk(qk.from(n),0,0))},SO.prototype.delete=function(t,e){return this.replace(t,e,Yk.empty)},SO.prototype.insert=function(t,e){return this.replaceWith(t,t,e)};var jO=function(t,e,n){this.$to=e,this.$from=t,this.unplaced=n,this.frontier=[];for(var r=0;r<=t.depth;r++){var o=t.node(r);this.frontier.push({type:o.type,match:o.contentMatchAt(t.indexAfter(r))})}this.placed=qk.empty;for(var i=t.depth;i>0;i--)this.placed=qk.from(t.node(i).copy(this.placed))},JO={depth:{configurable:!0}};function LO(t,e,n){return 0==e?t.cutByIndex(n):t.replaceChild(0,t.firstChild.copy(LO(t.firstChild.content,e-1,n)))}function VO(t,e,n){return 0==e?t.append(n):t.replaceChild(t.childCount-1,t.lastChild.copy(VO(t.lastChild.content,e-1,n)))}function qO(t,e){for(var n=0;n<e;n++)t=t.firstChild.content;return t}function WO(t,e,n){if(e<=0)return t;var r=t.content;return e>1&&(r=r.replaceChild(0,WO(r.firstChild,e-1,1==r.childCount?n-1:0))),e>0&&(r=t.type.contentMatch.fillBefore(r).append(r),n<=0&&(r=r.append(t.type.contentMatch.matchFragment(r).fillBefore(qk.empty,!0)))),t.copy(r)}function HO(t,e,n,r,o){var i=t.node(e),s=o?t.indexAfter(e):t.index(e);if(s==i.childCount&&!n.compatibleContent(i.type))return null;var a=r.fillBefore(i.content,!0,s);return a&&!KO(n,i.content,s)?a:null}function KO(t,e,n){for(var r=n;r<e.childCount;r++)if(!t.allowsMarks(e.child(r).marks))return!0;return!1}function UO(t,e,n,r,o){if(e<n){var i=t.firstChild;t=t.replaceChild(0,i.copy(UO(i.content,e+1,n,r,i)))}if(e>r){var s=o.contentMatchAt(0),a=s.fillBefore(t).append(t);t=a.append(s.matchFragment(a).fillBefore(qk.empty,!0))}return t}function GO(t,e){for(var n=[],r=Math.min(t.depth,e.depth),o=r;o>=0;o--){var i=t.start(o);if(i<t.pos-(t.depth-o)||e.end(o)>e.pos+(e.depth-o)||t.node(o).type.spec.isolating||e.node(o).type.spec.isolating)break;i==e.start(o)&&n.push(o)}return n}JO.depth.get=function(){return this.frontier.length-1},jO.prototype.fit=function(){while(this.unplaced.size){var t=this.findFittable();t?this.placeNodes(t):this.openMore()||this.dropNode()}var e=this.mustMoveInline(),n=this.placed.size-this.depth-this.$from.depth,r=this.$from,o=this.close(e<0?this.$to:r.doc.resolve(e));if(!o)return null;var i=this.placed,s=r.depth,a=o.depth;while(s&&a&&1==i.childCount)i=i.firstChild.content,s--,a--;var c=new Yk(i,s,a);return e>-1?new AO(r.pos,e,this.$to.pos,this.$to.end(),c,n):c.size||r.pos!=this.$to.pos?new EO(r.pos,o.pos,c):void 0},jO.prototype.findFittable=function(){for(var t=1;t<=2;t++)for(var e=this.unplaced.openStart;e>=0;e--){var n=void 0,r=void 0;e?(r=qO(this.unplaced.content,e-1).firstChild,n=r.content):n=this.unplaced.content;for(var o=n.firstChild,i=this.depth;i>=0;i--){var s=this.frontier[i],a=s.type,c=s.match,h=void 0,p=void 0;if(1==t&&(o?c.matchType(o.type)||(p=c.fillBefore(qk.from(o),!1)):a.compatibleContent(r.type)))return{sliceDepth:e,frontierDepth:i,parent:r,inject:p};if(2==t&&o&&(h=c.findWrapping(o.type)))return{sliceDepth:e,frontierDepth:i,parent:r,wrap:h};if(r&&c.matchType(r.type))break}}},jO.prototype.openMore=function(){var t=this.unplaced,e=t.content,n=t.openStart,r=t.openEnd,o=qO(e,n);return!(!o.childCount||o.firstChild.isLeaf)&&(this.unplaced=new Yk(e,n+1,Math.max(r,o.size+n>=e.size-r?n+1:0)),!0)},jO.prototype.dropNode=function(){var t=this.unplaced,e=t.content,n=t.openStart,r=t.openEnd,o=qO(e,n);if(o.childCount<=1&&n>0){var i=e.size-n<=n+o.size;this.unplaced=new Yk(LO(e,n-1,1),n-1,i?n-1:r)}else this.unplaced=new Yk(LO(e,n,1),n,r)},jO.prototype.placeNodes=function(t){var e=t.sliceDepth,n=t.frontierDepth,r=t.parent,o=t.inject,i=t.wrap;while(this.depth>n)this.closeFrontierNode();if(i)for(var s=0;s<i.length;s++)this.openFrontierNode(i[s]);var a=this.unplaced,c=r?r.content:a.content,h=a.openStart-e,p=0,l=[],u=this.frontier[n],f=u.match,d=u.type;if(o){for(var m=0;m<o.childCount;m++)l.push(o.child(m));f=f.matchFragment(o)}var v=c.size+e-(a.content.size-a.openEnd);while(p<c.childCount){var g=c.child(p),y=f.matchType(g.type);if(!y)break;p++,(p>1||0==h||g.content.size)&&(f=y,l.push(WO(g.mark(d.allowedMarks(g.marks)),1==p?h:0,p==c.childCount?v:-1)))}var w=p==c.childCount;w||(v=-1),w&&v<0&&r&&r.type==this.frontier[this.depth].type?this.closeFrontierNode():this.frontier[n].match=f;for(var x=0,b=c;x<v;x++){var k=b.lastChild;this.frontier.push({type:k.type,match:k.contentMatchAt(k.childCount)}),b=k.content}this.unplaced=w?0==e?Yk.empty:new Yk(LO(a.content,e-1,1),e-1,v<0?a.openEnd:e-1):new Yk(LO(a.content,e,p),a.openStart,a.openEnd),this.placed=VO(this.placed,n,qk.from(l))},jO.prototype.mustMoveInline=function(){if(!this.$to.parent.isTextblock||this.$to.end()==this.$to.pos)return-1;var t,e=this.frontier[this.depth];if(!e.type.isTextblock||!HO(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;var n=this.$to,r=n.depth,o=this.$to.after(r);while(r>1&&o==this.$to.end(--r))++o;return o},jO.prototype.findCloseLevel=function(t){t:for(var e=Math.min(this.depth,t.depth);e>=0;e--){var n=this.frontier[e],r=n.match,o=n.type,i=e<t.depth&&t.end(e+1)==t.pos+(t.depth-(e+1)),s=HO(t,e,o,r,i);if(s){for(var a=e-1;a>=0;a--){var c=this.frontier[a],h=c.match,p=c.type,l=HO(t,a,p,h,!0);if(!l||l.childCount)continue t}return{depth:e,fit:s,move:i?t.doc.resolve(t.after(e+1)):t}}}},jO.prototype.close=function(t){var e=this.findCloseLevel(t);if(!e)return null;while(this.depth>e.depth)this.closeFrontierNode();e.fit.childCount&&(this.placed=VO(this.placed,e.depth,e.fit)),t=e.move;for(var n=e.depth+1;n<=t.depth;n++){var r=t.node(n),o=r.type.contentMatch.fillBefore(r.content,!0,t.index(n));this.openFrontierNode(r.type,r.attrs,o)}return t},jO.prototype.openFrontierNode=function(t,e,n){var r=this.frontier[this.depth];r.match=r.match.matchType(t),this.placed=VO(this.placed,this.depth,qk.from(t.create(e,n))),this.frontier.push({type:t,match:t.contentMatch})},jO.prototype.closeFrontierNode=function(){var t=this.frontier.pop(),e=t.match.fillBefore(qk.empty,!0);e.childCount&&(this.placed=VO(this.placed,this.frontier.length,e))},Object.defineProperties(jO.prototype,JO),SO.prototype.replaceRange=function(t,e,n){if(!n.size)return this.deleteRange(t,e);var r=this.doc.resolve(t),o=this.doc.resolve(e);if(_O(r,o,n))return this.step(new EO(t,e,n));var i=GO(r,this.doc.resolve(e));0==i[i.length-1]&&i.pop();var s=-(r.depth+1);i.unshift(s);for(var a=r.depth,c=r.pos-1;a>0;a--,c--){var h=r.node(a).type.spec;if(h.defining||h.isolating)break;i.indexOf(a)>-1?s=a:r.before(a)==c&&i.splice(1,0,-a)}for(var p=i.indexOf(s),l=[],u=n.openStart,f=n.content,d=0;;d++){var m=f.firstChild;if(l.push(m),d==n.openStart)break;f=m.content}u>0&&l[u-1].type.spec.defining&&r.node(p).type!=l[u-1].type?u-=1:u>=2&&l[u-1].isTextblock&&l[u-2].type.spec.defining&&r.node(p).type!=l[u-2].type&&(u-=2);for(var v=n.openStart;v>=0;v--){var g=(v+u+1)%(n.openStart+1),y=l[g];if(y)for(var w=0;w<i.length;w++){var x=i[(w+p)%i.length],b=!0;x<0&&(b=!1,x=-x);var k=r.node(x-1),S=r.index(x-1);if(k.canReplaceWith(S,S,y.type,y.marks))return this.replace(r.before(x),b?o.after(x):e,new Yk(UO(n.content,0,n.openStart,g),g,n.openEnd))}}for(var O=this.steps.length,C=i.length-1;C>=0;C--){if(this.replace(t,e,n),this.steps.length>O)break;var M=i[C];C<0||(t=r.before(M),e=o.after(M))}return this},SO.prototype.replaceRangeWith=function(t,e,n){if(!n.isInline&&t==e&&this.doc.resolve(t).parent.content.size){var r=zO(this.doc,t,n.type);null!=r&&(t=e=r)}return this.replaceRange(t,e,new Yk(qk.from(n),0,0))},SO.prototype.deleteRange=function(t,e){for(var n=this.doc.resolve(t),r=this.doc.resolve(e),o=GO(n,r),i=0;i<o.length;i++){var s=o[i],a=i==o.length-1;if(a&&0==s||n.node(s).type.contentMatch.validEnd)return this.delete(n.start(s),r.end(s));if(s>0&&(a||n.node(s-1).canReplace(n.index(s-1),r.indexAfter(s-1))))return this.delete(n.before(s),r.after(s))}for(var c=1;c<=n.depth&&c<=r.depth;c++)if(t-n.start(c)==n.depth-c&&e>n.end(c)&&r.end(c)-e!=r.depth-c)return this.delete(n.before(c),e);return this.delete(t,e)};var XO=Object.create(null),YO=function(t,e,n){this.ranges=n||[new QO(t.min(e),t.max(e))],this.$anchor=t,this.$head=e},ZO={anchor:{configurable:!0},head:{configurable:!0},from:{configurable:!0},to:{configurable:!0},$from:{configurable:!0},$to:{configurable:!0},empty:{configurable:!0}};ZO.anchor.get=function(){return this.$anchor.pos},ZO.head.get=function(){return this.$head.pos},ZO.from.get=function(){return this.$from.pos},ZO.to.get=function(){return this.$to.pos},ZO.$from.get=function(){return this.ranges[0].$from},ZO.$to.get=function(){return this.ranges[0].$to},ZO.empty.get=function(){for(var t=this.ranges,e=0;e<t.length;e++)if(t[e].$from.pos!=t[e].$to.pos)return!1;return!0},YO.prototype.content=function(){return this.$from.node(0).slice(this.from,this.to,!0)},YO.prototype.replace=function(t,e){void 0===e&&(e=Yk.empty);for(var n=e.content.lastChild,r=null,o=0;o<e.openEnd;o++)r=n,n=n.lastChild;for(var i=t.steps.length,s=this.ranges,a=0;a<s.length;a++){var c=s[a],h=c.$from,p=c.$to,l=t.mapping.slice(i);t.replaceRange(l.map(h.pos),l.map(p.pos),a?Yk.empty:e),0==a&&aC(t,i,(n?n.isInline:r&&r.isTextblock)?-1:1)}},YO.prototype.replaceWith=function(t,e){for(var n=t.steps.length,r=this.ranges,o=0;o<r.length;o++){var i=r[o],s=i.$from,a=i.$to,c=t.mapping.slice(n),h=c.map(s.pos),p=c.map(a.pos);o?t.deleteRange(h,p):(t.replaceRangeWith(h,p,e),aC(t,n,e.isInline?-1:1))}},YO.findFrom=function(t,e,n){var r=t.parent.inlineContent?new tC(t):sC(t.node(0),t.parent,t.pos,t.index(),e,n);if(r)return r;for(var o=t.depth-1;o>=0;o--){var i=e<0?sC(t.node(0),t.node(o),t.before(o+1),t.index(o),e,n):sC(t.node(0),t.node(o),t.after(o+1),t.index(o)+1,e,n);if(i)return i}},YO.near=function(t,e){return void 0===e&&(e=1),this.findFrom(t,e)||this.findFrom(t,-e)||new oC(t.node(0))},YO.atStart=function(t){return sC(t,t,0,0,1)||new oC(t)},YO.atEnd=function(t){return sC(t,t,t.content.size,t.childCount,-1)||new oC(t)},YO.fromJSON=function(t,e){if(!e||!e.type)throw new RangeError("Invalid input for Selection.fromJSON");var n=XO[e.type];if(!n)throw new RangeError("No selection type "+e.type+" defined");return n.fromJSON(t,e)},YO.jsonID=function(t,e){if(t in XO)throw new RangeError("Duplicate use of selection JSON ID "+t);return XO[t]=e,e.prototype.jsonID=t,e},YO.prototype.getBookmark=function(){return tC.between(this.$anchor,this.$head).getBookmark()},Object.defineProperties(YO.prototype,ZO),YO.prototype.visible=!0;var QO=function(t,e){this.$from=t,this.$to=e},tC=function(t){function e(e,n){void 0===n&&(n=e),t.call(this,e,n)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={$cursor:{configurable:!0}};return n.$cursor.get=function(){return this.$anchor.pos==this.$head.pos?this.$head:null},e.prototype.map=function(n,r){var o=n.resolve(r.map(this.head));if(!o.parent.inlineContent)return t.near(o);var i=n.resolve(r.map(this.anchor));return new e(i.parent.inlineContent?i:o,o)},e.prototype.replace=function(e,n){if(void 0===n&&(n=Yk.empty),t.prototype.replace.call(this,e,n),n==Yk.empty){var r=this.$from.marksAcross(this.$to);r&&e.ensureMarks(r)}},e.prototype.eq=function(t){return t instanceof e&&t.anchor==this.anchor&&t.head==this.head},e.prototype.getBookmark=function(){return new eC(this.anchor,this.head)},e.prototype.toJSON=function(){return{type:"text",anchor:this.anchor,head:this.head}},e.fromJSON=function(t,n){if("number"!=typeof n.anchor||"number"!=typeof n.head)throw new RangeError("Invalid input for TextSelection.fromJSON");return new e(t.resolve(n.anchor),t.resolve(n.head))},e.create=function(t,e,n){void 0===n&&(n=e);var r=t.resolve(e);return new this(r,n==e?r:t.resolve(n))},e.between=function(n,r,o){var i=n.pos-r.pos;if(o&&!i||(o=i>=0?1:-1),!r.parent.inlineContent){var s=t.findFrom(r,o,!0)||t.findFrom(r,-o,!0);if(!s)return t.near(r,o);r=s.$head}return n.parent.inlineContent||(0==i?n=r:(n=(t.findFrom(n,-o,!0)||t.findFrom(n,o,!0)).$anchor,n.pos<r.pos!=i<0&&(n=r))),new e(n,r)},Object.defineProperties(e.prototype,n),e}(YO);YO.jsonID("text",tC);var eC=function(t,e){this.anchor=t,this.head=e};eC.prototype.map=function(t){return new eC(t.map(this.anchor),t.map(this.head))},eC.prototype.resolve=function(t){return tC.between(t.resolve(this.anchor),t.resolve(this.head))};var nC=function(t){function e(e){var n=e.nodeAfter,r=e.node(0).resolve(e.pos+n.nodeSize);t.call(this,e,r),this.node=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.map=function(n,r){var o=r.mapResult(this.anchor),i=o.deleted,s=o.pos,a=n.resolve(s);return i?t.near(a):new e(a)},e.prototype.content=function(){return new Yk(qk.from(this.node),0,0)},e.prototype.eq=function(t){return t instanceof e&&t.anchor==this.anchor},e.prototype.toJSON=function(){return{type:"node",anchor:this.anchor}},e.prototype.getBookmark=function(){return new rC(this.anchor)},e.fromJSON=function(t,n){if("number"!=typeof n.anchor)throw new RangeError("Invalid input for NodeSelection.fromJSON");return new e(t.resolve(n.anchor))},e.create=function(t,e){return new this(t.resolve(e))},e.isSelectable=function(t){return!t.isText&&!1!==t.type.spec.selectable},e}(YO);nC.prototype.visible=!1,YO.jsonID("node",nC);var rC=function(t){this.anchor=t};rC.prototype.map=function(t){var e=t.mapResult(this.anchor),n=e.deleted,r=e.pos;return n?new eC(r,r):new rC(r)},rC.prototype.resolve=function(t){var e=t.resolve(this.anchor),n=e.nodeAfter;return n&&nC.isSelectable(n)?new nC(e):YO.near(e)};var oC=function(t){function e(e){t.call(this,e.resolve(0),e.resolve(e.content.size))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.replace=function(e,n){if(void 0===n&&(n=Yk.empty),n==Yk.empty){e.delete(0,e.doc.content.size);var r=t.atStart(e.doc);r.eq(e.selection)||e.setSelection(r)}else t.prototype.replace.call(this,e,n)},e.prototype.toJSON=function(){return{type:"all"}},e.fromJSON=function(t){return new e(t)},e.prototype.map=function(t){return new e(t)},e.prototype.eq=function(t){return t instanceof e},e.prototype.getBookmark=function(){return iC},e}(YO);YO.jsonID("all",oC);var iC={map:function(){return this},resolve:function(t){return new oC(t)}};function sC(t,e,n,r,o,i){if(e.inlineContent)return tC.create(t,n);for(var s=r-(o>0?0:1);o>0?s<e.childCount:s>=0;s+=o){var a=e.child(s);if(a.isAtom){if(!i&&nC.isSelectable(a))return nC.create(t,n-(o<0?a.nodeSize:0))}else{var c=sC(t,a,n+o,o<0?a.childCount:0,o,i);if(c)return c}n+=a.nodeSize*o}}function aC(t,e,n){var r=t.steps.length-1;if(!(r<e)){var o=t.steps[r];if(o instanceof EO||o instanceof AO){var i,s=t.mapping.maps[r];s.forEach((function(t,e,n,r){null==i&&(i=r)})),t.setSelection(YO.near(t.doc.resolve(i),n))}}}var cC=1,hC=2,pC=4,lC=function(t){function e(e){t.call(this,e.doc),this.time=Date.now(),this.curSelection=e.selection,this.curSelectionFor=0,this.storedMarks=e.storedMarks,this.updated=0,this.meta=Object.create(null)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={selection:{configurable:!0},selectionSet:{configurable:!0},storedMarksSet:{configurable:!0},isGeneric:{configurable:!0},scrolledIntoView:{configurable:!0}};return n.selection.get=function(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection},e.prototype.setSelection=function(t){if(t.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=t,this.curSelectionFor=this.steps.length,this.updated=(this.updated|cC)&~hC,this.storedMarks=null,this},n.selectionSet.get=function(){return(this.updated&cC)>0},e.prototype.setStoredMarks=function(t){return this.storedMarks=t,this.updated|=hC,this},e.prototype.ensureMarks=function(t){return Gk.sameSet(this.storedMarks||this.selection.$from.marks(),t)||this.setStoredMarks(t),this},e.prototype.addStoredMark=function(t){return this.ensureMarks(t.addToSet(this.storedMarks||this.selection.$head.marks()))},e.prototype.removeStoredMark=function(t){return this.ensureMarks(t.removeFromSet(this.storedMarks||this.selection.$head.marks()))},n.storedMarksSet.get=function(){return(this.updated&hC)>0},e.prototype.addStep=function(e,n){t.prototype.addStep.call(this,e,n),this.updated=this.updated&~hC,this.storedMarks=null},e.prototype.setTime=function(t){return this.time=t,this},e.prototype.replaceSelection=function(t){return this.selection.replace(this,t),this},e.prototype.replaceSelectionWith=function(t,e){var n=this.selection;return!1!==e&&(t=t.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||Gk.none))),n.replaceWith(this,t),this},e.prototype.deleteSelection=function(){return this.selection.replace(this),this},e.prototype.insertText=function(t,e,n){void 0===n&&(n=e);var r=this.doc.type.schema;if(null==e)return t?this.replaceSelectionWith(r.text(t),!0):this.deleteSelection();if(!t)return this.deleteRange(e,n);var o=this.storedMarks;if(!o){var i=this.doc.resolve(e);o=n==e?i.marks():i.marksAcross(this.doc.resolve(n))}return this.replaceRangeWith(e,n,r.text(t,o)),this.selection.empty||this.setSelection(YO.near(this.selection.$to)),this},e.prototype.setMeta=function(t,e){return this.meta["string"==typeof t?t:t.key]=e,this},e.prototype.getMeta=function(t){return this.meta["string"==typeof t?t:t.key]},n.isGeneric.get=function(){for(var t in this.meta)return!1;return!0},e.prototype.scrollIntoView=function(){return this.updated|=pC,this},n.scrolledIntoView.get=function(){return(this.updated&pC)>0},Object.defineProperties(e.prototype,n),e}(SO);function uC(t,e){return e&&t?t.bind(e):t}var fC=function(t,e,n){this.name=t,this.init=uC(e.init,n),this.apply=uC(e.apply,n)},dC=[new fC("doc",{init:function(t){return t.doc||t.schema.topNodeType.createAndFill()},apply:function(t){return t.doc}}),new fC("selection",{init:function(t,e){return t.selection||YO.atStart(e.doc)},apply:function(t){return t.selection}}),new fC("storedMarks",{init:function(t){return t.storedMarks||null},apply:function(t,e,n,r){return r.selection.$cursor?t.storedMarks:null}}),new fC("scrollToSelection",{init:function(){return 0},apply:function(t,e){return t.scrolledIntoView?e+1:e}})],mC=function(t,e){var n=this;this.schema=t,this.fields=dC.concat(),this.plugins=[],this.pluginsByKey=Object.create(null),e&&e.forEach((function(t){if(n.pluginsByKey[t.key])throw new RangeError("Adding different instances of a keyed plugin ("+t.key+")");n.plugins.push(t),n.pluginsByKey[t.key]=t,t.spec.state&&n.fields.push(new fC(t.key,t.spec.state,t))}))},vC=function(t){this.config=t},gC={schema:{configurable:!0},plugins:{configurable:!0},tr:{configurable:!0}};gC.schema.get=function(){return this.config.schema},gC.plugins.get=function(){return this.config.plugins},vC.prototype.apply=function(t){return this.applyTransaction(t).state},vC.prototype.filterTransaction=function(t,e){void 0===e&&(e=-1);for(var n=0;n<this.config.plugins.length;n++)if(n!=e){var r=this.config.plugins[n];if(r.spec.filterTransaction&&!r.spec.filterTransaction.call(r,t,this))return!1}return!0},vC.prototype.applyTransaction=function(t){if(!this.filterTransaction(t))return{state:this,transactions:[]};for(var e=[t],n=this.applyInner(t),r=null;;){for(var o=!1,i=0;i<this.config.plugins.length;i++){var s=this.config.plugins[i];if(s.spec.appendTransaction){var a=r?r[i].n:0,c=r?r[i].state:this,h=a<e.length&&s.spec.appendTransaction.call(s,a?e.slice(a):e,c,n);if(h&&n.filterTransaction(h,i)){if(h.setMeta("appendedTransaction",t),!r){r=[];for(var p=0;p<this.config.plugins.length;p++)r.push(p<i?{state:n,n:e.length}:{state:this,n:0})}e.push(h),n=n.applyInner(h),o=!0}r&&(r[i]={state:n,n:e.length})}}if(!o)return{state:n,transactions:e}}},vC.prototype.applyInner=function(t){if(!t.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");for(var e=new vC(this.config),n=this.config.fields,r=0;r<n.length;r++){var o=n[r];e[o.name]=o.apply(t,this[o.name],this,e)}for(var i=0;i<yC.length;i++)yC[i](this,t,e);return e},gC.tr.get=function(){return new lC(this)},vC.create=function(t){for(var e=new mC(t.schema||t.doc.type.schema,t.plugins),n=new vC(e),r=0;r<e.fields.length;r++)n[e.fields[r].name]=e.fields[r].init(t,n);return n},vC.prototype.reconfigure=function(t){for(var e=new mC(t.schema||this.schema,t.plugins),n=e.fields,r=new vC(e),o=0;o<n.length;o++){var i=n[o].name;r[i]=this.hasOwnProperty(i)?this[i]:n[o].init(t,r)}return r},vC.prototype.toJSON=function(t){var e={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(e.storedMarks=this.storedMarks.map((function(t){return t.toJSON()}))),t&&"object"==typeof t)for(var n in t){if("doc"==n||"selection"==n)throw new RangeError("The JSON fields `doc` and `selection` are reserved");var r=t[n],o=r.spec.state;o&&o.toJSON&&(e[n]=o.toJSON.call(r,this[r.key]))}return e},vC.fromJSON=function(t,e,n){if(!e)throw new RangeError("Invalid input for EditorState.fromJSON");if(!t.schema)throw new RangeError("Required config field 'schema' missing");var r=new mC(t.schema,t.plugins),o=new vC(r);return r.fields.forEach((function(r){if("doc"==r.name)o.doc=wS.fromJSON(t.schema,e.doc);else if("selection"==r.name)o.selection=YO.fromJSON(o.doc,e.selection);else if("storedMarks"==r.name)e.storedMarks&&(o.storedMarks=e.storedMarks.map(t.schema.markFromJSON));else{if(n)for(var i in n){var s=n[i],a=s.spec.state;if(s.key==r.name&&a&&a.fromJSON&&Object.prototype.hasOwnProperty.call(e,i))return void(o[r.name]=a.fromJSON.call(s,t,e[i],o))}o[r.name]=r.init(t,o)}})),o},vC.addApplyListener=function(t){yC.push(t)},vC.removeApplyListener=function(t){var e=yC.indexOf(t);e>-1&&yC.splice(e,1)},Object.defineProperties(vC.prototype,gC);var yC=[];function wC(t,e,n){for(var r in t){var o=t[r];o instanceof Function?o=o.bind(e):"handleDOMEvents"==r&&(o=wC(o,e,{})),n[r]=o}return n}var xC=function(t){this.props={},t.props&&wC(t.props,this,this.props),this.spec=t,this.key=t.key?t.key.key:kC("plugin")};xC.prototype.getState=function(t){return t[this.key]};var bC=Object.create(null);function kC(t){return t in bC?t+"$"+ ++bC[t]:(bC[t]=0,t+"$")}var SC=function(t){void 0===t&&(t="key"),this.key=kC(t)};SC.prototype.get=function(t){return t.config.pluginsByKey[this.key]},SC.prototype.getState=function(t){return t[this.key]};var OC={};if("undefined"!=typeof navigator&&"undefined"!=typeof document){var CC=/Edge\/(\d+)/.exec(navigator.userAgent),MC=/MSIE \d/.test(navigator.userAgent),NC=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);OC.mac=/Mac/.test(navigator.platform);var TC=OC.ie=!!(MC||NC||CC);OC.ie_version=MC?document.documentMode||6:NC?+NC[1]:CC?+CC[1]:null,OC.gecko=!TC&&/gecko\/(\d+)/i.test(navigator.userAgent),OC.gecko_version=OC.gecko&&+(/Firefox\/(\d+)/.exec(navigator.userAgent)||[0,0])[1];var EC=!TC&&/Chrome\/(\d+)/.exec(navigator.userAgent);OC.chrome=!!EC,OC.chrome_version=EC&&+EC[1],OC.safari=!TC&&/Apple Computer/.test(navigator.vendor),OC.ios=OC.safari&&(/Mobile\/\w+/.test(navigator.userAgent)||navigator.maxTouchPoints>2),OC.android=/Android \d/.test(navigator.userAgent),OC.webkit="webkitFontSmoothing"in document.documentElement.style,OC.webkit_version=OC.webkit&&+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]}var AC=function(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e},DC=function(t){var e=t.assignedSlot||t.parentNode;return e&&11==e.nodeType?e.host:e},RC=null,zC=function(t,e,n){var r=RC||(RC=document.createRange());return r.setEnd(t,null==n?t.nodeValue.length:n),r.setStart(t,e||0),r},IC=function(t,e,n,r){return n&&(FC(t,e,n,r,-1)||FC(t,e,n,r,1))},PC=/^(img|br|input|textarea|hr)$/i;function FC(t,e,n,r,o){for(;;){if(t==n&&e==r)return!0;if(e==(o<0?0:BC(t))){var i=t.parentNode;if(1!=i.nodeType||_C(t)||PC.test(t.nodeName)||"false"==t.contentEditable)return!1;e=AC(t)+(o<0?0:1),t=i}else{if(1!=t.nodeType)return!1;if(t=t.childNodes[e+(o<0?-1:0)],"false"==t.contentEditable)return!1;e=o<0?BC(t):0}}}function BC(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}function $C(t,e,n){for(var r=0==e,o=e==BC(t);r||o;){if(t==n)return!0;var i=AC(t);if(t=t.parentNode,!t)return!1;r=r&&0==i,o=o&&i==BC(t)}}function _C(t){for(var e,n=t;n;n=n.parentNode)if(e=n.pmViewDesc)break;return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}var jC=function(t){var e=t.isCollapsed;return e&&OC.chrome&&t.rangeCount&&!t.getRangeAt(0).collapsed&&(e=!1),e};function JC(t,e){var n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=t,n.key=n.code=e,n}function LC(t){return{left:0,right:t.documentElement.clientWidth,top:0,bottom:t.documentElement.clientHeight}}function VC(t,e){return"number"==typeof t?t:t[e]}function qC(t){var e=t.getBoundingClientRect(),n=e.width/t.offsetWidth||1,r=e.height/t.offsetHeight||1;return{left:e.left,right:e.left+t.clientWidth*n,top:e.top,bottom:e.top+t.clientHeight*r}}function WC(t,e,n){for(var r=t.someProp("scrollThreshold")||0,o=t.someProp("scrollMargin")||5,i=t.dom.ownerDocument,s=n||t.dom;;s=DC(s)){if(!s)break;if(1==s.nodeType){var a=s==i.body||1!=s.nodeType,c=a?LC(i):qC(s),h=0,p=0;if(e.top<c.top+VC(r,"top")?p=-(c.top-e.top+VC(o,"top")):e.bottom>c.bottom-VC(r,"bottom")&&(p=e.bottom-c.bottom+VC(o,"bottom")),e.left<c.left+VC(r,"left")?h=-(c.left-e.left+VC(o,"left")):e.right>c.right-VC(r,"right")&&(h=e.right-c.right+VC(o,"right")),h||p)if(a)i.defaultView.scrollBy(h,p);else{var l=s.scrollLeft,u=s.scrollTop;p&&(s.scrollTop+=p),h&&(s.scrollLeft+=h);var f=s.scrollLeft-l,d=s.scrollTop-u;e={left:e.left-f,top:e.top-d,right:e.right-f,bottom:e.bottom-d}}if(a)break}}}function HC(t){for(var e,n,r=t.dom.getBoundingClientRect(),o=Math.max(0,r.top),i=(r.left+r.right)/2,s=o+1;s<Math.min(innerHeight,r.bottom);s+=5){var a=t.root.elementFromPoint(i,s);if(a!=t.dom&&t.dom.contains(a)){var c=a.getBoundingClientRect();if(c.top>=o-20){e=a,n=c.top;break}}}return{refDOM:e,refTop:n,stack:KC(t.dom)}}function KC(t){for(var e=[],n=t.ownerDocument;t;t=DC(t))if(e.push({dom:t,top:t.scrollTop,left:t.scrollLeft}),t==n)break;return e}function UC(t){var e=t.refDOM,n=t.refTop,r=t.stack,o=e?e.getBoundingClientRect().top:0;GC(r,0==o?0:o-n)}function GC(t,e){for(var n=0;n<t.length;n++){var r=t[n],o=r.dom,i=r.top,s=r.left;o.scrollTop!=i+e&&(o.scrollTop=i+e),o.scrollLeft!=s&&(o.scrollLeft=s)}}var XC=null;function YC(t){if(t.setActive)return t.setActive();if(XC)return t.focus(XC);var e=KC(t);t.focus(null==XC?{get preventScroll(){return XC={preventScroll:!0},!0}}:void 0),XC||(XC=!1,GC(e,0))}function ZC(t,e){for(var n,r,o=2e8,i=0,s=e.top,a=e.top,c=t.firstChild,h=0;c;c=c.nextSibling,h++){var p=void 0;if(1==c.nodeType)p=c.getClientRects();else{if(3!=c.nodeType)continue;p=zC(c).getClientRects()}for(var l=0;l<p.length;l++){var u=p[l];if(u.top<=s&&u.bottom>=a){s=Math.max(u.bottom,s),a=Math.min(u.top,a);var f=u.left>e.left?u.left-e.left:u.right<e.left?e.left-u.right:0;if(f<o){n=c,o=f,r=f&&3==n.nodeType?{left:u.right<e.left?u.right:u.left,top:e.top}:e,1==c.nodeType&&f&&(i=h+(e.left>=(u.left+u.right)/2?1:0));continue}}!n&&(e.left>=u.right&&e.top>=u.top||e.left>=u.left&&e.top>=u.bottom)&&(i=h+1)}}return n&&3==n.nodeType?QC(n,r):!n||o&&1==n.nodeType?{node:t,offset:i}:ZC(n,r)}function QC(t,e){for(var n=t.nodeValue.length,r=document.createRange(),o=0;o<n;o++){r.setEnd(t,o+1),r.setStart(t,o);var i=sM(r,1);if(i.top!=i.bottom&&tM(e,i))return{node:t,offset:o+(e.left>=(i.left+i.right)/2?1:0)}}return{node:t,offset:0}}function tM(t,e){return t.left>=e.left-1&&t.left<=e.right+1&&t.top>=e.top-1&&t.top<=e.bottom+1}function eM(t,e){var n=t.parentNode;return n&&/^li$/i.test(n.nodeName)&&e.left<t.getBoundingClientRect().left?n:t}function nM(t,e,n){var r=ZC(e,n),o=r.node,i=r.offset,s=-1;if(1==o.nodeType&&!o.firstChild){var a=o.getBoundingClientRect();s=a.left!=a.right&&n.left>(a.left+a.right)/2?1:-1}return t.docView.posFromDOM(o,i,s)}function rM(t,e,n,r){for(var o=-1,i=e;;){if(i==t.dom)break;var s=t.docView.nearestDesc(i,!0);if(!s)return null;if(s.node.isBlock&&s.parent){var a=s.dom.getBoundingClientRect();if(a.left>r.left||a.top>r.top)o=s.posBefore;else{if(!(a.right<r.left||a.bottom<r.top))break;o=s.posAfter}}i=s.dom.parentNode}return o>-1?o:t.docView.posFromDOM(e,n)}function oM(t,e,n){var r=t.childNodes.length;if(r&&n.top<n.bottom)for(var o=Math.max(0,Math.min(r-1,Math.floor(r*(e.top-n.top)/(n.bottom-n.top))-2)),i=o;;){var s=t.childNodes[i];if(1==s.nodeType)for(var a=s.getClientRects(),c=0;c<a.length;c++){var h=a[c];if(tM(e,h))return oM(s,e,h)}if((i=(i+1)%r)==o)break}return t}function iM(t,e){var n,r,o,i,s=t.root;if(s.caretPositionFromPoint)try{var a=s.caretPositionFromPoint(e.left,e.top);a&&(n=a,o=n.offsetNode,i=n.offset)}catch(v){}if(!o&&s.caretRangeFromPoint){var c=s.caretRangeFromPoint(e.left,e.top);c&&(r=c,o=r.startContainer,i=r.startOffset)}var h,p=s.elementFromPoint(e.left,e.top+1);if(!p||!t.dom.contains(1!=p.nodeType?p.parentNode:p)){var l=t.dom.getBoundingClientRect();if(!tM(e,l))return null;if(p=oM(t.dom,e,l),!p)return null}if(OC.safari)for(var u=p;o&&u;u=DC(u))u.draggable&&(o=i=null);if(p=eM(p,e),o){if(OC.gecko&&1==o.nodeType&&(i=Math.min(i,o.childNodes.length),i<o.childNodes.length)){var f,d=o.childNodes[i];"IMG"==d.nodeName&&(f=d.getBoundingClientRect()).right<=e.left&&f.bottom>e.top&&i++}o==t.dom&&i==o.childNodes.length-1&&1==o.lastChild.nodeType&&e.top>o.lastChild.getBoundingClientRect().bottom?h=t.state.doc.content.size:0!=i&&1==o.nodeType&&"BR"==o.childNodes[i-1].nodeName||(h=rM(t,o,i,e))}null==h&&(h=nM(t,p,e));var m=t.docView.nearestDesc(p,!0);return{pos:h,inside:m?m.posAtStart-m.border:-1}}function sM(t,e){var n=t.getClientRects();return n.length?n[e<0?0:n.length-1]:t.getBoundingClientRect()}var aM=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function cM(t,e,n){var r=t.docView.domFromPos(e,n<0?-1:1),o=r.node,i=r.offset,s=OC.webkit||OC.gecko;if(3==o.nodeType){if(!s||!aM.test(o.nodeValue)&&(n<0?i:i!=o.nodeValue.length)){var a=i,c=i,h=n<0?1:-1;return n<0&&!i?(c++,h=-1):n>=0&&i==o.nodeValue.length?(a--,h=1):n<0?a--:c++,hM(sM(zC(o,a,c),h),h<0)}var p=sM(zC(o,i,i),n);if(OC.gecko&&i&&/\s/.test(o.nodeValue[i-1])&&i<o.nodeValue.length){var l=sM(zC(o,i-1,i-1),-1);if(l.top==p.top){var u=sM(zC(o,i,i+1),-1);if(u.top!=p.top)return hM(u,u.left<l.left)}}return p}if(!t.state.doc.resolve(e).parent.inlineContent){if(i&&(n<0||i==BC(o))){var f=o.childNodes[i-1];if(1==f.nodeType)return pM(f.getBoundingClientRect(),!1)}if(i<BC(o)){var d=o.childNodes[i];if(1==d.nodeType)return pM(d.getBoundingClientRect(),!0)}return pM(o.getBoundingClientRect(),n>=0)}if(i&&(n<0||i==BC(o))){var m=o.childNodes[i-1],v=3==m.nodeType?zC(m,BC(m)-(s?0:1)):1!=m.nodeType||"BR"==m.nodeName&&m.nextSibling?null:m;if(v)return hM(sM(v,1),!1)}if(i<BC(o)){var g=o.childNodes[i],y=3==g.nodeType?zC(g,0,s?0:1):1==g.nodeType?g:null;if(y)return hM(sM(y,-1),!0)}return hM(sM(3==o.nodeType?zC(o):o,-n),n>=0)}function hM(t,e){if(0==t.width)return t;var n=e?t.left:t.right;return{top:t.top,bottom:t.bottom,left:n,right:n}}function pM(t,e){if(0==t.height)return t;var n=e?t.top:t.bottom;return{top:n,bottom:n,left:t.left,right:t.right}}function lM(t,e,n){var r=t.state,o=t.root.activeElement;r!=e&&t.updateState(e),o!=t.dom&&t.focus();try{return n()}finally{r!=e&&t.updateState(r),o!=t.dom&&o&&o.focus()}}function uM(t,e,n){var r=e.selection,o="up"==n?r.$from:r.$to;return lM(t,e,(function(){for(var e=t.docView.domFromPos(o.pos,"up"==n?-1:1),r=e.node;;){var i=t.docView.nearestDesc(r,!0);if(!i)break;if(i.node.isBlock){r=i.dom;break}r=i.dom.parentNode}for(var s=cM(t,o.pos,1),a=r.firstChild;a;a=a.nextSibling){var c=void 0;if(1==a.nodeType)c=a.getClientRects();else{if(3!=a.nodeType)continue;c=zC(a,0,a.nodeValue.length).getClientRects()}for(var h=0;h<c.length;h++){var p=c[h];if(p.bottom>p.top&&("up"==n?p.bottom<s.top+1:p.top>s.bottom-1))return!1}}return!0}))}var fM=/[\u0590-\u08ac]/;function dM(t,e,n){var r=e.selection,o=r.$head;if(!o.parent.isTextblock)return!1;var i=o.parentOffset,s=!i,a=i==o.parent.content.size,c=getSelection();return fM.test(o.parent.textContent)&&c.modify?lM(t,e,(function(){var e=c.getRangeAt(0),r=c.focusNode,i=c.focusOffset,s=c.caretBidiLevel;c.modify("move",n,"character");var a=o.depth?t.docView.domAfterPos(o.before()):t.dom,h=!a.contains(1==c.focusNode.nodeType?c.focusNode:c.focusNode.parentNode)||r==c.focusNode&&i==c.focusOffset;return c.removeAllRanges(),c.addRange(e),null!=s&&(c.caretBidiLevel=s),h})):"left"==n||"backward"==n?s:a}var mM=null,vM=null,gM=!1;function yM(t,e,n){return mM==e&&vM==n?gM:(mM=e,vM=n,gM="up"==n||"down"==n?uM(t,e,n):dM(t,e,n))}var wM=0,xM=1,bM=2,kM=3,SM=function(t,e,n,r){this.parent=t,this.children=e,this.dom=n,n.pmViewDesc=this,this.contentDOM=r,this.dirty=wM},OM={beforePosition:{configurable:!0},size:{configurable:!0},border:{configurable:!0},posBefore:{configurable:!0},posAtStart:{configurable:!0},posAfter:{configurable:!0},posAtEnd:{configurable:!0},contentLost:{configurable:!0},domAtom:{configurable:!0}};SM.prototype.matchesWidget=function(){return!1},SM.prototype.matchesMark=function(){return!1},SM.prototype.matchesNode=function(){return!1},SM.prototype.matchesHack=function(){return!1},OM.beforePosition.get=function(){return!1},SM.prototype.parseRule=function(){return null},SM.prototype.stopEvent=function(){return!1},OM.size.get=function(){for(var t=0,e=0;e<this.children.length;e++)t+=this.children[e].size;return t},OM.border.get=function(){return 0},SM.prototype.destroy=function(){this.parent=null,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=null);for(var t=0;t<this.children.length;t++)this.children[t].destroy()},SM.prototype.posBeforeChild=function(t){for(var e=0,n=this.posAtStart;e<this.children.length;e++){var r=this.children[e];if(r==t)return n;n+=r.size}},OM.posBefore.get=function(){return this.parent.posBeforeChild(this)},OM.posAtStart.get=function(){return this.parent?this.parent.posBeforeChild(this)+this.border:0},OM.posAfter.get=function(){return this.posBefore+this.size},OM.posAtEnd.get=function(){return this.posAtStart+this.size-2*this.border},SM.prototype.localPosFromDOM=function(t,e,n){if(this.contentDOM&&this.contentDOM.contains(1==t.nodeType?t:t.parentNode)){if(n<0){var r,o;if(t==this.contentDOM)r=t.childNodes[e-1];else{while(t.parentNode!=this.contentDOM)t=t.parentNode;r=t.previousSibling}while(r&&(!(o=r.pmViewDesc)||o.parent!=this))r=r.previousSibling;return r?this.posBeforeChild(o)+o.size:this.posAtStart}var i,s;if(t==this.contentDOM)i=t.childNodes[e];else{while(t.parentNode!=this.contentDOM)t=t.parentNode;i=t.nextSibling}while(i&&(!(s=i.pmViewDesc)||s.parent!=this))i=i.nextSibling;return i?this.posBeforeChild(s):this.posAtEnd}var a;if(t==this.dom&&this.contentDOM)a=e>AC(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))a=2&t.compareDocumentPosition(this.contentDOM);else if(this.dom.firstChild){if(0==e)for(var c=t;;c=c.parentNode){if(c==this.dom){a=!1;break}if(c.parentNode.firstChild!=c)break}if(null==a&&e==t.childNodes.length)for(var h=t;;h=h.parentNode){if(h==this.dom){a=!0;break}if(h.parentNode.lastChild!=h)break}}return(null==a?n>0:a)?this.posAtEnd:this.posAtStart},SM.prototype.nearestDesc=function(t,e){for(var n=!0,r=t;r;r=r.parentNode){var o=this.getDesc(r);if(o&&(!e||o.node)){if(!n||!o.nodeDOM||(1==o.nodeDOM.nodeType?o.nodeDOM.contains(1==t.nodeType?t:t.parentNode):o.nodeDOM==t))return o;n=!1}}},SM.prototype.getDesc=function(t){for(var e=t.pmViewDesc,n=e;n;n=n.parent)if(n==this)return e},SM.prototype.posFromDOM=function(t,e,n){for(var r=t;r;r=r.parentNode){var o=this.getDesc(r);if(o)return o.localPosFromDOM(t,e,n)}return-1},SM.prototype.descAt=function(t){for(var e=0,n=0;e<this.children.length;e++){var r=this.children[e],o=n+r.size;if(n==t&&o!=n){while(!r.border&&r.children.length)r=r.children[0];return r}if(t<o)return r.descAt(t-n-r.border);n=o}},SM.prototype.domFromPos=function(t,e){if(!this.contentDOM)return{node:this.dom,offset:0};for(var n=0,r=0,o=!0;;r++,o=!1){while(r<this.children.length&&(this.children[r].beforePosition||this.children[r].dom.parentNode!=this.contentDOM))n+=this.children[r++].size;var i=r==this.children.length?null:this.children[r];if(n==t&&(0==e||!i||!i.size||i.border||e<0&&o)||i&&i.domAtom&&t<n+i.size)return{node:this.contentDOM,offset:i?AC(i.dom):this.contentDOM.childNodes.length};if(!i)throw new Error("Invalid position "+t);var s=n+i.size;if(!i.domAtom&&(e<0&&!i.border?s>=t:s>t)&&(s>t||r+1>=this.children.length||!this.children[r+1].beforePosition))return i.domFromPos(t-n-i.border,e);n=s}},SM.prototype.parseRange=function(t,e,n){if(void 0===n&&(n=0),0==this.children.length)return{node:this.contentDOM,from:t,to:e,fromOffset:0,toOffset:this.contentDOM.childNodes.length};for(var r=-1,o=-1,i=n,s=0;;s++){var a=this.children[s],c=i+a.size;if(-1==r&&t<=c){var h=i+a.border;if(t>=h&&e<=c-a.border&&a.node&&a.contentDOM&&this.contentDOM.contains(a.contentDOM))return a.parseRange(t,e,h);t=i;for(var p=s;p>0;p--){var l=this.children[p-1];if(l.size&&l.dom.parentNode==this.contentDOM&&!l.emptyChildAt(1)){r=AC(l.dom)+1;break}t-=l.size}-1==r&&(r=0)}if(r>-1&&(c>e||s==this.children.length-1)){e=c;for(var u=s+1;u<this.children.length;u++){var f=this.children[u];if(f.size&&f.dom.parentNode==this.contentDOM&&!f.emptyChildAt(-1)){o=AC(f.dom);break}e+=f.size}-1==o&&(o=this.contentDOM.childNodes.length);break}i=c}return{node:this.contentDOM,from:t,to:e,fromOffset:r,toOffset:o}},SM.prototype.emptyChildAt=function(t){if(this.border||!this.contentDOM||!this.children.length)return!1;var e=this.children[t<0?0:this.children.length-1];return 0==e.size||e.emptyChildAt(t)},SM.prototype.domAfterPos=function(t){var e=this.domFromPos(t,0),n=e.node,r=e.offset;if(1!=n.nodeType||r==n.childNodes.length)throw new RangeError("No node after pos "+t);return n.childNodes[r]},SM.prototype.setSelection=function(t,e,n,r){for(var o=Math.min(t,e),i=Math.max(t,e),s=0,a=0;s<this.children.length;s++){var c=this.children[s],h=a+c.size;if(o>a&&i<h)return c.setSelection(t-a-c.border,e-a-c.border,n,r);a=h}var p=this.domFromPos(t,t?-1:1),l=e==t?p:this.domFromPos(e,e?-1:1),u=n.getSelection(),f=!1;if((OC.gecko||OC.safari)&&t==e){var d=p.node,m=p.offset;if(3==d.nodeType)f=m&&"\n"==d.nodeValue[m-1],f&&m==d.nodeValue.length&&d.nextSibling&&"BR"==d.nextSibling.nodeName&&(p=l={node:d.parentNode,offset:AC(d)+1});else{var v=d.childNodes[m-1];f=v&&("BR"==v.nodeName||"false"==v.contentEditable)}}if(OC.gecko&&u.focusNode&&u.focusNode!=l.node&&1==u.focusNode.nodeType){var g=u.focusNode.childNodes[u.focusOffset];g&&"false"==g.contentEditable&&(r=!0)}if(r||f&&OC.safari||!IC(p.node,p.offset,u.anchorNode,u.anchorOffset)||!IC(l.node,l.offset,u.focusNode,u.focusOffset)){var y=!1;if((u.extend||t==e)&&!f){u.collapse(p.node,p.offset);try{t!=e&&u.extend(l.node,l.offset),y=!0}catch(b){if(!(b instanceof DOMException))throw b}}if(!y){if(t>e){var w=p;p=l,l=w}var x=document.createRange();x.setEnd(l.node,l.offset),x.setStart(p.node,p.offset),u.removeAllRanges(),u.addRange(x)}}},SM.prototype.ignoreMutation=function(t){return!this.contentDOM&&"selection"!=t.type},OM.contentLost.get=function(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)},SM.prototype.markDirty=function(t,e){for(var n=0,r=0;r<this.children.length;r++){var o=this.children[r],i=n+o.size;if(n==i?t<=i&&e>=n:t<i&&e>n){var s=n+o.border,a=i-o.border;if(t>=s&&e<=a)return this.dirty=t==n||e==i?bM:xM,void(t!=s||e!=a||!o.contentLost&&o.dom.parentNode==this.contentDOM?o.markDirty(t-s,e-s):o.dirty=kM);o.dirty=kM}n=i}this.dirty=bM},SM.prototype.markParentsDirty=function(){for(var t=1,e=this.parent;e;e=e.parent,t++){var n=1==t?bM:xM;e.dirty<n&&(e.dirty=n)}},OM.domAtom.get=function(){return!1},Object.defineProperties(SM.prototype,OM);var CM=[],MM=function(t){function e(e,n,r,o){var i,s=n.type.toDOM;if("function"==typeof s&&(s=s(r,(function(){return i?i.parent?i.parent.posBeforeChild(i):void 0:o}))),!n.type.spec.raw){if(1!=s.nodeType){var a=document.createElement("span");a.appendChild(s),s=a}s.contentEditable=!1,s.classList.add("ProseMirror-widget")}t.call(this,e,CM,s,null),this.widget=n,i=this}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={beforePosition:{configurable:!0},domAtom:{configurable:!0}};return n.beforePosition.get=function(){return this.widget.type.side<0},e.prototype.matchesWidget=function(t){return this.dirty==wM&&t.type.eq(this.widget.type)},e.prototype.parseRule=function(){return{ignore:!0}},e.prototype.stopEvent=function(t){var e=this.widget.spec.stopEvent;return!!e&&e(t)},e.prototype.ignoreMutation=function(t){return"selection"!=t.type||this.widget.spec.ignoreSelection},n.domAtom.get=function(){return!0},Object.defineProperties(e.prototype,n),e}(SM),NM=function(t){function e(e,n,r,o){t.call(this,e,CM,n,null),this.textDOM=r,this.text=o}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={size:{configurable:!0}};return n.size.get=function(){return this.text.length},e.prototype.localPosFromDOM=function(t,e){return t!=this.textDOM?this.posAtStart+(e?this.size:0):this.posAtStart+e},e.prototype.domFromPos=function(t){return{node:this.textDOM,offset:t}},e.prototype.ignoreMutation=function(t){return"characterData"===t.type&&t.target.nodeValue==t.oldValue},Object.defineProperties(e.prototype,n),e}(SM),TM=function(t){function e(e,n,r,o){t.call(this,e,[],r,o),this.mark=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.create=function(t,n,r,o){var i=o.nodeViews[n.type.name],s=i&&i(n,o,r);return s&&s.dom||(s=lO.renderSpec(document,n.type.spec.toDOM(n,r))),new e(t,n,s.dom,s.contentDOM||s.dom)},e.prototype.parseRule=function(){return{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}},e.prototype.matchesMark=function(t){return this.dirty!=kM&&this.mark.eq(t)},e.prototype.markDirty=function(e,n){if(t.prototype.markDirty.call(this,e,n),this.dirty!=wM){var r=this.parent;while(!r.node)r=r.parent;r.dirty<this.dirty&&(r.dirty=this.dirty),this.dirty=wM}},e.prototype.slice=function(t,n,r){var o=e.create(this.parent,this.mark,!0,r),i=this.children,s=this.size;n<s&&(i=XM(i,n,s,r)),t>0&&(i=XM(i,0,t,r));for(var a=0;a<i.length;a++)i[a].parent=o;return o.children=i,o},e}(SM),EM=function(t){function e(e,n,r,o,i,s,a,c,h){t.call(this,e,n.isLeaf?CM:[],i,s),this.nodeDOM=a,this.node=n,this.outerDeco=r,this.innerDeco=o,s&&this.updateChildren(c,h)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={size:{configurable:!0},border:{configurable:!0},domAtom:{configurable:!0}};return e.create=function(t,n,r,o,i,s){var a,c,h=i.nodeViews[n.type.name],p=h&&h(n,i,(function(){return c?c.parent?c.parent.posBeforeChild(c):void 0:s}),r,o),l=p&&p.dom,u=p&&p.contentDOM;if(n.isText)if(l){if(3!=l.nodeType)throw new RangeError("Text must be rendered as a DOM text node")}else l=document.createTextNode(n.text);else l||(a=lO.renderSpec(document,n.type.spec.toDOM(n)),l=a.dom,u=a.contentDOM);u||n.isText||"BR"==l.nodeName||(l.hasAttribute("contenteditable")||(l.contentEditable=!1),n.type.spec.draggable&&(l.draggable=!0));var f=l;return l=jM(l,r,n),p?c=new zM(t,n,r,o,l,u,f,p,i,s+1):n.isText?new DM(t,n,r,o,l,f,i):new e(t,n,r,o,l,u,f,i,s+1)},e.prototype.parseRule=function(){var t=this;if(this.node.type.spec.reparseInView)return null;var e={node:this.node.type.name,attrs:this.node.attrs};return this.node.type.spec.code&&(e.preserveWhitespace="full"),this.contentDOM&&!this.contentLost?e.contentElement=this.contentDOM:e.getContent=function(){return t.contentDOM?qk.empty:t.node.content},e},e.prototype.matchesNode=function(t,e,n){return this.dirty==wM&&t.eq(this.node)&&JM(e,this.outerDeco)&&n.eq(this.innerDeco)},n.size.get=function(){return this.node.nodeSize},n.border.get=function(){return this.node.isLeaf?0:1},e.prototype.updateChildren=function(t,e){var n=this,r=this.node.inlineContent,o=e,i=r&&t.composing&&this.localCompositionNode(t,e),s=new VM(this,i&&i.node);HM(this.node,this.innerDeco,(function(e,i,a){e.spec.marks?s.syncToMarks(e.spec.marks,r,t):e.type.side>=0&&!a&&s.syncToMarks(i==n.node.childCount?Gk.none:n.node.child(i).marks,r,t),s.placeWidget(e,t,o)}),(function(e,n,i,a){s.syncToMarks(e.marks,r,t),s.findNodeMatch(e,n,i,a)||s.updateNextNode(e,n,i,t,a)||s.addNode(e,n,i,t,o),o+=e.nodeSize})),s.syncToMarks(CM,r,t),this.node.isTextblock&&s.addTextblockHacks(),s.destroyRest(),(s.changed||this.dirty==bM)&&(i&&this.protectLocalComposition(t,i),IM(this.contentDOM,this.children,t),OC.ios&&KM(this.dom))},e.prototype.localCompositionNode=function(t,e){var n=t.state.selection,r=n.from,o=n.to;if(!(!(t.state.selection instanceof tC)||r<e||o>e+this.node.content.size)){var i=t.root.getSelection(),s=UM(i.focusNode,i.focusOffset);if(s&&this.dom.contains(s.parentNode)){var a=s.nodeValue,c=GM(this.node.content,a,r-e,o-e);return c<0?null:{node:s,pos:c,text:a}}}},e.prototype.protectLocalComposition=function(t,e){var n=e.node,r=e.pos,o=e.text;if(!this.getDesc(n)){for(var i=n;;i=i.parentNode){if(i.parentNode==this.contentDOM)break;while(i.previousSibling)i.parentNode.removeChild(i.previousSibling);while(i.nextSibling)i.parentNode.removeChild(i.nextSibling);i.pmViewDesc&&(i.pmViewDesc=null)}var s=new NM(this,i,n,o);t.compositionNodes.push(s),this.children=XM(this.children,r,r+o.length,t,s)}},e.prototype.update=function(t,e,n,r){return!(this.dirty==kM||!t.sameMarkup(this.node))&&(this.updateInner(t,e,n,r),!0)},e.prototype.updateInner=function(t,e,n,r){this.updateOuterDeco(e),this.node=t,this.innerDeco=n,this.contentDOM&&this.updateChildren(r,this.posAtStart),this.dirty=wM},e.prototype.updateOuterDeco=function(t){if(!JM(t,this.outerDeco)){var e=1!=this.nodeDOM.nodeType,n=this.dom;this.dom=$M(this.dom,this.nodeDOM,BM(this.outerDeco,this.node,e),BM(t,this.node,e)),this.dom!=n&&(n.pmViewDesc=null,this.dom.pmViewDesc=this),this.outerDeco=t}},e.prototype.selectNode=function(){this.nodeDOM.classList.add("ProseMirror-selectednode"),!this.contentDOM&&this.node.type.spec.draggable||(this.dom.draggable=!0)},e.prototype.deselectNode=function(){this.nodeDOM.classList.remove("ProseMirror-selectednode"),!this.contentDOM&&this.node.type.spec.draggable||this.dom.removeAttribute("draggable")},n.domAtom.get=function(){return this.node.isAtom},Object.defineProperties(e.prototype,n),e}(SM);function AM(t,e,n,r,o){return jM(r,e,t),new EM(null,t,e,n,r,r,r,o,0)}var DM=function(t){function e(e,n,r,o,i,s,a){t.call(this,e,n,r,o,i,null,s,a)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={domAtom:{configurable:!0}};return e.prototype.parseRule=function(){var t=this.nodeDOM.parentNode;while(t&&t!=this.dom&&!t.pmIsDeco)t=t.parentNode;return{skip:t||!0}},e.prototype.update=function(t,e,n,r){return!(this.dirty==kM||this.dirty!=wM&&!this.inParent()||!t.sameMarkup(this.node))&&(this.updateOuterDeco(e),this.dirty==wM&&t.text==this.node.text||t.text==this.nodeDOM.nodeValue||(this.nodeDOM.nodeValue=t.text,r.trackWrites==this.nodeDOM&&(r.trackWrites=null)),this.node=t,this.dirty=wM,!0)},e.prototype.inParent=function(){for(var t=this.parent.contentDOM,e=this.nodeDOM;e;e=e.parentNode)if(e==t)return!0;return!1},e.prototype.domFromPos=function(t){return{node:this.nodeDOM,offset:t}},e.prototype.localPosFromDOM=function(e,n,r){return e==this.nodeDOM?this.posAtStart+Math.min(n,this.node.text.length):t.prototype.localPosFromDOM.call(this,e,n,r)},e.prototype.ignoreMutation=function(t){return"characterData"!=t.type&&"selection"!=t.type},e.prototype.slice=function(t,n,r){var o=this.node.cut(t,n),i=document.createTextNode(o.text);return new e(this.parent,o,this.outerDeco,this.innerDeco,i,i,r)},n.domAtom.get=function(){return!1},Object.defineProperties(e.prototype,n),e}(EM),RM=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={domAtom:{configurable:!0}};return e.prototype.parseRule=function(){return{ignore:!0}},e.prototype.matchesHack=function(){return this.dirty==wM},n.domAtom.get=function(){return!0},Object.defineProperties(e.prototype,n),e}(SM),zM=function(t){function e(e,n,r,o,i,s,a,c,h,p){t.call(this,e,n,r,o,i,s,a,h,p),this.spec=c}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.update=function(e,n,r,o){if(this.dirty==kM)return!1;if(this.spec.update){var i=this.spec.update(e,n,r);return i&&this.updateInner(e,n,r,o),i}return!(!this.contentDOM&&!e.isLeaf)&&t.prototype.update.call(this,e,n,r,o)},e.prototype.selectNode=function(){this.spec.selectNode?this.spec.selectNode():t.prototype.selectNode.call(this)},e.prototype.deselectNode=function(){this.spec.deselectNode?this.spec.deselectNode():t.prototype.deselectNode.call(this)},e.prototype.setSelection=function(e,n,r,o){this.spec.setSelection?this.spec.setSelection(e,n,r):t.prototype.setSelection.call(this,e,n,r,o)},e.prototype.destroy=function(){this.spec.destroy&&this.spec.destroy(),t.prototype.destroy.call(this)},e.prototype.stopEvent=function(t){return!!this.spec.stopEvent&&this.spec.stopEvent(t)},e.prototype.ignoreMutation=function(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):t.prototype.ignoreMutation.call(this,e)},e}(EM);function IM(t,e,n){for(var r=t.firstChild,o=!1,i=0;i<e.length;i++){var s=e[i],a=s.dom;if(a.parentNode==t){while(a!=r)r=LM(r),o=!0;r=r.nextSibling}else o=!0,t.insertBefore(a,r);if(s instanceof TM){var c=r?r.previousSibling:t.lastChild;IM(s.contentDOM,s.children,n),r=c?c.nextSibling:t.firstChild}}while(r)r=LM(r),o=!0;o&&n.trackWrites==t&&(n.trackWrites=null)}function PM(t){t&&(this.nodeName=t)}PM.prototype=Object.create(null);var FM=[new PM];function BM(t,e,n){if(0==t.length)return FM;for(var r=n?FM[0]:new PM,o=[r],i=0;i<t.length;i++){var s=t[i].type.attrs;if(s)for(var a in s.nodeName&&o.push(r=new PM(s.nodeName)),s){var c=s[a];null!=c&&(n&&1==o.length&&o.push(r=new PM(e.isInline?"span":"div")),"class"==a?r.class=(r.class?r.class+" ":"")+c:"style"==a?r.style=(r.style?r.style+";":"")+c:"nodeName"!=a&&(r[a]=c))}}return o}function $M(t,e,n,r){if(n==FM&&r==FM)return e;for(var o=e,i=0;i<r.length;i++){var s=r[i],a=n[i];if(i){var c=void 0;a&&a.nodeName==s.nodeName&&o!=t&&(c=o.parentNode)&&c.tagName.toLowerCase()==s.nodeName||(c=document.createElement(s.nodeName),c.pmIsDeco=!0,c.appendChild(o),a=FM[0]),o=c}_M(o,a||FM[0],s)}return o}function _M(t,e,n){for(var r in e)"class"==r||"style"==r||"nodeName"==r||r in n||t.removeAttribute(r);for(var o in n)"class"!=o&&"style"!=o&&"nodeName"!=o&&n[o]!=e[o]&&t.setAttribute(o,n[o]);if(e.class!=n.class){for(var i=e.class?e.class.split(" ").filter(Boolean):CM,s=n.class?n.class.split(" ").filter(Boolean):CM,a=0;a<i.length;a++)-1==s.indexOf(i[a])&&t.classList.remove(i[a]);for(var c=0;c<s.length;c++)-1==i.indexOf(s[c])&&t.classList.add(s[c])}if(e.style!=n.style){if(e.style){var h,p=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g;while(h=p.exec(e.style))t.style.removeProperty(h[1])}n.style&&(t.style.cssText+=n.style)}}function jM(t,e,n){return $M(t,t,FM,BM(e,n,1!=t.nodeType))}function JM(t,e){if(t.length!=e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].type.eq(e[n].type))return!1;return!0}function LM(t){var e=t.nextSibling;return t.parentNode.removeChild(t),e}var VM=function(t,e){this.top=t,this.lock=e,this.index=0,this.stack=[],this.changed=!1,this.preMatch=qM(t.node.content,t.children)};function qM(t,e){for(var n=t.childCount,r=e.length,o=new Map;n>0&&r>0;r--){var i=e[r-1],s=i.node;if(s){if(s!=t.child(n-1))break;--n,o.set(i,n)}}return{index:n,matched:o}}function WM(t,e){return t.type.side-e.type.side}function HM(t,e,n,r){var o=e.locals(t),i=0;if(0!=o.length)for(var s=0,a=[],c=null,h=0;;){if(s<o.length&&o[s].to==i){var p=o[s++],l=void 0;while(s<o.length&&o[s].to==i)(l||(l=[p])).push(o[s++]);if(l){l.sort(WM);for(var u=0;u<l.length;u++)n(l[u],h,!!c)}else n(p,h,!!c)}var f=void 0,d=void 0;if(c)d=-1,f=c,c=null;else{if(!(h<t.childCount))break;d=h,f=t.child(h++)}for(var m=0;m<a.length;m++)a[m].to<=i&&a.splice(m--,1);while(s<o.length&&o[s].from<=i&&o[s].to>i)a.push(o[s++]);var v=i+f.nodeSize;if(f.isText){var g=v;s<o.length&&o[s].from<g&&(g=o[s].from);for(var y=0;y<a.length;y++)a[y].to<g&&(g=a[y].to);g<v&&(c=f.cut(g-i),f=f.cut(0,g-i),v=g,d=-1)}var w=a.length?f.isInline&&!f.isLeaf?a.filter((function(t){return!t.inline})):a.slice():CM;r(f,w,e.forChild(i,f),d),i=v}else for(var x=0;x<t.childCount;x++){var b=t.child(x);r(b,o,e.forChild(i,b),x),i+=b.nodeSize}}function KM(t){if("UL"==t.nodeName||"OL"==t.nodeName){var e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t).listStyle,t.style.cssText=e}}function UM(t,e){for(;;){if(3==t.nodeType)return t;if(1==t.nodeType&&e>0){if(t.childNodes.length>e&&3==t.childNodes[e].nodeType)return t.childNodes[e];t=t.childNodes[e-1],e=BC(t)}else{if(!(1==t.nodeType&&e<t.childNodes.length))return null;t=t.childNodes[e],e=0}}}function GM(t,e,n,r){for(var o=0,i=0;o<t.childCount&&i<=r;){var s=t.child(o++),a=i;if(i+=s.nodeSize,s.isText){var c=s.text;while(o<t.childCount){var h=t.child(o++);if(i+=h.nodeSize,!h.isText)break;c+=h.text}if(i>=n){var p=c.lastIndexOf(e,r-a);if(p>=0&&p+e.length+a>=n)return a+p}}}return-1}function XM(t,e,n,r,o){for(var i=[],s=0,a=0;s<t.length;s++){var c=t[s],h=a,p=a+=c.size;h>=n||p<=e?i.push(c):(h<e&&i.push(c.slice(0,e-h,r)),o&&(i.push(o),o=null),p>n&&i.push(c.slice(n-h,c.size,r)))}return i}function YM(t,e){var n=t.root.getSelection(),r=t.state.doc;if(!n.focusNode)return null;var o=t.docView.nearestDesc(n.focusNode),i=o&&0==o.size,s=t.docView.posFromDOM(n.focusNode,n.focusOffset);if(s<0)return null;var a,c,h=r.resolve(s);if(jC(n)){a=h;while(o&&!o.node)o=o.parent;if(o&&o.node.isAtom&&nC.isSelectable(o.node)&&o.parent&&(!o.node.isInline||!$C(n.focusNode,n.focusOffset,o.dom))){var p=o.posBefore;c=new nC(s==p?h:r.resolve(p))}}else{var l=t.docView.posFromDOM(n.anchorNode,n.anchorOffset);if(l<0)return null;a=r.resolve(l)}if(!c){var u="pointer"==e||t.state.selection.head<h.pos&&!i?1:-1;c=cN(t,a,h,u)}return c}function ZM(t){return t.editable?t.hasFocus():pN(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function QM(t,e){var n=t.state.selection;if(sN(t,n),ZM(t)){if(t.domObserver.disconnectSelection(),t.cursorWrapper)iN(t);else{var r,o,i=n.anchor,s=n.head;!tN||n instanceof tC||(n.$from.parent.inlineContent||(r=eN(t,n.from)),n.empty||n.$from.parent.inlineContent||(o=eN(t,n.to))),t.docView.setSelection(i,s,t.root,e),tN&&(r&&rN(r),o&&rN(o)),n.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&oN(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}VM.prototype.destroyBetween=function(t,e){if(t!=e){for(var n=t;n<e;n++)this.top.children[n].destroy();this.top.children.splice(t,e-t),this.changed=!0}},VM.prototype.destroyRest=function(){this.destroyBetween(this.index,this.top.children.length)},VM.prototype.syncToMarks=function(t,e,n){var r=0,o=this.stack.length>>1,i=Math.min(o,t.length);while(r<i&&(r==o-1?this.top:this.stack[r+1<<1]).matchesMark(t[r])&&!1!==t[r].type.spec.spanning)r++;while(r<o)this.destroyRest(),this.top.dirty=wM,this.index=this.stack.pop(),this.top=this.stack.pop(),o--;while(o<t.length){this.stack.push(this.top,this.index+1);for(var s=-1,a=this.index;a<Math.min(this.index+3,this.top.children.length);a++)if(this.top.children[a].matchesMark(t[o])){s=a;break}if(s>-1)s>this.index&&(this.changed=!0,this.destroyBetween(this.index,s)),this.top=this.top.children[this.index];else{var c=TM.create(this.top,t[o],e,n);this.top.children.splice(this.index,0,c),this.top=c,this.changed=!0}this.index=0,o++}},VM.prototype.findNodeMatch=function(t,e,n,r){var o=this.top.children,i=-1;if(r>=this.preMatch.index){for(var s=this.index;s<o.length;s++)if(o[s].matchesNode(t,e,n)){i=s;break}}else for(var a=this.index,c=Math.min(o.length,a+1);a<c;a++){var h=o[a];if(h.matchesNode(t,e,n)&&!this.preMatch.matched.has(h)){i=a;break}}return!(i<0)&&(this.destroyBetween(this.index,i),this.index++,!0)},VM.prototype.updateNextNode=function(t,e,n,r,o){for(var i=this.index;i<this.top.children.length;i++){var s=this.top.children[i];if(s instanceof EM){var a=this.preMatch.matched.get(s);if(null!=a&&a!=o)return!1;var c=s.dom,h=this.lock&&(c==this.lock||1==c.nodeType&&c.contains(this.lock.parentNode))&&!(t.isText&&s.node&&s.node.isText&&s.nodeDOM.nodeValue==t.text&&s.dirty!=kM&&JM(e,s.outerDeco));if(!h&&s.update(t,e,n,r))return this.destroyBetween(this.index,i),s.dom!=c&&(this.changed=!0),this.index++,!0;break}}return!1},VM.prototype.addNode=function(t,e,n,r,o){this.top.children.splice(this.index++,0,EM.create(this.top,t,e,n,r,o)),this.changed=!0},VM.prototype.placeWidget=function(t,e,n){var r=this.index<this.top.children.length?this.top.children[this.index]:null;if(!r||!r.matchesWidget(t)||t!=r.widget&&r.widget.type.toDOM.parentNode){var o=new MM(this.top,t,e,n);this.top.children.splice(this.index++,0,o),this.changed=!0}else this.index++},VM.prototype.addTextblockHacks=function(){var t=this.top.children[this.index-1];while(t instanceof TM)t=t.children[t.children.length-1];if(!t||!(t instanceof DM)||/\n$/.test(t.node.text))if(this.index<this.top.children.length&&this.top.children[this.index].matchesHack())this.index++;else{var e=document.createElement("br");this.top.children.splice(this.index++,0,new RM(this.top,CM,e,null)),this.changed=!0}};var tN=OC.safari||OC.chrome&&OC.chrome_version<63;function eN(t,e){var n=t.docView.domFromPos(e,0),r=n.node,o=n.offset,i=o<r.childNodes.length?r.childNodes[o]:null,s=o?r.childNodes[o-1]:null;if(OC.safari&&i&&"false"==i.contentEditable)return nN(i);if((!i||"false"==i.contentEditable)&&(!s||"false"==s.contentEditable)){if(i)return nN(i);if(s)return nN(s)}}function nN(t){return t.contentEditable="true",OC.safari&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function rN(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function oN(t){var e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.hideSelectionGuard);var n=t.root.getSelection(),r=n.anchorNode,o=n.anchorOffset;e.addEventListener("selectionchange",t.hideSelectionGuard=function(){n.anchorNode==r&&n.anchorOffset==o||(e.removeEventListener("selectionchange",t.hideSelectionGuard),setTimeout((function(){ZM(t)&&!t.state.selection.visible||t.dom.classList.remove("ProseMirror-hideselection")}),20))})}function iN(t){var e=t.root.getSelection(),n=document.createRange(),r=t.cursorWrapper.dom,o="IMG"==r.nodeName;o?n.setEnd(r.parentNode,AC(r)+1):n.setEnd(r,0),n.collapse(!1),e.removeAllRanges(),e.addRange(n),!o&&!t.state.selection.visible&&OC.ie&&OC.ie_version<=11&&(r.disabled=!0,r.disabled=!1)}function sN(t,e){if(e instanceof nC){var n=t.docView.descAt(e.from);n!=t.lastSelectedViewDesc&&(aN(t),n&&n.selectNode(),t.lastSelectedViewDesc=n)}else aN(t)}function aN(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=null)}function cN(t,e,n,r){return t.someProp("createSelectionBetween",(function(r){return r(t,e,n)}))||tC.between(e,n,r)}function hN(t){return(!t.editable||t.root.activeElement==t.dom)&&pN(t)}function pN(t){var e=t.root.getSelection();if(!e.anchorNode)return!1;try{return t.dom.contains(3==e.anchorNode.nodeType?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(3==e.focusNode.nodeType?e.focusNode.parentNode:e.focusNode))}catch(n){return!1}}function lN(t){var e=t.docView.domFromPos(t.state.selection.anchor,0),n=t.root.getSelection();return IC(e.node,e.offset,n.anchorNode,n.anchorOffset)}function uN(t,e){var n=t.selection,r=n.$anchor,o=n.$head,i=e>0?r.max(o):r.min(o),s=i.parent.inlineContent?i.depth?t.doc.resolve(e>0?i.after():i.before()):null:i;return s&&YO.findFrom(s,e)}function fN(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function dN(t,e,n){var r=t.state.selection;if(!(r instanceof tC)){if(r instanceof nC&&r.node.isInline)return fN(t,new tC(e>0?r.$to:r.$from));var o=uN(t.state,e);return!!o&&fN(t,o)}if(!r.empty||n.indexOf("s")>-1)return!1;if(t.endOfTextblock(e>0?"right":"left")){var i=uN(t.state,e);return!!(i&&i instanceof nC)&&fN(t,i)}if(!(OC.mac&&n.indexOf("m")>-1)){var s,a=r.$head,c=a.textOffset?null:e<0?a.nodeBefore:a.nodeAfter;if(!c||c.isText)return!1;var h=e<0?a.pos-c.nodeSize:a.pos;return!!(c.isAtom||(s=t.docView.descAt(h))&&!s.contentDOM)&&(nC.isSelectable(c)?fN(t,new nC(e<0?t.state.doc.resolve(a.pos-c.nodeSize):a)):!!OC.webkit&&fN(t,new tC(t.state.doc.resolve(e<0?h:h+c.nodeSize))))}}function mN(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}function vN(t){var e=t.pmViewDesc;return e&&0==e.size&&(t.nextSibling||"BR"!=t.nodeName)}function gN(t){var e=t.root.getSelection(),n=e.focusNode,r=e.focusOffset;if(n){var o,i,s=!1;for(OC.gecko&&1==n.nodeType&&r<mN(n)&&vN(n.childNodes[r])&&(s=!0);;)if(r>0){if(1!=n.nodeType)break;var a=n.childNodes[r-1];if(vN(a))o=n,i=--r;else{if(3!=a.nodeType)break;n=a,r=n.nodeValue.length}}else{if(wN(n))break;var c=n.previousSibling;while(c&&vN(c))o=n.parentNode,i=AC(c),c=c.previousSibling;if(c)n=c,r=mN(n);else{if(n=n.parentNode,n==t.dom)break;r=0}}s?xN(t,e,n,r):o&&xN(t,e,o,i)}}function yN(t){var e=t.root.getSelection(),n=e.focusNode,r=e.focusOffset;if(n){for(var o,i,s=mN(n);;)if(r<s){if(1!=n.nodeType)break;var a=n.childNodes[r];if(!vN(a))break;o=n,i=++r}else{if(wN(n))break;var c=n.nextSibling;while(c&&vN(c))o=c.parentNode,i=AC(c)+1,c=c.nextSibling;if(c)n=c,r=0,s=mN(n);else{if(n=n.parentNode,n==t.dom)break;r=s=0}}o&&xN(t,e,o,i)}}function wN(t){var e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function xN(t,e,n,r){if(jC(e)){var o=document.createRange();o.setEnd(n,r),o.setStart(n,r),e.removeAllRanges(),e.addRange(o)}else e.extend&&e.extend(n,r);t.domObserver.setCurSelection();var i=t.state;setTimeout((function(){t.state==i&&QM(t)}),50)}function bN(t,e,n){var r=t.state.selection;if(r instanceof tC&&!r.empty||n.indexOf("s")>-1)return!1;if(OC.mac&&n.indexOf("m")>-1)return!1;var o=r.$from,i=r.$to;if(!o.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){var s=uN(t.state,e);if(s&&s instanceof nC)return fN(t,s)}if(!o.parent.inlineContent){var a=e<0?o:i,c=r instanceof oC?YO.near(a,e):YO.findFrom(a,e);return!!c&&fN(t,c)}return!1}function kN(t,e){if(!(t.state.selection instanceof tC))return!0;var n=t.state.selection,r=n.$head,o=n.$anchor,i=n.empty;if(!r.sameParent(o))return!0;if(!i)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;var s=!r.textOffset&&(e<0?r.nodeBefore:r.nodeAfter);if(s&&!s.isText){var a=t.state.tr;return e<0?a.delete(r.pos-s.nodeSize,r.pos):a.delete(r.pos,r.pos+s.nodeSize),t.dispatch(a),!0}return!1}function SN(t,e,n){t.domObserver.stop(),e.contentEditable=n,t.domObserver.start()}function ON(t){if(OC.safari&&!(t.state.selection.$head.parentOffset>0)){var e=t.root.getSelection(),n=e.focusNode,r=e.focusOffset;if(n&&1==n.nodeType&&0==r&&n.firstChild&&"false"==n.firstChild.contentEditable){var o=n.firstChild;SN(t,o,!0),setTimeout((function(){return SN(t,o,!1)}),20)}}}function CN(t){var e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}function MN(t,e){var n=e.keyCode,r=CN(e);return 8==n||OC.mac&&72==n&&"c"==r?kN(t,-1)||gN(t):46==n||OC.mac&&68==n&&"c"==r?kN(t,1)||yN(t):13==n||27==n||(37==n?dN(t,-1,r)||gN(t):39==n?dN(t,1,r)||yN(t):38==n?bN(t,-1,r)||gN(t):40==n?ON(t)||bN(t,1,r)||yN(t):r==(OC.mac?"m":"c")&&(66==n||73==n||89==n||90==n))}function NN(t,e,n){var r=t.docView.parseRange(e,n),o=r.node,i=r.fromOffset,s=r.toOffset,a=r.from,c=r.to,h=t.root.getSelection(),p=null,l=h.anchorNode;if(l&&t.dom.contains(1==l.nodeType?l:l.parentNode)&&(p=[{node:l,offset:h.anchorOffset}],jC(h)||p.push({node:h.focusNode,offset:h.focusOffset})),OC.chrome&&8===t.lastKeyCode)for(var u=s;u>i;u--){var f=o.childNodes[u-1],d=f.pmViewDesc;if("BR"==f.nodeName&&!d){s=u;break}if(!d||d.size)break}var m=t.state.doc,v=t.someProp("domParser")||GS.fromSchema(t.state.schema),g=m.resolve(a),y=null,w=v.parse(o,{topNode:g.parent,topMatch:g.parent.contentMatchAt(g.index()),topOpen:!0,from:i,to:s,preserveWhitespace:!g.parent.type.spec.code||"full",editableContent:!0,findPositions:p,ruleFromNode:TN,context:g});if(p&&null!=p[0].pos){var x=p[0].pos,b=p[1]&&p[1].pos;null==b&&(b=x),y={anchor:x+a,head:b+a}}return{doc:w,sel:y,from:a,to:c}}function TN(t){var e=t.pmViewDesc;if(e)return e.parseRule();if("BR"==t.nodeName&&t.parentNode){if(OC.safari&&/^(ul|ol)$/i.test(t.parentNode.nodeName)){var n=document.createElement("div");return n.appendChild(document.createElement("li")),{skip:n}}if(t.parentNode.lastChild==t||OC.safari&&/^(tr|table)$/i.test(t.parentNode.nodeName))return{ignore:!0}}else if("IMG"==t.nodeName&&t.getAttribute("mark-placeholder"))return{ignore:!0}}function EN(t,e,n,r,o){if(e<0){var i=t.lastSelectionTime>Date.now()-50?t.lastSelectionOrigin:null,s=YM(t,i);if(s&&!t.state.selection.eq(s)){var a=t.state.tr.setSelection(s);"pointer"==i?a.setMeta("pointer",!0):"key"==i&&a.scrollIntoView(),t.dispatch(a)}}else{var c=t.state.doc.resolve(e),h=c.sharedDepth(n);e=c.before(h+1),n=t.state.doc.resolve(n).after(h+1);var p=t.state.selection,l=NN(t,e,n);if(OC.chrome&&t.cursorWrapper&&l.sel&&l.sel.anchor==t.cursorWrapper.deco.from){var u=t.cursorWrapper.deco.type.toDOM.nextSibling,f=u&&u.nodeValue?u.nodeValue.length:1;l.sel={anchor:l.sel.anchor+f,head:l.sel.anchor+f}}var d,m,v=t.state.doc,g=v.slice(l.from,l.to);8===t.lastKeyCode&&Date.now()-100<t.lastKeyCodeTime?(d=t.state.selection.to,m="end"):(d=t.state.selection.from,m="start"),t.lastKeyCode=null;var y=IN(g.content,l.doc.content,l.from,d,m);if(!y){if(!(r&&p instanceof tC&&!p.empty&&p.$head.sameParent(p.$anchor))||t.composing||l.sel&&l.sel.anchor!=l.sel.head){if((OC.ios&&t.lastIOSEnter>Date.now()-225||OC.android)&&o.some((function(t){return"DIV"==t.nodeName||"P"==t.nodeName}))&&t.someProp("handleKeyDown",(function(e){return e(t,JC(13,"Enter"))})))return void(t.lastIOSEnter=0);if(l.sel){var w=AN(t,t.state.doc,l.sel);w&&!w.eq(t.state.selection)&&t.dispatch(t.state.tr.setSelection(w))}return}y={start:p.from,endA:p.to,endB:p.to}}t.domChangeCount++,t.state.selection.from<t.state.selection.to&&y.start==y.endB&&t.state.selection instanceof tC&&(y.start>t.state.selection.from&&y.start<=t.state.selection.from+2?y.start=t.state.selection.from:y.endA<t.state.selection.to&&y.endA>=t.state.selection.to-2&&(y.endB+=t.state.selection.to-y.endA,y.endA=t.state.selection.to)),OC.ie&&OC.ie_version<=11&&y.endB==y.start+1&&y.endA==y.start&&y.start>l.from&&" "==l.doc.textBetween(y.start-l.from-1,y.start-l.from+1)&&(y.start--,y.endA--,y.endB--);var x,b=l.doc.resolveNoCache(y.start-l.from),k=l.doc.resolveNoCache(y.endB-l.from),S=b.sameParent(k)&&b.parent.inlineContent;if((OC.ios&&t.lastIOSEnter>Date.now()-225&&(!S||o.some((function(t){return"DIV"==t.nodeName||"P"==t.nodeName})))||!S&&b.pos<l.doc.content.size&&(x=YO.findFrom(l.doc.resolve(b.pos+1),1,!0))&&x.head==k.pos)&&t.someProp("handleKeyDown",(function(e){return e(t,JC(13,"Enter"))})))t.lastIOSEnter=0;else if(t.state.selection.anchor>y.start&&RN(v,y.start,y.endA,b,k)&&t.someProp("handleKeyDown",(function(e){return e(t,JC(8,"Backspace"))})))OC.android&&OC.chrome&&t.domObserver.suppressSelectionUpdates();else{OC.chrome&&OC.android&&y.toB==y.from&&(t.lastAndroidDelete=Date.now()),OC.android&&!S&&b.start()!=k.start()&&0==k.parentOffset&&b.depth==k.depth&&l.sel&&l.sel.anchor==l.sel.head&&l.sel.head==y.endA&&(y.endB-=2,k=l.doc.resolveNoCache(y.endB-l.from),setTimeout((function(){t.someProp("handleKeyDown",(function(e){return e(t,JC(13,"Enter"))}))}),20));var O,C,M,N,T=y.start,E=y.endA;if(S)if(b.pos==k.pos)OC.ie&&OC.ie_version<=11&&0==b.parentOffset&&(t.domObserver.suppressSelectionUpdates(),setTimeout((function(){return QM(t)}),20)),O=t.state.tr.delete(T,E),C=v.resolve(y.start).marksAcross(v.resolve(y.endA));else if(y.endA==y.endB&&(N=v.resolve(y.start))&&(M=DN(b.parent.content.cut(b.parentOffset,k.parentOffset),N.parent.content.cut(N.parentOffset,y.endA-N.start()))))O=t.state.tr,"add"==M.type?O.addMark(T,E,M.mark):O.removeMark(T,E,M.mark);else if(b.parent.child(b.index()).isText&&b.index()==k.index()-(k.textOffset?0:1)){var A=b.parent.textBetween(b.parentOffset,k.parentOffset);if(t.someProp("handleTextInput",(function(e){return e(t,T,E,A)})))return;O=t.state.tr.insertText(A,T,E)}if(O||(O=t.state.tr.replace(T,E,l.doc.slice(y.start-l.from,y.endB-l.from))),l.sel){var D=AN(t,O.doc,l.sel);D&&!(OC.chrome&&OC.android&&t.composing&&D.empty&&(y.start!=y.endB||t.lastAndroidDelete<Date.now()-100)&&(D.head==T||D.head==O.mapping.map(E)-1)||OC.ie&&D.empty&&D.head==T)&&O.setSelection(D)}C&&O.ensureMarks(C),t.dispatch(O.scrollIntoView())}}}function AN(t,e,n){return Math.max(n.anchor,n.head)>e.content.size?null:cN(t,e.resolve(n.anchor),e.resolve(n.head))}function DN(t,e){for(var n,r,o,i=t.firstChild.marks,s=e.firstChild.marks,a=i,c=s,h=0;h<s.length;h++)a=s[h].removeFromSet(a);for(var p=0;p<i.length;p++)c=i[p].removeFromSet(c);if(1==a.length&&0==c.length)r=a[0],n="add",o=function(t){return t.mark(r.addToSet(t.marks))};else{if(0!=a.length||1!=c.length)return null;r=c[0],n="remove",o=function(t){return t.mark(r.removeFromSet(t.marks))}}for(var l=[],u=0;u<e.childCount;u++)l.push(o(e.child(u)));if(qk.from(l).eq(t))return{mark:r,type:n}}function RN(t,e,n,r,o){if(!r.parent.isTextblock||n-e<=o.pos-r.pos||zN(r,!0,!1)<o.pos)return!1;var i=t.resolve(e);if(i.parentOffset<i.parent.content.size||!i.parent.isTextblock)return!1;var s=t.resolve(zN(i,!0,!0));return!(!s.parent.isTextblock||s.pos>n||zN(s,!0,!1)<n)&&r.parent.content.cut(r.parentOffset).eq(s.parent.content)}function zN(t,e,n){var r=t.depth,o=e?t.end():t.pos;while(r>0&&(e||t.indexAfter(r)==t.node(r).childCount))r--,o++,e=!1;if(n){var i=t.node(r).maybeChild(t.indexAfter(r));while(i&&!i.isLeaf)i=i.firstChild,o++}return o}function IN(t,e,n,r,o){var i=t.findDiffStart(e,n);if(null==i)return null;var s=t.findDiffEnd(e,n+t.size,n+e.size),a=s.a,c=s.b;if("end"==o){var h=Math.max(0,i-Math.min(a,c));r-=a+h-i}if(a<i&&t.size<e.size){var p=r<=i&&r>=a?i-r:0;i-=p,c=i+(c-a),a=i}else if(c<i){var l=r<=i&&r>=c?i-r:0;i-=l,a=i+(a-c),c=i}return{start:i,endA:a,endB:c}}function PN(t,e){var n=[],r=e.content,o=e.openStart,i=e.openEnd;while(o>1&&i>1&&1==r.childCount&&1==r.firstChild.childCount){o--,i--;var s=r.firstChild;n.push(s.type.name,s.attrs!=s.type.defaultAttrs?s.attrs:null),r=s.content}var a=t.someProp("clipboardSerializer")||lO.fromSchema(t.state.schema),c=WN(),h=c.createElement("div");h.appendChild(a.serializeFragment(r,{document:c}));var p,l=h.firstChild;while(l&&1==l.nodeType&&(p=VN[l.nodeName.toLowerCase()])){for(var u=p.length-1;u>=0;u--){var f=c.createElement(p[u]);while(h.firstChild)f.appendChild(h.firstChild);h.appendChild(f)}l=h.firstChild}l&&1==l.nodeType&&l.setAttribute("data-pm-slice",o+" "+i+" "+JSON.stringify(n));var d=t.someProp("clipboardTextSerializer",(function(t){return t(e)}))||e.content.textBetween(0,e.content.size,"\n\n");return{dom:h,text:d}}function FN(t,e,n,r,o){var i,s,a=o.parent.type.spec.code;if(!n&&!e)return null;var c=e&&(r||a||!n);if(c){if(t.someProp("transformPastedText",(function(t){e=t(e,a||r)})),a)return new Yk(qk.from(t.state.schema.text(e.replace(/\r\n?/g,"\n"))),0,0);var h=t.someProp("clipboardTextParser",(function(t){return t(e,o,r)}));h?s=h:(i=document.createElement("div"),e.trim().split(/(?:\r\n?|\n)+/).forEach((function(t){i.appendChild(document.createElement("p")).textContent=t})))}else t.someProp("transformPastedHTML",(function(t){n=t(n)})),i=HN(n);var p=i&&i.querySelector("[data-pm-slice]"),l=p&&/^(\d+) (\d+) (.*)/.exec(p.getAttribute("data-pm-slice"));if(!s){var u=t.someProp("clipboardParser")||t.someProp("domParser")||GS.fromSchema(t.state.schema);s=u.parseSlice(i,{preserveWhitespace:!(!c&&!l),context:o})}return s=l?KN(LN(s,+l[1],+l[2]),l[3]):Yk.maxOpen(BN(s.content,o),!1),t.someProp("transformPasted",(function(t){s=t(s)})),s}function BN(t,e){if(t.childCount<2)return t;for(var n=function(n){var r=e.node(n),o=r.contentMatchAt(e.index(n)),i=void 0,s=[];if(t.forEach((function(t){if(s){var e,n=o.findWrapping(t.type);if(!n)return s=null;if(e=s.length&&i.length&&_N(n,i,t,s[s.length-1],0))s[s.length-1]=e;else{s.length&&(s[s.length-1]=jN(s[s.length-1],i.length));var r=$N(t,n);s.push(r),o=o.matchType(r.type,r.attrs),i=n}}})),s)return{v:qk.from(s)}},r=e.depth;r>=0;r--){var o=n(r);if(o)return o.v}return t}function $N(t,e,n){void 0===n&&(n=0);for(var r=e.length-1;r>=n;r--)t=e[r].create(null,qk.from(t));return t}function _N(t,e,n,r,o){if(o<t.length&&o<e.length&&t[o]==e[o]){var i=_N(t,e,n,r.lastChild,o+1);if(i)return r.copy(r.content.replaceChild(r.childCount-1,i));var s=r.contentMatchAt(r.childCount);if(s.matchType(o==t.length-1?n.type:t[o+1]))return r.copy(r.content.append(qk.from($N(n,t,o+1))))}}function jN(t,e){if(0==e)return t;var n=t.content.replaceChild(t.childCount-1,jN(t.lastChild,e-1)),r=t.contentMatchAt(t.childCount).fillBefore(qk.empty,!0);return t.copy(n.append(r))}function JN(t,e,n,r,o,i){var s=e<0?t.firstChild:t.lastChild,a=s.content;return o<r-1&&(a=JN(a,e,n,r,o+1,i)),o>=n&&(a=e<0?s.contentMatchAt(0).fillBefore(a,t.childCount>1||i<=o).append(a):a.append(s.contentMatchAt(s.childCount).fillBefore(qk.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,s.copy(a))}function LN(t,e,n){return e<t.openStart&&(t=new Yk(JN(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),n<t.openEnd&&(t=new Yk(JN(t.content,1,n,t.openEnd,0,0),t.openStart,n)),t}var VN={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]},qN=null;function WN(){return qN||(qN=document.implementation.createHTMLDocument("title"))}function HN(t){var e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));var n,r=WN().createElement("div"),o=/<([a-z][^>\s]+)/i.exec(t);if((n=o&&VN[o[1].toLowerCase()])&&(t=n.map((function(t){return"<"+t+">"})).join("")+t+n.map((function(t){return"</"+t+">"})).reverse().join("")),r.innerHTML=t,n)for(var i=0;i<n.length;i++)r=r.querySelector(n[i])||r;return r}function KN(t,e){if(!t.size)return t;var n,r=t.content.firstChild.type.schema;try{n=JSON.parse(e)}catch(h){return t}for(var o=t.content,i=t.openStart,s=t.openEnd,a=n.length-2;a>=0;a-=2){var c=r.nodes[n[a]];if(!c||c.hasRequiredAttrs())break;o=qk.from(c.create(n[a+1],o)),i++,s++}return new Yk(o,i,s)}var UN={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},GN=OC.ie&&OC.ie_version<=11,XN=function(){this.anchorNode=this.anchorOffset=this.focusNode=this.focusOffset=null};XN.prototype.set=function(t){this.anchorNode=t.anchorNode,this.anchorOffset=t.anchorOffset,this.focusNode=t.focusNode,this.focusOffset=t.focusOffset},XN.prototype.eq=function(t){return t.anchorNode==this.anchorNode&&t.anchorOffset==this.anchorOffset&&t.focusNode==this.focusNode&&t.focusOffset==this.focusOffset};var YN=function(t,e){var n=this;this.view=t,this.handleDOMChange=e,this.queue=[],this.flushingSoon=-1,this.observer=window.MutationObserver&&new window.MutationObserver((function(t){for(var e=0;e<t.length;e++)n.queue.push(t[e]);OC.ie&&OC.ie_version<=11&&t.some((function(t){return"childList"==t.type&&t.removedNodes.length||"characterData"==t.type&&t.oldValue.length>t.target.nodeValue.length}))?n.flushSoon():n.flush()})),this.currentSelection=new XN,GN&&(this.onCharData=function(t){n.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),n.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.suppressingSelectionUpdates=!1};YN.prototype.flushSoon=function(){var t=this;this.flushingSoon<0&&(this.flushingSoon=window.setTimeout((function(){t.flushingSoon=-1,t.flush()}),20))},YN.prototype.forceFlush=function(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())},YN.prototype.start=function(){this.observer&&this.observer.observe(this.view.dom,UN),GN&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()},YN.prototype.stop=function(){var t=this;if(this.observer){var e=this.observer.takeRecords();if(e.length){for(var n=0;n<e.length;n++)this.queue.push(e[n]);window.setTimeout((function(){return t.flush()}),20)}this.observer.disconnect()}GN&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()},YN.prototype.connectSelection=function(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)},YN.prototype.disconnectSelection=function(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)},YN.prototype.suppressSelectionUpdates=function(){var t=this;this.suppressingSelectionUpdates=!0,setTimeout((function(){return t.suppressingSelectionUpdates=!1}),50)},YN.prototype.onSelectionChange=function(){if(hN(this.view)){if(this.suppressingSelectionUpdates)return QM(this.view);if(OC.ie&&OC.ie_version<=11&&!this.view.state.selection.empty){var t=this.view.root.getSelection();if(t.focusNode&&IC(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset))return this.flushSoon()}this.flush()}},YN.prototype.setCurSelection=function(){this.currentSelection.set(this.view.root.getSelection())},YN.prototype.ignoreSelectionChange=function(t){if(0==t.rangeCount)return!0;var e=t.getRangeAt(0).commonAncestorContainer,n=this.view.docView.nearestDesc(e);return n&&n.ignoreMutation({type:"selection",target:3==e.nodeType?e.parentNode:e})?(this.setCurSelection(),!0):void 0},YN.prototype.flush=function(){if(this.view.docView&&!(this.flushingSoon>-1)){var t=this.observer?this.observer.takeRecords():[];this.queue.length&&(t=this.queue.concat(t),this.queue.length=0);var e=this.view.root.getSelection(),n=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(e)&&pN(this.view)&&!this.ignoreSelectionChange(e),r=-1,o=-1,i=!1,s=[];if(this.view.editable)for(var a=0;a<t.length;a++){var c=this.registerMutation(t[a],s);c&&(r=r<0?c.from:Math.min(c.from,r),o=o<0?c.to:Math.max(c.to,o),c.typeOver&&(i=!0))}if(OC.gecko&&s.length>1){var h=s.filter((function(t){return"BR"==t.nodeName}));if(2==h.length){var p=h[0],l=h[1];p.parentNode&&p.parentNode.parentNode==l.parentNode?l.remove():p.remove()}}(r>-1||n)&&(r>-1&&(this.view.docView.markDirty(r,o),QN(this.view)),this.handleDOMChange(r,o,i,s),this.view.docView.dirty?this.view.updateState(this.view.state):this.currentSelection.eq(e)||QM(this.view),this.currentSelection.set(e))}},YN.prototype.registerMutation=function(t,e){if(e.indexOf(t.target)>-1)return null;var n=this.view.docView.nearestDesc(t.target);if("attributes"==t.type&&(n==this.view.docView||"contenteditable"==t.attributeName||"style"==t.attributeName&&!t.oldValue&&!t.target.getAttribute("style")))return null;if(!n||n.ignoreMutation(t))return null;if("childList"==t.type){for(var r=0;r<t.addedNodes.length;r++)e.push(t.addedNodes[r]);if(n.contentDOM&&n.contentDOM!=n.dom&&!n.contentDOM.contains(t.target))return{from:n.posBefore,to:n.posAfter};var o=t.previousSibling,i=t.nextSibling;if(OC.ie&&OC.ie_version<=11&&t.addedNodes.length)for(var s=0;s<t.addedNodes.length;s++){var a=t.addedNodes[s],c=a.previousSibling,h=a.nextSibling;(!c||Array.prototype.indexOf.call(t.addedNodes,c)<0)&&(o=c),(!h||Array.prototype.indexOf.call(t.addedNodes,h)<0)&&(i=h)}var p=o&&o.parentNode==t.target?AC(o)+1:0,l=n.localPosFromDOM(t.target,p,-1),u=i&&i.parentNode==t.target?AC(i):t.target.childNodes.length,f=n.localPosFromDOM(t.target,u,1);return{from:l,to:f}}return"attributes"==t.type?{from:n.posAtStart-n.border,to:n.posAtEnd+n.border}:{from:n.posAtStart,to:n.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}};var ZN=!1;function QN(t){ZN||(ZN=!0,"normal"==getComputedStyle(t.dom).whiteSpace&&console["warn"]("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."))}var tT={},eT={};function nT(t){t.shiftKey=!1,t.mouseDown=null,t.lastKeyCode=null,t.lastKeyCodeTime=0,t.lastClick={time:0,x:0,y:0,type:""},t.lastSelectionOrigin=null,t.lastSelectionTime=0,t.lastIOSEnter=0,t.lastIOSEnterFallbackTimeout=null,t.lastAndroidDelete=0,t.composing=!1,t.composingTimeout=null,t.compositionNodes=[],t.compositionEndedAt=-2e8,t.domObserver=new YN(t,(function(e,n,r,o){return EN(t,e,n,r,o)})),t.domObserver.start(),t.domChangeCount=0,t.eventHandlers=Object.create(null);var e=function(e){var n=tT[e];t.dom.addEventListener(e,t.eventHandlers[e]=function(e){!aT(t,e)||sT(t,e)||!t.editable&&e.type in eT||n(t,e)})};for(var n in tT)e(n);OC.safari&&t.dom.addEventListener("input",(function(){return null})),iT(t)}function rT(t,e){t.lastSelectionOrigin=e,t.lastSelectionTime=Date.now()}function oT(t){for(var e in t.domObserver.stop(),t.eventHandlers)t.dom.removeEventListener(e,t.eventHandlers[e]);clearTimeout(t.composingTimeout),clearTimeout(t.lastIOSEnterFallbackTimeout)}function iT(t){t.someProp("handleDOMEvents",(function(e){for(var n in e)t.eventHandlers[n]||t.dom.addEventListener(n,t.eventHandlers[n]=function(e){return sT(t,e)})}))}function sT(t,e){return t.someProp("handleDOMEvents",(function(n){var r=n[e.type];return!!r&&(r(t,e)||e.defaultPrevented)}))}function aT(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(var n=e.target;n!=t.dom;n=n.parentNode)if(!n||11==n.nodeType||n.pmViewDesc&&n.pmViewDesc.stopEvent(e))return!1;return!0}function cT(t,e){sT(t,e)||!tT[e.type]||!t.editable&&e.type in eT||tT[e.type](t,e)}function hT(t){return{left:t.clientX,top:t.clientY}}function pT(t,e){var n=e.x-t.clientX,r=e.y-t.clientY;return n*n+r*r<100}function lT(t,e,n,r,o){if(-1==r)return!1;for(var i=t.state.doc.resolve(r),s=function(r){if(t.someProp(e,(function(e){return r>i.depth?e(t,n,i.nodeAfter,i.before(r),o,!0):e(t,n,i.node(r),i.before(r),o,!1)})))return{v:!0}},a=i.depth+1;a>0;a--){var c=s(a);if(c)return c.v}return!1}function uT(t,e,n){t.focused||t.focus();var r=t.state.tr.setSelection(e);"pointer"==n&&r.setMeta("pointer",!0),t.dispatch(r)}function fT(t,e){if(-1==e)return!1;var n=t.state.doc.resolve(e),r=n.nodeAfter;return!!(r&&r.isAtom&&nC.isSelectable(r))&&(uT(t,new nC(n),"pointer"),!0)}function dT(t,e){if(-1==e)return!1;var n,r,o=t.state.selection;o instanceof nC&&(n=o.node);for(var i=t.state.doc.resolve(e),s=i.depth+1;s>0;s--){var a=s>i.depth?i.nodeAfter:i.node(s);if(nC.isSelectable(a)){r=n&&o.$from.depth>0&&s>=o.$from.depth&&i.before(o.$from.depth+1)==o.$from.pos?i.before(o.$from.depth):i.before(s);break}}return null!=r&&(uT(t,nC.create(t.state.doc,r),"pointer"),!0)}function mT(t,e,n,r,o){return lT(t,"handleClickOn",e,n,r)||t.someProp("handleClick",(function(n){return n(t,e,r)}))||(o?dT(t,n):fT(t,n))}function vT(t,e,n,r){return lT(t,"handleDoubleClickOn",e,n,r)||t.someProp("handleDoubleClick",(function(n){return n(t,e,r)}))}function gT(t,e,n,r){return lT(t,"handleTripleClickOn",e,n,r)||t.someProp("handleTripleClick",(function(n){return n(t,e,r)}))||yT(t,n)}function yT(t,e){var n=t.state.doc;if(-1==e)return!!n.inlineContent&&(uT(t,tC.create(n,0,n.content.size),"pointer"),!0);for(var r=n.resolve(e),o=r.depth+1;o>0;o--){var i=o>r.depth?r.nodeAfter:r.node(o),s=r.before(o);if(i.inlineContent)uT(t,tC.create(n,s+1,s+1+i.content.size),"pointer");else{if(!nC.isSelectable(i))continue;uT(t,nC.create(n,s),"pointer")}return!0}}function wT(t){return MT(t)}eT.keydown=function(t,e){if(t.shiftKey=16==e.keyCode||e.shiftKey,!kT(t,e))if(t.domObserver.forceFlush(),t.lastKeyCode=e.keyCode,t.lastKeyCodeTime=Date.now(),!OC.ios||13!=e.keyCode||e.ctrlKey||e.altKey||e.metaKey)t.someProp("handleKeyDown",(function(n){return n(t,e)}))||MN(t,e)?e.preventDefault():rT(t,"key");else{var n=Date.now();t.lastIOSEnter=n,t.lastIOSEnterFallbackTimeout=setTimeout((function(){t.lastIOSEnter==n&&(t.someProp("handleKeyDown",(function(e){return e(t,JC(13,"Enter"))})),t.lastIOSEnter=0)}),200)}},eT.keyup=function(t,e){16==e.keyCode&&(t.shiftKey=!1)},eT.keypress=function(t,e){if(!(kT(t,e)||!e.charCode||e.ctrlKey&&!e.altKey||OC.mac&&e.metaKey))if(t.someProp("handleKeyPress",(function(n){return n(t,e)})))e.preventDefault();else{var n=t.state.selection;if(!(n instanceof tC)||!n.$from.sameParent(n.$to)){var r=String.fromCharCode(e.charCode);t.someProp("handleTextInput",(function(e){return e(t,n.$from.pos,n.$to.pos,r)}))||t.dispatch(t.state.tr.insertText(r).scrollIntoView()),e.preventDefault()}}};var xT=OC.mac?"metaKey":"ctrlKey";tT.mousedown=function(t,e){t.shiftKey=e.shiftKey;var n=wT(t),r=Date.now(),o="singleClick";r-t.lastClick.time<500&&pT(e,t.lastClick)&&!e[xT]&&("singleClick"==t.lastClick.type?o="doubleClick":"doubleClick"==t.lastClick.type&&(o="tripleClick")),t.lastClick={time:r,x:e.clientX,y:e.clientY,type:o};var i=t.posAtCoords(hT(e));i&&("singleClick"==o?(t.mouseDown&&t.mouseDown.done(),t.mouseDown=new bT(t,i,e,n)):("doubleClick"==o?vT:gT)(t,i.pos,i.inside,e)?e.preventDefault():rT(t,"pointer"))};var bT=function(t,e,n,r){var o,i,s=this;if(this.view=t,this.startDoc=t.state.doc,this.pos=e,this.event=n,this.flushed=r,this.selectNode=n[xT],this.allowDefault=n.shiftKey,e.inside>-1)o=t.state.doc.nodeAt(e.inside),i=e.inside;else{var a=t.state.doc.resolve(e.pos);o=a.parent,i=a.depth?a.before():0}this.mightDrag=null;var c=r?null:n.target,h=c?t.docView.nearestDesc(c,!0):null;this.target=h?h.dom:null;var p=t.state,l=p.selection;(o.type.spec.draggable&&!1!==o.type.spec.selectable||l instanceof nC&&l.from<=i&&l.to>i)&&(this.mightDrag={node:o,pos:i,addAttr:this.target&&!this.target.draggable,setUneditable:this.target&&OC.gecko&&!this.target.hasAttribute("contentEditable")}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout((function(){s.view.mouseDown==s&&s.target.setAttribute("contentEditable","false")}),20),this.view.domObserver.start()),t.root.addEventListener("mouseup",this.up=this.up.bind(this)),t.root.addEventListener("mousemove",this.move=this.move.bind(this)),rT(t,"pointer")};function kT(t,e){return!!t.composing||!!(OC.safari&&Math.abs(e.timeStamp-t.compositionEndedAt)<500)&&(t.compositionEndedAt=-2e8,!0)}bT.prototype.done=function(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.view.mouseDown=null},bT.prototype.up=function(t){if(this.done(),this.view.dom.contains(3==t.target.nodeType?t.target.parentNode:t.target)){var e=this.pos;this.view.state.doc!=this.startDoc&&(e=this.view.posAtCoords(hT(t))),this.allowDefault||!e?rT(this.view,"pointer"):mT(this.view,e.pos,e.inside,t,this.selectNode)?t.preventDefault():this.flushed||OC.safari&&this.mightDrag&&!this.mightDrag.node.isAtom||OC.chrome&&!(this.view.state.selection instanceof tC)&&Math.min(Math.abs(e.pos-this.view.state.selection.from),Math.abs(e.pos-this.view.state.selection.to))<=2?(uT(this.view,YO.near(this.view.state.doc.resolve(e.pos)),"pointer"),t.preventDefault()):rT(this.view,"pointer")}},bT.prototype.move=function(t){!this.allowDefault&&(Math.abs(this.event.x-t.clientX)>4||Math.abs(this.event.y-t.clientY)>4)&&(this.allowDefault=!0),rT(this.view,"pointer"),0==t.buttons&&this.done()},tT.touchdown=function(t){wT(t),rT(t,"pointer")},tT.contextmenu=function(t){return wT(t)};var ST=OC.android?5e3:-1;function OT(t,e){clearTimeout(t.composingTimeout),e>-1&&(t.composingTimeout=setTimeout((function(){return MT(t)}),e))}function CT(t){t.composing=!1;while(t.compositionNodes.length>0)t.compositionNodes.pop().markParentsDirty()}function MT(t,e){if(t.domObserver.forceFlush(),CT(t),e||t.docView.dirty){var n=YM(t);return n&&!n.eq(t.state.selection)?t.dispatch(t.state.tr.setSelection(n)):t.updateState(t.state),!0}return!1}function NT(t,e){if(t.dom.parentNode){var n=t.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(e),n.style.cssText="position: fixed; left: -10000px; top: 10px";var r=getSelection(),o=document.createRange();o.selectNodeContents(e),t.dom.blur(),r.removeAllRanges(),r.addRange(o),setTimeout((function(){n.parentNode&&n.parentNode.removeChild(n),t.focus()}),50)}}eT.compositionstart=eT.compositionupdate=function(t){if(!t.composing){t.domObserver.flush();var e=t.state,n=e.selection.$from;if(e.selection.empty&&(e.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some((function(t){return!1===t.type.spec.inclusive}))))t.markCursor=t.state.storedMarks||n.marks(),MT(t,!0),t.markCursor=null;else if(MT(t),OC.gecko&&e.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length)for(var r=t.root.getSelection(),o=r.focusNode,i=r.focusOffset;o&&1==o.nodeType&&0!=i;){var s=i<0?o.lastChild:o.childNodes[i-1];if(!s)break;if(3==s.nodeType){r.collapse(s,s.nodeValue.length);break}o=s,i=-1}t.composing=!0}OT(t,ST)},eT.compositionend=function(t,e){t.composing&&(t.composing=!1,t.compositionEndedAt=e.timeStamp,OT(t,20))};var TT=OC.ie&&OC.ie_version<15||OC.ios&&OC.webkit_version<604;function ET(t){return 0==t.openStart&&0==t.openEnd&&1==t.content.childCount?t.content.firstChild:null}function AT(t,e){if(t.dom.parentNode){var n=t.shiftKey||t.state.selection.$from.parent.type.spec.code,r=t.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus(),setTimeout((function(){t.focus(),r.parentNode&&r.parentNode.removeChild(r),n?DT(t,r.value,null,e):DT(t,r.textContent,r.innerHTML,e)}),50)}}function DT(t,e,n,r){var o=FN(t,e,n,t.shiftKey,t.state.selection.$from);if(t.someProp("handlePaste",(function(e){return e(t,r,o||Yk.empty)})))return!0;if(!o)return!1;var i=ET(o),s=i?t.state.tr.replaceSelectionWith(i,t.shiftKey):t.state.tr.replaceSelection(o);return t.dispatch(s.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}tT.copy=eT.cut=function(t,e){var n=t.state.selection,r="cut"==e.type;if(!n.empty){var o=TT?null:e.clipboardData,i=n.content(),s=PN(t,i),a=s.dom,c=s.text;o?(e.preventDefault(),o.clearData(),o.setData("text/html",a.innerHTML),o.setData("text/plain",c)):NT(t,a),r&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))}},eT.paste=function(t,e){var n=TT?null:e.clipboardData;n&&DT(t,n.getData("text/plain"),n.getData("text/html"),e)?e.preventDefault():AT(t,e)};var RT=function(t,e){this.slice=t,this.move=e},zT=OC.mac?"altKey":"ctrlKey";for(var IT in tT.dragstart=function(t,e){var n=t.mouseDown;if(n&&n.done(),e.dataTransfer){var r=t.state.selection,o=r.empty?null:t.posAtCoords(hT(e));if(o&&o.pos>=r.from&&o.pos<=(r instanceof nC?r.to-1:r.to));else if(n&&n.mightDrag)t.dispatch(t.state.tr.setSelection(nC.create(t.state.doc,n.mightDrag.pos)));else if(e.target&&1==e.target.nodeType){var i=t.docView.nearestDesc(e.target,!0);if(!i||!i.node.type.spec.draggable||i==t.docView)return;t.dispatch(t.state.tr.setSelection(nC.create(t.state.doc,i.posBefore)))}var s=t.state.selection.content(),a=PN(t,s),c=a.dom,h=a.text;e.dataTransfer.clearData(),e.dataTransfer.setData(TT?"Text":"text/html",c.innerHTML),e.dataTransfer.effectAllowed="copyMove",TT||e.dataTransfer.setData("text/plain",h),t.dragging=new RT(s,!e[zT])}},tT.dragend=function(t){var e=t.dragging;window.setTimeout((function(){t.dragging==e&&(t.dragging=null)}),50)},eT.dragover=eT.dragenter=function(t,e){return e.preventDefault()},eT.drop=function(t,e){var n=t.dragging;if(t.dragging=null,e.dataTransfer){var r=t.posAtCoords(hT(e));if(r){var o=t.state.doc.resolve(r.pos);if(o){var i=n&&n.slice;i?t.someProp("transformPasted",(function(t){i=t(i)})):i=FN(t,e.dataTransfer.getData(TT?"Text":"text/plain"),TT?null:e.dataTransfer.getData("text/html"),!1,o);var s=n&&!e[zT];if(t.someProp("handleDrop",(function(n){return n(t,e,i||Yk.empty,s)})))e.preventDefault();else if(i){e.preventDefault();var a=i?IO(t.state.doc,o.pos,i):o.pos;null==a&&(a=o.pos);var c=t.state.tr;s&&c.deleteSelection();var h=c.mapping.map(a),p=0==i.openStart&&0==i.openEnd&&1==i.content.childCount,l=c.doc;if(p?c.replaceRangeWith(h,h,i.content.firstChild):c.replaceRange(h,h,i),!c.doc.eq(l)){var u=c.doc.resolve(h);if(p&&nC.isSelectable(i.content.firstChild)&&u.nodeAfter&&u.nodeAfter.sameMarkup(i.content.firstChild))c.setSelection(new nC(u));else{var f=c.mapping.map(a);c.mapping.maps[c.mapping.maps.length-1].forEach((function(t,e,n,r){return f=r})),c.setSelection(cN(t,u,c.doc.resolve(f)))}t.focus(),t.dispatch(c.setMeta("uiEvent","drop"))}}}}}},tT.focus=function(t){t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout((function(){t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.root.getSelection())&&QM(t)}),20))},tT.blur=function(t){t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),t.domObserver.currentSelection.set({}),t.focused=!1)},tT.beforeinput=function(t,e){if(OC.chrome&&OC.android&&"deleteContentBackward"==e.inputType){var n=t.domChangeCount;setTimeout((function(){if(t.domChangeCount==n&&(t.dom.blur(),t.focus(),!t.someProp("handleKeyDown",(function(e){return e(t,JC(8,"Backspace"))})))){var e=t.state.selection,r=e.$cursor;r&&r.pos>0&&t.dispatch(t.state.tr.delete(r.pos-1,r.pos).scrollIntoView())}}),50)}},eT)tT[IT]=eT[IT];function PT(t,e){if(t==e)return!0;for(var n in t)if(t[n]!==e[n])return!1;for(var r in e)if(!(r in t))return!1;return!0}var FT=function(t,e){this.spec=e||LT,this.side=this.spec.side||0,this.toDOM=t};FT.prototype.map=function(t,e,n,r){var o=t.mapResult(e.from+r,this.side<0?-1:1),i=o.pos,s=o.deleted;return s?null:new _T(i-n,i-n,this)},FT.prototype.valid=function(){return!0},FT.prototype.eq=function(t){return this==t||t instanceof FT&&(this.spec.key&&this.spec.key==t.spec.key||this.toDOM==t.toDOM&&PT(this.spec,t.spec))};var BT=function(t,e){this.spec=e||LT,this.attrs=t};BT.prototype.map=function(t,e,n,r){var o=t.map(e.from+r,this.spec.inclusiveStart?-1:1)-n,i=t.map(e.to+r,this.spec.inclusiveEnd?1:-1)-n;return o>=i?null:new _T(o,i,this)},BT.prototype.valid=function(t,e){return e.from<e.to},BT.prototype.eq=function(t){return this==t||t instanceof BT&&PT(this.attrs,t.attrs)&&PT(this.spec,t.spec)},BT.is=function(t){return t.type instanceof BT};var $T=function(t,e){this.spec=e||LT,this.attrs=t};$T.prototype.map=function(t,e,n,r){var o=t.mapResult(e.from+r,1);if(o.deleted)return null;var i=t.mapResult(e.to+r,-1);return i.deleted||i.pos<=o.pos?null:new _T(o.pos-n,i.pos-n,this)},$T.prototype.valid=function(t,e){var n=t.content.findIndex(e.from),r=n.index,o=n.offset;return o==e.from&&o+t.child(r).nodeSize==e.to},$T.prototype.eq=function(t){return this==t||t instanceof $T&&PT(this.attrs,t.attrs)&&PT(this.spec,t.spec)};var _T=function(t,e,n){this.from=t,this.to=e,this.type=n},jT={spec:{configurable:!0},inline:{configurable:!0}};_T.prototype.copy=function(t,e){return new _T(t,e,this.type)},_T.prototype.eq=function(t,e){return void 0===e&&(e=0),this.type.eq(t.type)&&this.from+e==t.from&&this.to+e==t.to},_T.prototype.map=function(t,e,n){return this.type.map(t,this,e,n)},_T.widget=function(t,e,n){return new _T(t,t,new FT(e,n))},_T.inline=function(t,e,n,r){return new _T(t,e,new BT(n,r))},_T.node=function(t,e,n,r){return new _T(t,e,new $T(n,r))},jT.spec.get=function(){return this.type.spec},jT.inline.get=function(){return this.type instanceof BT},Object.defineProperties(_T.prototype,jT);var JT=[],LT={},VT=function(t,e){this.local=t&&t.length?t:JT,this.children=e&&e.length?e:JT};VT.create=function(t,e){return e.length?YT(e,t,0,LT):qT},VT.prototype.find=function(t,e,n){var r=[];return this.findInner(null==t?0:t,null==e?1e9:e,r,0,n),r},VT.prototype.findInner=function(t,e,n,r,o){for(var i=0;i<this.local.length;i++){var s=this.local[i];s.from<=e&&s.to>=t&&(!o||o(s.spec))&&n.push(s.copy(s.from+r,s.to+r))}for(var a=0;a<this.children.length;a+=3)if(this.children[a]<e&&this.children[a+1]>t){var c=this.children[a]+1;this.children[a+2].findInner(t-c,e-c,n,r+c,o)}},VT.prototype.map=function(t,e,n){return this==qT||0==t.maps.length?this:this.mapInner(t,e,0,0,n||LT)},VT.prototype.mapInner=function(t,e,n,r,o){for(var i,s=0;s<this.local.length;s++){var a=this.local[s].map(t,n,r);a&&a.type.valid(e,a)?(i||(i=[])).push(a):o.onRemove&&o.onRemove(this.local[s].spec)}return this.children.length?HT(this.children,i,t,e,n,r,o):i?new VT(i.sort(ZT)):qT},VT.prototype.add=function(t,e){return e.length?this==qT?VT.create(t,e):this.addInner(t,e,0):this},VT.prototype.addInner=function(t,e,n){var r,o=this,i=0;t.forEach((function(t,s){var a,c=s+n;if(a=GT(e,t,c)){r||(r=o.children.slice());while(i<r.length&&r[i]<s)i+=3;r[i]==s?r[i+2]=r[i+2].addInner(t,a,c+1):r.splice(i,0,s,s+t.nodeSize,YT(a,t,c+1,LT)),i+=3}}));for(var s=KT(i?XT(e):e,-n),a=0;a<s.length;a++)s[a].type.valid(t,s[a])||s.splice(a--,1);return new VT(s.length?this.local.concat(s).sort(ZT):this.local,r||this.children)},VT.prototype.remove=function(t){return 0==t.length||this==qT?this:this.removeInner(t,0)},VT.prototype.removeInner=function(t,e){for(var n=this.children,r=this.local,o=0;o<n.length;o+=3){for(var i=void 0,s=n[o]+e,a=n[o+1]+e,c=0,h=void 0;c<t.length;c++)(h=t[c])&&h.from>s&&h.to<a&&(t[c]=null,(i||(i=[])).push(h));if(i){n==this.children&&(n=this.children.slice());var p=n[o+2].removeInner(i,s+1);p!=qT?n[o+2]=p:(n.splice(o,3),o-=3)}}if(r.length)for(var l=0,u=void 0;l<t.length;l++)if(u=t[l])for(var f=0;f<r.length;f++)r[f].eq(u,e)&&(r==this.local&&(r=this.local.slice()),r.splice(f--,1));return n==this.children&&r==this.local?this:r.length||n.length?new VT(r,n):qT},VT.prototype.forChild=function(t,e){if(this==qT)return this;if(e.isLeaf)return VT.empty;for(var n,r,o=0;o<this.children.length;o+=3)if(this.children[o]>=t){this.children[o]==t&&(n=this.children[o+2]);break}for(var i=t+1,s=i+e.content.size,a=0;a<this.local.length;a++){var c=this.local[a];if(c.from<s&&c.to>i&&c.type instanceof BT){var h=Math.max(i,c.from)-i,p=Math.min(s,c.to)-i;h<p&&(r||(r=[])).push(c.copy(h,p))}}if(r){var l=new VT(r.sort(ZT));return n?new WT([l,n]):l}return n||qT},VT.prototype.eq=function(t){if(this==t)return!0;if(!(t instanceof VT)||this.local.length!=t.local.length||this.children.length!=t.children.length)return!1;for(var e=0;e<this.local.length;e++)if(!this.local[e].eq(t.local[e]))return!1;for(var n=0;n<this.children.length;n+=3)if(this.children[n]!=t.children[n]||this.children[n+1]!=t.children[n+1]||!this.children[n+2].eq(t.children[n+2]))return!1;return!0},VT.prototype.locals=function(t){return QT(this.localsInner(t))},VT.prototype.localsInner=function(t){if(this==qT)return JT;if(t.inlineContent||!this.local.some(BT.is))return this.local;for(var e=[],n=0;n<this.local.length;n++)this.local[n].type instanceof BT||e.push(this.local[n]);return e};var qT=new VT;VT.empty=qT,VT.removeOverlap=QT;var WT=function(t){this.members=t};function HT(t,e,n,r,o,i,s){for(var a=t.slice(),c=function(t,e,n,r){for(var s=0;s<a.length;s+=3){var c=a[s+1],h=void 0;-1==c||t>c+i||(e>=a[s]+i?a[s+1]=-1:n>=o&&(h=r-n-(e-t))&&(a[s]+=h,a[s+1]+=h))}},h=0;h<n.maps.length;h++)n.maps[h].forEach(c);for(var p=!1,l=0;l<a.length;l+=3)if(-1==a[l+1]){var u=n.map(t[l]+i),f=u-o;if(f<0||f>=r.content.size){p=!0;continue}var d=n.map(t[l+1]+i,-1),m=d-o,v=r.content.findIndex(f),g=v.index,y=v.offset,w=r.maybeChild(g);if(w&&y==f&&y+w.nodeSize==m){var x=a[l+2].mapInner(n,w,u+1,t[l]+i+1,s);x!=qT?(a[l]=f,a[l+1]=m,a[l+2]=x):(a[l+1]=-2,p=!0)}else p=!0}if(p){var b=UT(a,t,e||[],n,o,i,s),k=YT(b,r,0,s);e=k.local;for(var S=0;S<a.length;S+=3)a[S+1]<0&&(a.splice(S,3),S-=3);for(var O=0,C=0;O<k.children.length;O+=3){var M=k.children[O];while(C<a.length&&a[C]<M)C+=3;a.splice(C,0,k.children[O],k.children[O+1],k.children[O+2])}}return new VT(e&&e.sort(ZT),a)}function KT(t,e){if(!e||!t.length)return t;for(var n=[],r=0;r<t.length;r++){var o=t[r];n.push(new _T(o.from+e,o.to+e,o.type))}return n}function UT(t,e,n,r,o,i,s){function a(t,e){for(var i=0;i<t.local.length;i++){var c=t.local[i].map(r,o,e);c?n.push(c):s.onRemove&&s.onRemove(t.local[i].spec)}for(var h=0;h<t.children.length;h+=3)a(t.children[h+2],t.children[h]+e+1)}for(var c=0;c<t.length;c+=3)-1==t[c+1]&&a(t[c+2],e[c]+i+1);return n}function GT(t,e,n){if(e.isLeaf)return null;for(var r=n+e.nodeSize,o=null,i=0,s=void 0;i<t.length;i++)(s=t[i])&&s.from>n&&s.to<r&&((o||(o=[])).push(s),t[i]=null);return o}function XT(t){for(var e=[],n=0;n<t.length;n++)null!=t[n]&&e.push(t[n]);return e}function YT(t,e,n,r){var o=[],i=!1;e.forEach((function(e,s){var a=GT(t,e,s+n);if(a){i=!0;var c=YT(a,e,n+s+1,r);c!=qT&&o.push(s,s+e.nodeSize,c)}}));for(var s=KT(i?XT(t):t,-n).sort(ZT),a=0;a<s.length;a++)s[a].type.valid(e,s[a])||(r.onRemove&&r.onRemove(s[a].spec),s.splice(a--,1));return s.length||o.length?new VT(s,o):qT}function ZT(t,e){return t.from-e.from||t.to-e.to}function QT(t){for(var e=t,n=0;n<e.length-1;n++){var r=e[n];if(r.from!=r.to)for(var o=n+1;o<e.length;o++){var i=e[o];if(i.from!=r.from){i.from<r.to&&(e==t&&(e=t.slice()),e[n]=r.copy(r.from,i.from),tE(e,o,r.copy(i.from,r.to)));break}i.to!=r.to&&(e==t&&(e=t.slice()),e[o]=i.copy(i.from,r.to),tE(e,o+1,i.copy(r.to,i.to)))}}return e}function tE(t,e,n){while(e<t.length&&ZT(n,t[e])>0)e++;t.splice(e,0,n)}function eE(t){var e=[];return t.someProp("decorations",(function(n){var r=n(t.state);r&&r!=qT&&e.push(r)})),t.cursorWrapper&&e.push(VT.create(t.state.doc,[t.cursorWrapper.deco])),WT.from(e)}WT.prototype.forChild=function(t,e){if(e.isLeaf)return VT.empty;for(var n=[],r=0;r<this.members.length;r++){var o=this.members[r].forChild(t,e);o!=qT&&(o instanceof WT?n=n.concat(o.members):n.push(o))}return WT.from(n)},WT.prototype.eq=function(t){if(!(t instanceof WT)||t.members.length!=this.members.length)return!1;for(var e=0;e<this.members.length;e++)if(!this.members[e].eq(t.members[e]))return!1;return!0},WT.prototype.locals=function(t){for(var e,n=!0,r=0;r<this.members.length;r++){var o=this.members[r].localsInner(t);if(o.length)if(e){n&&(e=e.slice(),n=!1);for(var i=0;i<o.length;i++)e.push(o[i])}else e=o}return e?QT(n?e:e.sort(ZT)):JT},WT.from=function(t){switch(t.length){case 0:return qT;case 1:return t[0];default:return new WT(t)}};var nE=function(t,e){this._props=e,this.state=e.state,this.dispatch=this.dispatch.bind(this),this._root=null,this.focused=!1,this.trackWrites=null,this.dom=t&&t.mount||document.createElement("div"),t&&(t.appendChild?t.appendChild(this.dom):t.apply?t(this.dom):t.mount&&(this.mounted=!0)),this.editable=sE(this),this.markCursor=null,this.cursorWrapper=null,iE(this),this.nodeViews=cE(this),this.docView=AM(this.state.doc,oE(this),eE(this),this.dom,this),this.lastSelectedViewDesc=null,this.dragging=null,nT(this),this.pluginViews=[],this.updatePluginViews()},rE={props:{configurable:!0},root:{configurable:!0}};function oE(t){var e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(t.editable),t.someProp("attributes",(function(n){if("function"==typeof n&&(n=n(t.state)),n)for(var r in n)"class"==r?e.class+=" "+n[r]:e[r]||"contenteditable"==r||"nodeName"==r||(e[r]=String(n[r]))})),[_T.node(0,t.state.doc.content.size,e)]}function iE(t){if(t.markCursor){var e=document.createElement("img");e.setAttribute("mark-placeholder","true"),t.cursorWrapper={dom:e,deco:_T.widget(t.state.selection.head,e,{raw:!0,marks:t.markCursor})}}else t.cursorWrapper=null}function sE(t){return!t.someProp("editable",(function(e){return!1===e(t.state)}))}function aE(t,e){var n=Math.min(t.$anchor.sharedDepth(t.head),e.$anchor.sharedDepth(e.head));return t.$anchor.start(n)!=e.$anchor.start(n)}function cE(t){var e={};return t.someProp("nodeViews",(function(t){for(var n in t)Object.prototype.hasOwnProperty.call(e,n)||(e[n]=t[n])})),e}function hE(t,e){var n=0,r=0;for(var o in t){if(t[o]!=e[o])return!0;n++}for(var i in e)r++;return n!=r}function pE(t,e,n){for(var r=0;;r++){if(r==t.childCount||r==e.childCount)return t.childCount==e.childCount?null:n;var o=t.child(r),i=e.child(r);if(o!=i){if(!o.sameMarkup(i))return n;if(o.isText&&o.text!=i.text){for(var s=0;o.text[s]==i.text[s];s++)n++;return n}if(o.content.size||i.content.size){var a=pE(o.content,i.content,n+1);if(null!=a)return a}n+=o.nodeSize}else n+=o.nodeSize}}function lE(t,e,n,r){for(var o=t.childCount,i=e.childCount;;){if(0==o||0==i)return o==i?null:{a:n,b:r};var s=t.child(--o),a=e.child(--i),c=s.nodeSize;if(s!=a){if(!s.sameMarkup(a))return{a:n,b:r};if(s.isText&&s.text!=a.text){var h=0,p=Math.min(s.text.length,a.text.length);while(h<p&&s.text[s.text.length-h-1]==a.text[a.text.length-h-1])h++,n--,r--;return{a:n,b:r}}if(s.content.size||a.content.size){var l=lE(s.content,a.content,n-1,r-1);if(l)return l}n-=c,r-=c}else n-=c,r-=c}}rE.props.get=function(){if(this._props.state!=this.state){var t=this._props;for(var e in this._props={},t)this._props[e]=t[e];this._props.state=this.state}return this._props},nE.prototype.update=function(t){t.handleDOMEvents!=this._props.handleDOMEvents&&iT(this),this._props=t,this.updateStateInner(t.state,!0)},nE.prototype.setProps=function(t){var e={};for(var n in this._props)e[n]=this._props[n];for(var r in e.state=this.state,t)e[r]=t[r];this.update(e)},nE.prototype.updateState=function(t){this.updateStateInner(t,this.state.plugins!=t.plugins)},nE.prototype.updateStateInner=function(t,e){var n=this,r=this.state,o=!1,i=!1;if(t.storedMarks&&this.composing&&(CT(this),i=!0),this.state=t,e){var s=cE(this);hE(s,this.nodeViews)&&(this.nodeViews=s,o=!0),iT(this)}this.editable=sE(this),iE(this);var a=eE(this),c=oE(this),h=e?"reset":t.scrollToSelection>r.scrollToSelection?"to selection":"preserve",p=o||!this.docView.matchesNode(t.doc,c,a);!p&&t.selection.eq(r.selection)||(i=!0);var l="preserve"==h&&i&&null==this.dom.style.overflowAnchor&&HC(this);if(i){this.domObserver.stop();var u=p&&(OC.ie||OC.chrome)&&!this.composing&&!r.selection.empty&&!t.selection.empty&&aE(r.selection,t.selection);if(p){var f=OC.chrome?this.trackWrites=this.root.getSelection().focusNode:null;!o&&this.docView.update(t.doc,c,a,this)||(this.docView.updateOuterDeco([]),this.docView.destroy(),this.docView=AM(t.doc,c,a,this.dom,this)),f&&!this.trackWrites&&(u=!0)}u||!(this.mouseDown&&this.domObserver.currentSelection.eq(this.root.getSelection())&&lN(this))?QM(this,u):(sN(this,t.selection),this.domObserver.setCurSelection()),this.domObserver.start()}if(this.updatePluginViews(r),"reset"==h)this.dom.scrollTop=0;else if("to selection"==h){var d=this.root.getSelection().focusNode;this.someProp("handleScrollToSelection",(function(t){return t(n)}))||(t.selection instanceof nC?WC(this,this.docView.domAfterPos(t.selection.from).getBoundingClientRect(),d):WC(this,this.coordsAtPos(t.selection.head,1),d))}else l&&UC(l)},nE.prototype.destroyPluginViews=function(){var t;while(t=this.pluginViews.pop())t.destroy&&t.destroy()},nE.prototype.updatePluginViews=function(t){if(t&&t.plugins==this.state.plugins)for(var e=0;e<this.pluginViews.length;e++){var n=this.pluginViews[e];n.update&&n.update(this,t)}else{this.destroyPluginViews();for(var r=0;r<this.state.plugins.length;r++){var o=this.state.plugins[r];o.spec.view&&this.pluginViews.push(o.spec.view(this))}}},nE.prototype.someProp=function(t,e){var n,r=this._props&&this._props[t];if(null!=r&&(n=e?e(r):r))return n;var o=this.state.plugins;if(o)for(var i=0;i<o.length;i++){var s=o[i].props[t];if(null!=s&&(n=e?e(s):s))return n}},nE.prototype.hasFocus=function(){return this.root.activeElement==this.dom},nE.prototype.focus=function(){this.domObserver.stop(),this.editable&&YC(this.dom),QM(this),this.domObserver.start()},rE.root.get=function(){var t=this._root;if(null==t)for(var e=this.dom.parentNode;e;e=e.parentNode)if(9==e.nodeType||11==e.nodeType&&e.host)return e.getSelection||(Object.getPrototypeOf(e).getSelection=function(){return document.getSelection()}),this._root=e;return t||document},nE.prototype.posAtCoords=function(t){return iM(this,t)},nE.prototype.coordsAtPos=function(t,e){return void 0===e&&(e=1),cM(this,t,e)},nE.prototype.domAtPos=function(t,e){return void 0===e&&(e=0),this.docView.domFromPos(t,e)},nE.prototype.nodeDOM=function(t){var e=this.docView.descAt(t);return e?e.nodeDOM:null},nE.prototype.posAtDOM=function(t,e,n){void 0===n&&(n=-1);var r=this.docView.posFromDOM(t,e,n);if(null==r)throw new RangeError("DOM position not inside the editor");return r},nE.prototype.endOfTextblock=function(t,e){return yM(this,e||this.state,t)},nE.prototype.destroy=function(){this.docView&&(oT(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],eE(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null)},nE.prototype.dispatchEvent=function(t){return cT(this,t)},nE.prototype.dispatch=function(t){var e=this._props.dispatchTransaction;e?e.call(this,t):this.updateState(this.state.apply(t))},Object.defineProperties(nE.prototype,rE);var uE=function(t,e){if(this.content=t,this.size=e||0,null==e)for(var n=0;n<t.length;n++)this.size+=t[n].nodeSize},fE={firstChild:{configurable:!0},lastChild:{configurable:!0},childCount:{configurable:!0}};uE.prototype.nodesBetween=function(t,e,n,r,o){void 0===r&&(r=0);for(var i=0,s=0;s<e;i++){var a=this.content[i],c=s+a.nodeSize;if(c>t&&!1!==n(a,r+s,o,i)&&a.content.size){var h=s+1;a.nodesBetween(Math.max(0,t-h),Math.min(a.content.size,e-h),n,r+h)}s=c}},uE.prototype.descendants=function(t){this.nodesBetween(0,this.size,t)},uE.prototype.textBetween=function(t,e,n,r){var o="",i=!0;return this.nodesBetween(t,e,(function(s,a){s.isText?(o+=s.text.slice(Math.max(t,a)-a,e-a),i=!n):s.isLeaf&&r?(o+=r,i=!n):!i&&s.isBlock&&(o+=n,i=!0)}),0),o},uE.prototype.append=function(t){if(!t.size)return this;if(!this.size)return t;var e=this.lastChild,n=t.firstChild,r=this.content.slice(),o=0;for(e.isText&&e.sameMarkup(n)&&(r[r.length-1]=e.withText(e.text+n.text),o=1);o<t.content.length;o++)r.push(t.content[o]);return new uE(r,this.size+t.size)},uE.prototype.cut=function(t,e){if(null==e&&(e=this.size),0==t&&e==this.size)return this;var n=[],r=0;if(e>t)for(var o=0,i=0;i<e;o++){var s=this.content[o],a=i+s.nodeSize;a>t&&((i<t||a>e)&&(s=s.isText?s.cut(Math.max(0,t-i),Math.min(s.text.length,e-i)):s.cut(Math.max(0,t-i-1),Math.min(s.content.size,e-i-1))),n.push(s),r+=s.nodeSize),i=a}return new uE(n,r)},uE.prototype.cutByIndex=function(t,e){return t==e?uE.empty:0==t&&e==this.content.length?this:new uE(this.content.slice(t,e))},uE.prototype.replaceChild=function(t,e){var n=this.content[t];if(n==e)return this;var r=this.content.slice(),o=this.size+e.nodeSize-n.nodeSize;return r[t]=e,new uE(r,o)},uE.prototype.addToStart=function(t){return new uE([t].concat(this.content),this.size+t.nodeSize)},uE.prototype.addToEnd=function(t){return new uE(this.content.concat(t),this.size+t.nodeSize)},uE.prototype.eq=function(t){if(this.content.length!=t.content.length)return!1;for(var e=0;e<this.content.length;e++)if(!this.content[e].eq(t.content[e]))return!1;return!0},fE.firstChild.get=function(){return this.content.length?this.content[0]:null},fE.lastChild.get=function(){return this.content.length?this.content[this.content.length-1]:null},fE.childCount.get=function(){return this.content.length},uE.prototype.child=function(t){var e=this.content[t];if(!e)throw new RangeError("Index "+t+" out of range for "+this);return e},uE.prototype.maybeChild=function(t){return this.content[t]},uE.prototype.forEach=function(t){for(var e=0,n=0;e<this.content.length;e++){var r=this.content[e];t(r,n,e),n+=r.nodeSize}},uE.prototype.findDiffStart=function(t,e){return void 0===e&&(e=0),pE(this,t,e)},uE.prototype.findDiffEnd=function(t,e,n){return void 0===e&&(e=this.size),void 0===n&&(n=t.size),lE(this,t,e,n)},uE.prototype.findIndex=function(t,e){if(void 0===e&&(e=-1),0==t)return mE(0,t);if(t==this.size)return mE(this.content.length,t);if(t>this.size||t<0)throw new RangeError("Position "+t+" outside of fragment ("+this+")");for(var n=0,r=0;;n++){var o=this.child(n),i=r+o.nodeSize;if(i>=t)return i==t||e>0?mE(n+1,i):mE(n,r);r=i}},uE.prototype.toString=function(){return"<"+this.toStringInner()+">"},uE.prototype.toStringInner=function(){return this.content.join(", ")},uE.prototype.toJSON=function(){return this.content.length?this.content.map((function(t){return t.toJSON()})):null},uE.fromJSON=function(t,e){if(!e)return uE.empty;if(!Array.isArray(e))throw new RangeError("Invalid input for Fragment.fromJSON");return new uE(e.map(t.nodeFromJSON))},uE.fromArray=function(t){if(!t.length)return uE.empty;for(var e,n=0,r=0;r<t.length;r++){var o=t[r];n+=o.nodeSize,r&&o.isText&&t[r-1].sameMarkup(o)?(e||(e=t.slice(0,r)),e[e.length-1]=o.withText(e[e.length-1].text+o.text)):e&&e.push(o)}return new uE(e||t,n)},uE.from=function(t){if(!t)return uE.empty;if(t instanceof uE)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new uE([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))},Object.defineProperties(uE.prototype,fE);var dE={index:0,offset:0};function mE(t,e){return dE.index=t,dE.offset=e,dE}function vE(t,e){if(t===e)return!0;if(!t||"object"!=typeof t||!e||"object"!=typeof e)return!1;var n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(var r=0;r<t.length;r++)if(!vE(t[r],e[r]))return!1}else{for(var o in t)if(!(o in e)||!vE(t[o],e[o]))return!1;for(var i in e)if(!(i in t))return!1}return!0}uE.empty=new uE([],0);var gE=function(t,e){this.type=t,this.attrs=e};function yE(t){var e=Error.call(this,t);return e.__proto__=yE.prototype,e}gE.prototype.addToSet=function(t){for(var e,n=!1,r=0;r<t.length;r++){var o=t[r];if(this.eq(o))return t;if(this.type.excludes(o.type))e||(e=t.slice(0,r));else{if(o.type.excludes(this.type))return t;!n&&o.type.rank>this.type.rank&&(e||(e=t.slice(0,r)),e.push(this),n=!0),e&&e.push(o)}}return e||(e=t.slice()),n||e.push(this),e},gE.prototype.removeFromSet=function(t){for(var e=0;e<t.length;e++)if(this.eq(t[e]))return t.slice(0,e).concat(t.slice(e+1));return t},gE.prototype.isInSet=function(t){for(var e=0;e<t.length;e++)if(this.eq(t[e]))return!0;return!1},gE.prototype.eq=function(t){return this==t||this.type==t.type&&vE(this.attrs,t.attrs)},gE.prototype.toJSON=function(){var t={type:this.type.name};for(var e in this.attrs){t.attrs=this.attrs;break}return t},gE.fromJSON=function(t,e){if(!e)throw new RangeError("Invalid input for Mark.fromJSON");var n=t.marks[e.type];if(!n)throw new RangeError("There is no mark type "+e.type+" in this schema");return n.create(e.attrs)},gE.sameSet=function(t,e){if(t==e)return!0;if(t.length!=e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].eq(e[n]))return!1;return!0},gE.setFrom=function(t){if(!t||0==t.length)return gE.none;if(t instanceof gE)return[t];var e=t.slice();return e.sort((function(t,e){return t.type.rank-e.type.rank})),e},gE.none=[],yE.prototype=Object.create(Error.prototype),yE.prototype.constructor=yE,yE.prototype.name="ReplaceError";var wE=function(t,e,n){this.content=t,this.openStart=e,this.openEnd=n},xE={size:{configurable:!0}};function bE(t,e,n){var r=t.findIndex(e),o=r.index,i=r.offset,s=t.maybeChild(o),a=t.findIndex(n),c=a.index,h=a.offset;if(i==e||s.isText){if(h!=n&&!t.child(c).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(o!=c)throw new RangeError("Removing non-flat range");return t.replaceChild(o,s.copy(bE(s.content,e-i-1,n-i-1)))}function kE(t,e,n,r){var o=t.findIndex(e),i=o.index,s=o.offset,a=t.maybeChild(i);if(s==e||a.isText)return r&&!r.canReplace(i,i,n)?null:t.cut(0,e).append(n).append(t.cut(e));var c=kE(a.content,e-s-1,n);return c&&t.replaceChild(i,a.copy(c))}function SE(t,e,n){if(n.openStart>t.depth)throw new yE("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new yE("Inconsistent open depths");return OE(t,e,n,0)}function OE(t,e,n,r){var o=t.index(r),i=t.node(r);if(o==e.index(r)&&r<t.depth-n.openStart){var s=OE(t,e,n,r+1);return i.copy(i.content.replaceChild(o,s))}if(n.content.size){if(n.openStart||n.openEnd||t.depth!=r||e.depth!=r){var a=RE(n,t),c=a.start,h=a.end;return EE(i,AE(t,c,h,e,r))}var p=t.parent,l=p.content;return EE(p,l.cut(0,t.parentOffset).append(n.content).append(l.cut(e.parentOffset)))}return EE(i,DE(t,e,r))}function CE(t,e){if(!e.type.compatibleContent(t.type))throw new yE("Cannot join "+e.type.name+" onto "+t.type.name)}function ME(t,e,n){var r=t.node(n);return CE(r,e.node(n)),r}function NE(t,e){var n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function TE(t,e,n,r){var o=(e||t).node(n),i=0,s=e?e.index(n):o.childCount;t&&(i=t.index(n),t.depth>n?i++:t.textOffset&&(NE(t.nodeAfter,r),i++));for(var a=i;a<s;a++)NE(o.child(a),r);e&&e.depth==n&&e.textOffset&&NE(e.nodeBefore,r)}function EE(t,e){if(!t.type.validContent(e))throw new yE("Invalid content for node "+t.type.name);return t.copy(e)}function AE(t,e,n,r,o){var i=t.depth>o&&ME(t,e,o+1),s=r.depth>o&&ME(n,r,o+1),a=[];return TE(null,t,o,a),i&&s&&e.index(o)==n.index(o)?(CE(i,s),NE(EE(i,AE(t,e,n,r,o+1)),a)):(i&&NE(EE(i,DE(t,e,o+1)),a),TE(e,n,o,a),s&&NE(EE(s,DE(n,r,o+1)),a)),TE(r,null,o,a),new uE(a)}function DE(t,e,n){var r=[];if(TE(null,t,n,r),t.depth>n){var o=ME(t,e,n+1);NE(EE(o,DE(t,e,n+1)),r)}return TE(e,null,n,r),new uE(r)}function RE(t,e){for(var n=e.depth-t.openStart,r=e.node(n),o=r.copy(t.content),i=n-1;i>=0;i--)o=e.node(i).copy(uE.from(o));return{start:o.resolveNoCache(t.openStart+n),end:o.resolveNoCache(o.content.size-t.openEnd-n)}}xE.size.get=function(){return this.content.size-this.openStart-this.openEnd},wE.prototype.insertAt=function(t,e){var n=kE(this.content,t+this.openStart,e,null);return n&&new wE(n,this.openStart,this.openEnd)},wE.prototype.removeBetween=function(t,e){return new wE(bE(this.content,t+this.openStart,e+this.openStart),this.openStart,this.openEnd)},wE.prototype.eq=function(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd},wE.prototype.toString=function(){return this.content+"("+this.openStart+","+this.openEnd+")"},wE.prototype.toJSON=function(){if(!this.content.size)return null;var t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t},wE.fromJSON=function(t,e){if(!e)return wE.empty;var n=e.openStart||0,r=e.openEnd||0;if("number"!=typeof n||"number"!=typeof r)throw new RangeError("Invalid input for Slice.fromJSON");return new wE(uE.fromJSON(t,e.content),n,r)},wE.maxOpen=function(t,e){void 0===e&&(e=!0);for(var n=0,r=0,o=t.firstChild;o&&!o.isLeaf&&(e||!o.type.spec.isolating);o=o.firstChild)n++;for(var i=t.lastChild;i&&!i.isLeaf&&(e||!i.type.spec.isolating);i=i.lastChild)r++;return new wE(t,n,r)},Object.defineProperties(wE.prototype,xE),wE.empty=new wE(uE.empty,0,0);var zE=function(t,e,n){this.pos=t,this.path=e,this.depth=e.length/3-1,this.parentOffset=n},IE={parent:{configurable:!0},doc:{configurable:!0},textOffset:{configurable:!0},nodeAfter:{configurable:!0},nodeBefore:{configurable:!0}};zE.prototype.resolveDepth=function(t){return null==t?this.depth:t<0?this.depth+t:t},IE.parent.get=function(){return this.node(this.depth)},IE.doc.get=function(){return this.node(0)},zE.prototype.node=function(t){return this.path[3*this.resolveDepth(t)]},zE.prototype.index=function(t){return this.path[3*this.resolveDepth(t)+1]},zE.prototype.indexAfter=function(t){return t=this.resolveDepth(t),this.index(t)+(t!=this.depth||this.textOffset?1:0)},zE.prototype.start=function(t){return t=this.resolveDepth(t),0==t?0:this.path[3*t-1]+1},zE.prototype.end=function(t){return t=this.resolveDepth(t),this.start(t)+this.node(t).content.size},zE.prototype.before=function(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position before the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]},zE.prototype.after=function(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position after the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]+this.path[3*t].nodeSize},IE.textOffset.get=function(){return this.pos-this.path[this.path.length-1]},IE.nodeAfter.get=function(){var t=this.parent,e=this.index(this.depth);if(e==t.childCount)return null;var n=this.pos-this.path[this.path.length-1],r=t.child(e);return n?t.child(e).cut(n):r},IE.nodeBefore.get=function(){var t=this.index(this.depth),e=this.pos-this.path[this.path.length-1];return e?this.parent.child(t).cut(0,e):0==t?null:this.parent.child(t-1)},zE.prototype.posAtIndex=function(t,e){e=this.resolveDepth(e);for(var n=this.path[3*e],r=0==e?0:this.path[3*e-1]+1,o=0;o<t;o++)r+=n.child(o).nodeSize;return r},zE.prototype.marks=function(){var t=this.parent,e=this.index();if(0==t.content.size)return gE.none;if(this.textOffset)return t.child(e).marks;var n=t.maybeChild(e-1),r=t.maybeChild(e);if(!n){var o=n;n=r,r=o}for(var i=n.marks,s=0;s<i.length;s++)!1!==i[s].type.spec.inclusive||r&&i[s].isInSet(r.marks)||(i=i[s--].removeFromSet(i));return i},zE.prototype.marksAcross=function(t){var e=this.parent.maybeChild(this.index());if(!e||!e.isInline)return null;for(var n=e.marks,r=t.parent.maybeChild(t.index()),o=0;o<n.length;o++)!1!==n[o].type.spec.inclusive||r&&n[o].isInSet(r.marks)||(n=n[o--].removeFromSet(n));return n},zE.prototype.sharedDepth=function(t){for(var e=this.depth;e>0;e--)if(this.start(e)<=t&&this.end(e)>=t)return e;return 0},zE.prototype.blockRange=function(t,e){if(void 0===t&&(t=this),t.pos<this.pos)return t.blockRange(this);for(var n=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);n>=0;n--)if(t.pos<=this.end(n)&&(!e||e(this.node(n))))return new $E(this,t,n)},zE.prototype.sameParent=function(t){return this.pos-this.parentOffset==t.pos-t.parentOffset},zE.prototype.max=function(t){return t.pos>this.pos?t:this},zE.prototype.min=function(t){return t.pos<this.pos?t:this},zE.prototype.toString=function(){for(var t="",e=1;e<=this.depth;e++)t+=(t?"/":"")+this.node(e).type.name+"_"+this.index(e-1);return t+":"+this.parentOffset},zE.resolve=function(t,e){if(!(e>=0&&e<=t.content.size))throw new RangeError("Position "+e+" out of range");for(var n=[],r=0,o=e,i=t;;){var s=i.content.findIndex(o),a=s.index,c=s.offset,h=o-c;if(n.push(i,a,r+c),!h)break;if(i=i.child(a),i.isText)break;o=h-1,r+=c+1}return new zE(e,n,o)},zE.resolveCached=function(t,e){for(var n=0;n<PE.length;n++){var r=PE[n];if(r.pos==e&&r.doc==t)return r}var o=PE[FE]=zE.resolve(t,e);return FE=(FE+1)%BE,o},Object.defineProperties(zE.prototype,IE);var PE=[],FE=0,BE=12,$E=function(t,e,n){this.$from=t,this.$to=e,this.depth=n},_E={start:{configurable:!0},end:{configurable:!0},parent:{configurable:!0},startIndex:{configurable:!0},endIndex:{configurable:!0}};_E.start.get=function(){return this.$from.before(this.depth+1)},_E.end.get=function(){return this.$to.after(this.depth+1)},_E.parent.get=function(){return this.$from.node(this.depth)},_E.startIndex.get=function(){return this.$from.index(this.depth)},_E.endIndex.get=function(){return this.$to.indexAfter(this.depth)},Object.defineProperties($E.prototype,_E);var jE=Object.create(null),JE=function(t,e,n,r){this.type=t,this.attrs=e,this.content=n||uE.empty,this.marks=r||gE.none},LE={nodeSize:{configurable:!0},childCount:{configurable:!0},textContent:{configurable:!0},firstChild:{configurable:!0},lastChild:{configurable:!0},isBlock:{configurable:!0},isTextblock:{configurable:!0},inlineContent:{configurable:!0},isInline:{configurable:!0},isText:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};LE.nodeSize.get=function(){return this.isLeaf?1:2+this.content.size},LE.childCount.get=function(){return this.content.childCount},JE.prototype.child=function(t){return this.content.child(t)},JE.prototype.maybeChild=function(t){return this.content.maybeChild(t)},JE.prototype.forEach=function(t){this.content.forEach(t)},JE.prototype.nodesBetween=function(t,e,n,r){void 0===r&&(r=0),this.content.nodesBetween(t,e,n,r,this)},JE.prototype.descendants=function(t){this.nodesBetween(0,this.content.size,t)},LE.textContent.get=function(){return this.textBetween(0,this.content.size,"")},JE.prototype.textBetween=function(t,e,n,r){return this.content.textBetween(t,e,n,r)},LE.firstChild.get=function(){return this.content.firstChild},LE.lastChild.get=function(){return this.content.lastChild},JE.prototype.eq=function(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)},JE.prototype.sameMarkup=function(t){return this.hasMarkup(t.type,t.attrs,t.marks)},JE.prototype.hasMarkup=function(t,e,n){return this.type==t&&vE(this.attrs,e||t.defaultAttrs||jE)&&gE.sameSet(this.marks,n||gE.none)},JE.prototype.copy=function(t){return void 0===t&&(t=null),t==this.content?this:new this.constructor(this.type,this.attrs,t,this.marks)},JE.prototype.mark=function(t){return t==this.marks?this:new this.constructor(this.type,this.attrs,this.content,t)},JE.prototype.cut=function(t,e){return 0==t&&e==this.content.size?this:this.copy(this.content.cut(t,e))},JE.prototype.slice=function(t,e,n){if(void 0===e&&(e=this.content.size),void 0===n&&(n=!1),t==e)return wE.empty;var r=this.resolve(t),o=this.resolve(e),i=n?0:r.sharedDepth(e),s=r.start(i),a=r.node(i),c=a.content.cut(r.pos-s,o.pos-s);return new wE(c,r.depth-i,o.depth-i)},JE.prototype.replace=function(t,e,n){return SE(this.resolve(t),this.resolve(e),n)},JE.prototype.nodeAt=function(t){for(var e=this;;){var n=e.content.findIndex(t),r=n.index,o=n.offset;if(e=e.maybeChild(r),!e)return null;if(o==t||e.isText)return e;t-=o+1}},JE.prototype.childAfter=function(t){var e=this.content.findIndex(t),n=e.index,r=e.offset;return{node:this.content.maybeChild(n),index:n,offset:r}},JE.prototype.childBefore=function(t){if(0==t)return{node:null,index:0,offset:0};var e=this.content.findIndex(t),n=e.index,r=e.offset;if(r<t)return{node:this.content.child(n),index:n,offset:r};var o=this.content.child(n-1);return{node:o,index:n-1,offset:r-o.nodeSize}},JE.prototype.resolve=function(t){return zE.resolveCached(this,t)},JE.prototype.resolveNoCache=function(t){return zE.resolve(this,t)},JE.prototype.rangeHasMark=function(t,e,n){var r=!1;return e>t&&this.nodesBetween(t,e,(function(t){return n.isInSet(t.marks)&&(r=!0),!r})),r},LE.isBlock.get=function(){return this.type.isBlock},LE.isTextblock.get=function(){return this.type.isTextblock},LE.inlineContent.get=function(){return this.type.inlineContent},LE.isInline.get=function(){return this.type.isInline},LE.isText.get=function(){return this.type.isText},LE.isLeaf.get=function(){return this.type.isLeaf},LE.isAtom.get=function(){return this.type.isAtom},JE.prototype.toString=function(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);var t=this.type.name;return this.content.size&&(t+="("+this.content.toStringInner()+")"),qE(this.marks,t)},JE.prototype.contentMatchAt=function(t){var e=this.type.contentMatch.matchFragment(this.content,0,t);if(!e)throw new Error("Called contentMatchAt on a node with invalid content");return e},JE.prototype.canReplace=function(t,e,n,r,o){void 0===n&&(n=uE.empty),void 0===r&&(r=0),void 0===o&&(o=n.childCount);var i=this.contentMatchAt(t).matchFragment(n,r,o),s=i&&i.matchFragment(this.content,e);if(!s||!s.validEnd)return!1;for(var a=r;a<o;a++)if(!this.type.allowsMarks(n.child(a).marks))return!1;return!0},JE.prototype.canReplaceWith=function(t,e,n,r){if(r&&!this.type.allowsMarks(r))return!1;var o=this.contentMatchAt(t).matchType(n),i=o&&o.matchFragment(this.content,e);return!!i&&i.validEnd},JE.prototype.canAppend=function(t){return t.content.size?this.canReplace(this.childCount,this.childCount,t.content):this.type.compatibleContent(t.type)},JE.prototype.check=function(){if(!this.type.validContent(this.content))throw new RangeError("Invalid content for node "+this.type.name+": "+this.content.toString().slice(0,50));for(var t=gE.none,e=0;e<this.marks.length;e++)t=this.marks[e].addToSet(t);if(!gE.sameSet(t,this.marks))throw new RangeError("Invalid collection of marks for node "+this.type.name+": "+this.marks.map((function(t){return t.type.name})));this.content.forEach((function(t){return t.check()}))},JE.prototype.toJSON=function(){var t={type:this.type.name};for(var e in this.attrs){t.attrs=this.attrs;break}return this.content.size&&(t.content=this.content.toJSON()),this.marks.length&&(t.marks=this.marks.map((function(t){return t.toJSON()}))),t},JE.fromJSON=function(t,e){if(!e)throw new RangeError("Invalid input for Node.fromJSON");var n=null;if(e.marks){if(!Array.isArray(e.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=e.marks.map(t.markFromJSON)}if("text"==e.type){if("string"!=typeof e.text)throw new RangeError("Invalid text node in JSON");return t.text(e.text,n)}var r=uE.fromJSON(t,e.content);return t.nodeType(e.type).create(e.attrs,r,n)},Object.defineProperties(JE.prototype,LE);var VE=function(t){function e(e,n,r,o){if(t.call(this,e,n,null,o),!r)throw new RangeError("Empty text nodes are not allowed");this.text=r}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={textContent:{configurable:!0},nodeSize:{configurable:!0}};return e.prototype.toString=function(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):qE(this.marks,JSON.stringify(this.text))},n.textContent.get=function(){return this.text},e.prototype.textBetween=function(t,e){return this.text.slice(t,e)},n.nodeSize.get=function(){return this.text.length},e.prototype.mark=function(t){return t==this.marks?this:new e(this.type,this.attrs,this.text,t)},e.prototype.withText=function(t){return t==this.text?this:new e(this.type,this.attrs,t,this.marks)},e.prototype.cut=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=this.text.length),0==t&&e==this.text.length?this:this.withText(this.text.slice(t,e))},e.prototype.eq=function(t){return this.sameMarkup(t)&&this.text==t.text},e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.text=this.text,e},Object.defineProperties(e.prototype,n),e}(JE);function qE(t,e){for(var n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}var WE=function(t){this.validEnd=t,this.next=[],this.wrapCache=[]},HE={inlineContent:{configurable:!0},defaultType:{configurable:!0},edgeCount:{configurable:!0}};WE.parse=function(t,e){var n=new KE(t,e);if(null==n.next)return WE.empty;var r=GE(n);n.next&&n.err("Unexpected trailing text");var o=iA(nA(r));return sA(o,n),o},WE.prototype.matchType=function(t){for(var e=0;e<this.next.length;e+=2)if(this.next[e]==t)return this.next[e+1];return null},WE.prototype.matchFragment=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=t.childCount);for(var r=this,o=e;r&&o<n;o++)r=r.matchType(t.child(o).type);return r},HE.inlineContent.get=function(){var t=this.next[0];return!!t&&t.isInline},HE.defaultType.get=function(){for(var t=0;t<this.next.length;t+=2){var e=this.next[t];if(!e.isText&&!e.hasRequiredAttrs())return e}},WE.prototype.compatible=function(t){for(var e=0;e<this.next.length;e+=2)for(var n=0;n<t.next.length;n+=2)if(this.next[e]==t.next[n])return!0;return!1},WE.prototype.fillBefore=function(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=0);var r=[this];function o(i,s){var a=i.matchFragment(t,n);if(a&&(!e||a.validEnd))return uE.from(s.map((function(t){return t.createAndFill()})));for(var c=0;c<i.next.length;c+=2){var h=i.next[c],p=i.next[c+1];if(!h.isText&&!h.hasRequiredAttrs()&&-1==r.indexOf(p)){r.push(p);var l=o(p,s.concat(h));if(l)return l}}}return o(this,[])},WE.prototype.findWrapping=function(t){for(var e=0;e<this.wrapCache.length;e+=2)if(this.wrapCache[e]==t)return this.wrapCache[e+1];var n=this.computeWrapping(t);return this.wrapCache.push(t,n),n},WE.prototype.computeWrapping=function(t){var e=Object.create(null),n=[{match:this,type:null,via:null}];while(n.length){var r=n.shift(),o=r.match;if(o.matchType(t)){for(var i=[],s=r;s.type;s=s.via)i.push(s.type);return i.reverse()}for(var a=0;a<o.next.length;a+=2){var c=o.next[a];c.isLeaf||c.hasRequiredAttrs()||c.name in e||r.type&&!o.next[a+1].validEnd||(n.push({match:c.contentMatch,type:c,via:r}),e[c.name]=!0)}}},HE.edgeCount.get=function(){return this.next.length>>1},WE.prototype.edge=function(t){var e=t<<1;if(e>=this.next.length)throw new RangeError("There's no "+t+"th edge in this content match");return{type:this.next[e],next:this.next[e+1]}},WE.prototype.toString=function(){var t=[];function e(n){t.push(n);for(var r=1;r<n.next.length;r+=2)-1==t.indexOf(n.next[r])&&e(n.next[r])}return e(this),t.map((function(e,n){for(var r=n+(e.validEnd?"*":" ")+" ",o=0;o<e.next.length;o+=2)r+=(o?", ":"")+e.next[o].name+"->"+t.indexOf(e.next[o+1]);return r})).join("\n")},Object.defineProperties(WE.prototype,HE),WE.empty=new WE(!0);var KE=function(t,e){this.string=t,this.nodeTypes=e,this.inline=null,this.pos=0,this.tokens=t.split(/\s*(?=\b|\W|$)/),""==this.tokens[this.tokens.length-1]&&this.tokens.pop(),""==this.tokens[0]&&this.tokens.shift()},UE={next:{configurable:!0}};function GE(t){var e=[];do{e.push(XE(t))}while(t.eat("|"));return 1==e.length?e[0]:{type:"choice",exprs:e}}function XE(t){var e=[];do{e.push(YE(t))}while(t.next&&")"!=t.next&&"|"!=t.next);return 1==e.length?e[0]:{type:"seq",exprs:e}}function YE(t){for(var e=eA(t);;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else{if(!t.eat("{"))break;e=QE(t,e)}return e}function ZE(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");var e=Number(t.next);return t.pos++,e}function QE(t,e){var n=ZE(t),r=n;return t.eat(",")&&(r="}"!=t.next?ZE(t):-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:e}}function tA(t,e){var n=t.nodeTypes,r=n[e];if(r)return[r];var o=[];for(var i in n){var s=n[i];s.groups.indexOf(e)>-1&&o.push(s)}return 0==o.length&&t.err("No node type or group '"+e+"' found"),o}function eA(t){if(t.eat("(")){var e=GE(t);return t.eat(")")||t.err("Missing closing paren"),e}if(!/\W/.test(t.next)){var n=tA(t,t.next).map((function(e){return null==t.inline?t.inline=e.isInline:t.inline!=e.isInline&&t.err("Mixing inline and block content"),{type:"name",value:e}}));return t.pos++,1==n.length?n[0]:{type:"choice",exprs:n}}t.err("Unexpected token '"+t.next+"'")}function nA(t){var e=[[]];return o(i(t,0),n()),e;function n(){return e.push([])-1}function r(t,n,r){var o={term:r,to:n};return e[t].push(o),o}function o(t,e){t.forEach((function(t){return t.to=e}))}function i(t,e){if("choice"==t.type)return t.exprs.reduce((function(t,n){return t.concat(i(n,e))}),[]);if("seq"==t.type)for(var s=0;;s++){var a=i(t.exprs[s],e);if(s==t.exprs.length-1)return a;o(a,e=n())}else{if("star"==t.type){var c=n();return r(e,c),o(i(t.expr,c),c),[r(c)]}if("plus"==t.type){var h=n();return o(i(t.expr,e),h),o(i(t.expr,h),h),[r(h)]}if("opt"==t.type)return[r(e)].concat(i(t.expr,e));if("range"==t.type){for(var p=e,l=0;l<t.min;l++){var u=n();o(i(t.expr,p),u),p=u}if(-1==t.max)o(i(t.expr,p),p);else for(var f=t.min;f<t.max;f++){var d=n();r(p,d),o(i(t.expr,p),d),p=d}return[r(p)]}if("name"==t.type)return[r(e,null,t.value)]}}}function rA(t,e){return e-t}function oA(t,e){var n=[];return r(e),n.sort(rA);function r(e){var o=t[e];if(1==o.length&&!o[0].term)return r(o[0].to);n.push(e);for(var i=0;i<o.length;i++){var s=o[i],a=s.term,c=s.to;a||-1!=n.indexOf(c)||r(c)}}}function iA(t){var e=Object.create(null);return n(oA(t,0));function n(r){var o=[];r.forEach((function(e){t[e].forEach((function(e){var n=e.term,r=e.to;if(n){var i=o.indexOf(n),s=i>-1&&o[i+1];oA(t,r).forEach((function(t){s||o.push(n,s=[]),-1==s.indexOf(t)&&s.push(t)}))}}))}));for(var i=e[r.join(",")]=new WE(r.indexOf(t.length-1)>-1),s=0;s<o.length;s+=2){var a=o[s+1].sort(rA);i.next.push(o[s],e[a.join(",")]||n(a))}return i}}function sA(t,e){for(var n=0,r=[t];n<r.length;n++){for(var o=r[n],i=!o.validEnd,s=[],a=0;a<o.next.length;a+=2){var c=o.next[a],h=o.next[a+1];s.push(c.name),!i||c.isText||c.hasRequiredAttrs()||(i=!1),-1==r.indexOf(h)&&r.push(h)}i&&e.err("Only non-generatable nodes ("+s.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function aA(t){var e=Object.create(null);for(var n in t){var r=t[n];if(!r.hasDefault)return null;e[n]=r.default}return e}function cA(t,e){var n=Object.create(null);for(var r in t){var o=e&&e[r];if(void 0===o){var i=t[r];if(!i.hasDefault)throw new RangeError("No value supplied for attribute "+r);o=i.default}n[r]=o}return n}function hA(t){var e=Object.create(null);if(t)for(var n in t)e[n]=new uA(t[n]);return e}UE.next.get=function(){return this.tokens[this.pos]},KE.prototype.eat=function(t){return this.next==t&&(this.pos++||!0)},KE.prototype.err=function(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")},Object.defineProperties(KE.prototype,UE);var pA=function(t,e,n){this.name=t,this.schema=e,this.spec=n,this.groups=n.group?n.group.split(" "):[],this.attrs=hA(n.attrs),this.defaultAttrs=aA(this.attrs),this.contentMatch=null,this.markSet=null,this.inlineContent=null,this.isBlock=!(n.inline||"text"==t),this.isText="text"==t},lA={isInline:{configurable:!0},isTextblock:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};lA.isInline.get=function(){return!this.isBlock},lA.isTextblock.get=function(){return this.isBlock&&this.inlineContent},lA.isLeaf.get=function(){return this.contentMatch==WE.empty},lA.isAtom.get=function(){return this.isLeaf||this.spec.atom},pA.prototype.hasRequiredAttrs=function(){for(var t in this.attrs)if(this.attrs[t].isRequired)return!0;return!1},pA.prototype.compatibleContent=function(t){return this==t||this.contentMatch.compatible(t.contentMatch)},pA.prototype.computeAttrs=function(t){return!t&&this.defaultAttrs?this.defaultAttrs:cA(this.attrs,t)},pA.prototype.create=function(t,e,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new JE(this,this.computeAttrs(t),uE.from(e),gE.setFrom(n))},pA.prototype.createChecked=function(t,e,n){if(e=uE.from(e),!this.validContent(e))throw new RangeError("Invalid content for node "+this.name);return new JE(this,this.computeAttrs(t),e,gE.setFrom(n))},pA.prototype.createAndFill=function(t,e,n){if(t=this.computeAttrs(t),e=uE.from(e),e.size){var r=this.contentMatch.fillBefore(e);if(!r)return null;e=r.append(e)}var o=this.contentMatch.matchFragment(e).fillBefore(uE.empty,!0);return o?new JE(this,t,e.append(o),gE.setFrom(n)):null},pA.prototype.validContent=function(t){var e=this.contentMatch.matchFragment(t);if(!e||!e.validEnd)return!1;for(var n=0;n<t.childCount;n++)if(!this.allowsMarks(t.child(n).marks))return!1;return!0},pA.prototype.allowsMarkType=function(t){return null==this.markSet||this.markSet.indexOf(t)>-1},pA.prototype.allowsMarks=function(t){if(null==this.markSet)return!0;for(var e=0;e<t.length;e++)if(!this.allowsMarkType(t[e].type))return!1;return!0},pA.prototype.allowedMarks=function(t){if(null==this.markSet)return t;for(var e,n=0;n<t.length;n++)this.allowsMarkType(t[n].type)?e&&e.push(t[n]):e||(e=t.slice(0,n));return e?e.length?e:gE.empty:t},pA.compile=function(t,e){var n=Object.create(null);t.forEach((function(t,r){return n[t]=new pA(t,e,r)}));var r=e.spec.topNode||"doc";if(!n[r])throw new RangeError("Schema is missing its top node type ('"+r+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(var o in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n},Object.defineProperties(pA.prototype,lA);var uA=function(t){this.hasDefault=Object.prototype.hasOwnProperty.call(t,"default"),this.default=t.default},fA={isRequired:{configurable:!0}};fA.isRequired.get=function(){return!this.hasDefault},Object.defineProperties(uA.prototype,fA);var dA=function(t,e,n,r){this.name=t,this.schema=n,this.spec=r,this.attrs=hA(r.attrs),this.rank=e,this.excluded=null;var o=aA(this.attrs);this.instance=o&&new gE(this,o)};dA.prototype.create=function(t){return!t&&this.instance?this.instance:new gE(this,cA(this.attrs,t))},dA.compile=function(t,e){var n=Object.create(null),r=0;return t.forEach((function(t,o){return n[t]=new dA(t,r++,e,o)})),n},dA.prototype.removeFromSet=function(t){for(var e=0;e<t.length;e++)t[e].type==this&&(t=t.slice(0,e).concat(t.slice(e+1)),e--);return t},dA.prototype.isInSet=function(t){for(var e=0;e<t.length;e++)if(t[e].type==this)return t[e]},dA.prototype.excludes=function(t){return this.excluded.indexOf(t)>-1};var mA=function(t){for(var e in this.spec={},t)this.spec[e]=t[e];this.spec.nodes=c.from(t.nodes),this.spec.marks=c.from(t.marks),this.nodes=pA.compile(this.spec.nodes,this),this.marks=dA.compile(this.spec.marks,this);var n=Object.create(null);for(var r in this.nodes){if(r in this.marks)throw new RangeError(r+" can not be both a node and a mark");var o=this.nodes[r],i=o.spec.content||"",s=o.spec.marks;o.contentMatch=n[i]||(n[i]=WE.parse(i,this.nodes)),o.inlineContent=o.contentMatch.inlineContent,o.markSet="_"==s?null:s?vA(this,s.split(" ")):""!=s&&o.inlineContent?null:[]}for(var a in this.marks){var h=this.marks[a],p=h.spec.excludes;h.excluded=null==p?[h]:""==p?[]:vA(this,p.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached=Object.create(null),this.cached.wrappings=Object.create(null)};function vA(t,e){for(var n=[],r=0;r<e.length;r++){var o=e[r],i=t.marks[o],s=i;if(i)n.push(i);else for(var a in t.marks){var c=t.marks[a];("_"==o||c.spec.group&&c.spec.group.split(" ").indexOf(o)>-1)&&n.push(s=c)}if(!s)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return n}mA.prototype.node=function(t,e,n,r){if("string"==typeof t)t=this.nodeType(t);else{if(!(t instanceof pA))throw new RangeError("Invalid node type: "+t);if(t.schema!=this)throw new RangeError("Node type from different schema used ("+t.name+")")}return t.createChecked(e,n,r)},mA.prototype.text=function(t,e){var n=this.nodes.text;return new VE(n,n.defaultAttrs,t,gE.setFrom(e))},mA.prototype.mark=function(t,e){return"string"==typeof t&&(t=this.marks[t]),t.create(e)},mA.prototype.nodeFromJSON=function(t){return JE.fromJSON(this,t)},mA.prototype.markFromJSON=function(t){return gE.fromJSON(this,t)},mA.prototype.nodeType=function(t){var e=this.nodes[t];if(!e)throw new RangeError("Unknown node type: "+t);return e};var gA=function(t,e){var n=this;this.schema=t,this.rules=e,this.tags=[],this.styles=[],e.forEach((function(t){t.tag?n.tags.push(t):t.style&&n.styles.push(t)})),this.normalizeLists=!this.tags.some((function(e){if(!/^(ul|ol)\b/.test(e.tag)||!e.node)return!1;var n=t.nodes[e.node];return n.contentMatch.matchType(n)}))};gA.prototype.parse=function(t,e){void 0===e&&(e={});var n=new MA(this,e,!1);return n.addAll(t,null,e.from,e.to),n.finish()},gA.prototype.parseSlice=function(t,e){void 0===e&&(e={});var n=new MA(this,e,!0);return n.addAll(t,null,e.from,e.to),wE.maxOpen(n.finish())},gA.prototype.matchTag=function(t,e,n){for(var r=n?this.tags.indexOf(n)+1:0;r<this.tags.length;r++){var o=this.tags[r];if(EA(t,o.tag)&&(void 0===o.namespace||t.namespaceURI==o.namespace)&&(!o.context||e.matchesContext(o.context))){if(o.getAttrs){var i=o.getAttrs(t);if(!1===i)continue;o.attrs=i}return o}}},gA.prototype.matchStyle=function(t,e,n,r){for(var o=r?this.styles.indexOf(r)+1:0;o<this.styles.length;o++){var i=this.styles[o];if(!(0!=i.style.indexOf(t)||i.context&&!n.matchesContext(i.context)||i.style.length>t.length&&(61!=i.style.charCodeAt(t.length)||i.style.slice(t.length+1)!=e))){if(i.getAttrs){var s=i.getAttrs(e);if(!1===s)continue;i.attrs=s}return i}}},gA.schemaRules=function(t){var e=[];function n(t){for(var n=null==t.priority?50:t.priority,r=0;r<e.length;r++){var o=e[r],i=null==o.priority?50:o.priority;if(i<n)break}e.splice(r,0,t)}var r=function(e){var r=t.marks[e].spec.parseDOM;r&&r.forEach((function(t){n(t=DA(t)),t.mark=e}))};for(var o in t.marks)r(o);var i=function(e){var r=t.nodes[s].spec.parseDOM;r&&r.forEach((function(t){n(t=DA(t)),t.node=s}))};for(var s in t.nodes)i();return e},gA.fromSchema=function(t){return t.cached.domParser||(t.cached.domParser=new gA(t,gA.schemaRules(t)))};var yA={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},wA={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},xA={ol:!0,ul:!0},bA=1,kA=2,SA=4;function OA(t){return(t?bA:0)|("full"===t?kA:0)}var CA=function(t,e,n,r,o,i,s){this.type=t,this.attrs=e,this.solid=o,this.match=i||(s&SA?null:t.contentMatch),this.options=s,this.content=[],this.marks=n,this.activeMarks=gE.none,this.pendingMarks=r,this.stashMarks=[]};CA.prototype.findWrapping=function(t){if(!this.match){if(!this.type)return[];var e=this.type.contentMatch.fillBefore(uE.from(t));if(!e){var n,r=this.type.contentMatch;return(n=r.findWrapping(t.type))?(this.match=r,n):null}this.match=this.type.contentMatch.matchFragment(e)}return this.match.findWrapping(t.type)},CA.prototype.finish=function(t){if(!(this.options&bA)){var e,n=this.content[this.content.length-1];n&&n.isText&&(e=/[ \t\r\n\u000c]+$/.exec(n.text))&&(n.text.length==e[0].length?this.content.pop():this.content[this.content.length-1]=n.withText(n.text.slice(0,n.text.length-e[0].length)))}var r=uE.from(this.content);return!t&&this.match&&(r=r.append(this.match.fillBefore(uE.empty,!0))),this.type?this.type.create(this.attrs,r,this.marks):r},CA.prototype.popFromStashMark=function(t){for(var e=this.stashMarks.length-1;e>=0;e--)if(t.eq(this.stashMarks[e]))return this.stashMarks.splice(e,1)[0]},CA.prototype.applyPending=function(t){for(var e=0,n=this.pendingMarks;e<n.length;e++){var r=n[e];(this.type?this.type.allowsMarkType(r.type):RA(r.type,t))&&!r.isInSet(this.activeMarks)&&(this.activeMarks=r.addToSet(this.activeMarks),this.pendingMarks=r.removeFromSet(this.pendingMarks))}};var MA=function(t,e,n){this.parser=t,this.options=e,this.isOpen=n;var r,o=e.topNode,i=OA(e.preserveWhitespace)|(n?SA:0);r=o?new CA(o.type,o.attrs,gE.none,gE.none,!0,e.topMatch||o.type.contentMatch,i):new CA(n?null:t.schema.topNodeType,null,gE.none,gE.none,!0,null,i),this.nodes=[r],this.open=0,this.find=e.findPositions,this.needsBlock=!1},NA={top:{configurable:!0},currentPos:{configurable:!0}};function TA(t){for(var e=t.firstChild,n=null;e;e=e.nextSibling){var r=1==e.nodeType?e.nodeName.toLowerCase():null;r&&xA.hasOwnProperty(r)&&n?(n.appendChild(e),e=n):"li"==r?n=e:r&&(n=null)}}function EA(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function AA(t){var e,n=/\s*([\w-]+)\s*:\s*([^;]+)/g,r=[];while(e=n.exec(t))r.push(e[1],e[2].trim());return r}function DA(t){var e={};for(var n in t)e[n]=t[n];return e}function RA(t,e){var n=e.schema.nodes,r=function(r){var o=n[r];if(o.allowsMarkType(t)){var i=[],s=function(t){i.push(t);for(var n=0;n<t.edgeCount;n++){var r=t.edge(n),o=r.type,a=r.next;if(o==e)return!0;if(i.indexOf(a)<0&&s(a))return!0}};return s(o.contentMatch)?{v:!0}:void 0}};for(var o in n){var i=r(o);if(i)return i.v}}function zA(t,e){for(var n=0;n<e.length;n++)if(t.eq(e[n]))return e[n]}NA.top.get=function(){return this.nodes[this.open]},MA.prototype.addDOM=function(t){if(3==t.nodeType)this.addTextNode(t);else if(1==t.nodeType){var e=t.getAttribute("style"),n=e?this.readStyles(AA(e)):null,r=this.top;if(null!=n)for(var o=0;o<n.length;o++)this.addPendingMark(n[o]);if(this.addElement(t),null!=n)for(var i=0;i<n.length;i++)this.removePendingMark(n[i],r)}},MA.prototype.addTextNode=function(t){var e=t.nodeValue,n=this.top;if(n.options&kA||(n.type?n.type.inlineContent:n.content.length&&n.content[0].isInline)||/[^ \t\r\n\u000c]/.test(e)){if(n.options&bA)e=n.options&kA?e.replace(/\r\n?/g,"\n"):e.replace(/\r?\n|\r/g," ");else if(e=e.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(e)&&this.open==this.nodes.length-1){var r=n.content[n.content.length-1],o=t.previousSibling;(!r||o&&"BR"==o.nodeName||r.isText&&/[ \t\r\n\u000c]$/.test(r.text))&&(e=e.slice(1))}e&&this.insertNode(this.parser.schema.text(e)),this.findInText(t)}else this.findInside(t)},MA.prototype.addElement=function(t,e){var n,r=t.nodeName.toLowerCase();xA.hasOwnProperty(r)&&this.parser.normalizeLists&&TA(t);var o=this.options.ruleFromNode&&this.options.ruleFromNode(t)||(n=this.parser.matchTag(t,this,e));if(o?o.ignore:wA.hasOwnProperty(r))this.findInside(t),this.ignoreFallback(t);else if(!o||o.skip||o.closeParent){o&&o.closeParent?this.open=Math.max(0,this.open-1):o&&o.skip.nodeType&&(t=o.skip);var i,s=this.top,a=this.needsBlock;if(yA.hasOwnProperty(r))i=!0,s.type||(this.needsBlock=!0);else if(!t.firstChild)return void this.leafFallback(t);this.addAll(t),i&&this.sync(s),this.needsBlock=a}else this.addElementByRule(t,o,!1===o.consuming?n:null)},MA.prototype.leafFallback=function(t){"BR"==t.nodeName&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(t.ownerDocument.createTextNode("\n"))},MA.prototype.ignoreFallback=function(t){"BR"!=t.nodeName||this.top.type&&this.top.type.inlineContent||this.findPlace(this.parser.schema.text("-"))},MA.prototype.readStyles=function(t){var e=gE.none;t:for(var n=0;n<t.length;n+=2)for(var r=null;;){var o=this.parser.matchStyle(t[n],t[n+1],this,r);if(!o)continue t;if(o.ignore)return null;if(e=this.parser.schema.marks[o.mark].create(o.attrs).addToSet(e),!1!==o.consuming)break;r=o}return e},MA.prototype.addElementByRule=function(t,e,n){var r,o,i,s,a=this;e.node?(o=this.parser.schema.nodes[e.node],o.isLeaf?this.insertNode(o.create(e.attrs))||this.leafFallback(t):r=this.enter(o,e.attrs,e.preserveWhitespace)):(i=this.parser.schema.marks[e.mark],s=i.create(e.attrs),this.addPendingMark(s));var c=this.top;if(o&&o.isLeaf)this.findInside(t);else if(n)this.addElement(t,n);else if(e.getContent)this.findInside(t),e.getContent(t,this.parser.schema).forEach((function(t){return a.insertNode(t)}));else{var h=e.contentElement;"string"==typeof h?h=t.querySelector(h):"function"==typeof h&&(h=h(t)),h||(h=t),this.findAround(t,h,!0),this.addAll(h,r)}r&&(this.sync(c),this.open--),s&&this.removePendingMark(s,c)},MA.prototype.addAll=function(t,e,n,r){for(var o=n||0,i=n?t.childNodes[n]:t.firstChild,s=null==r?null:t.childNodes[r];i!=s;i=i.nextSibling,++o)this.findAtPoint(t,o),this.addDOM(i),e&&yA.hasOwnProperty(i.nodeName.toLowerCase())&&this.sync(e);this.findAtPoint(t,o)},MA.prototype.findPlace=function(t){for(var e,n,r=this.open;r>=0;r--){var o=this.nodes[r],i=o.findWrapping(t);if(i&&(!e||e.length>i.length)&&(e=i,n=o,!i.length))break;if(o.solid)break}if(!e)return!1;this.sync(n);for(var s=0;s<e.length;s++)this.enterInner(e[s],null,!1);return!0},MA.prototype.insertNode=function(t){if(t.isInline&&this.needsBlock&&!this.top.type){var e=this.textblockFromContext();e&&this.enterInner(e)}if(this.findPlace(t)){this.closeExtra();var n=this.top;n.applyPending(t.type),n.match&&(n.match=n.match.matchType(t.type));for(var r=n.activeMarks,o=0;o<t.marks.length;o++)n.type&&!n.type.allowsMarkType(t.marks[o].type)||(r=t.marks[o].addToSet(r));return n.content.push(t.mark(r)),!0}return!1},MA.prototype.enter=function(t,e,n){var r=this.findPlace(t.create(e));return r&&this.enterInner(t,e,!0,n),r},MA.prototype.enterInner=function(t,e,n,r){this.closeExtra();var o=this.top;o.applyPending(t),o.match=o.match&&o.match.matchType(t,e);var i=null==r?o.options&~SA:OA(r);o.options&SA&&0==o.content.length&&(i|=SA),this.nodes.push(new CA(t,e,o.activeMarks,o.pendingMarks,n,null,i)),this.open++},MA.prototype.closeExtra=function(t){var e=this.nodes.length-1;if(e>this.open){for(;e>this.open;e--)this.nodes[e-1].content.push(this.nodes[e].finish(t));this.nodes.length=this.open+1}},MA.prototype.finish=function(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)},MA.prototype.sync=function(t){for(var e=this.open;e>=0;e--)if(this.nodes[e]==t)return void(this.open=e)},NA.currentPos.get=function(){this.closeExtra();for(var t=0,e=this.open;e>=0;e--){for(var n=this.nodes[e].content,r=n.length-1;r>=0;r--)t+=n[r].nodeSize;e&&t++}return t},MA.prototype.findAtPoint=function(t,e){if(this.find)for(var n=0;n<this.find.length;n++)this.find[n].node==t&&this.find[n].offset==e&&(this.find[n].pos=this.currentPos)},MA.prototype.findInside=function(t){if(this.find)for(var e=0;e<this.find.length;e++)null==this.find[e].pos&&1==t.nodeType&&t.contains(this.find[e].node)&&(this.find[e].pos=this.currentPos)},MA.prototype.findAround=function(t,e,n){if(t!=e&&this.find)for(var r=0;r<this.find.length;r++)if(null==this.find[r].pos&&1==t.nodeType&&t.contains(this.find[r].node)){var o=e.compareDocumentPosition(this.find[r].node);o&(n?2:4)&&(this.find[r].pos=this.currentPos)}},MA.prototype.findInText=function(t){if(this.find)for(var e=0;e<this.find.length;e++)this.find[e].node==t&&(this.find[e].pos=this.currentPos-(t.nodeValue.length-this.find[e].offset))},MA.prototype.matchesContext=function(t){var e=this;if(t.indexOf("|")>-1)return t.split(/\s*\|\s*/).some(this.matchesContext,this);var n=t.split("/"),r=this.options.context,o=!this.isOpen&&(!r||r.parent.type==this.nodes[0].type),i=-(r?r.depth+1:0)+(o?0:1),s=function(t,a){for(;t>=0;t--){var c=n[t];if(""==c){if(t==n.length-1||0==t)continue;for(;a>=i;a--)if(s(t-1,a))return!0;return!1}var h=a>0||0==a&&o?e.nodes[a].type:r&&a>=i?r.node(a-i).type:null;if(!h||h.name!=c&&-1==h.groups.indexOf(c))return!1;a--}return!0};return s(n.length-1,this.open)},MA.prototype.textblockFromContext=function(){var t=this.options.context;if(t)for(var e=t.depth;e>=0;e--){var n=t.node(e).contentMatchAt(t.indexAfter(e)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(var r in this.parser.schema.nodes){var o=this.parser.schema.nodes[r];if(o.isTextblock&&o.defaultAttrs)return o}},MA.prototype.addPendingMark=function(t){var e=zA(t,this.top.pendingMarks);e&&this.top.stashMarks.push(e),this.top.pendingMarks=t.addToSet(this.top.pendingMarks)},MA.prototype.removePendingMark=function(t,e){for(var n=this.open;n>=0;n--){var r=this.nodes[n],o=r.pendingMarks.lastIndexOf(t);if(o>-1)r.pendingMarks=t.removeFromSet(r.pendingMarks);else{r.activeMarks=t.removeFromSet(r.activeMarks);var i=r.popFromStashMark(t);i&&r.type&&r.type.allowsMarkType(i.type)&&(r.activeMarks=i.addToSet(r.activeMarks))}if(r==e)break}},Object.defineProperties(MA.prototype,NA);var IA=function(t,e){this.nodes=t||{},this.marks=e||{}};function PA(t){var e={};for(var n in t){var r=t[n].spec.toDOM;r&&(e[n]=r)}return e}function FA(t){return t.document||window.document}function BA(t,e,n){for(var r=0;;r++){if(r==t.childCount||r==e.childCount)return t.childCount==e.childCount?null:n;var o=t.child(r),i=e.child(r);if(o!=i){if(!o.sameMarkup(i))return n;if(o.isText&&o.text!=i.text){for(var s=0;o.text[s]==i.text[s];s++)n++;return n}if(o.content.size||i.content.size){var a=BA(o.content,i.content,n+1);if(null!=a)return a}n+=o.nodeSize}else n+=o.nodeSize}}function $A(t,e,n,r){for(var o=t.childCount,i=e.childCount;;){if(0==o||0==i)return o==i?null:{a:n,b:r};var s=t.child(--o),a=e.child(--i),c=s.nodeSize;if(s!=a){if(!s.sameMarkup(a))return{a:n,b:r};if(s.isText&&s.text!=a.text){var h=0,p=Math.min(s.text.length,a.text.length);while(h<p&&s.text[s.text.length-h-1]==a.text[a.text.length-h-1])h++,n--,r--;return{a:n,b:r}}if(s.content.size||a.content.size){var l=$A(s.content,a.content,n-1,r-1);if(l)return l}n-=c,r-=c}else n-=c,r-=c}}IA.prototype.serializeFragment=function(t,e,n){var r=this;void 0===e&&(e={}),n||(n=FA(e).createDocumentFragment());var o=n,i=null;return t.forEach((function(t){if(i||t.marks.length){i||(i=[]);var n=0,s=0;while(n<i.length&&s<t.marks.length){var a=t.marks[s];if(r.marks[a.type.name]){if(!a.eq(i[n])||!1===a.type.spec.spanning)break;n+=2,s++}else s++}while(n<i.length)o=i.pop(),i.pop();while(s<t.marks.length){var c=t.marks[s++],h=r.serializeMark(c,t.isInline,e);h&&(i.push(c,o),o.appendChild(h.dom),o=h.contentDOM||h.dom)}}o.appendChild(r.serializeNode(t,e))})),n},IA.prototype.serializeNode=function(t,e){void 0===e&&(e={});var n=IA.renderSpec(FA(e),this.nodes[t.type.name](t)),r=n.dom,o=n.contentDOM;if(o){if(t.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");e.onContent?e.onContent(t,o,e):this.serializeFragment(t.content,e,o)}return r},IA.prototype.serializeNodeAndMarks=function(t,e){void 0===e&&(e={});for(var n=this.serializeNode(t,e),r=t.marks.length-1;r>=0;r--){var o=this.serializeMark(t.marks[r],t.isInline,e);o&&((o.contentDOM||o.dom).appendChild(n),n=o.dom)}return n},IA.prototype.serializeMark=function(t,e,n){void 0===n&&(n={});var r=this.marks[t.type.name];return r&&IA.renderSpec(FA(n),r(t,e))},IA.renderSpec=function(t,e,n){if(void 0===n&&(n=null),"string"==typeof e)return{dom:t.createTextNode(e)};if(null!=e.nodeType)return{dom:e};if(e.dom&&null!=e.dom.nodeType)return e;var r=e[0],o=r.indexOf(" ");o>0&&(n=r.slice(0,o),r=r.slice(o+1));var i=null,s=n?t.createElementNS(n,r):t.createElement(r),a=e[1],c=1;if(a&&"object"==typeof a&&null==a.nodeType&&!Array.isArray(a))for(var h in c=2,a)if(null!=a[h]){var p=h.indexOf(" ");p>0?s.setAttributeNS(h.slice(0,p),h.slice(p+1),a[h]):s.setAttribute(h,a[h])}for(var l=c;l<e.length;l++){var u=e[l];if(0===u){if(l<e.length-1||l>c)throw new RangeError("Content hole must be the only child of its parent node");return{dom:s,contentDOM:s}}var f=IA.renderSpec(t,u,n),d=f.dom,m=f.contentDOM;if(s.appendChild(d),m){if(i)throw new RangeError("Multiple content holes");i=m}}return{dom:s,contentDOM:i}},IA.fromSchema=function(t){return t.cached.domSerializer||(t.cached.domSerializer=new IA(this.nodesFromSchema(t),this.marksFromSchema(t)))},IA.nodesFromSchema=function(t){var e=PA(t.nodes);return e.text||(e.text=function(t){return t.text}),e},IA.marksFromSchema=function(t){return PA(t.marks)};var _A=function(t,e){if(this.content=t,this.size=e||0,null==e)for(var n=0;n<t.length;n++)this.size+=t[n].nodeSize},jA={firstChild:{configurable:!0},lastChild:{configurable:!0},childCount:{configurable:!0}};_A.prototype.nodesBetween=function(t,e,n,r,o){void 0===r&&(r=0);for(var i=0,s=0;s<e;i++){var a=this.content[i],c=s+a.nodeSize;if(c>t&&!1!==n(a,r+s,o,i)&&a.content.size){var h=s+1;a.nodesBetween(Math.max(0,t-h),Math.min(a.content.size,e-h),n,r+h)}s=c}},_A.prototype.descendants=function(t){this.nodesBetween(0,this.size,t)},_A.prototype.textBetween=function(t,e,n,r){var o="",i=!0;return this.nodesBetween(t,e,(function(s,a){s.isText?(o+=s.text.slice(Math.max(t,a)-a,e-a),i=!n):s.isLeaf&&r?(o+=r,i=!n):!i&&s.isBlock&&(o+=n,i=!0)}),0),o},_A.prototype.append=function(t){if(!t.size)return this;if(!this.size)return t;var e=this.lastChild,n=t.firstChild,r=this.content.slice(),o=0;for(e.isText&&e.sameMarkup(n)&&(r[r.length-1]=e.withText(e.text+n.text),o=1);o<t.content.length;o++)r.push(t.content[o]);return new _A(r,this.size+t.size)},_A.prototype.cut=function(t,e){if(null==e&&(e=this.size),0==t&&e==this.size)return this;var n=[],r=0;if(e>t)for(var o=0,i=0;i<e;o++){var s=this.content[o],a=i+s.nodeSize;a>t&&((i<t||a>e)&&(s=s.isText?s.cut(Math.max(0,t-i),Math.min(s.text.length,e-i)):s.cut(Math.max(0,t-i-1),Math.min(s.content.size,e-i-1))),n.push(s),r+=s.nodeSize),i=a}return new _A(n,r)},_A.prototype.cutByIndex=function(t,e){return t==e?_A.empty:0==t&&e==this.content.length?this:new _A(this.content.slice(t,e))},_A.prototype.replaceChild=function(t,e){var n=this.content[t];if(n==e)return this;var r=this.content.slice(),o=this.size+e.nodeSize-n.nodeSize;return r[t]=e,new _A(r,o)},_A.prototype.addToStart=function(t){return new _A([t].concat(this.content),this.size+t.nodeSize)},_A.prototype.addToEnd=function(t){return new _A(this.content.concat(t),this.size+t.nodeSize)},_A.prototype.eq=function(t){if(this.content.length!=t.content.length)return!1;for(var e=0;e<this.content.length;e++)if(!this.content[e].eq(t.content[e]))return!1;return!0},jA.firstChild.get=function(){return this.content.length?this.content[0]:null},jA.lastChild.get=function(){return this.content.length?this.content[this.content.length-1]:null},jA.childCount.get=function(){return this.content.length},_A.prototype.child=function(t){var e=this.content[t];if(!e)throw new RangeError("Index "+t+" out of range for "+this);return e},_A.prototype.maybeChild=function(t){return this.content[t]},_A.prototype.forEach=function(t){for(var e=0,n=0;e<this.content.length;e++){var r=this.content[e];t(r,n,e),n+=r.nodeSize}},_A.prototype.findDiffStart=function(t,e){return void 0===e&&(e=0),BA(this,t,e)},_A.prototype.findDiffEnd=function(t,e,n){return void 0===e&&(e=this.size),void 0===n&&(n=t.size),$A(this,t,e,n)},_A.prototype.findIndex=function(t,e){if(void 0===e&&(e=-1),0==t)return LA(0,t);if(t==this.size)return LA(this.content.length,t);if(t>this.size||t<0)throw new RangeError("Position "+t+" outside of fragment ("+this+")");for(var n=0,r=0;;n++){var o=this.child(n),i=r+o.nodeSize;if(i>=t)return i==t||e>0?LA(n+1,i):LA(n,r);r=i}},_A.prototype.toString=function(){return"<"+this.toStringInner()+">"},_A.prototype.toStringInner=function(){return this.content.join(", ")},_A.prototype.toJSON=function(){return this.content.length?this.content.map((function(t){return t.toJSON()})):null},_A.fromJSON=function(t,e){if(!e)return _A.empty;if(!Array.isArray(e))throw new RangeError("Invalid input for Fragment.fromJSON");return new _A(e.map(t.nodeFromJSON))},_A.fromArray=function(t){if(!t.length)return _A.empty;for(var e,n=0,r=0;r<t.length;r++){var o=t[r];n+=o.nodeSize,r&&o.isText&&t[r-1].sameMarkup(o)?(e||(e=t.slice(0,r)),e[e.length-1]=o.withText(e[e.length-1].text+o.text)):e&&e.push(o)}return new _A(e||t,n)},_A.from=function(t){if(!t)return _A.empty;if(t instanceof _A)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new _A([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))},Object.defineProperties(_A.prototype,jA);var JA={index:0,offset:0};function LA(t,e){return JA.index=t,JA.offset=e,JA}function VA(t,e){if(t===e)return!0;if(!t||"object"!=typeof t||!e||"object"!=typeof e)return!1;var n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(var r=0;r<t.length;r++)if(!VA(t[r],e[r]))return!1}else{for(var o in t)if(!(o in e)||!VA(t[o],e[o]))return!1;for(var i in e)if(!(i in t))return!1}return!0}_A.empty=new _A([],0);var qA=function(t,e){this.type=t,this.attrs=e};function WA(t){var e=Error.call(this,t);return e.__proto__=WA.prototype,e}qA.prototype.addToSet=function(t){for(var e,n=!1,r=0;r<t.length;r++){var o=t[r];if(this.eq(o))return t;if(this.type.excludes(o.type))e||(e=t.slice(0,r));else{if(o.type.excludes(this.type))return t;!n&&o.type.rank>this.type.rank&&(e||(e=t.slice(0,r)),e.push(this),n=!0),e&&e.push(o)}}return e||(e=t.slice()),n||e.push(this),e},qA.prototype.removeFromSet=function(t){for(var e=0;e<t.length;e++)if(this.eq(t[e]))return t.slice(0,e).concat(t.slice(e+1));return t},qA.prototype.isInSet=function(t){for(var e=0;e<t.length;e++)if(this.eq(t[e]))return!0;return!1},qA.prototype.eq=function(t){return this==t||this.type==t.type&&VA(this.attrs,t.attrs)},qA.prototype.toJSON=function(){var t={type:this.type.name};for(var e in this.attrs){t.attrs=this.attrs;break}return t},qA.fromJSON=function(t,e){if(!e)throw new RangeError("Invalid input for Mark.fromJSON");var n=t.marks[e.type];if(!n)throw new RangeError("There is no mark type "+e.type+" in this schema");return n.create(e.attrs)},qA.sameSet=function(t,e){if(t==e)return!0;if(t.length!=e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].eq(e[n]))return!1;return!0},qA.setFrom=function(t){if(!t||0==t.length)return qA.none;if(t instanceof qA)return[t];var e=t.slice();return e.sort((function(t,e){return t.type.rank-e.type.rank})),e},qA.none=[],WA.prototype=Object.create(Error.prototype),WA.prototype.constructor=WA,WA.prototype.name="ReplaceError";var HA=function(t,e,n){this.content=t,this.openStart=e,this.openEnd=n},KA={size:{configurable:!0}};function UA(t,e,n){var r=t.findIndex(e),o=r.index,i=r.offset,s=t.maybeChild(o),a=t.findIndex(n),c=a.index,h=a.offset;if(i==e||s.isText){if(h!=n&&!t.child(c).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(o!=c)throw new RangeError("Removing non-flat range");return t.replaceChild(o,s.copy(UA(s.content,e-i-1,n-i-1)))}function GA(t,e,n,r){var o=t.findIndex(e),i=o.index,s=o.offset,a=t.maybeChild(i);if(s==e||a.isText)return r&&!r.canReplace(i,i,n)?null:t.cut(0,e).append(n).append(t.cut(e));var c=GA(a.content,e-s-1,n);return c&&t.replaceChild(i,a.copy(c))}function XA(t,e,n){if(n.openStart>t.depth)throw new WA("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new WA("Inconsistent open depths");return YA(t,e,n,0)}function YA(t,e,n,r){var o=t.index(r),i=t.node(r);if(o==e.index(r)&&r<t.depth-n.openStart){var s=YA(t,e,n,r+1);return i.copy(i.content.replaceChild(o,s))}if(n.content.size){if(n.openStart||n.openEnd||t.depth!=r||e.depth!=r){var a=iD(n,t),c=a.start,h=a.end;return nD(i,rD(t,c,h,e,r))}var p=t.parent,l=p.content;return nD(p,l.cut(0,t.parentOffset).append(n.content).append(l.cut(e.parentOffset)))}return nD(i,oD(t,e,r))}function ZA(t,e){if(!e.type.compatibleContent(t.type))throw new WA("Cannot join "+e.type.name+" onto "+t.type.name)}function QA(t,e,n){var r=t.node(n);return ZA(r,e.node(n)),r}function tD(t,e){var n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function eD(t,e,n,r){var o=(e||t).node(n),i=0,s=e?e.index(n):o.childCount;t&&(i=t.index(n),t.depth>n?i++:t.textOffset&&(tD(t.nodeAfter,r),i++));for(var a=i;a<s;a++)tD(o.child(a),r);e&&e.depth==n&&e.textOffset&&tD(e.nodeBefore,r)}function nD(t,e){if(!t.type.validContent(e))throw new WA("Invalid content for node "+t.type.name);return t.copy(e)}function rD(t,e,n,r,o){var i=t.depth>o&&QA(t,e,o+1),s=r.depth>o&&QA(n,r,o+1),a=[];return eD(null,t,o,a),i&&s&&e.index(o)==n.index(o)?(ZA(i,s),tD(nD(i,rD(t,e,n,r,o+1)),a)):(i&&tD(nD(i,oD(t,e,o+1)),a),eD(e,n,o,a),s&&tD(nD(s,oD(n,r,o+1)),a)),eD(r,null,o,a),new _A(a)}function oD(t,e,n){var r=[];if(eD(null,t,n,r),t.depth>n){var o=QA(t,e,n+1);tD(nD(o,oD(t,e,n+1)),r)}return eD(e,null,n,r),new _A(r)}function iD(t,e){for(var n=e.depth-t.openStart,r=e.node(n),o=r.copy(t.content),i=n-1;i>=0;i--)o=e.node(i).copy(_A.from(o));return{start:o.resolveNoCache(t.openStart+n),end:o.resolveNoCache(o.content.size-t.openEnd-n)}}KA.size.get=function(){return this.content.size-this.openStart-this.openEnd},HA.prototype.insertAt=function(t,e){var n=GA(this.content,t+this.openStart,e,null);return n&&new HA(n,this.openStart,this.openEnd)},HA.prototype.removeBetween=function(t,e){return new HA(UA(this.content,t+this.openStart,e+this.openStart),this.openStart,this.openEnd)},HA.prototype.eq=function(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd},HA.prototype.toString=function(){return this.content+"("+this.openStart+","+this.openEnd+")"},HA.prototype.toJSON=function(){if(!this.content.size)return null;var t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t},HA.fromJSON=function(t,e){if(!e)return HA.empty;var n=e.openStart||0,r=e.openEnd||0;if("number"!=typeof n||"number"!=typeof r)throw new RangeError("Invalid input for Slice.fromJSON");return new HA(_A.fromJSON(t,e.content),e.openStart||0,e.openEnd||0)},HA.maxOpen=function(t,e){void 0===e&&(e=!0);for(var n=0,r=0,o=t.firstChild;o&&!o.isLeaf&&(e||!o.type.spec.isolating);o=o.firstChild)n++;for(var i=t.lastChild;i&&!i.isLeaf&&(e||!i.type.spec.isolating);i=i.lastChild)r++;return new HA(t,n,r)},Object.defineProperties(HA.prototype,KA),HA.empty=new HA(_A.empty,0,0);var sD=function(t,e,n){this.pos=t,this.path=e,this.depth=e.length/3-1,this.parentOffset=n},aD={parent:{configurable:!0},doc:{configurable:!0},textOffset:{configurable:!0},nodeAfter:{configurable:!0},nodeBefore:{configurable:!0}};sD.prototype.resolveDepth=function(t){return null==t?this.depth:t<0?this.depth+t:t},aD.parent.get=function(){return this.node(this.depth)},aD.doc.get=function(){return this.node(0)},sD.prototype.node=function(t){return this.path[3*this.resolveDepth(t)]},sD.prototype.index=function(t){return this.path[3*this.resolveDepth(t)+1]},sD.prototype.indexAfter=function(t){return t=this.resolveDepth(t),this.index(t)+(t!=this.depth||this.textOffset?1:0)},sD.prototype.start=function(t){return t=this.resolveDepth(t),0==t?0:this.path[3*t-1]+1},sD.prototype.end=function(t){return t=this.resolveDepth(t),this.start(t)+this.node(t).content.size},sD.prototype.before=function(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position before the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]},sD.prototype.after=function(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position after the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]+this.path[3*t].nodeSize},aD.textOffset.get=function(){return this.pos-this.path[this.path.length-1]},aD.nodeAfter.get=function(){var t=this.parent,e=this.index(this.depth);if(e==t.childCount)return null;var n=this.pos-this.path[this.path.length-1],r=t.child(e);return n?t.child(e).cut(n):r},aD.nodeBefore.get=function(){var t=this.index(this.depth),e=this.pos-this.path[this.path.length-1];return e?this.parent.child(t).cut(0,e):0==t?null:this.parent.child(t-1)},sD.prototype.marks=function(){var t=this.parent,e=this.index();if(0==t.content.size)return qA.none;if(this.textOffset)return t.child(e).marks;var n=t.maybeChild(e-1),r=t.maybeChild(e);if(!n){var o=n;n=r,r=o}for(var i=n.marks,s=0;s<i.length;s++)!1!==i[s].type.spec.inclusive||r&&i[s].isInSet(r.marks)||(i=i[s--].removeFromSet(i));return i},sD.prototype.marksAcross=function(t){var e=this.parent.maybeChild(this.index());if(!e||!e.isInline)return null;for(var n=e.marks,r=t.parent.maybeChild(t.index()),o=0;o<n.length;o++)!1!==n[o].type.spec.inclusive||r&&n[o].isInSet(r.marks)||(n=n[o--].removeFromSet(n));return n},sD.prototype.sharedDepth=function(t){for(var e=this.depth;e>0;e--)if(this.start(e)<=t&&this.end(e)>=t)return e;return 0},sD.prototype.blockRange=function(t,e){if(void 0===t&&(t=this),t.pos<this.pos)return t.blockRange(this);for(var n=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);n>=0;n--)if(t.pos<=this.end(n)&&(!e||e(this.node(n))))return new lD(this,t,n)},sD.prototype.sameParent=function(t){return this.pos-this.parentOffset==t.pos-t.parentOffset},sD.prototype.max=function(t){return t.pos>this.pos?t:this},sD.prototype.min=function(t){return t.pos<this.pos?t:this},sD.prototype.toString=function(){for(var t="",e=1;e<=this.depth;e++)t+=(t?"/":"")+this.node(e).type.name+"_"+this.index(e-1);return t+":"+this.parentOffset},sD.resolve=function(t,e){if(!(e>=0&&e<=t.content.size))throw new RangeError("Position "+e+" out of range");for(var n=[],r=0,o=e,i=t;;){var s=i.content.findIndex(o),a=s.index,c=s.offset,h=o-c;if(n.push(i,a,r+c),!h)break;if(i=i.child(a),i.isText)break;o=h-1,r+=c+1}return new sD(e,n,o)},sD.resolveCached=function(t,e){for(var n=0;n<cD.length;n++){var r=cD[n];if(r.pos==e&&r.doc==t)return r}var o=cD[hD]=sD.resolve(t,e);return hD=(hD+1)%pD,o},Object.defineProperties(sD.prototype,aD);var cD=[],hD=0,pD=12,lD=function(t,e,n){this.$from=t,this.$to=e,this.depth=n},uD={start:{configurable:!0},end:{configurable:!0},parent:{configurable:!0},startIndex:{configurable:!0},endIndex:{configurable:!0}};uD.start.get=function(){return this.$from.before(this.depth+1)},uD.end.get=function(){return this.$to.after(this.depth+1)},uD.parent.get=function(){return this.$from.node(this.depth)},uD.startIndex.get=function(){return this.$from.index(this.depth)},uD.endIndex.get=function(){return this.$to.indexAfter(this.depth)},Object.defineProperties(lD.prototype,uD);var fD=Object.create(null),dD=function(t,e,n,r){this.type=t,this.attrs=e,this.content=n||_A.empty,this.marks=r||qA.none},mD={nodeSize:{configurable:!0},childCount:{configurable:!0},textContent:{configurable:!0},firstChild:{configurable:!0},lastChild:{configurable:!0},isBlock:{configurable:!0},isTextblock:{configurable:!0},inlineContent:{configurable:!0},isInline:{configurable:!0},isText:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};mD.nodeSize.get=function(){return this.isLeaf?1:2+this.content.size},mD.childCount.get=function(){return this.content.childCount},dD.prototype.child=function(t){return this.content.child(t)},dD.prototype.maybeChild=function(t){return this.content.maybeChild(t)},dD.prototype.forEach=function(t){this.content.forEach(t)},dD.prototype.nodesBetween=function(t,e,n,r){void 0===r&&(r=0),this.content.nodesBetween(t,e,n,r,this)},dD.prototype.descendants=function(t){this.nodesBetween(0,this.content.size,t)},mD.textContent.get=function(){return this.textBetween(0,this.content.size,"")},dD.prototype.textBetween=function(t,e,n,r){return this.content.textBetween(t,e,n,r)},mD.firstChild.get=function(){return this.content.firstChild},mD.lastChild.get=function(){return this.content.lastChild},dD.prototype.eq=function(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)},dD.prototype.sameMarkup=function(t){return this.hasMarkup(t.type,t.attrs,t.marks)},dD.prototype.hasMarkup=function(t,e,n){return this.type==t&&VA(this.attrs,e||t.defaultAttrs||fD)&&qA.sameSet(this.marks,n||qA.none)},dD.prototype.copy=function(t){return void 0===t&&(t=null),t==this.content?this:new this.constructor(this.type,this.attrs,t,this.marks)},dD.prototype.mark=function(t){return t==this.marks?this:new this.constructor(this.type,this.attrs,this.content,t)},dD.prototype.cut=function(t,e){return 0==t&&e==this.content.size?this:this.copy(this.content.cut(t,e))},dD.prototype.slice=function(t,e,n){if(void 0===e&&(e=this.content.size),void 0===n&&(n=!1),t==e)return HA.empty;var r=this.resolve(t),o=this.resolve(e),i=n?0:r.sharedDepth(e),s=r.start(i),a=r.node(i),c=a.content.cut(r.pos-s,o.pos-s);return new HA(c,r.depth-i,o.depth-i)},dD.prototype.replace=function(t,e,n){return XA(this.resolve(t),this.resolve(e),n)},dD.prototype.nodeAt=function(t){for(var e=this;;){var n=e.content.findIndex(t),r=n.index,o=n.offset;if(e=e.maybeChild(r),!e)return null;if(o==t||e.isText)return e;t-=o+1}},dD.prototype.childAfter=function(t){var e=this.content.findIndex(t),n=e.index,r=e.offset;return{node:this.content.maybeChild(n),index:n,offset:r}},dD.prototype.childBefore=function(t){if(0==t)return{node:null,index:0,offset:0};var e=this.content.findIndex(t),n=e.index,r=e.offset;if(r<t)return{node:this.content.child(n),index:n,offset:r};var o=this.content.child(n-1);return{node:o,index:n-1,offset:r-o.nodeSize}},dD.prototype.resolve=function(t){return sD.resolveCached(this,t)},dD.prototype.resolveNoCache=function(t){return sD.resolve(this,t)},dD.prototype.rangeHasMark=function(t,e,n){var r=!1;return e>t&&this.nodesBetween(t,e,(function(t){return n.isInSet(t.marks)&&(r=!0),!r})),r},mD.isBlock.get=function(){return this.type.isBlock},mD.isTextblock.get=function(){return this.type.isTextblock},mD.inlineContent.get=function(){return this.type.inlineContent},mD.isInline.get=function(){return this.type.isInline},mD.isText.get=function(){return this.type.isText},mD.isLeaf.get=function(){return this.type.isLeaf},mD.isAtom.get=function(){return this.type.isAtom},dD.prototype.toString=function(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);var t=this.type.name;return this.content.size&&(t+="("+this.content.toStringInner()+")"),gD(this.marks,t)},dD.prototype.contentMatchAt=function(t){var e=this.type.contentMatch.matchFragment(this.content,0,t);if(!e)throw new Error("Called contentMatchAt on a node with invalid content");return e},dD.prototype.canReplace=function(t,e,n,r,o){void 0===n&&(n=_A.empty),void 0===r&&(r=0),void 0===o&&(o=n.childCount);var i=this.contentMatchAt(t).matchFragment(n,r,o),s=i&&i.matchFragment(this.content,e);if(!s||!s.validEnd)return!1;for(var a=r;a<o;a++)if(!this.type.allowsMarks(n.child(a).marks))return!1;return!0},dD.prototype.canReplaceWith=function(t,e,n,r){if(r&&!this.type.allowsMarks(r))return!1;var o=this.contentMatchAt(t).matchType(n),i=o&&o.matchFragment(this.content,e);return!!i&&i.validEnd},dD.prototype.canAppend=function(t){return t.content.size?this.canReplace(this.childCount,this.childCount,t.content):this.type.compatibleContent(t.type)},dD.prototype.check=function(){if(!this.type.validContent(this.content))throw new RangeError("Invalid content for node "+this.type.name+": "+this.content.toString().slice(0,50));this.content.forEach((function(t){return t.check()}))},dD.prototype.toJSON=function(){var t={type:this.type.name};for(var e in this.attrs){t.attrs=this.attrs;break}return this.content.size&&(t.content=this.content.toJSON()),this.marks.length&&(t.marks=this.marks.map((function(t){return t.toJSON()}))),t},dD.fromJSON=function(t,e){if(!e)throw new RangeError("Invalid input for Node.fromJSON");var n=null;if(e.marks){if(!Array.isArray(e.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=e.marks.map(t.markFromJSON)}if("text"==e.type){if("string"!=typeof e.text)throw new RangeError("Invalid text node in JSON");return t.text(e.text,n)}var r=_A.fromJSON(t,e.content);return t.nodeType(e.type).create(e.attrs,r,n)},Object.defineProperties(dD.prototype,mD);var vD=function(t){function e(e,n,r,o){if(t.call(this,e,n,null,o),!r)throw new RangeError("Empty text nodes are not allowed");this.text=r}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={textContent:{configurable:!0},nodeSize:{configurable:!0}};return e.prototype.toString=function(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):gD(this.marks,JSON.stringify(this.text))},n.textContent.get=function(){return this.text},e.prototype.textBetween=function(t,e){return this.text.slice(t,e)},n.nodeSize.get=function(){return this.text.length},e.prototype.mark=function(t){return t==this.marks?this:new e(this.type,this.attrs,this.text,t)},e.prototype.withText=function(t){return t==this.text?this:new e(this.type,this.attrs,t,this.marks)},e.prototype.cut=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=this.text.length),0==t&&e==this.text.length?this:this.withText(this.text.slice(t,e))},e.prototype.eq=function(t){return this.sameMarkup(t)&&this.text==t.text},e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.text=this.text,e},Object.defineProperties(e.prototype,n),e}(dD);function gD(t,e){for(var n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}var yD=function(t){this.validEnd=t,this.next=[],this.wrapCache=[]},wD={inlineContent:{configurable:!0},defaultType:{configurable:!0},edgeCount:{configurable:!0}};yD.parse=function(t,e){var n=new xD(t,e);if(null==n.next)return yD.empty;var r=kD(n);n.next&&n.err("Unexpected trailing text");var o=RD(ED(r));return zD(o,n),o},yD.prototype.matchType=function(t){for(var e=0;e<this.next.length;e+=2)if(this.next[e]==t)return this.next[e+1];return null},yD.prototype.matchFragment=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=t.childCount);for(var r=this,o=e;r&&o<n;o++)r=r.matchType(t.child(o).type);return r},wD.inlineContent.get=function(){var t=this.next[0];return!!t&&t.isInline},wD.defaultType.get=function(){for(var t=0;t<this.next.length;t+=2){var e=this.next[t];if(!e.isText&&!e.hasRequiredAttrs())return e}},yD.prototype.compatible=function(t){for(var e=0;e<this.next.length;e+=2)for(var n=0;n<t.next.length;n+=2)if(this.next[e]==t.next[n])return!0;return!1},yD.prototype.fillBefore=function(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=0);var r=[this];function o(i,s){var a=i.matchFragment(t,n);if(a&&(!e||a.validEnd))return _A.from(s.map((function(t){return t.createAndFill()})));for(var c=0;c<i.next.length;c+=2){var h=i.next[c],p=i.next[c+1];if(!h.isText&&!h.hasRequiredAttrs()&&-1==r.indexOf(p)){r.push(p);var l=o(p,s.concat(h));if(l)return l}}}return o(this,[])},yD.prototype.findWrapping=function(t){for(var e=0;e<this.wrapCache.length;e+=2)if(this.wrapCache[e]==t)return this.wrapCache[e+1];var n=this.computeWrapping(t);return this.wrapCache.push(t,n),n},yD.prototype.computeWrapping=function(t){var e=Object.create(null),n=[{match:this,type:null,via:null}];while(n.length){var r=n.shift(),o=r.match;if(o.matchType(t)){for(var i=[],s=r;s.type;s=s.via)i.push(s.type);return i.reverse()}for(var a=0;a<o.next.length;a+=2){var c=o.next[a];c.isLeaf||c.hasRequiredAttrs()||c.name in e||r.type&&!o.next[a+1].validEnd||(n.push({match:c.contentMatch,type:c,via:r}),e[c.name]=!0)}}},wD.edgeCount.get=function(){return this.next.length>>1},yD.prototype.edge=function(t){var e=t<<1;if(e>=this.next.length)throw new RangeError("There's no "+t+"th edge in this content match");return{type:this.next[e],next:this.next[e+1]}},yD.prototype.toString=function(){var t=[];function e(n){t.push(n);for(var r=1;r<n.next.length;r+=2)-1==t.indexOf(n.next[r])&&e(n.next[r])}return e(this),t.map((function(e,n){for(var r=n+(e.validEnd?"*":" ")+" ",o=0;o<e.next.length;o+=2)r+=(o?", ":"")+e.next[o].name+"->"+t.indexOf(e.next[o+1]);return r})).join("\n")},Object.defineProperties(yD.prototype,wD),yD.empty=new yD(!0);var xD=function(t,e){this.string=t,this.nodeTypes=e,this.inline=null,this.pos=0,this.tokens=t.split(/\s*(?=\b|\W|$)/),""==this.tokens[this.tokens.length-1]&&this.tokens.pop(),""==this.tokens[0]&&this.tokens.unshift()},bD={next:{configurable:!0}};function kD(t){var e=[];do{e.push(SD(t))}while(t.eat("|"));return 1==e.length?e[0]:{type:"choice",exprs:e}}function SD(t){var e=[];do{e.push(OD(t))}while(t.next&&")"!=t.next&&"|"!=t.next);return 1==e.length?e[0]:{type:"seq",exprs:e}}function OD(t){for(var e=TD(t);;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else{if(!t.eat("{"))break;e=MD(t,e)}return e}function CD(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");var e=Number(t.next);return t.pos++,e}function MD(t,e){var n=CD(t),r=n;return t.eat(",")&&(r="}"!=t.next?CD(t):-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:e}}function ND(t,e){var n=t.nodeTypes,r=n[e];if(r)return[r];var o=[];for(var i in n){var s=n[i];s.groups.indexOf(e)>-1&&o.push(s)}return 0==o.length&&t.err("No node type or group '"+e+"' found"),o}function TD(t){if(t.eat("(")){var e=kD(t);return t.eat(")")||t.err("Missing closing paren"),e}if(!/\W/.test(t.next)){var n=ND(t,t.next).map((function(e){return null==t.inline?t.inline=e.isInline:t.inline!=e.isInline&&t.err("Mixing inline and block content"),{type:"name",value:e}}));return t.pos++,1==n.length?n[0]:{type:"choice",exprs:n}}t.err("Unexpected token '"+t.next+"'")}function ED(t){var e=[[]];return o(i(t,0),n()),e;function n(){return e.push([])-1}function r(t,n,r){var o={term:r,to:n};return e[t].push(o),o}function o(t,e){t.forEach((function(t){return t.to=e}))}function i(t,e){if("choice"==t.type)return t.exprs.reduce((function(t,n){return t.concat(i(n,e))}),[]);if("seq"==t.type)for(var s=0;;s++){var a=i(t.exprs[s],e);if(s==t.exprs.length-1)return a;o(a,e=n())}else{if("star"==t.type){var c=n();return r(e,c),o(i(t.expr,c),c),[r(c)]}if("plus"==t.type){var h=n();return o(i(t.expr,e),h),o(i(t.expr,h),h),[r(h)]}if("opt"==t.type)return[r(e)].concat(i(t.expr,e));if("range"==t.type){for(var p=e,l=0;l<t.min;l++){var u=n();o(i(t.expr,p),u),p=u}if(-1==t.max)o(i(t.expr,p),p);else for(var f=t.min;f<t.max;f++){var d=n();r(p,d),o(i(t.expr,p),d),p=d}return[r(p)]}if("name"==t.type)return[r(e,null,t.value)]}}}function AD(t,e){return e-t}function DD(t,e){var n=[];return r(e),n.sort(AD);function r(e){var o=t[e];if(1==o.length&&!o[0].term)return r(o[0].to);n.push(e);for(var i=0;i<o.length;i++){var s=o[i],a=s.term,c=s.to;a||-1!=n.indexOf(c)||r(c)}}}function RD(t){var e=Object.create(null);return n(DD(t,0));function n(r){var o=[];r.forEach((function(e){t[e].forEach((function(e){var n=e.term,r=e.to;if(n){var i=o.indexOf(n),s=i>-1&&o[i+1];DD(t,r).forEach((function(t){s||o.push(n,s=[]),-1==s.indexOf(t)&&s.push(t)}))}}))}));for(var i=e[r.join(",")]=new yD(r.indexOf(t.length-1)>-1),s=0;s<o.length;s+=2){var a=o[s+1].sort(AD);i.next.push(o[s],e[a.join(",")]||n(a))}return i}}function zD(t,e){for(var n=0,r=[t];n<r.length;n++){for(var o=r[n],i=!o.validEnd,s=[],a=0;a<o.next.length;a+=2){var c=o.next[a],h=o.next[a+1];s.push(c.name),!i||c.isText||c.hasRequiredAttrs()||(i=!1),-1==r.indexOf(h)&&r.push(h)}i&&e.err("Only non-generatable nodes ("+s.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function ID(t){var e=Object.create(null);for(var n in t){var r=t[n];if(!r.hasDefault)return null;e[n]=r.default}return e}function PD(t,e){var n=Object.create(null);for(var r in t){var o=e&&e[r];if(void 0===o){var i=t[r];if(!i.hasDefault)throw new RangeError("No value supplied for attribute "+r);o=i.default}n[r]=o}return n}function FD(t){var e=Object.create(null);if(t)for(var n in t)e[n]=new _D(t[n]);return e}bD.next.get=function(){return this.tokens[this.pos]},xD.prototype.eat=function(t){return this.next==t&&(this.pos++||!0)},xD.prototype.err=function(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")},Object.defineProperties(xD.prototype,bD);var BD=function(t,e,n){this.name=t,this.schema=e,this.spec=n,this.groups=n.group?n.group.split(" "):[],this.attrs=FD(n.attrs),this.defaultAttrs=ID(this.attrs),this.contentMatch=null,this.markSet=null,this.inlineContent=null,this.isBlock=!(n.inline||"text"==t),this.isText="text"==t},$D={isInline:{configurable:!0},isTextblock:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};$D.isInline.get=function(){return!this.isBlock},$D.isTextblock.get=function(){return this.isBlock&&this.inlineContent},$D.isLeaf.get=function(){return this.contentMatch==yD.empty},$D.isAtom.get=function(){return this.isLeaf||this.spec.atom},BD.prototype.hasRequiredAttrs=function(){for(var t in this.attrs)if(this.attrs[t].isRequired)return!0;return!1},BD.prototype.compatibleContent=function(t){return this==t||this.contentMatch.compatible(t.contentMatch)},BD.prototype.computeAttrs=function(t){return!t&&this.defaultAttrs?this.defaultAttrs:PD(this.attrs,t)},BD.prototype.create=function(t,e,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new dD(this,this.computeAttrs(t),_A.from(e),qA.setFrom(n))},BD.prototype.createChecked=function(t,e,n){if(e=_A.from(e),!this.validContent(e))throw new RangeError("Invalid content for node "+this.name);return new dD(this,this.computeAttrs(t),e,qA.setFrom(n))},BD.prototype.createAndFill=function(t,e,n){if(t=this.computeAttrs(t),e=_A.from(e),e.size){var r=this.contentMatch.fillBefore(e);if(!r)return null;e=r.append(e)}var o=this.contentMatch.matchFragment(e).fillBefore(_A.empty,!0);return o?new dD(this,t,e.append(o),qA.setFrom(n)):null},BD.prototype.validContent=function(t){var e=this.contentMatch.matchFragment(t);if(!e||!e.validEnd)return!1;for(var n=0;n<t.childCount;n++)if(!this.allowsMarks(t.child(n).marks))return!1;return!0},BD.prototype.allowsMarkType=function(t){return null==this.markSet||this.markSet.indexOf(t)>-1},BD.prototype.allowsMarks=function(t){if(null==this.markSet)return!0;for(var e=0;e<t.length;e++)if(!this.allowsMarkType(t[e].type))return!1;return!0},BD.prototype.allowedMarks=function(t){if(null==this.markSet)return t;for(var e,n=0;n<t.length;n++)this.allowsMarkType(t[n].type)?e&&e.push(t[n]):e||(e=t.slice(0,n));return e?e.length?e:qA.empty:t},BD.compile=function(t,e){var n=Object.create(null);t.forEach((function(t,r){return n[t]=new BD(t,e,r)}));var r=e.spec.topNode||"doc";if(!n[r])throw new RangeError("Schema is missing its top node type ('"+r+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(var o in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n},Object.defineProperties(BD.prototype,$D);var _D=function(t){this.hasDefault=Object.prototype.hasOwnProperty.call(t,"default"),this.default=t.default},jD={isRequired:{configurable:!0}};jD.isRequired.get=function(){return!this.hasDefault},Object.defineProperties(_D.prototype,jD);var JD=function(t,e,n,r){this.name=t,this.schema=n,this.spec=r,this.attrs=FD(r.attrs),this.rank=e,this.excluded=null;var o=ID(this.attrs);this.instance=o&&new qA(this,o)};JD.prototype.create=function(t){return!t&&this.instance?this.instance:new qA(this,PD(this.attrs,t))},JD.compile=function(t,e){var n=Object.create(null),r=0;return t.forEach((function(t,o){return n[t]=new JD(t,r++,e,o)})),n},JD.prototype.removeFromSet=function(t){for(var e=0;e<t.length;e++)if(t[e].type==this)return t.slice(0,e).concat(t.slice(e+1));return t},JD.prototype.isInSet=function(t){for(var e=0;e<t.length;e++)if(t[e].type==this)return t[e]},JD.prototype.excludes=function(t){return this.excluded.indexOf(t)>-1};var LD=function(t){for(var e in this.spec={},t)this.spec[e]=t[e];this.spec.nodes=c.from(t.nodes),this.spec.marks=c.from(t.marks),this.nodes=BD.compile(this.spec.nodes,this),this.marks=JD.compile(this.spec.marks,this);var n=Object.create(null);for(var r in this.nodes){if(r in this.marks)throw new RangeError(r+" can not be both a node and a mark");var o=this.nodes[r],i=o.spec.content||"",s=o.spec.marks;o.contentMatch=n[i]||(n[i]=yD.parse(i,this.nodes)),o.inlineContent=o.contentMatch.inlineContent,o.markSet="_"==s?null:s?VD(this,s.split(" ")):""!=s&&o.inlineContent?null:[]}for(var a in this.marks){var h=this.marks[a],p=h.spec.excludes;h.excluded=null==p?[h]:""==p?[]:VD(this,p.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached=Object.create(null),this.cached.wrappings=Object.create(null)};function VD(t,e){for(var n=[],r=0;r<e.length;r++){var o=e[r],i=t.marks[o],s=i;if(i)n.push(i);else for(var a in t.marks){var c=t.marks[a];("_"==o||c.spec.group&&c.spec.group.split(" ").indexOf(o)>-1)&&n.push(s=c)}if(!s)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return n}LD.prototype.node=function(t,e,n,r){if("string"==typeof t)t=this.nodeType(t);else{if(!(t instanceof BD))throw new RangeError("Invalid node type: "+t);if(t.schema!=this)throw new RangeError("Node type from different schema used ("+t.name+")")}return t.createChecked(e,n,r)},LD.prototype.text=function(t,e){var n=this.nodes.text;return new vD(n,n.defaultAttrs,t,qA.setFrom(e))},LD.prototype.mark=function(t,e){return"string"==typeof t&&(t=this.marks[t]),t.create(e)},LD.prototype.nodeFromJSON=function(t){return dD.fromJSON(this,t)},LD.prototype.markFromJSON=function(t){return qA.fromJSON(this,t)},LD.prototype.nodeType=function(t){var e=this.nodes[t];if(!e)throw new RangeError("Unknown node type: "+t);return e};var qD=function(t,e){var n=this;this.schema=t,this.rules=e,this.tags=[],this.styles=[],e.forEach((function(t){t.tag?n.tags.push(t):t.style&&n.styles.push(t)})),this.normalizeLists=!this.tags.some((function(e){if(!/^(ul|ol)\b/.test(e.tag)||!e.node)return!1;var n=t.nodes[e.node];return n.contentMatch.matchType(n)}))};qD.prototype.parse=function(t,e){void 0===e&&(e={});var n=new QD(this,e,!1);return n.addAll(t,null,e.from,e.to),n.finish()},qD.prototype.parseSlice=function(t,e){void 0===e&&(e={});var n=new QD(this,e,!0);return n.addAll(t,null,e.from,e.to),HA.maxOpen(n.finish())},qD.prototype.matchTag=function(t,e){for(var n=0;n<this.tags.length;n++){var r=this.tags[n];if(nR(t,r.tag)&&(void 0===r.namespace||t.namespaceURI==r.namespace)&&(!r.context||e.matchesContext(r.context))){if(r.getAttrs){var o=r.getAttrs(t);if(!1===o)continue;r.attrs=o}return r}}},qD.prototype.matchStyle=function(t,e,n){for(var r=0;r<this.styles.length;r++){var o=this.styles[r];if(!(0!=o.style.indexOf(t)||o.context&&!n.matchesContext(o.context)||o.style.length>t.length&&(61!=o.style.charCodeAt(t.length)||o.style.slice(t.length+1)!=e))){if(o.getAttrs){var i=o.getAttrs(e);if(!1===i)continue;o.attrs=i}return o}}},qD.schemaRules=function(t){var e=[];function n(t){for(var n=null==t.priority?50:t.priority,r=0;r<e.length;r++){var o=e[r],i=null==o.priority?50:o.priority;if(i<n)break}e.splice(r,0,t)}var r=function(e){var r=t.marks[e].spec.parseDOM;r&&r.forEach((function(t){n(t=oR(t)),t.mark=e}))};for(var o in t.marks)r(o);var i=function(e){var r=t.nodes[s].spec.parseDOM;r&&r.forEach((function(t){n(t=oR(t)),t.node=s}))};for(var s in t.nodes)i();return e},qD.fromSchema=function(t){return t.cached.domParser||(t.cached.domParser=new qD(t,qD.schemaRules(t)))};var WD={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},HD={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},KD={ol:!0,ul:!0},UD=1,GD=2,XD=4;function YD(t){return(t?UD:0)|("full"===t?GD:0)}var ZD=function(t,e,n,r,o,i,s){this.type=t,this.attrs=e,this.solid=o,this.match=i||(s&XD?null:t.contentMatch),this.options=s,this.content=[],this.marks=n,this.activeMarks=qA.none,this.pendingMarks=r};ZD.prototype.findWrapping=function(t){if(!this.match){if(!this.type)return[];var e=this.type.contentMatch.fillBefore(_A.from(t));if(!e){var n,r=this.type.contentMatch;return(n=r.findWrapping(t.type))?(this.match=r,n):null}this.match=this.type.contentMatch.matchFragment(e)}return this.match.findWrapping(t.type)},ZD.prototype.finish=function(t){if(!(this.options&UD)){var e,n=this.content[this.content.length-1];n&&n.isText&&(e=/[ \t\r\n\u000c]+$/.exec(n.text))&&(n.text.length==e[0].length?this.content.pop():this.content[this.content.length-1]=n.withText(n.text.slice(0,n.text.length-e[0].length)))}var r=_A.from(this.content);return!t&&this.match&&(r=r.append(this.match.fillBefore(_A.empty,!0))),this.type?this.type.create(this.attrs,r,this.marks):r},ZD.prototype.applyPending=function(t){for(var e=0,n=this.pendingMarks;e<n.length;e++){var r=n[e];(this.type?this.type.allowsMarkType(r.type):iR(r.type,t))&&!r.isInSet(this.activeMarks)&&(this.activeMarks=r.addToSet(this.activeMarks),this.pendingMarks=r.removeFromSet(this.pendingMarks))}};var QD=function(t,e,n){this.parser=t,this.options=e,this.isOpen=n;var r,o=e.topNode,i=YD(e.preserveWhitespace)|(n?XD:0);r=o?new ZD(o.type,o.attrs,qA.none,qA.none,!0,e.topMatch||o.type.contentMatch,i):new ZD(n?null:t.schema.topNodeType,null,qA.none,qA.none,!0,null,i),this.nodes=[r],this.open=0,this.find=e.findPositions,this.needsBlock=!1},tR={top:{configurable:!0},currentPos:{configurable:!0}};function eR(t){for(var e=t.firstChild,n=null;e;e=e.nextSibling){var r=1==e.nodeType?e.nodeName.toLowerCase():null;r&&KD.hasOwnProperty(r)&&n?(n.appendChild(e),e=n):"li"==r?n=e:r&&(n=null)}}function nR(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function rR(t){var e,n=/\s*([\w-]+)\s*:\s*([^;]+)/g,r=[];while(e=n.exec(t))r.push(e[1],e[2].trim());return r}function oR(t){var e={};for(var n in t)e[n]=t[n];return e}function iR(t,e){var n=e.schema.nodes,r=function(r){var o=n[r];if(o.allowsMarkType(t)){var i=[],s=function(t){i.push(t);for(var n=0;n<t.edgeCount;n++){var r=t.edge(n),o=r.type,a=r.next;if(o==e)return!0;if(i.indexOf(a)<0&&s(a))return!0}};return s(o.contentMatch)?{v:!0}:void 0}};for(var o in n){var i=r(o);if(i)return i.v}}tR.top.get=function(){return this.nodes[this.open]},QD.prototype.addDOM=function(t){if(3==t.nodeType)this.addTextNode(t);else if(1==t.nodeType){var e=t.getAttribute("style"),n=e?this.readStyles(rR(e)):null,r=this.top;if(null!=n)for(var o=0;o<n.length;o++)this.addPendingMark(n[o]);if(this.addElement(t),null!=n)for(var i=0;i<n.length;i++)this.removePendingMark(n[i],r)}},QD.prototype.addTextNode=function(t){var e=t.nodeValue,n=this.top;if((n.type?n.type.inlineContent:n.content.length&&n.content[0].isInline)||/[^ \t\r\n\u000c]/.test(e)){if(n.options&UD)n.options&GD||(e=e.replace(/\r?\n|\r/g," "));else if(e=e.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(e)&&this.open==this.nodes.length-1){var r=n.content[n.content.length-1],o=t.previousSibling;(!r||o&&"BR"==o.nodeName||r.isText&&/[ \t\r\n\u000c]$/.test(r.text))&&(e=e.slice(1))}e&&this.insertNode(this.parser.schema.text(e)),this.findInText(t)}else this.findInside(t)},QD.prototype.addElement=function(t){var e=t.nodeName.toLowerCase();KD.hasOwnProperty(e)&&this.normalizeLists&&eR(t);var n=this.options.ruleFromNode&&this.options.ruleFromNode(t)||this.parser.matchTag(t,this);if(n?n.ignore:HD.hasOwnProperty(e))this.findInside(t);else if(!n||n.skip||n.closeParent){n&&n.closeParent?this.open=Math.max(0,this.open-1):n&&n.skip.nodeType&&(t=n.skip);var r,o=this.top,i=this.needsBlock;if(WD.hasOwnProperty(e))r=!0,o.type||(this.needsBlock=!0);else if(!t.firstChild)return void this.leafFallback(t);this.addAll(t),r&&this.sync(o),this.needsBlock=i}else this.addElementByRule(t,n)},QD.prototype.leafFallback=function(t){"BR"==t.nodeName&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(t.ownerDocument.createTextNode("\n"))},QD.prototype.readStyles=function(t){for(var e=qA.none,n=0;n<t.length;n+=2){var r=this.parser.matchStyle(t[n],t[n+1],this);if(r){if(r.ignore)return null;e=this.parser.schema.marks[r.mark].create(r.attrs).addToSet(e)}}return e},QD.prototype.addElementByRule=function(t,e){var n,r,o,i,s=this;e.node?(r=this.parser.schema.nodes[e.node],r.isLeaf?this.insertNode(r.create(e.attrs))||this.leafFallback(t):n=this.enter(r,e.attrs,e.preserveWhitespace)):(o=this.parser.schema.marks[e.mark],i=o.create(e.attrs),this.addPendingMark(i));var a=this.top;if(r&&r.isLeaf)this.findInside(t);else if(e.getContent)this.findInside(t),e.getContent(t,this.parser.schema).forEach((function(t){return s.insertNode(t)}));else{var c=e.contentElement;"string"==typeof c?c=t.querySelector(c):"function"==typeof c&&(c=c(t)),c||(c=t),this.findAround(t,c,!0),this.addAll(c,n)}n&&(this.sync(a),this.open--),i&&this.removePendingMark(i,a)},QD.prototype.addAll=function(t,e,n,r){for(var o=n||0,i=n?t.childNodes[n]:t.firstChild,s=null==r?null:t.childNodes[r];i!=s;i=i.nextSibling,++o)this.findAtPoint(t,o),this.addDOM(i),e&&WD.hasOwnProperty(i.nodeName.toLowerCase())&&this.sync(e);this.findAtPoint(t,o)},QD.prototype.findPlace=function(t){for(var e,n,r=this.open;r>=0;r--){var o=this.nodes[r],i=o.findWrapping(t);if(i&&(!e||e.length>i.length)&&(e=i,n=o,!i.length))break;if(o.solid)break}if(!e)return!1;this.sync(n);for(var s=0;s<e.length;s++)this.enterInner(e[s],null,!1);return!0},QD.prototype.insertNode=function(t){if(t.isInline&&this.needsBlock&&!this.top.type){var e=this.textblockFromContext();e&&this.enterInner(e)}if(this.findPlace(t)){this.closeExtra();var n=this.top;n.applyPending(t.type),n.match&&(n.match=n.match.matchType(t.type));for(var r=n.activeMarks,o=0;o<t.marks.length;o++)n.type&&!n.type.allowsMarkType(t.marks[o].type)||(r=t.marks[o].addToSet(r));return n.content.push(t.mark(r)),!0}return!1},QD.prototype.enter=function(t,e,n){var r=this.findPlace(t.create(e));return r&&this.enterInner(t,e,!0,n),r},QD.prototype.enterInner=function(t,e,n,r){this.closeExtra();var o=this.top;o.applyPending(t),o.match=o.match&&o.match.matchType(t,e);var i=null==r?o.options&~XD:YD(r);o.options&XD&&0==o.content.length&&(i|=XD),this.nodes.push(new ZD(t,e,o.activeMarks,o.pendingMarks,n,null,i)),this.open++},QD.prototype.closeExtra=function(t){var e=this.nodes.length-1;if(e>this.open){for(;e>this.open;e--)this.nodes[e-1].content.push(this.nodes[e].finish(t));this.nodes.length=this.open+1}},QD.prototype.finish=function(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)},QD.prototype.sync=function(t){for(var e=this.open;e>=0;e--)if(this.nodes[e]==t)return void(this.open=e)},tR.currentPos.get=function(){this.closeExtra();for(var t=0,e=this.open;e>=0;e--){for(var n=this.nodes[e].content,r=n.length-1;r>=0;r--)t+=n[r].nodeSize;e&&t++}return t},QD.prototype.findAtPoint=function(t,e){if(this.find)for(var n=0;n<this.find.length;n++)this.find[n].node==t&&this.find[n].offset==e&&(this.find[n].pos=this.currentPos)},QD.prototype.findInside=function(t){if(this.find)for(var e=0;e<this.find.length;e++)null==this.find[e].pos&&1==t.nodeType&&t.contains(this.find[e].node)&&(this.find[e].pos=this.currentPos)},QD.prototype.findAround=function(t,e,n){if(t!=e&&this.find)for(var r=0;r<this.find.length;r++)if(null==this.find[r].pos&&1==t.nodeType&&t.contains(this.find[r].node)){var o=e.compareDocumentPosition(this.find[r].node);o&(n?2:4)&&(this.find[r].pos=this.currentPos)}},QD.prototype.findInText=function(t){if(this.find)for(var e=0;e<this.find.length;e++)this.find[e].node==t&&(this.find[e].pos=this.currentPos-(t.nodeValue.length-this.find[e].offset))},QD.prototype.matchesContext=function(t){var e=this;if(t.indexOf("|")>-1)return t.split(/\s*\|\s*/).some(this.matchesContext,this);var n=t.split("/"),r=this.options.context,o=!this.isOpen&&(!r||r.parent.type==this.nodes[0].type),i=-(r?r.depth+1:0)+(o?0:1),s=function(t,a){for(;t>=0;t--){var c=n[t];if(""==c){if(t==n.length-1||0==t)continue;for(;a>=i;a--)if(s(t-1,a))return!0;return!1}var h=a>0||0==a&&o?e.nodes[a].type:r&&a>=i?r.node(a-i).type:null;if(!h||h.name!=c&&-1==h.groups.indexOf(c))return!1;a--}return!0};return s(n.length-1,this.open)},QD.prototype.textblockFromContext=function(){var t=this.options.context;if(t)for(var e=t.depth;e>=0;e--){var n=t.node(e).contentMatchAt(t.indexAfter(e)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(var r in this.parser.schema.nodes){var o=this.parser.schema.nodes[r];if(o.isTextblock&&o.defaultAttrs)return o}},QD.prototype.addPendingMark=function(t){this.top.pendingMarks=t.addToSet(this.top.pendingMarks)},QD.prototype.removePendingMark=function(t,e){for(var n=this.open;n>=0;n--){var r=this.nodes[n],o=r.pendingMarks.lastIndexOf(t);if(o>-1?r.pendingMarks=t.removeFromSet(r.pendingMarks):r.activeMarks=t.removeFromSet(r.activeMarks),r==e)break}},Object.defineProperties(QD.prototype,tR);var sR=function(t,e){this.nodes=t||{},this.marks=e||{}};function aR(t){var e={};for(var n in t){var r=t[n].spec.toDOM;r&&(e[n]=r)}return e}function cR(t){return t.document||window.document}sR.prototype.serializeFragment=function(t,e,n){var r=this;void 0===e&&(e={}),n||(n=cR(e).createDocumentFragment());var o=n,i=null;return t.forEach((function(t){if(i||t.marks.length){i||(i=[]);var n=0,s=0;while(n<i.length&&s<t.marks.length){var a=t.marks[s];if(r.marks[a.type.name]){if(!a.eq(i[n])||!1===a.type.spec.spanning)break;n+=2,s++}else s++}while(n<i.length)o=i.pop(),i.pop();while(s<t.marks.length){var c=t.marks[s++],h=r.serializeMark(c,t.isInline,e);h&&(i.push(c,o),o.appendChild(h.dom),o=h.contentDOM||h.dom)}}o.appendChild(r.serializeNode(t,e))})),n},sR.prototype.serializeNode=function(t,e){void 0===e&&(e={});var n=sR.renderSpec(cR(e),this.nodes[t.type.name](t)),r=n.dom,o=n.contentDOM;if(o){if(t.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");e.onContent?e.onContent(t,o,e):this.serializeFragment(t.content,e,o)}return r},sR.prototype.serializeNodeAndMarks=function(t,e){void 0===e&&(e={});for(var n=this.serializeNode(t,e),r=t.marks.length-1;r>=0;r--){var o=this.serializeMark(t.marks[r],t.isInline,e);o&&((o.contentDOM||o.dom).appendChild(n),n=o.dom)}return n},sR.prototype.serializeMark=function(t,e,n){void 0===n&&(n={});var r=this.marks[t.type.name];return r&&sR.renderSpec(cR(n),r(t,e))},sR.renderSpec=function(t,e,n){if(void 0===n&&(n=null),"string"==typeof e)return{dom:t.createTextNode(e)};if(null!=e.nodeType)return{dom:e};var r=e[0],o=r.indexOf(" ");o>0&&(n=r.slice(0,o),r=r.slice(o+1));var i=null,s=n?t.createElementNS(n,r):t.createElement(r),a=e[1],c=1;if(a&&"object"==typeof a&&null==a.nodeType&&!Array.isArray(a))for(var h in c=2,a)if(null!=a[h]){var p=h.indexOf(" ");p>0?s.setAttributeNS(h.slice(0,p),h.slice(p+1),a[h]):s.setAttribute(h,a[h])}for(var l=c;l<e.length;l++){var u=e[l];if(0===u){if(l<e.length-1||l>c)throw new RangeError("Content hole must be the only child of its parent node");return{dom:s,contentDOM:s}}var f=sR.renderSpec(t,u,n),d=f.dom,m=f.contentDOM;if(s.appendChild(d),m){if(i)throw new RangeError("Multiple content holes");i=m}}return{dom:s,contentDOM:i}},sR.fromSchema=function(t){return t.cached.domSerializer||(t.cached.domSerializer=new sR(this.nodesFromSchema(t),this.marksFromSchema(t)))},sR.nodesFromSchema=function(t){var e=aR(t.nodes);return e.text||(e.text=function(t){return t.text}),e},sR.marksFromSchema=function(t){return aR(t.marks)};var hR=65535,pR=Math.pow(2,16);function lR(t,e){return t+e*pR}function uR(t){return t&hR}function fR(t){return(t-(t&hR))/pR}var dR=function(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=null),this.pos=t,this.deleted=e,this.recover=n},mR=function(t,e){void 0===e&&(e=!1),this.ranges=t,this.inverted=e};mR.prototype.recover=function(t){var e=0,n=uR(t);if(!this.inverted)for(var r=0;r<n;r++)e+=this.ranges[3*r+2]-this.ranges[3*r+1];return this.ranges[3*n]+e+fR(t)},mR.prototype.mapResult=function(t,e){return void 0===e&&(e=1),this._map(t,e,!1)},mR.prototype.map=function(t,e){return void 0===e&&(e=1),this._map(t,e,!0)},mR.prototype._map=function(t,e,n){for(var r=0,o=this.inverted?2:1,i=this.inverted?1:2,s=0;s<this.ranges.length;s+=3){var a=this.ranges[s]-(this.inverted?r:0);if(a>t)break;var c=this.ranges[s+o],h=this.ranges[s+i],p=a+c;if(t<=p){var l=c?t==a?-1:t==p?1:e:e,u=a+r+(l<0?0:h);if(n)return u;var f=t==(e<0?a:p)?null:lR(s/3,t-a);return new dR(u,e<0?t!=a:t!=p,f)}r+=h-c}return n?t+r:new dR(t+r)},mR.prototype.touches=function(t,e){for(var n=0,r=uR(e),o=this.inverted?2:1,i=this.inverted?1:2,s=0;s<this.ranges.length;s+=3){var a=this.ranges[s]-(this.inverted?n:0);if(a>t)break;var c=this.ranges[s+o],h=a+c;if(t<=h&&s==3*r)return!0;n+=this.ranges[s+i]-c}return!1},mR.prototype.forEach=function(t){for(var e=this.inverted?2:1,n=this.inverted?1:2,r=0,o=0;r<this.ranges.length;r+=3){var i=this.ranges[r],s=i-(this.inverted?o:0),a=i+(this.inverted?0:o),c=this.ranges[r+e],h=this.ranges[r+n];t(s,s+c,a,a+h),o+=h-c}},mR.prototype.invert=function(){return new mR(this.ranges,!this.inverted)},mR.prototype.toString=function(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)},mR.offset=function(t){return 0==t?mR.empty:new mR(t<0?[0,-t,0]:[0,0,t])},mR.empty=new mR([]);var vR=function(t,e,n,r){this.maps=t||[],this.from=n||0,this.to=null==r?this.maps.length:r,this.mirror=e};function gR(t){var e=Error.call(this,t);return e.__proto__=gR.prototype,e}vR.prototype.slice=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=this.maps.length),new vR(this.maps,this.mirror,t,e)},vR.prototype.copy=function(){return new vR(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)},vR.prototype.appendMap=function(t,e){this.to=this.maps.push(t),null!=e&&this.setMirror(this.maps.length-1,e)},vR.prototype.appendMapping=function(t){for(var e=0,n=this.maps.length;e<t.maps.length;e++){var r=t.getMirror(e);this.appendMap(t.maps[e],null!=r&&r<e?n+r:null)}},vR.prototype.getMirror=function(t){if(this.mirror)for(var e=0;e<this.mirror.length;e++)if(this.mirror[e]==t)return this.mirror[e+(e%2?-1:1)]},vR.prototype.setMirror=function(t,e){this.mirror||(this.mirror=[]),this.mirror.push(t,e)},vR.prototype.appendMappingInverted=function(t){for(var e=t.maps.length-1,n=this.maps.length+t.maps.length;e>=0;e--){var r=t.getMirror(e);this.appendMap(t.maps[e].invert(),null!=r&&r>e?n-r-1:null)}},vR.prototype.invert=function(){var t=new vR;return t.appendMappingInverted(this),t},vR.prototype.map=function(t,e){if(void 0===e&&(e=1),this.mirror)return this._map(t,e,!0);for(var n=this.from;n<this.to;n++)t=this.maps[n].map(t,e);return t},vR.prototype.mapResult=function(t,e){return void 0===e&&(e=1),this._map(t,e,!1)},vR.prototype._map=function(t,e,n){for(var r=!1,o=this.from;o<this.to;o++){var i=this.maps[o],s=i.mapResult(t,e);if(null!=s.recover){var a=this.getMirror(o);if(null!=a&&a>o&&a<this.to){o=a,t=this.maps[a].recover(s.recover);continue}}s.deleted&&(r=!0),t=s.pos}return n?t:new dR(t,r)},gR.prototype=Object.create(Error.prototype),gR.prototype.constructor=gR,gR.prototype.name="TransformError";var yR=function(t){this.doc=t,this.steps=[],this.docs=[],this.mapping=new vR},wR={before:{configurable:!0},docChanged:{configurable:!0}};function xR(){throw new Error("Override me")}wR.before.get=function(){return this.docs.length?this.docs[0]:this.doc},yR.prototype.step=function(t){var e=this.maybeStep(t);if(e.failed)throw new gR(e.failed);return this},yR.prototype.maybeStep=function(t){var e=t.apply(this.doc);return e.failed||this.addStep(t,e.doc),e},wR.docChanged.get=function(){return this.steps.length>0},yR.prototype.addStep=function(t,e){this.docs.push(this.doc),this.steps.push(t),this.mapping.appendMap(t.getMap()),this.doc=e},Object.defineProperties(yR.prototype,wR);var bR=Object.create(null),kR=function(){};kR.prototype.apply=function(t){return xR()},kR.prototype.getMap=function(){return mR.empty},kR.prototype.invert=function(t){return xR()},kR.prototype.map=function(t){return xR()},kR.prototype.merge=function(t){return null},kR.prototype.toJSON=function(){return xR()},kR.fromJSON=function(t,e){if(!e||!e.stepType)throw new RangeError("Invalid input for Step.fromJSON");var n=bR[e.stepType];if(!n)throw new RangeError("No step type "+e.stepType+" defined");return n.fromJSON(t,e)},kR.jsonID=function(t,e){if(t in bR)throw new RangeError("Duplicate use of step JSON ID "+t);return bR[t]=e,e.prototype.jsonID=t,e};var SR=function(t,e){this.doc=t,this.failed=e};SR.ok=function(t){return new SR(t,null)},SR.fail=function(t){return new SR(null,t)},SR.fromReplace=function(t,e,n,r){try{return SR.ok(t.replace(e,n,r))}catch(o){if(o instanceof WA)return SR.fail(o.message);throw o}};var OR=function(t){function e(e,n,r,o){t.call(this),this.from=e,this.to=n,this.slice=r,this.structure=!!o}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(t){return this.structure&&MR(t,this.from,this.to)?SR.fail("Structure replace would overwrite content"):SR.fromReplace(t,this.from,this.to,this.slice)},e.prototype.getMap=function(){return new mR([this.from,this.to-this.from,this.slice.size])},e.prototype.invert=function(t){return new e(this.from,this.from+this.slice.size,t.slice(this.from,this.to))},e.prototype.map=function(t){var n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return n.deleted&&r.deleted?null:new e(n.pos,Math.max(n.pos,r.pos),this.slice)},e.prototype.merge=function(t){if(!(t instanceof e)||t.structure!=this.structure)return null;if(this.from+this.slice.size!=t.from||this.slice.openEnd||t.slice.openStart){if(t.to!=this.from||this.slice.openStart||t.slice.openEnd)return null;var n=this.slice.size+t.slice.size==0?HA.empty:new HA(t.slice.content.append(this.slice.content),t.slice.openStart,this.slice.openEnd);return new e(t.from,this.to,n,this.structure)}var r=this.slice.size+t.slice.size==0?HA.empty:new HA(this.slice.content.append(t.slice.content),this.slice.openStart,t.slice.openEnd);return new e(this.from,this.to+(t.to-t.from),r,this.structure)},e.prototype.toJSON=function(){var t={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t},e.fromJSON=function(t,n){if("number"!=typeof n.from||"number"!=typeof n.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new e(n.from,n.to,HA.fromJSON(t,n.slice),!!n.structure)},e}(kR);kR.jsonID("replace",OR);var CR=function(t){function e(e,n,r,o,i,s,a){t.call(this),this.from=e,this.to=n,this.gapFrom=r,this.gapTo=o,this.slice=i,this.insert=s,this.structure=!!a}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(t){if(this.structure&&(MR(t,this.from,this.gapFrom)||MR(t,this.gapTo,this.to)))return SR.fail("Structure gap-replace would overwrite content");var e=t.slice(this.gapFrom,this.gapTo);if(e.openStart||e.openEnd)return SR.fail("Gap is not a flat range");var n=this.slice.insertAt(this.insert,e.content);return n?SR.fromReplace(t,this.from,this.to,n):SR.fail("Content does not fit in gap")},e.prototype.getMap=function(){return new mR([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])},e.prototype.invert=function(t){var n=this.gapTo-this.gapFrom;return new e(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)},e.prototype.map=function(t){var n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1),o=t.map(this.gapFrom,-1),i=t.map(this.gapTo,1);return n.deleted&&r.deleted||o<n.pos||i>r.pos?null:new e(n.pos,r.pos,o,i,this.slice,this.insert,this.structure)},e.prototype.toJSON=function(){var t={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t},e.fromJSON=function(t,n){if("number"!=typeof n.from||"number"!=typeof n.to||"number"!=typeof n.gapFrom||"number"!=typeof n.gapTo||"number"!=typeof n.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new e(n.from,n.to,n.gapFrom,n.gapTo,HA.fromJSON(t,n.slice),n.insert,!!n.structure)},e}(kR);function MR(t,e,n){var r=t.resolve(e),o=n-e,i=r.depth;while(o>0&&i>0&&r.indexAfter(i)==r.node(i).childCount)i--,o--;if(o>0){var s=r.node(i).maybeChild(r.indexAfter(i));while(o>0){if(!s||s.isLeaf)return!0;s=s.firstChild,o--}}return!1}function NR(t,e,n){var r=t.resolve(e),o=r.index();return r.parent.canReplaceWith(o,o+1,n)}function TR(t,e,n){var r=t.resolve(e);if(r.parent.canReplaceWith(r.index(),r.index(),n))return e;if(0==r.parentOffset)for(var o=r.depth-1;o>=0;o--){var i=r.index(o);if(r.node(o).canReplaceWith(i,i,n))return r.before(o+1);if(i>0)return null}if(r.parentOffset==r.parent.content.size)for(var s=r.depth-1;s>=0;s--){var a=r.indexAfter(s);if(r.node(s).canReplaceWith(a,a,n))return r.after(s+1);if(a<r.node(s).childCount)return null}}function ER(t,e,n){for(var r=[],o=0;o<t.childCount;o++){var i=t.child(o);i.content.size&&(i=i.copy(ER(i.content,e,i))),i.isInline&&(i=e(i,n,o)),r.push(i)}return _A.fromArray(r)}kR.jsonID("replaceAround",CR),yR.prototype.lift=function(t,e){for(var n=t.$from,r=t.$to,o=t.depth,i=n.before(o+1),s=r.after(o+1),a=i,c=s,h=_A.empty,p=0,l=o,u=!1;l>e;l--)u||n.index(l)>0?(u=!0,h=_A.from(n.node(l).copy(h)),p++):a--;for(var f=_A.empty,d=0,m=o,v=!1;m>e;m--)v||r.after(m+1)<r.end(m)?(v=!0,f=_A.from(r.node(m).copy(f)),d++):c++;return this.step(new CR(a,c,i,s,new HA(h.append(f),p,d),h.size-p,!0))},yR.prototype.wrap=function(t,e){for(var n=_A.empty,r=e.length-1;r>=0;r--)n=_A.from(e[r].type.create(e[r].attrs,n));var o=t.start,i=t.end;return this.step(new CR(o,i,o,i,new HA(n,0,0),e.length,!0))},yR.prototype.setBlockType=function(t,e,n,r){var o=this;if(void 0===e&&(e=t),!n.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");var i=this.steps.length;return this.doc.nodesBetween(t,e,(function(t,e){if(t.isTextblock&&!t.hasMarkup(n,r)&&NR(o.doc,o.mapping.slice(i).map(e),n)){o.clearIncompatible(o.mapping.slice(i).map(e,1),n);var s=o.mapping.slice(i),a=s.map(e,1),c=s.map(e+t.nodeSize,1);return o.step(new CR(a,c,a+1,c-1,new HA(_A.from(n.create(r,null,t.marks)),0,0),1,!0)),!1}})),this},yR.prototype.setNodeMarkup=function(t,e,n,r){var o=this.doc.nodeAt(t);if(!o)throw new RangeError("No node at given position");e||(e=o.type);var i=e.create(n,null,r||o.marks);if(o.isLeaf)return this.replaceWith(t,t+o.nodeSize,i);if(!e.validContent(o.content))throw new RangeError("Invalid content for node type "+e.name);return this.step(new CR(t,t+o.nodeSize,t+1,t+o.nodeSize-1,new HA(_A.from(i),0,0),1,!0))},yR.prototype.split=function(t,e,n){void 0===e&&(e=1);for(var r=this.doc.resolve(t),o=_A.empty,i=_A.empty,s=r.depth,a=r.depth-e,c=e-1;s>a;s--,c--){o=_A.from(r.node(s).copy(o));var h=n&&n[c];i=_A.from(h?h.type.create(h.attrs,i):r.node(s).copy(i))}return this.step(new OR(t,t,new HA(o.append(i),e,e),!0))},yR.prototype.join=function(t,e){void 0===e&&(e=1);var n=new OR(t-e,t+e,HA.empty,!0);return this.step(n)};var AR=function(t){function e(e,n,r){t.call(this),this.from=e,this.to=n,this.mark=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(t){var e=this,n=t.slice(this.from,this.to),r=t.resolve(this.from),o=r.node(r.sharedDepth(this.to)),i=new HA(ER(n.content,(function(t,n){return n.type.allowsMarkType(e.mark.type)?t.mark(e.mark.addToSet(t.marks)):t}),o),n.openStart,n.openEnd);return SR.fromReplace(t,this.from,this.to,i)},e.prototype.invert=function(){return new DR(this.from,this.to,this.mark)},e.prototype.map=function(t){var n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new e(n.pos,r.pos,this.mark)},e.prototype.merge=function(t){if(t instanceof e&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from)return new e(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark)},e.prototype.toJSON=function(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},e.fromJSON=function(t,n){if("number"!=typeof n.from||"number"!=typeof n.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new e(n.from,n.to,t.markFromJSON(n.mark))},e}(kR);kR.jsonID("addMark",AR);var DR=function(t){function e(e,n,r){t.call(this),this.from=e,this.to=n,this.mark=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(t){var e=this,n=t.slice(this.from,this.to),r=new HA(ER(n.content,(function(t){return t.mark(e.mark.removeFromSet(t.marks))})),n.openStart,n.openEnd);return SR.fromReplace(t,this.from,this.to,r)},e.prototype.invert=function(){return new AR(this.from,this.to,this.mark)},e.prototype.map=function(t){var n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new e(n.pos,r.pos,this.mark)},e.prototype.merge=function(t){if(t instanceof e&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from)return new e(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark)},e.prototype.toJSON=function(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},e.fromJSON=function(t,n){if("number"!=typeof n.from||"number"!=typeof n.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new e(n.from,n.to,t.markFromJSON(n.mark))},e}(kR);function RR(t,e,n,r){if(void 0===n&&(n=e),void 0===r&&(r=HA.empty),e==n&&!r.size)return null;var o=t.resolve(e),i=t.resolve(n);return zR(o,i,r)?new OR(e,n,r):new IR(o,i,r).fit()}function zR(t,e,n){return!n.openStart&&!n.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),n.content)}kR.jsonID("removeMark",DR),yR.prototype.addMark=function(t,e,n){var r=this,o=[],i=[],s=null,a=null;return this.doc.nodesBetween(t,e,(function(r,c,h){if(r.isInline){var p=r.marks;if(!n.isInSet(p)&&h.type.allowsMarkType(n.type)){for(var l=Math.max(c,t),u=Math.min(c+r.nodeSize,e),f=n.addToSet(p),d=0;d<p.length;d++)p[d].isInSet(f)||(s&&s.to==l&&s.mark.eq(p[d])?s.to=u:o.push(s=new DR(l,u,p[d])));a&&a.to==l?a.to=u:i.push(a=new AR(l,u,n))}}})),o.forEach((function(t){return r.step(t)})),i.forEach((function(t){return r.step(t)})),this},yR.prototype.removeMark=function(t,e,n){var r=this;void 0===n&&(n=null);var o=[],i=0;return this.doc.nodesBetween(t,e,(function(r,s){if(r.isInline){i++;var a=null;if(n instanceof JD){var c=n.isInSet(r.marks);c&&(a=[c])}else n?n.isInSet(r.marks)&&(a=[n]):a=r.marks;if(a&&a.length)for(var h=Math.min(s+r.nodeSize,e),p=0;p<a.length;p++){for(var l=a[p],u=void 0,f=0;f<o.length;f++){var d=o[f];d.step==i-1&&l.eq(o[f].style)&&(u=d)}u?(u.to=h,u.step=i):o.push({style:l,from:Math.max(s,t),to:h,step:i})}}})),o.forEach((function(t){return r.step(new DR(t.from,t.to,t.style))})),this},yR.prototype.clearIncompatible=function(t,e,n){void 0===n&&(n=e.contentMatch);for(var r=this.doc.nodeAt(t),o=[],i=t+1,s=0;s<r.childCount;s++){var a=r.child(s),c=i+a.nodeSize,h=n.matchType(a.type,a.attrs);if(h){n=h;for(var p=0;p<a.marks.length;p++)e.allowsMarkType(a.marks[p].type)||this.step(new DR(i,c,a.marks[p]))}else o.push(new OR(i,c,HA.empty));i=c}if(!n.validEnd){var l=n.fillBefore(_A.empty,!0);this.replace(i,i,new HA(l,0,0))}for(var u=o.length-1;u>=0;u--)this.step(o[u]);return this},yR.prototype.replace=function(t,e,n){void 0===e&&(e=t),void 0===n&&(n=HA.empty);var r=RR(this.doc,t,e,n);return r&&this.step(r),this},yR.prototype.replaceWith=function(t,e,n){return this.replace(t,e,new HA(_A.from(n),0,0))},yR.prototype.delete=function(t,e){return this.replace(t,e,HA.empty)},yR.prototype.insert=function(t,e){return this.replaceWith(t,t,e)};var IR=function(t,e,n){this.$to=e,this.$from=t,this.unplaced=n,this.frontier=[];for(var r=0;r<=t.depth;r++){var o=t.node(r);this.frontier.push({type:o.type,match:o.contentMatchAt(t.indexAfter(r))})}this.placed=_A.empty;for(var i=t.depth;i>0;i--)this.placed=_A.from(t.node(i).copy(this.placed))},PR={depth:{configurable:!0}};function FR(t,e,n){return 0==e?t.cutByIndex(n):t.replaceChild(0,t.firstChild.copy(FR(t.firstChild.content,e-1,n)))}function BR(t,e,n){return 0==e?t.append(n):t.replaceChild(t.childCount-1,t.lastChild.copy(BR(t.lastChild.content,e-1,n)))}function $R(t,e){for(var n=0;n<e;n++)t=t.firstChild.content;return t}function _R(t,e,n){if(e<=0)return t;var r=t.content;return e>1&&(r=r.replaceChild(0,_R(r.firstChild,e-1,1==r.childCount?n-1:0))),e>0&&(r=t.type.contentMatch.fillBefore(r).append(r),n<=0&&(r=r.append(t.type.contentMatch.matchFragment(r).fillBefore(_A.empty,!0)))),t.copy(r)}function jR(t,e,n,r,o){var i=t.node(e),s=o?t.indexAfter(e):t.index(e);if(s==i.childCount&&!n.compatibleContent(i.type))return null;var a=r.fillBefore(i.content,!0,s);return a&&!JR(n,i.content,s)?a:null}function JR(t,e,n){for(var r=n;r<e.childCount;r++)if(!t.allowsMarks(e.child(r).marks))return!0;return!1}function LR(t,e,n,r,o){if(e<n){var i=t.firstChild;t=t.replaceChild(0,i.copy(LR(i.content,e+1,n,r,i)))}if(e>r){var s=o.contentMatchAt(0),a=s.fillBefore(t).append(t);t=a.append(s.matchFragment(a).fillBefore(_A.empty,!0))}return t}function VR(t,e){for(var n=[],r=Math.min(t.depth,e.depth),o=r;o>=0;o--){var i=t.start(o);if(i<t.pos-(t.depth-o)||e.end(o)>e.pos+(e.depth-o)||t.node(o).type.spec.isolating||e.node(o).type.spec.isolating)break;i==e.start(o)&&n.push(o)}return n}PR.depth.get=function(){return this.frontier.length-1},IR.prototype.fit=function(){while(this.unplaced.size){var t=this.findFittable();t?this.placeNodes(t):this.openMore()||this.dropNode()}var e=this.mustMoveInline(),n=this.placed.size-this.depth-this.$from.depth,r=this.$from,o=this.close(e<0?this.$to:r.doc.resolve(e));if(!o)return null;var i=this.placed,s=r.depth,a=o.depth;while(s&&a&&1==i.childCount)i=i.firstChild.content,s--,a--;var c=new HA(i,s,a);return e>-1?new CR(r.pos,e,this.$to.pos,this.$to.end(),c,n):c.size||r.pos!=this.$to.pos?new OR(r.pos,o.pos,c):void 0},IR.prototype.findFittable=function(){for(var t=1;t<=2;t++)for(var e=this.unplaced.openStart;e>=0;e--){var n=void 0,r=void 0;e?(r=$R(this.unplaced.content,e-1).firstChild,n=r.content):n=this.unplaced.content;for(var o=n.firstChild,i=this.depth;i>=0;i--){var s=this.frontier[i],a=s.type,c=s.match,h=void 0,p=void 0;if(1==t&&(o?c.matchType(o.type)||(p=c.fillBefore(_A.from(o),!1)):a.compatibleContent(r.type)))return{sliceDepth:e,frontierDepth:i,parent:r,inject:p};if(2==t&&o&&(h=c.findWrapping(o.type)))return{sliceDepth:e,frontierDepth:i,parent:r,wrap:h};if(r&&c.matchType(r.type))break}}},IR.prototype.openMore=function(){var t=this.unplaced,e=t.content,n=t.openStart,r=t.openEnd,o=$R(e,n);return!(!o.childCount||o.firstChild.isLeaf)&&(this.unplaced=new HA(e,n+1,Math.max(r,o.size+n>=e.size-r?n+1:0)),!0)},IR.prototype.dropNode=function(){var t=this.unplaced,e=t.content,n=t.openStart,r=t.openEnd,o=$R(e,n);if(o.childCount<=1&&n>0){var i=e.size-n<=n+o.size;this.unplaced=new HA(FR(e,n-1,1),n-1,i?n-1:r)}else this.unplaced=new HA(FR(e,n,1),n,r)},IR.prototype.placeNodes=function(t){var e=t.sliceDepth,n=t.frontierDepth,r=t.parent,o=t.inject,i=t.wrap;while(this.depth>n)this.closeFrontierNode();if(i)for(var s=0;s<i.length;s++)this.openFrontierNode(i[s]);var a=this.unplaced,c=r?r.content:a.content,h=a.openStart-e,p=0,l=[],u=this.frontier[n],f=u.match,d=u.type;if(o){for(var m=0;m<o.childCount;m++)l.push(o.child(m));f=f.matchFragment(o)}var v=c.size+e-(a.content.size-a.openEnd);while(p<c.childCount){var g=c.child(p),y=f.matchType(g.type);if(!y)break;p++,(p>1||0==h||g.content.size)&&(f=y,l.push(_R(g.mark(d.allowedMarks(g.marks)),1==p?h:0,p==c.childCount?v:-1)))}var w=p==c.childCount;w||(v=-1),w&&v<0&&r&&r.type==this.frontier[this.depth].type?this.closeFrontierNode():this.frontier[n].match=f;for(var x=0,b=c;x<v;x++){var k=b.lastChild;this.frontier.push({type:k.type,match:k.contentMatchAt(k.childCount)}),b=k.content}this.unplaced=w?0==e?HA.empty:new HA(FR(a.content,e-1,1),e-1,v<0?a.openEnd:e-1):new HA(FR(a.content,e,p),a.openStart,a.openEnd),this.placed=BR(this.placed,n,_A.from(l))},IR.prototype.mustMoveInline=function(){if(!this.$to.parent.isTextblock||this.$to.end()==this.$to.pos)return-1;var t,e=this.frontier[this.depth];if(!e.type.isTextblock||!jR(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;var n=this.$to,r=n.depth,o=this.$to.after(r);while(r>1&&o==this.$to.end(--r))++o;return o},IR.prototype.findCloseLevel=function(t){t:for(var e=Math.min(this.depth,t.depth);e>=0;e--){var n=this.frontier[e],r=n.match,o=n.type,i=e<t.depth&&t.end(e+1)==t.pos+(t.depth-(e+1)),s=jR(t,e,o,r,i);if(s){for(var a=e-1;a>=0;a--){var c=this.frontier[a],h=c.match,p=c.type,l=jR(t,a,p,h,!0);if(!l||l.childCount)continue t}return{depth:e,fit:s,move:i?t.doc.resolve(t.after(e+1)):t}}}},IR.prototype.close=function(t){var e=this.findCloseLevel(t);if(!e)return null;while(this.depth>e.depth)this.closeFrontierNode();e.fit.childCount&&(this.placed=BR(this.placed,e.depth,e.fit)),t=e.move;for(var n=e.depth+1;n<=t.depth;n++){var r=t.node(n),o=r.type.contentMatch.fillBefore(r.content,!0,t.index(n));this.openFrontierNode(r.type,r.attrs,o)}return t},IR.prototype.openFrontierNode=function(t,e,n){var r=this.frontier[this.depth];r.match=r.match.matchType(t),this.placed=BR(this.placed,this.depth,_A.from(t.create(e,n))),this.frontier.push({type:t,match:t.contentMatch})},IR.prototype.closeFrontierNode=function(){var t=this.frontier.pop(),e=t.match.fillBefore(_A.empty,!0);e.childCount&&(this.placed=BR(this.placed,this.frontier.length,e))},Object.defineProperties(IR.prototype,PR),yR.prototype.replaceRange=function(t,e,n){if(!n.size)return this.deleteRange(t,e);var r=this.doc.resolve(t),o=this.doc.resolve(e);if(zR(r,o,n))return this.step(new OR(t,e,n));var i=VR(r,this.doc.resolve(e));0==i[i.length-1]&&i.pop();var s=-(r.depth+1);i.unshift(s);for(var a=r.depth,c=r.pos-1;a>0;a--,c--){var h=r.node(a).type.spec;if(h.defining||h.isolating)break;i.indexOf(a)>-1?s=a:r.before(a)==c&&i.splice(1,0,-a)}for(var p=i.indexOf(s),l=[],u=n.openStart,f=n.content,d=0;;d++){var m=f.firstChild;if(l.push(m),d==n.openStart)break;f=m.content}u>0&&l[u-1].type.spec.defining&&r.node(p).type!=l[u-1].type?u-=1:u>=2&&l[u-1].isTextblock&&l[u-2].type.spec.defining&&r.node(p).type!=l[u-2].type&&(u-=2);for(var v=n.openStart;v>=0;v--){var g=(v+u+1)%(n.openStart+1),y=l[g];if(y)for(var w=0;w<i.length;w++){var x=i[(w+p)%i.length],b=!0;x<0&&(b=!1,x=-x);var k=r.node(x-1),S=r.index(x-1);if(k.canReplaceWith(S,S,y.type,y.marks))return this.replace(r.before(x),b?o.after(x):e,new HA(LR(n.content,0,n.openStart,g),g,n.openEnd))}}for(var O=this.steps.length,C=i.length-1;C>=0;C--){if(this.replace(t,e,n),this.steps.length>O)break;var M=i[C];C<0||(t=r.before(M),e=o.after(M))}return this},yR.prototype.replaceRangeWith=function(t,e,n){if(!n.isInline&&t==e&&this.doc.resolve(t).parent.content.size){var r=TR(this.doc,t,n.type);null!=r&&(t=e=r)}return this.replaceRange(t,e,new HA(_A.from(n),0,0))},yR.prototype.deleteRange=function(t,e){for(var n=this.doc.resolve(t),r=this.doc.resolve(e),o=VR(n,r),i=0;i<o.length;i++){var s=o[i],a=i==o.length-1;if(a&&0==s||n.node(s).type.contentMatch.validEnd)return this.delete(n.start(s),r.end(s));if(s>0&&(a||n.node(s-1).canReplace(n.index(s-1),r.indexAfter(s-1))))return this.delete(n.before(s),r.after(s))}for(var c=1;c<=n.depth&&c<=r.depth;c++)if(t-n.start(c)==n.depth-c&&e>n.end(c)&&r.end(c)-e!=r.depth-c)return this.delete(n.before(c),e);return this.delete(t,e)};var qR=Object.create(null),WR=function(t,e,n){this.ranges=n||[new KR(t.min(e),t.max(e))],this.$anchor=t,this.$head=e},HR={anchor:{configurable:!0},head:{configurable:!0},from:{configurable:!0},to:{configurable:!0},$from:{configurable:!0},$to:{configurable:!0},empty:{configurable:!0}};HR.anchor.get=function(){return this.$anchor.pos},HR.head.get=function(){return this.$head.pos},HR.from.get=function(){return this.$from.pos},HR.to.get=function(){return this.$to.pos},HR.$from.get=function(){return this.ranges[0].$from},HR.$to.get=function(){return this.ranges[0].$to},HR.empty.get=function(){for(var t=this.ranges,e=0;e<t.length;e++)if(t[e].$from.pos!=t[e].$to.pos)return!1;return!0},WR.prototype.content=function(){return this.$from.node(0).slice(this.from,this.to,!0)},WR.prototype.replace=function(t,e){void 0===e&&(e=HA.empty);for(var n=e.content.lastChild,r=null,o=0;o<e.openEnd;o++)r=n,n=n.lastChild;for(var i=t.steps.length,s=this.ranges,a=0;a<s.length;a++){var c=s[a],h=c.$from,p=c.$to,l=t.mapping.slice(i);t.replaceRange(l.map(h.pos),l.map(p.pos),a?HA.empty:e),0==a&&ez(t,i,(n?n.isInline:r&&r.isTextblock)?-1:1)}},WR.prototype.replaceWith=function(t,e){for(var n=t.steps.length,r=this.ranges,o=0;o<r.length;o++){var i=r[o],s=i.$from,a=i.$to,c=t.mapping.slice(n),h=c.map(s.pos),p=c.map(a.pos);o?t.deleteRange(h,p):(t.replaceRangeWith(h,p,e),ez(t,n,e.isInline?-1:1))}},WR.findFrom=function(t,e,n){var r=t.parent.inlineContent?new UR(t):tz(t.node(0),t.parent,t.pos,t.index(),e,n);if(r)return r;for(var o=t.depth-1;o>=0;o--){var i=e<0?tz(t.node(0),t.node(o),t.before(o+1),t.index(o),e,n):tz(t.node(0),t.node(o),t.after(o+1),t.index(o)+1,e,n);if(i)return i}},WR.near=function(t,e){return void 0===e&&(e=1),this.findFrom(t,e)||this.findFrom(t,-e)||new ZR(t.node(0))},WR.atStart=function(t){return tz(t,t,0,0,1)||new ZR(t)},WR.atEnd=function(t){return tz(t,t,t.content.size,t.childCount,-1)||new ZR(t)},WR.fromJSON=function(t,e){if(!e||!e.type)throw new RangeError("Invalid input for Selection.fromJSON");var n=qR[e.type];if(!n)throw new RangeError("No selection type "+e.type+" defined");return n.fromJSON(t,e)},WR.jsonID=function(t,e){if(t in qR)throw new RangeError("Duplicate use of selection JSON ID "+t);return qR[t]=e,e.prototype.jsonID=t,e},WR.prototype.getBookmark=function(){return UR.between(this.$anchor,this.$head).getBookmark()},Object.defineProperties(WR.prototype,HR),WR.prototype.visible=!0;var KR=function(t,e){this.$from=t,this.$to=e},UR=function(t){function e(e,n){void 0===n&&(n=e),t.call(this,e,n)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={$cursor:{configurable:!0}};return n.$cursor.get=function(){return this.$anchor.pos==this.$head.pos?this.$head:null},e.prototype.map=function(n,r){var o=n.resolve(r.map(this.head));if(!o.parent.inlineContent)return t.near(o);var i=n.resolve(r.map(this.anchor));return new e(i.parent.inlineContent?i:o,o)},e.prototype.replace=function(e,n){if(void 0===n&&(n=HA.empty),t.prototype.replace.call(this,e,n),n==HA.empty){var r=this.$from.marksAcross(this.$to);r&&e.ensureMarks(r)}},e.prototype.eq=function(t){return t instanceof e&&t.anchor==this.anchor&&t.head==this.head},e.prototype.getBookmark=function(){return new GR(this.anchor,this.head)},e.prototype.toJSON=function(){return{type:"text",anchor:this.anchor,head:this.head}},e.fromJSON=function(t,n){if("number"!=typeof n.anchor||"number"!=typeof n.head)throw new RangeError("Invalid input for TextSelection.fromJSON");return new e(t.resolve(n.anchor),t.resolve(n.head))},e.create=function(t,e,n){void 0===n&&(n=e);var r=t.resolve(e);return new this(r,n==e?r:t.resolve(n))},e.between=function(n,r,o){var i=n.pos-r.pos;if(o&&!i||(o=i>=0?1:-1),!r.parent.inlineContent){var s=t.findFrom(r,o,!0)||t.findFrom(r,-o,!0);if(!s)return t.near(r,o);r=s.$head}return n.parent.inlineContent||(0==i?n=r:(n=(t.findFrom(n,-o,!0)||t.findFrom(n,o,!0)).$anchor,n.pos<r.pos!=i<0&&(n=r))),new e(n,r)},Object.defineProperties(e.prototype,n),e}(WR);WR.jsonID("text",UR);var GR=function(t,e){this.anchor=t,this.head=e};GR.prototype.map=function(t){return new GR(t.map(this.anchor),t.map(this.head))},GR.prototype.resolve=function(t){return UR.between(t.resolve(this.anchor),t.resolve(this.head))};var XR=function(t){function e(e){var n=e.nodeAfter,r=e.node(0).resolve(e.pos+n.nodeSize);t.call(this,e,r),this.node=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.map=function(n,r){var o=r.mapResult(this.anchor),i=o.deleted,s=o.pos,a=n.resolve(s);return i?t.near(a):new e(a)},e.prototype.content=function(){return new HA(_A.from(this.node),0,0)},e.prototype.eq=function(t){return t instanceof e&&t.anchor==this.anchor},e.prototype.toJSON=function(){return{type:"node",anchor:this.anchor}},e.prototype.getBookmark=function(){return new YR(this.anchor)},e.fromJSON=function(t,n){if("number"!=typeof n.anchor)throw new RangeError("Invalid input for NodeSelection.fromJSON");return new e(t.resolve(n.anchor))},e.create=function(t,e){return new this(t.resolve(e))},e.isSelectable=function(t){return!t.isText&&!1!==t.type.spec.selectable},e}(WR);XR.prototype.visible=!1,WR.jsonID("node",XR);var YR=function(t){this.anchor=t};YR.prototype.map=function(t){var e=t.mapResult(this.anchor),n=e.deleted,r=e.pos;return n?new GR(r,r):new YR(r)},YR.prototype.resolve=function(t){var e=t.resolve(this.anchor),n=e.nodeAfter;return n&&XR.isSelectable(n)?new XR(e):WR.near(e)};var ZR=function(t){function e(e){t.call(this,e.resolve(0),e.resolve(e.content.size))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.replace=function(e,n){if(void 0===n&&(n=HA.empty),n==HA.empty){e.delete(0,e.doc.content.size);var r=t.atStart(e.doc);r.eq(e.selection)||e.setSelection(r)}else t.prototype.replace.call(this,e,n)},e.prototype.toJSON=function(){return{type:"all"}},e.fromJSON=function(t){return new e(t)},e.prototype.map=function(t){return new e(t)},e.prototype.eq=function(t){return t instanceof e},e.prototype.getBookmark=function(){return QR},e}(WR);WR.jsonID("all",ZR);var QR={map:function(){return this},resolve:function(t){return new ZR(t)}};function tz(t,e,n,r,o,i){if(e.inlineContent)return UR.create(t,n);for(var s=r-(o>0?0:1);o>0?s<e.childCount:s>=0;s+=o){var a=e.child(s);if(a.isAtom){if(!i&&XR.isSelectable(a))return XR.create(t,n-(o<0?a.nodeSize:0))}else{var c=tz(t,a,n+o,o<0?a.childCount:0,o,i);if(c)return c}n+=a.nodeSize*o}}function ez(t,e,n){var r=t.steps.length-1;if(!(r<e)){var o=t.steps[r];if(o instanceof OR||o instanceof CR){var i,s=t.mapping.maps[r];s.forEach((function(t,e,n,r){null==i&&(i=r)})),t.setSelection(WR.near(t.doc.resolve(i),n))}}}var nz=1,rz=2,oz=4,iz=function(t){function e(e){t.call(this,e.doc),this.time=Date.now(),this.curSelection=e.selection,this.curSelectionFor=0,this.storedMarks=e.storedMarks,this.updated=0,this.meta=Object.create(null)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={selection:{configurable:!0},selectionSet:{configurable:!0},storedMarksSet:{configurable:!0},isGeneric:{configurable:!0},scrolledIntoView:{configurable:!0}};return n.selection.get=function(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection},e.prototype.setSelection=function(t){if(t.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=t,this.curSelectionFor=this.steps.length,this.updated=(this.updated|nz)&~rz,this.storedMarks=null,this},n.selectionSet.get=function(){return(this.updated&nz)>0},e.prototype.setStoredMarks=function(t){return this.storedMarks=t,this.updated|=rz,this},e.prototype.ensureMarks=function(t){return qA.sameSet(this.storedMarks||this.selection.$from.marks(),t)||this.setStoredMarks(t),this},e.prototype.addStoredMark=function(t){return this.ensureMarks(t.addToSet(this.storedMarks||this.selection.$head.marks()))},e.prototype.removeStoredMark=function(t){return this.ensureMarks(t.removeFromSet(this.storedMarks||this.selection.$head.marks()))},n.storedMarksSet.get=function(){return(this.updated&rz)>0},e.prototype.addStep=function(e,n){t.prototype.addStep.call(this,e,n),this.updated=this.updated&~rz,this.storedMarks=null},e.prototype.setTime=function(t){return this.time=t,this},e.prototype.replaceSelection=function(t){return this.selection.replace(this,t),this},e.prototype.replaceSelectionWith=function(t,e){var n=this.selection;return!1!==e&&(t=t.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||qA.none))),n.replaceWith(this,t),this},e.prototype.deleteSelection=function(){return this.selection.replace(this),this},e.prototype.insertText=function(t,e,n){void 0===n&&(n=e);var r=this.doc.type.schema;if(null==e)return t?this.replaceSelectionWith(r.text(t),!0):this.deleteSelection();if(!t)return this.deleteRange(e,n);var o=this.storedMarks;if(!o){var i=this.doc.resolve(e);o=n==e?i.marks():i.marksAcross(this.doc.resolve(n))}return this.replaceRangeWith(e,n,r.text(t,o)),this.selection.empty||this.setSelection(WR.near(this.selection.$to)),this},e.prototype.setMeta=function(t,e){return this.meta["string"==typeof t?t:t.key]=e,this},e.prototype.getMeta=function(t){return this.meta["string"==typeof t?t:t.key]},n.isGeneric.get=function(){for(var t in this.meta)return!1;return!0},e.prototype.scrollIntoView=function(){return this.updated|=oz,this},n.scrolledIntoView.get=function(){return(this.updated&oz)>0},Object.defineProperties(e.prototype,n),e}(yR);function sz(t,e){return e&&t?t.bind(e):t}var az=function(t,e,n){this.name=t,this.init=sz(e.init,n),this.apply=sz(e.apply,n)},cz=[new az("doc",{init:function(t){return t.doc||t.schema.topNodeType.createAndFill()},apply:function(t){return t.doc}}),new az("selection",{init:function(t,e){return t.selection||WR.atStart(e.doc)},apply:function(t){return t.selection}}),new az("storedMarks",{init:function(t){return t.storedMarks||null},apply:function(t,e,n,r){return r.selection.$cursor?t.storedMarks:null}}),new az("scrollToSelection",{init:function(){return 0},apply:function(t,e){return t.scrolledIntoView?e+1:e}})],hz=function(t,e){var n=this;this.schema=t,this.fields=cz.concat(),this.plugins=[],this.pluginsByKey=Object.create(null),e&&e.forEach((function(t){if(n.pluginsByKey[t.key])throw new RangeError("Adding different instances of a keyed plugin ("+t.key+")");n.plugins.push(t),n.pluginsByKey[t.key]=t,t.spec.state&&n.fields.push(new az(t.key,t.spec.state,t))}))},pz=function(t){this.config=t},lz={schema:{configurable:!0},plugins:{configurable:!0},tr:{configurable:!0}};lz.schema.get=function(){return this.config.schema},lz.plugins.get=function(){return this.config.plugins},pz.prototype.apply=function(t){return this.applyTransaction(t).state},pz.prototype.filterTransaction=function(t,e){void 0===e&&(e=-1);for(var n=0;n<this.config.plugins.length;n++)if(n!=e){var r=this.config.plugins[n];if(r.spec.filterTransaction&&!r.spec.filterTransaction.call(r,t,this))return!1}return!0},pz.prototype.applyTransaction=function(t){if(!this.filterTransaction(t))return{state:this,transactions:[]};for(var e=[t],n=this.applyInner(t),r=null;;){for(var o=!1,i=0;i<this.config.plugins.length;i++){var s=this.config.plugins[i];if(s.spec.appendTransaction){var a=r?r[i].n:0,c=r?r[i].state:this,h=a<e.length&&s.spec.appendTransaction.call(s,a?e.slice(a):e,c,n);if(h&&n.filterTransaction(h,i)){if(h.setMeta("appendedTransaction",t),!r){r=[];for(var p=0;p<this.config.plugins.length;p++)r.push(p<i?{state:n,n:e.length}:{state:this,n:0})}e.push(h),n=n.applyInner(h),o=!0}r&&(r[i]={state:n,n:e.length})}}if(!o)return{state:n,transactions:e}}},pz.prototype.applyInner=function(t){if(!t.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");for(var e=new pz(this.config),n=this.config.fields,r=0;r<n.length;r++){var o=n[r];e[o.name]=o.apply(t,this[o.name],this,e)}for(var i=0;i<uz.length;i++)uz[i](this,t,e);return e},lz.tr.get=function(){return new iz(this)},pz.create=function(t){for(var e=new hz(t.doc?t.doc.type.schema:t.schema,t.plugins),n=new pz(e),r=0;r<e.fields.length;r++)n[e.fields[r].name]=e.fields[r].init(t,n);return n},pz.prototype.reconfigure=function(t){for(var e=new hz(this.schema,t.plugins),n=e.fields,r=new pz(e),o=0;o<n.length;o++){var i=n[o].name;r[i]=this.hasOwnProperty(i)?this[i]:n[o].init(t,r)}return r},pz.prototype.toJSON=function(t){var e={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(e.storedMarks=this.storedMarks.map((function(t){return t.toJSON()}))),t&&"object"==typeof t)for(var n in t){if("doc"==n||"selection"==n)throw new RangeError("The JSON fields `doc` and `selection` are reserved");var r=t[n],o=r.spec.state;o&&o.toJSON&&(e[n]=o.toJSON.call(r,this[r.key]))}return e},pz.fromJSON=function(t,e,n){if(!e)throw new RangeError("Invalid input for EditorState.fromJSON");if(!t.schema)throw new RangeError("Required config field 'schema' missing");var r=new hz(t.schema,t.plugins),o=new pz(r);return r.fields.forEach((function(r){if("doc"==r.name)o.doc=dD.fromJSON(t.schema,e.doc);else if("selection"==r.name)o.selection=WR.fromJSON(o.doc,e.selection);else if("storedMarks"==r.name)e.storedMarks&&(o.storedMarks=e.storedMarks.map(t.schema.markFromJSON));else{if(n)for(var i in n){var s=n[i],a=s.spec.state;if(s.key==r.name&&a&&a.fromJSON&&Object.prototype.hasOwnProperty.call(e,i))return void(o[r.name]=a.fromJSON.call(s,t,e[i],o))}o[r.name]=r.init(t,o)}})),o},pz.addApplyListener=function(t){uz.push(t)},pz.removeApplyListener=function(t){var e=uz.indexOf(t);e>-1&&uz.splice(e,1)},Object.defineProperties(pz.prototype,lz);var uz=[];function fz(t,e,n){for(var r in t){var o=t[r];o instanceof Function?o=o.bind(e):"handleDOMEvents"==r&&(o=fz(o,e,{})),n[r]=o}return n}var dz=function(t){this.props={},t.props&&fz(t.props,this,this.props),this.spec=t,this.key=t.key?t.key.key:vz("plugin")};dz.prototype.getState=function(t){return t[this.key]};var mz=Object.create(null);function vz(t){return t in mz?t+"$"+ ++mz[t]:(mz[t]=0,t+"$")}var gz,yz,wz=function(t){void 0===t&&(t="key"),this.key=vz(t)};if(wz.prototype.get=function(t){return t.config.pluginsByKey[this.key]},wz.prototype.getState=function(t){return t[this.key]},"undefined"!=typeof WeakMap){var xz=new WeakMap;gz=function(t){return xz.get(t)},yz=function(t,e){return xz.set(t,e),e}}else{var bz=[],kz=10,Sz=0;gz=function(t){for(var e=0;e<bz.length;e+=2)if(bz[e]==t)return bz[e+1]},yz=function(t,e){return Sz==kz&&(Sz=0),bz[Sz++]=t,bz[Sz++]=e}}var Oz=function(t,e,n,r){this.left=t,this.top=e,this.right=n,this.bottom=r},Cz=function(t,e,n,r){this.width=t,this.height=e,this.map=n,this.problems=r};function Mz(t){if("table"!=t.type.spec.tableRole)throw new RangeError("Not a table node: "+t.type.name);for(var e=Nz(t),n=t.childCount,r=[],o=0,i=null,s=[],a=0,c=e*n;a<c;a++)r[a]=0;for(var h=0,p=0;h<n;h++){var l=t.child(h);p++;for(var u=0;;u++){while(o<r.length&&0!=r[o])o++;if(u==l.childCount)break;for(var f=l.child(u),d=f.attrs,m=d.colspan,v=d.rowspan,g=d.colwidth,y=0;y<v;y++){if(y+h>=n){(i||(i=[])).push({type:"overlong_rowspan",pos:p,n:v-y});break}for(var w=o+y*e,x=0;x<m;x++){0==r[w+x]?r[w+x]=p:(i||(i=[])).push({type:"collision",row:h,pos:p,n:m-x});var b=g&&g[x];if(b){var k=(w+x)%e*2,S=s[k];null==S||S!=b&&1==s[k+1]?(s[k]=b,s[k+1]=1):S==b&&s[k+1]++}}}o+=m,p+=f.nodeSize}var O=(h+1)*e,C=0;while(o<O)0==r[o++]&&C++;C&&(i||(i=[])).push({type:"missing",row:h,n:C}),p++}for(var M=new Cz(e,n,r,i),N=!1,T=0;!N&&T<s.length;T+=2)null!=s[T]&&s[T+1]<n&&(N=!0);return N&&Tz(M,s,t),M}function Nz(t){for(var e=-1,n=!1,r=0;r<t.childCount;r++){var o=t.child(r),i=0;if(n)for(var s=0;s<r;s++)for(var a=t.child(s),c=0;c<a.childCount;c++){var h=a.child(c);s+h.attrs.rowspan>r&&(i+=h.attrs.colspan)}for(var p=0;p<o.childCount;p++){var l=o.child(p);i+=l.attrs.colspan,l.attrs.rowspan>1&&(n=!0)}-1==e?e=i:e!=i&&(e=Math.max(e,i))}return e}function Tz(t,e,n){t.problems||(t.problems=[]);for(var r=0,o={};r<t.map.length;r++){var i=t.map[r];if(!o[i]){o[i]=!0;for(var s=n.nodeAt(i),a=null,c=0;c<s.attrs.colspan;c++){var h=(r+c)%t.width,p=e[2*h];null==p||s.attrs.colwidth&&s.attrs.colwidth[c]==p||((a||(a=Ez(s.attrs)))[c]=p)}a&&t.problems.unshift({type:"colwidth mismatch",pos:i,colwidth:a})}}}function Ez(t){if(t.colwidth)return t.colwidth.slice();for(var e=[],n=0;n<t.colspan;n++)e.push(0);return e}function Az(t,e){var n=t.getAttribute("data-colwidth"),r=n&&/^\d+(,\d+)*$/.test(n)?n.split(",").map((function(t){return Number(t)})):null,o=Number(t.getAttribute("colspan")||1),i={colspan:o,rowspan:Number(t.getAttribute("rowspan")||1),colwidth:r&&r.length==o?r:null};for(var s in e){var a=e[s].getFromDOM,c=a&&a(t);null!=c&&(i[s]=c)}return i}function Dz(t,e){var n={};for(var r in 1!=t.attrs.colspan&&(n.colspan=t.attrs.colspan),1!=t.attrs.rowspan&&(n.rowspan=t.attrs.rowspan),t.attrs.colwidth&&(n["data-colwidth"]=t.attrs.colwidth.join(",")),e){var o=e[r].setDOMAttr;o&&o(t.attrs[r],n)}return n}function Rz(t){var e=t.cellAttributes||{},n={colspan:{default:1},rowspan:{default:1},colwidth:{default:null}};for(var r in e)n[r]={default:e[r].default};return{table:{content:"table_row+",tableRole:"table",isolating:!0,group:t.tableGroup,parseDOM:[{tag:"table"}],toDOM:function(){return["table",["tbody",0]]}},table_row:{content:"(table_cell | table_header)*",tableRole:"row",parseDOM:[{tag:"tr"}],toDOM:function(){return["tr",0]}},table_cell:{content:t.cellContent,attrs:n,tableRole:"cell",isolating:!0,parseDOM:[{tag:"td",getAttrs:function(t){return Az(t,e)}}],toDOM:function(t){return["td",Dz(t,e),0]}},table_header:{content:t.cellContent,attrs:n,tableRole:"header_cell",isolating:!0,parseDOM:[{tag:"th",getAttrs:function(t){return Az(t,e)}}],toDOM:function(t){return["th",Dz(t,e),0]}}}}function zz(t){var e=t.cached.tableNodeTypes;if(!e)for(var n in e=t.cached.tableNodeTypes={},t.nodes){var r=t.nodes[n],o=r.spec.tableRole;o&&(e[o]=r)}return e}Cz.prototype.findCell=function(t){for(var e=0;e<this.map.length;e++){var n=this.map[e];if(n==t){for(var r=e%this.width,o=e/this.width|0,i=r+1,s=o+1,a=1;i<this.width&&this.map[e+a]==n;a++)i++;for(var c=1;s<this.height&&this.map[e+this.width*c]==n;c++)s++;return new Oz(r,o,i,s)}}throw new RangeError("No cell with offset "+t+" found")},Cz.prototype.colCount=function(t){for(var e=0;e<this.map.length;e++)if(this.map[e]==t)return e%this.width;throw new RangeError("No cell with offset "+t+" found")},Cz.prototype.nextCell=function(t,e,n){var r=this.findCell(t),o=r.left,i=r.right,s=r.top,a=r.bottom;return"horiz"==e?(n<0?0==o:i==this.width)?null:this.map[s*this.width+(n<0?o-1:i)]:(n<0?0==s:a==this.height)?null:this.map[o+this.width*(n<0?s-1:a)]},Cz.prototype.rectBetween=function(t,e){var n=this.findCell(t),r=n.left,o=n.right,i=n.top,s=n.bottom,a=this.findCell(e),c=a.left,h=a.right,p=a.top,l=a.bottom;return new Oz(Math.min(r,c),Math.min(i,p),Math.max(o,h),Math.max(s,l))},Cz.prototype.cellsInRect=function(t){for(var e=[],n={},r=t.top;r<t.bottom;r++)for(var o=t.left;o<t.right;o++){var i=r*this.width+o,s=this.map[i];n[s]||(n[s]=!0,o==t.left&&o&&this.map[i-1]==s||r==t.top&&r&&this.map[i-this.width]==s||e.push(s))}return e},Cz.prototype.positionAt=function(t,e,n){for(var r=0,o=0;;r++){var i=o+n.child(r).nodeSize;if(r==t){var s=e+t*this.width,a=(t+1)*this.width;while(s<a&&this.map[s]<o)s++;return s==a?i-1:this.map[s]}o=i}},Cz.get=function(t){return gz(t)||yz(t,Mz(t))};var Iz=new ll("selectingCells");function Pz(t){for(var e=t.depth-1;e>0;e--)if("row"==t.node(e).type.spec.tableRole)return t.node(0).resolve(t.before(e+1));return null}function Fz(t){for(var e=t.depth;e>0;e--){var n=t.node(e).type.spec.tableRole;if("cell"===n||"header_cell"===n)return t.node(e)}return null}function Bz(t){for(var e=t.selection.$head,n=e.depth;n>0;n--)if("row"==e.node(n).type.spec.tableRole)return!0;return!1}function $z(t){var e=t.selection;return e.$anchorCell?e.$anchorCell.pos>e.$headCell.pos?e.$anchorCell:e.$headCell:e.node&&"cell"==e.node.type.spec.tableRole?e.$anchor:Pz(e.$head)||_z(e.$head)}function _z(t){for(var e=t.nodeAfter,n=t.pos;e;e=e.firstChild,n++){var r=e.type.spec.tableRole;if("cell"==r||"header_cell"==r)return t.doc.resolve(n)}for(var o=t.nodeBefore,i=t.pos;o;o=o.lastChild,i--){var s=o.type.spec.tableRole;if("cell"==s||"header_cell"==s)return t.doc.resolve(i-o.nodeSize)}}function jz(t){return"row"==t.parent.type.spec.tableRole&&t.nodeAfter}function Jz(t){return t.node(0).resolve(t.pos+t.nodeAfter.nodeSize)}function Lz(t,e){return t.depth==e.depth&&t.pos>=e.start(-1)&&t.pos<=e.end(-1)}function Vz(t,e,n){var r=t.start(-1),o=Cz.get(t.node(-1)),i=o.nextCell(t.pos-r,e,n);return null==i?null:t.node(0).resolve(r+i)}function qz(t,e,n){var r={};for(var o in t)r[o]=t[o];return r[e]=n,r}function Wz(t,e,n){void 0===n&&(n=1);var r=qz(t,"colspan",t.colspan-n);return r.colwidth&&(r.colwidth=r.colwidth.slice(),r.colwidth.splice(e,n),r.colwidth.some((function(t){return t>0}))||(r.colwidth=null)),r}function Hz(t,e,n){void 0===n&&(n=1);var r=qz(t,"colspan",t.colspan+n);if(r.colwidth){r.colwidth=r.colwidth.slice();for(var o=0;o<n;o++)r.colwidth.splice(e,0,0)}return r}function Kz(t,e,n){for(var r=zz(e.type.schema).header_cell,o=0;o<t.height;o++)if(e.nodeAt(t.map[n+o*t.width]).type!=r)return!1;return!0}var Uz=function(t){function e(e,n){void 0===n&&(n=e);var r=e.node(-1),o=Cz.get(r),i=e.start(-1),s=o.rectBetween(e.pos-i,n.pos-i),a=e.node(0),c=o.cellsInRect(s).filter((function(t){return t!=n.pos-i}));c.unshift(n.pos-i);var h=c.map((function(t){var e=r.nodeAt(t),n=t+i+1;return new Jp(a.resolve(n),a.resolve(n+e.content.size))}));t.call(this,h[0].$from,h[0].$to,h),this.$anchorCell=e,this.$headCell=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.map=function(t,n){var r=t.resolve(n.map(this.$anchorCell.pos)),o=t.resolve(n.map(this.$headCell.pos));if(jz(r)&&jz(o)&&Lz(r,o)){var i=this.$anchorCell.node(-1)!=r.node(-1);return i&&this.isRowSelection()?e.rowSelection(r,o):i&&this.isColSelection()?e.colSelection(r,o):new e(r,o)}return Lp.between(r,o)},e.prototype.content=function(){for(var t=this.$anchorCell.node(-1),e=Cz.get(t),n=this.$anchorCell.start(-1),r=e.rectBetween(this.$anchorCell.pos-n,this.$headCell.pos-n),o={},i=[],s=r.top;s<r.bottom;s++){for(var a=[],c=s*e.width+r.left,h=r.left;h<r.right;h++,c++){var p=e.map[c];if(!o[p]){o[p]=!0;var l=e.findCell(p),u=t.nodeAt(p),f=r.left-l.left,d=l.right-r.right;if(f>0||d>0){var m=u.attrs;f>0&&(m=Wz(m,0,f)),d>0&&(m=Wz(m,m.colspan-d,d)),u=l.left<r.left?u.type.createAndFill(m):u.type.create(m,u.content)}if(l.top<r.top||l.bottom>r.bottom){var v=qz(u.attrs,"rowspan",Math.min(l.bottom,r.bottom)-Math.max(l.top,r.top));u=l.top<r.top?u.type.createAndFill(v):u.type.create(v,u.content)}a.push(u)}}i.push(t.child(s).copy(Bt.from(a)))}var g=this.isColSelection()&&this.isRowSelection()?t:i;return new qt(Bt.from(g),1,1)},e.prototype.replace=function(e,n){void 0===n&&(n=qt.empty);for(var r=e.steps.length,o=this.ranges,i=0;i<o.length;i++){var s=o[i],a=s.$from,c=s.$to,h=e.mapping.slice(r);e.replace(h.map(a.pos),h.map(c.pos),i?qt.empty:n)}var p=t.findFrom(e.doc.resolve(e.mapping.slice(r).map(this.to)),-1);p&&e.setSelection(p)},e.prototype.replaceWith=function(t,e){this.replace(t,new qt(Bt.from(e),0,0))},e.prototype.forEachCell=function(t){for(var e=this.$anchorCell.node(-1),n=Cz.get(e),r=this.$anchorCell.start(-1),o=n.cellsInRect(n.rectBetween(this.$anchorCell.pos-r,this.$headCell.pos-r)),i=0;i<o.length;i++)t(e.nodeAt(o[i]),r+o[i])},e.prototype.isColSelection=function(){var t=this.$anchorCell.index(-1),e=this.$headCell.index(-1);if(Math.min(t,e)>0)return!1;var n=t+this.$anchorCell.nodeAfter.attrs.rowspan,r=e+this.$headCell.nodeAfter.attrs.rowspan;return Math.max(n,r)==this.$headCell.node(-1).childCount},e.colSelection=function(t,n){void 0===n&&(n=t);var r=Cz.get(t.node(-1)),o=t.start(-1),i=r.findCell(t.pos-o),s=r.findCell(n.pos-o),a=t.node(0);return i.top<=s.top?(i.top>0&&(t=a.resolve(o+r.map[i.left])),s.bottom<r.height&&(n=a.resolve(o+r.map[r.width*(r.height-1)+s.right-1]))):(s.top>0&&(n=a.resolve(o+r.map[s.left])),i.bottom<r.height&&(t=a.resolve(o+r.map[r.width*(r.height-1)+i.right-1]))),new e(t,n)},e.prototype.isRowSelection=function(){var t=Cz.get(this.$anchorCell.node(-1)),e=this.$anchorCell.start(-1),n=t.colCount(this.$anchorCell.pos-e),r=t.colCount(this.$headCell.pos-e);if(Math.min(n,r)>0)return!1;var o=n+this.$anchorCell.nodeAfter.attrs.colspan,i=r+this.$headCell.nodeAfter.attrs.colspan;return Math.max(o,i)==t.width},e.prototype.eq=function(t){return t instanceof e&&t.$anchorCell.pos==this.$anchorCell.pos&&t.$headCell.pos==this.$headCell.pos},e.rowSelection=function(t,n){void 0===n&&(n=t);var r=Cz.get(t.node(-1)),o=t.start(-1),i=r.findCell(t.pos-o),s=r.findCell(n.pos-o),a=t.node(0);return i.left<=s.left?(i.left>0&&(t=a.resolve(o+r.map[i.top*r.width])),s.right<r.width&&(n=a.resolve(o+r.map[r.width*(s.top+1)-1]))):(s.left>0&&(n=a.resolve(o+r.map[s.top*r.width])),i.right<r.width&&(t=a.resolve(o+r.map[r.width*(i.top+1)-1]))),new e(t,n)},e.prototype.toJSON=function(){return{type:"cell",anchor:this.$anchorCell.pos,head:this.$headCell.pos}},e.fromJSON=function(t,n){return new e(t.resolve(n.anchor),t.resolve(n.head))},e.create=function(t,n,r){return void 0===r&&(r=n),new e(t.resolve(n),t.resolve(r))},e.prototype.getBookmark=function(){return new Gz(this.$anchorCell.pos,this.$headCell.pos)},e}(_p);Uz.prototype.visible=!1,_p.jsonID("cell",Uz);var Gz=function(t,e){this.anchor=t,this.head=e};function Xz(t){if(!(t.selection instanceof Uz))return null;var e=[];return t.selection.forEachCell((function(t,n){e.push(Vd.node(n,n+t.nodeSize,{class:"selectedCell"}))})),Kd.create(t.doc,e)}function Yz(t){var e=t.$from,n=t.$to;if(e.pos==n.pos||e.pos<e.pos-6)return!1;for(var r=e.pos,o=n.pos,i=e.depth;i>=0;i--,r++)if(e.after(i+1)<e.end(i))break;for(var s=n.depth;s>=0;s--,o--)if(n.before(s+1)>n.start(s))break;return r==o&&/row|table/.test(e.node(i).type.spec.tableRole)}function Zz(t){for(var e,n,r=t.$from,o=t.$to,i=r.depth;i>0;i--){var s=r.node(i);if("cell"===s.type.spec.tableRole||"header_cell"===s.type.spec.tableRole){e=s;break}}for(var a=o.depth;a>0;a--){var c=o.node(a);if("cell"===c.type.spec.tableRole||"header_cell"===c.type.spec.tableRole){n=c;break}}return e!==n&&0===o.parentOffset}function Qz(t,e,n){var r,o,i=(e||t).selection,s=(e||t).doc;if(i instanceof qp&&(o=i.node.type.spec.tableRole)){if("cell"==o||"header_cell"==o)r=Uz.create(s,i.from);else if("row"==o){var a=s.resolve(i.from+1);r=Uz.rowSelection(a,a)}else if(!n){var c=Cz.get(i.node),h=i.from+1,p=h+c.map[c.width*c.height-1];r=Uz.create(s,h+1,p)}}else i instanceof Lp&&Yz(i)?r=Lp.create(s,i.from):i instanceof Lp&&Zz(i)&&(r=Lp.create(s,i.$from.start(),i.$from.end()));return r&&(e||(e=t.tr)).setSelection(r),e}function tI(t){if(!t.size)return null;var e=t.content,n=t.openStart,r=t.openEnd;while(1==e.childCount&&(n>0&&r>0||"table"==e.firstChild.type.spec.tableRole))n--,r--,e=e.firstChild.content;var o=e.firstChild,i=o.type.spec.tableRole,s=o.type.schema,a=[];if("row"==i)for(var c=0;c<e.childCount;c++){var h=e.child(c).content,p=c?0:Math.max(0,n-1),l=c<e.childCount-1?0:Math.max(0,r-1);(p||l)&&(h=nI(zz(s).row,new qt(h,p,l)).content),a.push(h)}else{if("cell"!=i&&"header_cell"!=i)return null;a.push(n||r?nI(zz(s).row,new qt(e,n,r)).content:e)}return eI(s,a)}function eI(t,e){for(var n=[],r=0;r<e.length;r++)for(var o=e[r],i=o.childCount-1;i>=0;i--)for(var s=o.child(i).attrs,a=s.rowspan,c=s.colspan,h=r;h<r+a;h++)n[h]=(n[h]||0)+c;for(var p=0,l=0;l<n.length;l++)p=Math.max(p,n[l]);for(var u=0;u<n.length;u++)if(u>=e.length&&e.push(Bt.empty),n[u]<p){for(var f=zz(t).cell.createAndFill(),d=[],m=n[u];m<p;m++)d.push(f);e[u]=e[u].append(Bt.from(d))}return{height:e.length,width:p,rows:e}}function nI(t,e){var n=t.createAndFill(),r=new gn(n).replace(0,n.content.size,e);return r.doc}function rI(t,e,n){var r=t.width,o=t.height,i=t.rows;if(r!=e){for(var s=[],a=[],c=0;c<i.length;c++){for(var h=i[c],p=[],l=s[c]||0,u=0;l<e;u++){var f=h.child(u%h.childCount);l+f.attrs.colspan>e&&(f=f.type.create(Wz(f.attrs,f.attrs.colspan,l+f.attrs.colspan-e),f.content)),p.push(f),l+=f.attrs.colspan;for(var d=1;d<f.attrs.rowspan;d++)s[c+d]=(s[c+d]||0)+f.attrs.colspan}a.push(Bt.from(p))}i=a,r=e}if(o!=n){for(var m=[],v=0,g=0;v<n;v++,g++){for(var y=[],w=i[g%o],x=0;x<w.childCount;x++){var b=w.child(x);v+b.attrs.rowspan>n&&(b=b.type.create(qz(b.attrs,"rowspan",Math.max(1,n-b.attrs.rowspan)),b.content)),y.push(b)}m.push(Bt.from(y))}i=m,o=n}return{width:r,height:o,rows:i}}function oI(t,e,n,r,o,i,s){var a,c,h=t.doc.type.schema,p=zz(h);if(o>e.width)for(var l=0,u=0;l<e.height;l++){var f=n.child(l);u+=f.nodeSize;var d=[],m=void 0;m=null==f.lastChild||f.lastChild.type==p.cell?a||(a=p.cell.createAndFill()):c||(c=p.header_cell.createAndFill());for(var v=e.width;v<o;v++)d.push(m);t.insert(t.mapping.slice(s).map(u-1+r),d)}if(i>e.height){for(var g=[],y=0,w=(e.height-1)*e.width;y<Math.max(e.width,o);y++){var x=!(y>=e.width)&&n.nodeAt(e.map[w+y]).type==p.header_cell;g.push(x?c||(c=p.header_cell.createAndFill()):a||(a=p.cell.createAndFill()))}for(var b=p.row.create(null,Bt.from(g)),k=[],S=e.height;S<i;S++)k.push(b);t.insert(t.mapping.slice(s).map(r+n.nodeSize-2),k)}return!(!a&&!c)}function iI(t,e,n,r,o,i,s,a){if(0==s||s==e.height)return!1;for(var c=!1,h=o;h<i;h++){var p=s*e.width+h,l=e.map[p];if(e.map[p-e.width]==l){c=!0;var u=n.nodeAt(l),f=e.findCell(l),d=f.top,m=f.left;t.setNodeMarkup(t.mapping.slice(a).map(l+r),null,qz(u.attrs,"rowspan",s-d)),t.insert(t.mapping.slice(a).map(e.positionAt(s,m,n)),u.type.createAndFill(qz(u.attrs,"rowspan",d+u.attrs.rowspan-s))),h+=u.attrs.colspan-1}}return c}function sI(t,e,n,r,o,i,s,a){if(0==s||s==e.width)return!1;for(var c=!1,h=o;h<i;h++){var p=h*e.width+s,l=e.map[p];if(e.map[p-1]==l){c=!0;var u=n.nodeAt(l),f=e.colCount(l),d=t.mapping.slice(a).map(l+r);t.setNodeMarkup(d,null,Wz(u.attrs,s-f,u.attrs.colspan-(s-f))),t.insert(d+u.nodeSize,u.type.createAndFill(Wz(u.attrs,0,s-f))),h+=u.attrs.rowspan-1}}return c}function aI(t,e,n,r,o){var i=n?t.doc.nodeAt(n-1):t.doc,s=Cz.get(i),a=r.top,c=r.left,h=c+o.width,p=a+o.height,l=t.tr,u=0;function f(){i=n?l.doc.nodeAt(n-1):l.doc,s=Cz.get(i),u=l.mapping.maps.length}oI(l,s,i,n,h,p,u)&&f(),iI(l,s,i,n,c,h,a,u)&&f(),iI(l,s,i,n,c,h,p,u)&&f(),sI(l,s,i,n,a,p,c,u)&&f(),sI(l,s,i,n,a,p,h,u)&&f();for(var d=a;d<p;d++){var m=s.positionAt(d,c,i),v=s.positionAt(d,h,i);l.replace(l.mapping.slice(u).map(m+n),l.mapping.slice(u).map(v+n),new qt(o.rows[d-a],0,0))}f(),l.setSelection(new Uz(l.doc.resolve(n+s.positionAt(a,c,i)),l.doc.resolve(n+s.positionAt(p-1,h-1,i)))),e(l)}Gz.prototype.map=function(t){return new Gz(t.map(this.anchor),t.map(this.head))},Gz.prototype.resolve=function(t){var e=t.resolve(this.anchor),n=t.resolve(this.head);return"row"==e.parent.type.spec.tableRole&&"row"==n.parent.type.spec.tableRole&&e.index()<e.parent.childCount&&n.index()<n.parent.childCount&&Lz(e,n)?new Uz(e,n):_p.near(n,1)};var cI=Al({ArrowLeft:pI("horiz",-1),ArrowRight:pI("horiz",1),ArrowUp:pI("vert",-1),ArrowDown:pI("vert",1),"Shift-ArrowLeft":lI("horiz",-1),"Shift-ArrowRight":lI("horiz",1),"Shift-ArrowUp":lI("vert",-1),"Shift-ArrowDown":lI("vert",1),Backspace:uI,"Mod-Backspace":uI,Delete:uI,"Mod-Delete":uI});function hI(t,e,n){return!n.eq(t.selection)&&(e&&e(t.tr.setSelection(n).scrollIntoView()),!0)}function pI(t,e){return function(n,r,o){var i=n.selection;if(i instanceof Uz)return hI(n,r,_p.near(i.$headCell,e));if("horiz"!=t&&!i.empty)return!1;var s=vI(o,t,e);if(null==s)return!1;if("horiz"==t)return hI(n,r,_p.near(n.doc.resolve(i.head+e),e));var a,c=n.doc.resolve(s),h=Vz(c,t,e);return a=h?_p.near(h,1):e<0?_p.near(n.doc.resolve(c.before(-1)),-1):_p.near(n.doc.resolve(c.after(-1)),1),hI(n,r,a)}}function lI(t,e){return function(n,r,o){var i=n.selection;if(!(i instanceof Uz)){var s=vI(o,t,e);if(null==s)return!1;i=new Uz(n.doc.resolve(s))}var a=Vz(i.$headCell,t,e);return!!a&&hI(n,r,new Uz(i.$anchorCell,a))}}function uI(t,e){var n=t.selection;if(!(n instanceof Uz))return!1;if(e){var r=t.tr,o=zz(t.schema).cell.createAndFill().content;n.forEachCell((function(t,e){t.content.eq(o)||r.replace(r.mapping.map(e+1),r.mapping.map(e+t.nodeSize-1),new qt(o,0,0))})),r.docChanged&&e(r)}return!0}function fI(t,e){var n=t.state.doc,r=Pz(n.resolve(e));return!!r&&(t.dispatch(t.state.tr.setSelection(new Uz(r))),!0)}function dI(t,e,n){if(!Bz(t.state))return!1;var r=tI(n),o=t.state.selection;if(o instanceof Uz){r||(r={width:1,height:1,rows:[Bt.from(nI(zz(t.state.schema).cell,n))]});var i=o.$anchorCell.node(-1),s=o.$anchorCell.start(-1),a=Cz.get(i).rectBetween(o.$anchorCell.pos-s,o.$headCell.pos-s);return r=rI(r,a.right-a.left,a.bottom-a.top),aI(t.state,t.dispatch,s,a,r),!0}if(r){var c=$z(t.state),h=c.start(-1);return aI(t.state,t.dispatch,h,Cz.get(c.node(-1)).findCell(c.pos-h),r),!0}return!1}function mI(t,e){if(!e.ctrlKey&&!e.metaKey){var n,r=gI(t,e.target);if(e.shiftKey&&t.state.selection instanceof Uz)o(t.state.selection.$anchorCell,e),e.preventDefault();else if(e.shiftKey&&r&&null!=(n=Pz(t.state.selection.$anchor))&&yI(t,e).pos!=n.pos)o(n,e),e.preventDefault();else if(!r)return;t.root.addEventListener("mouseup",i),t.root.addEventListener("dragstart",i),t.root.addEventListener("mousemove",s)}function o(e,n){var r=yI(t,n),o=null==Iz.getState(t.state);if(!r||!Lz(e,r)){if(!o)return;r=e}var i=new Uz(e,r);if(o||!t.state.selection.eq(i)){var s=t.state.tr.setSelection(i);o&&s.setMeta(Iz,e.pos),t.dispatch(s)}}function i(){t.root.removeEventListener("mouseup",i),t.root.removeEventListener("dragstart",i),t.root.removeEventListener("mousemove",s),null!=Iz.getState(t.state)&&t.dispatch(t.state.tr.setMeta(Iz,-1))}function s(n){var s,a=Iz.getState(t.state);if(null!=a)s=t.state.doc.resolve(a);else if(gI(t,n.target)!=r&&(s=yI(t,e),!s))return i();s&&o(s,n)}}function vI(t,e,n){if(!(t.state.selection instanceof Lp))return null;for(var r=t.state.selection,o=r.$head,i=o.depth-1;i>=0;i--){var s=o.node(i),a=n<0?o.index(i):o.indexAfter(i);if(a!=(n<0?0:s.childCount))return null;if("cell"==s.type.spec.tableRole||"header_cell"==s.type.spec.tableRole){var c=o.before(i),h="vert"==e?n>0?"down":"up":n>0?"right":"left";return t.endOfTextblock(h)?c:null}}return null}function gI(t,e){for(;e&&e!=t.dom;e=e.parentNode)if("TD"==e.nodeName||"TH"==e.nodeName)return e}function yI(t,e){var n=t.posAtCoords({left:e.clientX,top:e.clientY});return n&&n?Pz(t.state.doc.resolve(n.pos)):null}var wI=new ll("fix-tables");function xI(t,e,n,r){var o=t.childCount,i=e.childCount;t:for(var s=0,a=0;s<i;s++){for(var c=e.child(s),h=a,p=Math.min(o,s+3);h<p;h++)if(t.child(h)==c){a=h+1,n+=c.nodeSize;continue t}r(c,n),a<o&&t.child(a).sameMarkup(c)?xI(t.child(a),c,n+1,r):c.nodesBetween(0,c.content.size,r,n+1),n+=c.nodeSize}}function bI(t,e){var n,r=function(e,r){"table"==e.type.spec.tableRole&&(n=kI(t,e,r,n))};return e?e.doc!=t.doc&&xI(e.doc,t.doc,0,r):t.doc.descendants(r),n}function kI(t,e,n,r){var o=Cz.get(e);if(!o.problems)return r;r||(r=t.tr);for(var i,s,a=[],c=0;c<o.height;c++)a.push(0);for(var h=0;h<o.problems.length;h++){var p=o.problems[h];if("collision"==p.type){for(var l=e.nodeAt(p.pos),u=0;u<l.attrs.rowspan;u++)a[p.row+u]+=p.n;r.setNodeMarkup(r.mapping.map(n+1+p.pos),null,Wz(l.attrs,l.attrs.colspan-p.n,p.n))}else if("missing"==p.type)a[p.row]+=p.n;else if("overlong_rowspan"==p.type){var f=e.nodeAt(p.pos);r.setNodeMarkup(r.mapping.map(n+1+p.pos),null,qz(f.attrs,"rowspan",f.attrs.rowspan-p.n))}else if("colwidth mismatch"==p.type){var d=e.nodeAt(p.pos);r.setNodeMarkup(r.mapping.map(n+1+p.pos),null,qz(d.attrs,"colwidth",p.colwidth))}}for(var m=0;m<a.length;m++)a[m]&&(null==i&&(i=m),s=m);for(var v=0,g=n+1;v<o.height;v++){var y=e.child(v),w=g+y.nodeSize,x=a[v];if(x>0){var b="cell";y.firstChild&&(b=y.firstChild.type.spec.tableRole);for(var k=[],S=0;S<x;S++)k.push(zz(t.schema)[b].createAndFill());var O=0!=v&&i!=v-1||s!=v?w-1:g+1;r.insert(r.mapping.map(O),k)}g=w}return r.setMeta(wI,{fixTables:!0})}function SI(t){var e,n=t.selection,r=$z(t),o=r.node(-1),i=r.start(-1),s=Cz.get(o);return e=n instanceof Uz?s.rectBetween(n.$anchorCell.pos-i,n.$headCell.pos-i):s.findCell(r.pos-i),e.tableStart=i,e.map=s,e.table=o,e}function OI(t,e,n){var r=e.map,o=e.tableStart,i=e.table,s=n>0?-1:0;Kz(r,i,n+s)&&(s=0==n||n==r.width?null:0);for(var a=0;a<r.height;a++){var c=a*r.width+n;if(n>0&&n<r.width&&r.map[c-1]==r.map[c]){var h=r.map[c],p=i.nodeAt(h);t.setNodeMarkup(t.mapping.map(o+h),null,Hz(p.attrs,n-r.colCount(h))),a+=p.attrs.rowspan-1}else{var l=null==s?zz(i.type.schema).cell:i.nodeAt(r.map[c+s]).type,u=r.positionAt(a,n,i);t.insert(t.mapping.map(o+u),l.createAndFill())}}return t}function CI(t,e){if(!Bz(t))return!1;if(e){var n=SI(t);e(OI(t.tr,n,n.left))}return!0}function MI(t,e){if(!Bz(t))return!1;if(e){var n=SI(t);e(OI(t.tr,n,n.right))}return!0}function NI(t,e,n){for(var r=e.map,o=e.table,i=e.tableStart,s=t.mapping.maps.length,a=0;a<r.height;){var c=a*r.width+n,h=r.map[c],p=o.nodeAt(h);if(n>0&&r.map[c-1]==h||n<r.width-1&&r.map[c+1]==h)t.setNodeMarkup(t.mapping.slice(s).map(i+h),null,Wz(p.attrs,n-r.colCount(h)));else{var l=t.mapping.slice(s).map(i+h);t.delete(l,l+p.nodeSize)}a+=p.attrs.rowspan}}function TI(t,e){if(!Bz(t))return!1;if(e){var n=SI(t),r=t.tr;if(0==n.left&&n.right==n.map.width)return!1;for(var o=n.right-1;;o--){if(NI(r,n,o),o==n.left)break;n.table=n.tableStart?r.doc.nodeAt(n.tableStart-1):r.doc,n.map=Cz.get(n.table)}e(r)}return!0}function EI(t,e,n){for(var r=zz(e.type.schema).header_cell,o=0;o<t.width;o++)if(e.nodeAt(t.map[o+n*t.width]).type!=r)return!1;return!0}function AI(t,e,n){for(var r=e.map,o=e.tableStart,i=e.table,s=o,a=0;a<n;a++)s+=i.child(a).nodeSize;var c=[],h=n>0?-1:0;EI(r,i,n+h)&&(h=0==n||n==r.height?null:0);for(var p=0,l=r.width*n;p<r.width;p++,l++)if(n>0&&n<r.height&&r.map[l]==r.map[l-r.width]){var u=r.map[l],f=i.nodeAt(u).attrs;t.setNodeMarkup(o+u,null,qz(f,"rowspan",f.rowspan+1)),p+=f.colspan-1}else{var d=null==h?zz(i.type.schema).cell:i.nodeAt(r.map[l+h*r.width]).type;c.push(d.createAndFill())}return t.insert(s,zz(i.type.schema).row.create(null,c)),t}function DI(t,e){if(!Bz(t))return!1;if(e){var n=SI(t);e(AI(t.tr,n,n.top))}return!0}function RI(t,e){if(!Bz(t))return!1;if(e){var n=SI(t);e(AI(t.tr,n,n.bottom))}return!0}function zI(t,e,n){for(var r=e.map,o=e.table,i=e.tableStart,s=0,a=0;a<n;a++)s+=o.child(a).nodeSize;var c=s+o.child(n).nodeSize,h=t.mapping.maps.length;t.delete(s+i,c+i);for(var p=0,l=n*r.width;p<r.width;p++,l++){var u=r.map[l];if(n>0&&u==r.map[l-r.width]){var f=o.nodeAt(u).attrs;t.setNodeMarkup(t.mapping.slice(h).map(u+i),null,qz(f,"rowspan",f.rowspan-1)),p+=f.colspan-1}else if(n<r.width&&u==r.map[l+r.width]){var d=o.nodeAt(u),m=d.type.create(qz(d.attrs,"rowspan",d.attrs.rowspan-1),d.content),v=r.positionAt(n+1,p,o);t.insert(t.mapping.slice(h).map(i+v),m),p+=d.attrs.colspan-1}}}function II(t,e){if(!Bz(t))return!1;if(e){var n=SI(t),r=t.tr;if(0==n.top&&n.bottom==n.map.height)return!1;for(var o=n.bottom-1;;o--){if(zI(r,n,o),o==n.top)break;n.table=n.tableStart?r.doc.nodeAt(n.tableStart-1):r.doc,n.map=Cz.get(n.table)}e(r)}return!0}function PI(t){var e=t.content;return 1==e.childCount&&e.firstChild.isTextblock&&0==e.firstChild.childCount}function FI(t,e){for(var n=t.width,r=t.height,o=t.map,i=e.top*n+e.left,s=i,a=(e.bottom-1)*n+e.left,c=i+(e.right-e.left-1),h=e.top;h<e.bottom;h++){if(e.left>0&&o[s]==o[s-1]||e.right<n&&o[c]==o[c+1])return!0;s+=n,c+=n}for(var p=e.left;p<e.right;p++){if(e.top>0&&o[i]==o[i-n]||e.bottom<r&&o[a]==o[a+n])return!0;i++,a++}return!1}function BI(t,e){var n=t.selection;if(!(n instanceof Uz)||n.$anchorCell.pos==n.$headCell.pos)return!1;var r=SI(t),o=r.map;if(FI(o,r))return!1;if(e){for(var i,s,a=t.tr,c={},h=Bt.empty,p=r.top;p<r.bottom;p++)for(var l=r.left;l<r.right;l++){var u=o.map[p*o.width+l],f=r.table.nodeAt(u);if(!c[u])if(c[u]=!0,null==i)i=u,s=f;else{PI(f)||(h=h.append(f.content));var d=a.mapping.map(u+r.tableStart);a.delete(d,d+f.nodeSize)}}if(a.setNodeMarkup(i+r.tableStart,null,qz(Hz(s.attrs,s.attrs.colspan,r.right-r.left-s.attrs.colspan),"rowspan",r.bottom-r.top)),h.size){var m=i+1+s.content.size,v=PI(s)?i+1:m;a.replaceWith(v+r.tableStart,m+r.tableStart,h)}a.setSelection(new Uz(a.doc.resolve(i+r.tableStart))),e(a)}return!0}function $I(t,e){var n=zz(t.schema);return _I((function(t){var e=t.node;return n[e.type.spec.tableRole]}))(t,e)}function _I(t){return function(e,n){var r,o,i=e.selection;if(i instanceof Uz){if(i.$anchorCell.pos!=i.$headCell.pos)return!1;r=i.$anchorCell.nodeAfter,o=i.$anchorCell.pos}else{if(r=Fz(i.$from),!r)return!1;o=Pz(i.$from).pos}if(1==r.attrs.colspan&&1==r.attrs.rowspan)return!1;if(n){var s=r.attrs,a=[],c=s.colwidth;s.rowspan>1&&(s=qz(s,"rowspan",1)),s.colspan>1&&(s=qz(s,"colspan",1));for(var h,p=SI(e),l=e.tr,u=0;u<p.right-p.left;u++)a.push(c?qz(s,"colwidth",c&&c[u]?[c[u]]:null):s);for(var f=p.top;f<p.bottom;f++){var d=p.map.positionAt(f,p.left,p.table);f==p.top&&(d+=r.nodeSize);for(var m=p.left,v=0;m<p.right;m++,v++)m==p.left&&f==p.top||l.insert(h=l.mapping.map(d+p.tableStart,1),t({node:r,row:f,col:m}).createAndFill(a[v]))}l.setNodeMarkup(o,t({node:r,row:p.top,col:p.left}),a[0]),i instanceof Uz&&l.setSelection(new Uz(l.doc.resolve(i.$anchorCell.pos),h&&l.doc.resolve(h))),n(l)}return!0}}function jI(t,e){return function(n,r){if(!Bz(n))return!1;var o=$z(n);if(o.nodeAfter.attrs[t]===e)return!1;if(r){var i=n.tr;n.selection instanceof Uz?n.selection.forEachCell((function(n,r){n.attrs[t]!==e&&i.setNodeMarkup(r,null,qz(n.attrs,t,e))})):i.setNodeMarkup(o.pos,null,qz(o.nodeAfter.attrs,t,e)),r(i)}return!0}}function JI(t){return function(e,n){if(!Bz(e))return!1;if(n){for(var r=zz(e.schema),o=SI(e),i=e.tr,s=o.map.cellsInRect("column"==t?new Oz(o.left,0,o.right,o.map.height):"row"==t?new Oz(0,o.top,o.map.width,o.bottom):o),a=s.map((function(t){return o.table.nodeAt(t)})),c=0;c<s.length;c++)a[c].type==r.header_cell&&i.setNodeMarkup(o.tableStart+s[c],r.cell,a[c].attrs);if(0==i.steps.length)for(var h=0;h<s.length;h++)i.setNodeMarkup(o.tableStart+s[h],r.header_cell,a[h].attrs);n(i)}return!0}}function LI(t,e,n){for(var r=e.map.cellsInRect({left:0,top:0,right:"row"==t?e.map.width:1,bottom:"column"==t?e.map.height:1}),o=0;o<r.length;o++){var i=e.table.nodeAt(r[o]);if(i&&i.type!==n.header_cell)return!1}return!0}function VI(t,e){return e=e||{useDeprecatedLogic:!1},e.useDeprecatedLogic?JI(t):function(e,n){if(!Bz(e))return!1;if(n){var r=zz(e.schema),o=SI(e),i=e.tr,s=LI("row",o,r),a=LI("column",o,r),c="column"===t?s:"row"===t&&a,h=c?1:0,p="column"==t?new Oz(0,h,1,o.map.height):"row"==t?new Oz(h,0,o.map.width,1):o,l="column"==t?a?r.cell:r.header_cell:"row"==t?s?r.cell:r.header_cell:r.cell;o.map.cellsInRect(p).forEach((function(t){var e=t+o.tableStart,n=i.doc.nodeAt(e);n&&i.setNodeMarkup(e,l,n.attrs)})),n(i)}return!0}}var qI=VI("row",{useDeprecatedLogic:!0}),WI=VI("column",{useDeprecatedLogic:!0}),HI=VI("cell",{useDeprecatedLogic:!0});function KI(t,e){if(e<0){var n=t.nodeBefore;if(n)return t.pos-n.nodeSize;for(var r=t.index(-1)-1,o=t.before();r>=0;r--){var i=t.node(-1).child(r);if(i.childCount)return o-1-i.lastChild.nodeSize;o-=i.nodeSize}}else{if(t.index()<t.parent.childCount-1)return t.pos+t.nodeAfter.nodeSize;for(var s=t.node(-1),a=t.indexAfter(-1),c=t.after();a<s.childCount;a++){var h=s.child(a);if(h.childCount)return c+1;c+=h.nodeSize}}}function UI(t){return function(e,n){if(!Bz(e))return!1;var r=KI($z(e),t);if(null!=r){if(n){var o=e.doc.resolve(r);n(e.tr.setSelection(Lp.between(o,Jz(o))).scrollIntoView())}return!0}}}function GI(t,e){for(var n=t.selection.$anchor,r=n.depth;r>0;r--){var o=n.node(r);if("table"==o.type.spec.tableRole)return e&&e(t.tr.delete(n.before(r),n.after(r)).scrollIntoView()),!0}return!1}var XI=function(t,e){this.node=t,this.cellMinWidth=e,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.colgroup=this.table.appendChild(document.createElement("colgroup")),YI(t,this.colgroup,this.table,e),this.contentDOM=this.table.appendChild(document.createElement("tbody"))};function YI(t,e,n,r,o,i){for(var s=0,a=!0,c=e.firstChild,h=t.firstChild,p=0,l=0;p<h.childCount;p++)for(var u=h.child(p).attrs,f=u.colspan,d=u.colwidth,m=0;m<f;m++,l++){var v=o==l?i:d&&d[m],g=v?v+"px":"";s+=v||r,v||(a=!1),c?(c.style.width!=g&&(c.style.width=g),c=c.nextSibling):e.appendChild(document.createElement("col")).style.width=g}while(c){var y=c.nextSibling;c.parentNode.removeChild(c),c=y}a?(n.style.width=s+"px",n.style.minWidth=""):(n.style.width="",n.style.minWidth=s+"px")}XI.prototype.update=function(t){return t.type==this.node.type&&(this.node=t,YI(t,this.colgroup,this.table,this.cellMinWidth),!0)},XI.prototype.ignoreMutation=function(t){return"attributes"==t.type&&(t.target==this.table||this.colgroup.contains(t.target))};var ZI=new ll("tableColumnResizing");function QI(t){void 0===t&&(t={});var e=t.handleWidth;void 0===e&&(e=5);var n=t.cellMinWidth;void 0===n&&(n=25);var r=t.View;void 0===r&&(r=XI);var o=t.lastColumnResizable;void 0===o&&(o=!0);var i=new cl({key:ZI,state:{init:function(t,e){return this.spec.props.nodeViews[zz(e.schema).table.name]=function(t,e){return new r(t,n,e)},new tP(-1,!1)},apply:function(t,e){return e.apply(t)}},props:{attributes:function(t){var e=ZI.getState(t);return e.activeHandle>-1?{class:"resize-cursor"}:null},handleDOMEvents:{mousemove:function(t,r){eP(t,r,e,n,o)},mouseleave:function(t){nP(t)},mousedown:function(t,e){rP(t,e,n)}},decorations:function(t){var e=ZI.getState(t);if(e.activeHandle>-1)return uP(t,e.activeHandle)},nodeViews:{}}});return i}var tP=function(t,e){this.activeHandle=t,this.dragging=e};function eP(t,e,n,r,o){var i=ZI.getState(t.state);if(!i.dragging){var s=iP(e.target),a=-1;if(s){var c=s.getBoundingClientRect(),h=c.left,p=c.right;e.clientX-h<=n?a=sP(t,e,"left"):p-e.clientX<=n&&(a=sP(t,e,"right"))}if(a!=i.activeHandle){if(!o&&-1!==a){var l=t.state.doc.resolve(a),u=l.node(-1),f=Cz.get(u),d=l.start(-1),m=f.colCount(l.pos-d)+l.nodeAfter.attrs.colspan-1;if(m==f.width-1)return}cP(t,a)}}}function nP(t){var e=ZI.getState(t.state);e.activeHandle>-1&&!e.dragging&&cP(t,-1)}function rP(t,e,n){var r=ZI.getState(t.state);if(-1==r.activeHandle||r.dragging)return!1;var o=t.state.doc.nodeAt(r.activeHandle),i=oP(t,r.activeHandle,o.attrs);function s(e){window.removeEventListener("mouseup",s),window.removeEventListener("mousemove",a);var r=ZI.getState(t.state);r.dragging&&(hP(t,r.activeHandle,aP(r.dragging,e,n)),t.dispatch(t.state.tr.setMeta(ZI,{setDragging:null})))}function a(e){if(!e.which)return s(e);var r=ZI.getState(t.state),o=aP(r.dragging,e,n);pP(t,r.activeHandle,o,n)}return t.dispatch(t.state.tr.setMeta(ZI,{setDragging:{startX:e.clientX,startWidth:i}})),window.addEventListener("mouseup",s),window.addEventListener("mousemove",a),e.preventDefault(),!0}function oP(t,e,n){var r=n.colspan,o=n.colwidth,i=o&&o[o.length-1];if(i)return i;var s=t.domAtPos(e),a=s.node.childNodes[s.offset],c=a.offsetWidth,h=r;if(o)for(var p=0;p<r;p++)o[p]&&(c-=o[p],h--);return c/h}function iP(t){while(t&&"TD"!=t.nodeName&&"TH"!=t.nodeName)t=t.classList.contains("ProseMirror")?null:t.parentNode;return t}function sP(t,e,n){var r=t.posAtCoords({left:e.clientX,top:e.clientY});if(!r)return-1;var o=r.pos,i=Pz(t.state.doc.resolve(o));if(!i)return-1;if("right"==n)return i.pos;var s=Cz.get(i.node(-1)),a=i.start(-1),c=s.map.indexOf(i.pos-a);return c%s.width==0?-1:a+s.map[c-1]}function aP(t,e,n){var r=e.clientX-t.startX;return Math.max(n,t.startWidth+r)}function cP(t,e){t.dispatch(t.state.tr.setMeta(ZI,{setHandle:e}))}function hP(t,e,n){for(var r=t.state.doc.resolve(e),o=r.node(-1),i=Cz.get(o),s=r.start(-1),a=i.colCount(r.pos-s)+r.nodeAfter.attrs.colspan-1,c=t.state.tr,h=0;h<i.height;h++){var p=h*i.width+a;if(!h||i.map[p]!=i.map[p-i.width]){var l=i.map[p],u=o.nodeAt(l),f=u.attrs,d=1==f.colspan?0:a-i.colCount(l);if(!f.colwidth||f.colwidth[d]!=n){var m=f.colwidth?f.colwidth.slice():lP(f.colspan);m[d]=n,c.setNodeMarkup(s+l,null,qz(f,"colwidth",m))}}}c.docChanged&&t.dispatch(c)}function pP(t,e,n,r){var o=t.state.doc.resolve(e),i=o.node(-1),s=o.start(-1),a=Cz.get(i).colCount(o.pos-s)+o.nodeAfter.attrs.colspan-1,c=t.domAtPos(o.start(-1)).node;while("TABLE"!=c.nodeName)c=c.parentNode;YI(i,c.firstChild,c,r,a,n)}function lP(t){for(var e=[],n=0;n<t;n++)e.push(0);return e}function uP(t,e){for(var n=[],r=t.doc.resolve(e),o=r.node(-1),i=Cz.get(o),s=r.start(-1),a=i.colCount(r.pos-s)+r.nodeAfter.attrs.colspan,c=0;c<i.height;c++){var h=a+c*i.width-1;if((a==i.width||i.map[h]!=i.map[h+1])&&(0==c||i.map[h-1]!=i.map[h-1-i.width])){var p=i.map[h],l=s+p+o.nodeAt(p).nodeSize-1,u=document.createElement("div");u.className="column-resize-handle",n.push(Vd.widget(l,u))}}return Kd.create(t.doc,n)}function fP(t){void 0===t&&(t={});var e=t.allowTableNodeSelection;return void 0===e&&(e=!1),new cl({key:Iz,state:{init:function(){return null},apply:function(t,e){var n=t.getMeta(Iz);if(null!=n)return-1==n?null:n;if(null==e||!t.docChanged)return e;var r=t.mapping.mapResult(e),o=r.deleted,i=r.pos;return o?null:i}},props:{decorations:Xz,handleDOMEvents:{mousedown:mI},createSelectionBetween:function(t){if(null!=Iz.getState(t.state))return t.state.selection},handleTripleClick:fI,handleKeyDown:cI,handlePaste:dI},appendTransaction:function(t,n,r){return Qz(r,bI(r,n),e)}})}function dP(t,e,n){for(var r=0;;r++){if(r==t.childCount||r==e.childCount)return t.childCount==e.childCount?null:n;var o=t.child(r),i=e.child(r);if(o!=i){if(!o.sameMarkup(i))return n;if(o.isText&&o.text!=i.text){for(var s=0;o.text[s]==i.text[s];s++)n++;return n}if(o.content.size||i.content.size){var a=dP(o.content,i.content,n+1);if(null!=a)return a}n+=o.nodeSize}else n+=o.nodeSize}}function mP(t,e,n,r){for(var o=t.childCount,i=e.childCount;;){if(0==o||0==i)return o==i?null:{a:n,b:r};var s=t.child(--o),a=e.child(--i),c=s.nodeSize;if(s!=a){if(!s.sameMarkup(a))return{a:n,b:r};if(s.isText&&s.text!=a.text){var h=0,p=Math.min(s.text.length,a.text.length);while(h<p&&s.text[s.text.length-h-1]==a.text[a.text.length-h-1])h++,n--,r--;return{a:n,b:r}}if(s.content.size||a.content.size){var l=mP(s.content,a.content,n-1,r-1);if(l)return l}n-=c,r-=c}else n-=c,r-=c}}tP.prototype.apply=function(t){var e=this,n=t.getMeta(ZI);if(n&&null!=n.setHandle)return new tP(n.setHandle,null);if(n&&void 0!==n.setDragging)return new tP(e.activeHandle,n.setDragging);if(e.activeHandle>-1&&t.docChanged){var r=t.mapping.map(e.activeHandle,-1);jz(t.doc.resolve(r))||(r=null),e=new tP(r,e.dragging)}return e};var vP=function(t,e){if(this.content=t,this.size=e||0,null==e)for(var n=0;n<t.length;n++)this.size+=t[n].nodeSize},gP={firstChild:{configurable:!0},lastChild:{configurable:!0},childCount:{configurable:!0}};vP.prototype.nodesBetween=function(t,e,n,r,o){void 0===r&&(r=0);for(var i=0,s=0;s<e;i++){var a=this.content[i],c=s+a.nodeSize;if(c>t&&!1!==n(a,r+s,o,i)&&a.content.size){var h=s+1;a.nodesBetween(Math.max(0,t-h),Math.min(a.content.size,e-h),n,r+h)}s=c}},vP.prototype.descendants=function(t){this.nodesBetween(0,this.size,t)},vP.prototype.textBetween=function(t,e,n,r){var o="",i=!0;return this.nodesBetween(t,e,(function(s,a){s.isText?(o+=s.text.slice(Math.max(t,a)-a,e-a),i=!n):s.isLeaf&&r?(o+=r,i=!n):!i&&s.isBlock&&(o+=n,i=!0)}),0),o},vP.prototype.append=function(t){if(!t.size)return this;if(!this.size)return t;var e=this.lastChild,n=t.firstChild,r=this.content.slice(),o=0;for(e.isText&&e.sameMarkup(n)&&(r[r.length-1]=e.withText(e.text+n.text),o=1);o<t.content.length;o++)r.push(t.content[o]);return new vP(r,this.size+t.size)},vP.prototype.cut=function(t,e){if(null==e&&(e=this.size),0==t&&e==this.size)return this;var n=[],r=0;if(e>t)for(var o=0,i=0;i<e;o++){var s=this.content[o],a=i+s.nodeSize;a>t&&((i<t||a>e)&&(s=s.isText?s.cut(Math.max(0,t-i),Math.min(s.text.length,e-i)):s.cut(Math.max(0,t-i-1),Math.min(s.content.size,e-i-1))),n.push(s),r+=s.nodeSize),i=a}return new vP(n,r)},vP.prototype.cutByIndex=function(t,e){return t==e?vP.empty:0==t&&e==this.content.length?this:new vP(this.content.slice(t,e))},vP.prototype.replaceChild=function(t,e){var n=this.content[t];if(n==e)return this;var r=this.content.slice(),o=this.size+e.nodeSize-n.nodeSize;return r[t]=e,new vP(r,o)},vP.prototype.addToStart=function(t){return new vP([t].concat(this.content),this.size+t.nodeSize)},vP.prototype.addToEnd=function(t){return new vP(this.content.concat(t),this.size+t.nodeSize)},vP.prototype.eq=function(t){if(this.content.length!=t.content.length)return!1;for(var e=0;e<this.content.length;e++)if(!this.content[e].eq(t.content[e]))return!1;return!0},gP.firstChild.get=function(){return this.content.length?this.content[0]:null},gP.lastChild.get=function(){return this.content.length?this.content[this.content.length-1]:null},gP.childCount.get=function(){return this.content.length},vP.prototype.child=function(t){var e=this.content[t];if(!e)throw new RangeError("Index "+t+" out of range for "+this);return e},vP.prototype.maybeChild=function(t){return this.content[t]},vP.prototype.forEach=function(t){for(var e=0,n=0;e<this.content.length;e++){var r=this.content[e];t(r,n,e),n+=r.nodeSize}},vP.prototype.findDiffStart=function(t,e){return void 0===e&&(e=0),dP(this,t,e)},vP.prototype.findDiffEnd=function(t,e,n){return void 0===e&&(e=this.size),void 0===n&&(n=t.size),mP(this,t,e,n)},vP.prototype.findIndex=function(t,e){if(void 0===e&&(e=-1),0==t)return wP(0,t);if(t==this.size)return wP(this.content.length,t);if(t>this.size||t<0)throw new RangeError("Position "+t+" outside of fragment ("+this+")");for(var n=0,r=0;;n++){var o=this.child(n),i=r+o.nodeSize;if(i>=t)return i==t||e>0?wP(n+1,i):wP(n,r);r=i}},vP.prototype.toString=function(){return"<"+this.toStringInner()+">"},vP.prototype.toStringInner=function(){return this.content.join(", ")},vP.prototype.toJSON=function(){return this.content.length?this.content.map((function(t){return t.toJSON()})):null},vP.fromJSON=function(t,e){if(!e)return vP.empty;if(!Array.isArray(e))throw new RangeError("Invalid input for Fragment.fromJSON");return new vP(e.map(t.nodeFromJSON))},vP.fromArray=function(t){if(!t.length)return vP.empty;for(var e,n=0,r=0;r<t.length;r++){var o=t[r];n+=o.nodeSize,r&&o.isText&&t[r-1].sameMarkup(o)?(e||(e=t.slice(0,r)),e[e.length-1]=o.withText(e[e.length-1].text+o.text)):e&&e.push(o)}return new vP(e||t,n)},vP.from=function(t){if(!t)return vP.empty;if(t instanceof vP)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new vP([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))},Object.defineProperties(vP.prototype,gP);var yP={index:0,offset:0};function wP(t,e){return yP.index=t,yP.offset=e,yP}function xP(t,e){if(t===e)return!0;if(!t||"object"!=typeof t||!e||"object"!=typeof e)return!1;var n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(var r=0;r<t.length;r++)if(!xP(t[r],e[r]))return!1}else{for(var o in t)if(!(o in e)||!xP(t[o],e[o]))return!1;for(var i in e)if(!(i in t))return!1}return!0}vP.empty=new vP([],0);var bP=function(t,e){this.type=t,this.attrs=e};function kP(t){var e=Error.call(this,t);return e.__proto__=kP.prototype,e}bP.prototype.addToSet=function(t){for(var e,n=!1,r=0;r<t.length;r++){var o=t[r];if(this.eq(o))return t;if(this.type.excludes(o.type))e||(e=t.slice(0,r));else{if(o.type.excludes(this.type))return t;!n&&o.type.rank>this.type.rank&&(e||(e=t.slice(0,r)),e.push(this),n=!0),e&&e.push(o)}}return e||(e=t.slice()),n||e.push(this),e},bP.prototype.removeFromSet=function(t){for(var e=0;e<t.length;e++)if(this.eq(t[e]))return t.slice(0,e).concat(t.slice(e+1));return t},bP.prototype.isInSet=function(t){for(var e=0;e<t.length;e++)if(this.eq(t[e]))return!0;return!1},bP.prototype.eq=function(t){return this==t||this.type==t.type&&xP(this.attrs,t.attrs)},bP.prototype.toJSON=function(){var t={type:this.type.name};for(var e in this.attrs){t.attrs=this.attrs;break}return t},bP.fromJSON=function(t,e){if(!e)throw new RangeError("Invalid input for Mark.fromJSON");var n=t.marks[e.type];if(!n)throw new RangeError("There is no mark type "+e.type+" in this schema");return n.create(e.attrs)},bP.sameSet=function(t,e){if(t==e)return!0;if(t.length!=e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].eq(e[n]))return!1;return!0},bP.setFrom=function(t){if(!t||0==t.length)return bP.none;if(t instanceof bP)return[t];var e=t.slice();return e.sort((function(t,e){return t.type.rank-e.type.rank})),e},bP.none=[],kP.prototype=Object.create(Error.prototype),kP.prototype.constructor=kP,kP.prototype.name="ReplaceError";var SP=function(t,e,n){this.content=t,this.openStart=e,this.openEnd=n},OP={size:{configurable:!0}};function CP(t,e,n){var r=t.findIndex(e),o=r.index,i=r.offset,s=t.maybeChild(o),a=t.findIndex(n),c=a.index,h=a.offset;if(i==e||s.isText){if(h!=n&&!t.child(c).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(o!=c)throw new RangeError("Removing non-flat range");return t.replaceChild(o,s.copy(CP(s.content,e-i-1,n-i-1)))}function MP(t,e,n,r){var o=t.findIndex(e),i=o.index,s=o.offset,a=t.maybeChild(i);if(s==e||a.isText)return r&&!r.canReplace(i,i,n)?null:t.cut(0,e).append(n).append(t.cut(e));var c=MP(a.content,e-s-1,n);return c&&t.replaceChild(i,a.copy(c))}function NP(t,e,n){if(n.openStart>t.depth)throw new kP("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new kP("Inconsistent open depths");return TP(t,e,n,0)}function TP(t,e,n,r){var o=t.index(r),i=t.node(r);if(o==e.index(r)&&r<t.depth-n.openStart){var s=TP(t,e,n,r+1);return i.copy(i.content.replaceChild(o,s))}if(n.content.size){if(n.openStart||n.openEnd||t.depth!=r||e.depth!=r){var a=FP(n,t),c=a.start,h=a.end;return zP(i,IP(t,c,h,e,r))}var p=t.parent,l=p.content;return zP(p,l.cut(0,t.parentOffset).append(n.content).append(l.cut(e.parentOffset)))}return zP(i,PP(t,e,r))}function EP(t,e){if(!e.type.compatibleContent(t.type))throw new kP("Cannot join "+e.type.name+" onto "+t.type.name)}function AP(t,e,n){var r=t.node(n);return EP(r,e.node(n)),r}function DP(t,e){var n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function RP(t,e,n,r){var o=(e||t).node(n),i=0,s=e?e.index(n):o.childCount;t&&(i=t.index(n),t.depth>n?i++:t.textOffset&&(DP(t.nodeAfter,r),i++));for(var a=i;a<s;a++)DP(o.child(a),r);e&&e.depth==n&&e.textOffset&&DP(e.nodeBefore,r)}function zP(t,e){if(!t.type.validContent(e))throw new kP("Invalid content for node "+t.type.name);return t.copy(e)}function IP(t,e,n,r,o){var i=t.depth>o&&AP(t,e,o+1),s=r.depth>o&&AP(n,r,o+1),a=[];return RP(null,t,o,a),i&&s&&e.index(o)==n.index(o)?(EP(i,s),DP(zP(i,IP(t,e,n,r,o+1)),a)):(i&&DP(zP(i,PP(t,e,o+1)),a),RP(e,n,o,a),s&&DP(zP(s,PP(n,r,o+1)),a)),RP(r,null,o,a),new vP(a)}function PP(t,e,n){var r=[];if(RP(null,t,n,r),t.depth>n){var o=AP(t,e,n+1);DP(zP(o,PP(t,e,n+1)),r)}return RP(e,null,n,r),new vP(r)}function FP(t,e){for(var n=e.depth-t.openStart,r=e.node(n),o=r.copy(t.content),i=n-1;i>=0;i--)o=e.node(i).copy(vP.from(o));return{start:o.resolveNoCache(t.openStart+n),end:o.resolveNoCache(o.content.size-t.openEnd-n)}}OP.size.get=function(){return this.content.size-this.openStart-this.openEnd},SP.prototype.insertAt=function(t,e){var n=MP(this.content,t+this.openStart,e,null);return n&&new SP(n,this.openStart,this.openEnd)},SP.prototype.removeBetween=function(t,e){return new SP(CP(this.content,t+this.openStart,e+this.openStart),this.openStart,this.openEnd)},SP.prototype.eq=function(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd},SP.prototype.toString=function(){return this.content+"("+this.openStart+","+this.openEnd+")"},SP.prototype.toJSON=function(){if(!this.content.size)return null;var t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t},SP.fromJSON=function(t,e){if(!e)return SP.empty;var n=e.openStart||0,r=e.openEnd||0;if("number"!=typeof n||"number"!=typeof r)throw new RangeError("Invalid input for Slice.fromJSON");return new SP(vP.fromJSON(t,e.content),e.openStart||0,e.openEnd||0)},SP.maxOpen=function(t,e){void 0===e&&(e=!0);for(var n=0,r=0,o=t.firstChild;o&&!o.isLeaf&&(e||!o.type.spec.isolating);o=o.firstChild)n++;for(var i=t.lastChild;i&&!i.isLeaf&&(e||!i.type.spec.isolating);i=i.lastChild)r++;return new SP(t,n,r)},Object.defineProperties(SP.prototype,OP),SP.empty=new SP(vP.empty,0,0);var BP=function(t,e,n){this.pos=t,this.path=e,this.depth=e.length/3-1,this.parentOffset=n},$P={parent:{configurable:!0},doc:{configurable:!0},textOffset:{configurable:!0},nodeAfter:{configurable:!0},nodeBefore:{configurable:!0}};BP.prototype.resolveDepth=function(t){return null==t?this.depth:t<0?this.depth+t:t},$P.parent.get=function(){return this.node(this.depth)},$P.doc.get=function(){return this.node(0)},BP.prototype.node=function(t){return this.path[3*this.resolveDepth(t)]},BP.prototype.index=function(t){return this.path[3*this.resolveDepth(t)+1]},BP.prototype.indexAfter=function(t){return t=this.resolveDepth(t),this.index(t)+(t!=this.depth||this.textOffset?1:0)},BP.prototype.start=function(t){return t=this.resolveDepth(t),0==t?0:this.path[3*t-1]+1},BP.prototype.end=function(t){return t=this.resolveDepth(t),this.start(t)+this.node(t).content.size},BP.prototype.before=function(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position before the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]},BP.prototype.after=function(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position after the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]+this.path[3*t].nodeSize},$P.textOffset.get=function(){return this.pos-this.path[this.path.length-1]},$P.nodeAfter.get=function(){var t=this.parent,e=this.index(this.depth);if(e==t.childCount)return null;var n=this.pos-this.path[this.path.length-1],r=t.child(e);return n?t.child(e).cut(n):r},$P.nodeBefore.get=function(){var t=this.index(this.depth),e=this.pos-this.path[this.path.length-1];return e?this.parent.child(t).cut(0,e):0==t?null:this.parent.child(t-1)},BP.prototype.marks=function(){var t=this.parent,e=this.index();if(0==t.content.size)return bP.none;if(this.textOffset)return t.child(e).marks;var n=t.maybeChild(e-1),r=t.maybeChild(e);if(!n){var o=n;n=r,r=o}for(var i=n.marks,s=0;s<i.length;s++)!1!==i[s].type.spec.inclusive||r&&i[s].isInSet(r.marks)||(i=i[s--].removeFromSet(i));return i},BP.prototype.marksAcross=function(t){var e=this.parent.maybeChild(this.index());if(!e||!e.isInline)return null;for(var n=e.marks,r=t.parent.maybeChild(t.index()),o=0;o<n.length;o++)!1!==n[o].type.spec.inclusive||r&&n[o].isInSet(r.marks)||(n=n[o--].removeFromSet(n));return n},BP.prototype.sharedDepth=function(t){for(var e=this.depth;e>0;e--)if(this.start(e)<=t&&this.end(e)>=t)return e;return 0},BP.prototype.blockRange=function(t,e){if(void 0===t&&(t=this),t.pos<this.pos)return t.blockRange(this);for(var n=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);n>=0;n--)if(t.pos<=this.end(n)&&(!e||e(this.node(n))))return new LP(this,t,n)},BP.prototype.sameParent=function(t){return this.pos-this.parentOffset==t.pos-t.parentOffset},BP.prototype.max=function(t){return t.pos>this.pos?t:this},BP.prototype.min=function(t){return t.pos<this.pos?t:this},BP.prototype.toString=function(){for(var t="",e=1;e<=this.depth;e++)t+=(t?"/":"")+this.node(e).type.name+"_"+this.index(e-1);return t+":"+this.parentOffset},BP.resolve=function(t,e){if(!(e>=0&&e<=t.content.size))throw new RangeError("Position "+e+" out of range");for(var n=[],r=0,o=e,i=t;;){var s=i.content.findIndex(o),a=s.index,c=s.offset,h=o-c;if(n.push(i,a,r+c),!h)break;if(i=i.child(a),i.isText)break;o=h-1,r+=c+1}return new BP(e,n,o)},BP.resolveCached=function(t,e){for(var n=0;n<_P.length;n++){var r=_P[n];if(r.pos==e&&r.doc==t)return r}var o=_P[jP]=BP.resolve(t,e);return jP=(jP+1)%JP,o},Object.defineProperties(BP.prototype,$P);var _P=[],jP=0,JP=12,LP=function(t,e,n){this.$from=t,this.$to=e,this.depth=n},VP={start:{configurable:!0},end:{configurable:!0},parent:{configurable:!0},startIndex:{configurable:!0},endIndex:{configurable:!0}};VP.start.get=function(){return this.$from.before(this.depth+1)},VP.end.get=function(){return this.$to.after(this.depth+1)},VP.parent.get=function(){return this.$from.node(this.depth)},VP.startIndex.get=function(){return this.$from.index(this.depth)},VP.endIndex.get=function(){return this.$to.indexAfter(this.depth)},Object.defineProperties(LP.prototype,VP);var qP=Object.create(null),WP=function(t,e,n,r){this.type=t,this.attrs=e,this.content=n||vP.empty,this.marks=r||bP.none},HP={nodeSize:{configurable:!0},childCount:{configurable:!0},textContent:{configurable:!0},firstChild:{configurable:!0},lastChild:{configurable:!0},isBlock:{configurable:!0},isTextblock:{configurable:!0},inlineContent:{configurable:!0},isInline:{configurable:!0},isText:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};HP.nodeSize.get=function(){return this.isLeaf?1:2+this.content.size},HP.childCount.get=function(){return this.content.childCount},WP.prototype.child=function(t){return this.content.child(t)},WP.prototype.maybeChild=function(t){return this.content.maybeChild(t)},WP.prototype.forEach=function(t){this.content.forEach(t)},WP.prototype.nodesBetween=function(t,e,n,r){void 0===r&&(r=0),this.content.nodesBetween(t,e,n,r,this)},WP.prototype.descendants=function(t){this.nodesBetween(0,this.content.size,t)},HP.textContent.get=function(){return this.textBetween(0,this.content.size,"")},WP.prototype.textBetween=function(t,e,n,r){return this.content.textBetween(t,e,n,r)},HP.firstChild.get=function(){return this.content.firstChild},HP.lastChild.get=function(){return this.content.lastChild},WP.prototype.eq=function(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)},WP.prototype.sameMarkup=function(t){return this.hasMarkup(t.type,t.attrs,t.marks)},WP.prototype.hasMarkup=function(t,e,n){return this.type==t&&xP(this.attrs,e||t.defaultAttrs||qP)&&bP.sameSet(this.marks,n||bP.none)},WP.prototype.copy=function(t){return void 0===t&&(t=null),t==this.content?this:new this.constructor(this.type,this.attrs,t,this.marks)},WP.prototype.mark=function(t){return t==this.marks?this:new this.constructor(this.type,this.attrs,this.content,t)},WP.prototype.cut=function(t,e){return 0==t&&e==this.content.size?this:this.copy(this.content.cut(t,e))},WP.prototype.slice=function(t,e,n){if(void 0===e&&(e=this.content.size),void 0===n&&(n=!1),t==e)return SP.empty;var r=this.resolve(t),o=this.resolve(e),i=n?0:r.sharedDepth(e),s=r.start(i),a=r.node(i),c=a.content.cut(r.pos-s,o.pos-s);return new SP(c,r.depth-i,o.depth-i)},WP.prototype.replace=function(t,e,n){return NP(this.resolve(t),this.resolve(e),n)},WP.prototype.nodeAt=function(t){for(var e=this;;){var n=e.content.findIndex(t),r=n.index,o=n.offset;if(e=e.maybeChild(r),!e)return null;if(o==t||e.isText)return e;t-=o+1}},WP.prototype.childAfter=function(t){var e=this.content.findIndex(t),n=e.index,r=e.offset;return{node:this.content.maybeChild(n),index:n,offset:r}},WP.prototype.childBefore=function(t){if(0==t)return{node:null,index:0,offset:0};var e=this.content.findIndex(t),n=e.index,r=e.offset;if(r<t)return{node:this.content.child(n),index:n,offset:r};var o=this.content.child(n-1);return{node:o,index:n-1,offset:r-o.nodeSize}},WP.prototype.resolve=function(t){return BP.resolveCached(this,t)},WP.prototype.resolveNoCache=function(t){return BP.resolve(this,t)},WP.prototype.rangeHasMark=function(t,e,n){var r=!1;return e>t&&this.nodesBetween(t,e,(function(t){return n.isInSet(t.marks)&&(r=!0),!r})),r},HP.isBlock.get=function(){return this.type.isBlock},HP.isTextblock.get=function(){return this.type.isTextblock},HP.inlineContent.get=function(){return this.type.inlineContent},HP.isInline.get=function(){return this.type.isInline},HP.isText.get=function(){return this.type.isText},HP.isLeaf.get=function(){return this.type.isLeaf},HP.isAtom.get=function(){return this.type.isAtom},WP.prototype.toString=function(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);var t=this.type.name;return this.content.size&&(t+="("+this.content.toStringInner()+")"),UP(this.marks,t)},WP.prototype.contentMatchAt=function(t){var e=this.type.contentMatch.matchFragment(this.content,0,t);if(!e)throw new Error("Called contentMatchAt on a node with invalid content");return e},WP.prototype.canReplace=function(t,e,n,r,o){void 0===n&&(n=vP.empty),void 0===r&&(r=0),void 0===o&&(o=n.childCount);var i=this.contentMatchAt(t).matchFragment(n,r,o),s=i&&i.matchFragment(this.content,e);if(!s||!s.validEnd)return!1;for(var a=r;a<o;a++)if(!this.type.allowsMarks(n.child(a).marks))return!1;return!0},WP.prototype.canReplaceWith=function(t,e,n,r){if(r&&!this.type.allowsMarks(r))return!1;var o=this.contentMatchAt(t).matchType(n),i=o&&o.matchFragment(this.content,e);return!!i&&i.validEnd},WP.prototype.canAppend=function(t){return t.content.size?this.canReplace(this.childCount,this.childCount,t.content):this.type.compatibleContent(t.type)},WP.prototype.check=function(){if(!this.type.validContent(this.content))throw new RangeError("Invalid content for node "+this.type.name+": "+this.content.toString().slice(0,50));this.content.forEach((function(t){return t.check()}))},WP.prototype.toJSON=function(){var t={type:this.type.name};for(var e in this.attrs){t.attrs=this.attrs;break}return this.content.size&&(t.content=this.content.toJSON()),this.marks.length&&(t.marks=this.marks.map((function(t){return t.toJSON()}))),t},WP.fromJSON=function(t,e){if(!e)throw new RangeError("Invalid input for Node.fromJSON");var n=null;if(e.marks){if(!Array.isArray(e.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=e.marks.map(t.markFromJSON)}if("text"==e.type){if("string"!=typeof e.text)throw new RangeError("Invalid text node in JSON");return t.text(e.text,n)}var r=vP.fromJSON(t,e.content);return t.nodeType(e.type).create(e.attrs,r,n)},Object.defineProperties(WP.prototype,HP);var KP=function(t){function e(e,n,r,o){if(t.call(this,e,n,null,o),!r)throw new RangeError("Empty text nodes are not allowed");this.text=r}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={textContent:{configurable:!0},nodeSize:{configurable:!0}};return e.prototype.toString=function(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):UP(this.marks,JSON.stringify(this.text))},n.textContent.get=function(){return this.text},e.prototype.textBetween=function(t,e){return this.text.slice(t,e)},n.nodeSize.get=function(){return this.text.length},e.prototype.mark=function(t){return t==this.marks?this:new e(this.type,this.attrs,this.text,t)},e.prototype.withText=function(t){return t==this.text?this:new e(this.type,this.attrs,t,this.marks)},e.prototype.cut=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=this.text.length),0==t&&e==this.text.length?this:this.withText(this.text.slice(t,e))},e.prototype.eq=function(t){return this.sameMarkup(t)&&this.text==t.text},e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.text=this.text,e},Object.defineProperties(e.prototype,n),e}(WP);function UP(t,e){for(var n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}var GP=function(t){this.validEnd=t,this.next=[],this.wrapCache=[]},XP={inlineContent:{configurable:!0},defaultType:{configurable:!0},edgeCount:{configurable:!0}};GP.parse=function(t,e){var n=new YP(t,e);if(null==n.next)return GP.empty;var r=QP(n);n.next&&n.err("Unexpected trailing text");var o=hF(sF(r));return pF(o,n),o},GP.prototype.matchType=function(t){for(var e=0;e<this.next.length;e+=2)if(this.next[e]==t)return this.next[e+1];return null},GP.prototype.matchFragment=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=t.childCount);for(var r=this,o=e;r&&o<n;o++)r=r.matchType(t.child(o).type);return r},XP.inlineContent.get=function(){var t=this.next[0];return!!t&&t.isInline},XP.defaultType.get=function(){for(var t=0;t<this.next.length;t+=2){var e=this.next[t];if(!e.isText&&!e.hasRequiredAttrs())return e}},GP.prototype.compatible=function(t){for(var e=0;e<this.next.length;e+=2)for(var n=0;n<t.next.length;n+=2)if(this.next[e]==t.next[n])return!0;return!1},GP.prototype.fillBefore=function(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=0);var r=[this];function o(i,s){var a=i.matchFragment(t,n);if(a&&(!e||a.validEnd))return vP.from(s.map((function(t){return t.createAndFill()})));for(var c=0;c<i.next.length;c+=2){var h=i.next[c],p=i.next[c+1];if(!h.isText&&!h.hasRequiredAttrs()&&-1==r.indexOf(p)){r.push(p);var l=o(p,s.concat(h));if(l)return l}}}return o(this,[])},GP.prototype.findWrapping=function(t){for(var e=0;e<this.wrapCache.length;e+=2)if(this.wrapCache[e]==t)return this.wrapCache[e+1];var n=this.computeWrapping(t);return this.wrapCache.push(t,n),n},GP.prototype.computeWrapping=function(t){var e=Object.create(null),n=[{match:this,type:null,via:null}];while(n.length){var r=n.shift(),o=r.match;if(o.matchType(t)){for(var i=[],s=r;s.type;s=s.via)i.push(s.type);return i.reverse()}for(var a=0;a<o.next.length;a+=2){var c=o.next[a];c.isLeaf||c.hasRequiredAttrs()||c.name in e||r.type&&!o.next[a+1].validEnd||(n.push({match:c.contentMatch,type:c,via:r}),e[c.name]=!0)}}},XP.edgeCount.get=function(){return this.next.length>>1},GP.prototype.edge=function(t){var e=t<<1;if(e>=this.next.length)throw new RangeError("There's no "+t+"th edge in this content match");return{type:this.next[e],next:this.next[e+1]}},GP.prototype.toString=function(){var t=[];function e(n){t.push(n);for(var r=1;r<n.next.length;r+=2)-1==t.indexOf(n.next[r])&&e(n.next[r])}return e(this),t.map((function(e,n){for(var r=n+(e.validEnd?"*":" ")+" ",o=0;o<e.next.length;o+=2)r+=(o?", ":"")+e.next[o].name+"->"+t.indexOf(e.next[o+1]);return r})).join("\n")},Object.defineProperties(GP.prototype,XP),GP.empty=new GP(!0);var YP=function(t,e){this.string=t,this.nodeTypes=e,this.inline=null,this.pos=0,this.tokens=t.split(/\s*(?=\b|\W|$)/),""==this.tokens[this.tokens.length-1]&&this.tokens.pop(),""==this.tokens[0]&&this.tokens.unshift()},ZP={next:{configurable:!0}};function QP(t){var e=[];do{e.push(tF(t))}while(t.eat("|"));return 1==e.length?e[0]:{type:"choice",exprs:e}}function tF(t){var e=[];do{e.push(eF(t))}while(t.next&&")"!=t.next&&"|"!=t.next);return 1==e.length?e[0]:{type:"seq",exprs:e}}function eF(t){for(var e=iF(t);;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else{if(!t.eat("{"))break;e=rF(t,e)}return e}function nF(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");var e=Number(t.next);return t.pos++,e}function rF(t,e){var n=nF(t),r=n;return t.eat(",")&&(r="}"!=t.next?nF(t):-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:e}}function oF(t,e){var n=t.nodeTypes,r=n[e];if(r)return[r];var o=[];for(var i in n){var s=n[i];s.groups.indexOf(e)>-1&&o.push(s)}return 0==o.length&&t.err("No node type or group '"+e+"' found"),o}function iF(t){if(t.eat("(")){var e=QP(t);return t.eat(")")||t.err("Missing closing paren"),e}if(!/\W/.test(t.next)){var n=oF(t,t.next).map((function(e){return null==t.inline?t.inline=e.isInline:t.inline!=e.isInline&&t.err("Mixing inline and block content"),{type:"name",value:e}}));return t.pos++,1==n.length?n[0]:{type:"choice",exprs:n}}t.err("Unexpected token '"+t.next+"'")}function sF(t){var e=[[]];return o(i(t,0),n()),e;function n(){return e.push([])-1}function r(t,n,r){var o={term:r,to:n};return e[t].push(o),o}function o(t,e){t.forEach((function(t){return t.to=e}))}function i(t,e){if("choice"==t.type)return t.exprs.reduce((function(t,n){return t.concat(i(n,e))}),[]);if("seq"==t.type)for(var s=0;;s++){var a=i(t.exprs[s],e);if(s==t.exprs.length-1)return a;o(a,e=n())}else{if("star"==t.type){var c=n();return r(e,c),o(i(t.expr,c),c),[r(c)]}if("plus"==t.type){var h=n();return o(i(t.expr,e),h),o(i(t.expr,h),h),[r(h)]}if("opt"==t.type)return[r(e)].concat(i(t.expr,e));if("range"==t.type){for(var p=e,l=0;l<t.min;l++){var u=n();o(i(t.expr,p),u),p=u}if(-1==t.max)o(i(t.expr,p),p);else for(var f=t.min;f<t.max;f++){var d=n();r(p,d),o(i(t.expr,p),d),p=d}return[r(p)]}if("name"==t.type)return[r(e,null,t.value)]}}}function aF(t,e){return e-t}function cF(t,e){var n=[];return r(e),n.sort(aF);function r(e){var o=t[e];if(1==o.length&&!o[0].term)return r(o[0].to);n.push(e);for(var i=0;i<o.length;i++){var s=o[i],a=s.term,c=s.to;a||-1!=n.indexOf(c)||r(c)}}}function hF(t){var e=Object.create(null);return n(cF(t,0));function n(r){var o=[];r.forEach((function(e){t[e].forEach((function(e){var n=e.term,r=e.to;if(n){var i=o.indexOf(n),s=i>-1&&o[i+1];cF(t,r).forEach((function(t){s||o.push(n,s=[]),-1==s.indexOf(t)&&s.push(t)}))}}))}));for(var i=e[r.join(",")]=new GP(r.indexOf(t.length-1)>-1),s=0;s<o.length;s+=2){var a=o[s+1].sort(aF);i.next.push(o[s],e[a.join(",")]||n(a))}return i}}function pF(t,e){for(var n=0,r=[t];n<r.length;n++){for(var o=r[n],i=!o.validEnd,s=[],a=0;a<o.next.length;a+=2){var c=o.next[a],h=o.next[a+1];s.push(c.name),!i||c.isText||c.hasRequiredAttrs()||(i=!1),-1==r.indexOf(h)&&r.push(h)}i&&e.err("Only non-generatable nodes ("+s.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function lF(t){var e=Object.create(null);for(var n in t){var r=t[n];if(!r.hasDefault)return null;e[n]=r.default}return e}function uF(t,e){var n=Object.create(null);for(var r in t){var o=e&&e[r];if(void 0===o){var i=t[r];if(!i.hasDefault)throw new RangeError("No value supplied for attribute "+r);o=i.default}n[r]=o}return n}function fF(t){var e=Object.create(null);if(t)for(var n in t)e[n]=new vF(t[n]);return e}ZP.next.get=function(){return this.tokens[this.pos]},YP.prototype.eat=function(t){return this.next==t&&(this.pos++||!0)},YP.prototype.err=function(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")},Object.defineProperties(YP.prototype,ZP);var dF=function(t,e,n){this.name=t,this.schema=e,this.spec=n,this.groups=n.group?n.group.split(" "):[],this.attrs=fF(n.attrs),this.defaultAttrs=lF(this.attrs),this.contentMatch=null,this.markSet=null,this.inlineContent=null,this.isBlock=!(n.inline||"text"==t),this.isText="text"==t},mF={isInline:{configurable:!0},isTextblock:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};mF.isInline.get=function(){return!this.isBlock},mF.isTextblock.get=function(){return this.isBlock&&this.inlineContent},mF.isLeaf.get=function(){return this.contentMatch==GP.empty},mF.isAtom.get=function(){return this.isLeaf||this.spec.atom},dF.prototype.hasRequiredAttrs=function(){for(var t in this.attrs)if(this.attrs[t].isRequired)return!0;return!1},dF.prototype.compatibleContent=function(t){return this==t||this.contentMatch.compatible(t.contentMatch)},dF.prototype.computeAttrs=function(t){return!t&&this.defaultAttrs?this.defaultAttrs:uF(this.attrs,t)},dF.prototype.create=function(t,e,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new WP(this,this.computeAttrs(t),vP.from(e),bP.setFrom(n))},dF.prototype.createChecked=function(t,e,n){if(e=vP.from(e),!this.validContent(e))throw new RangeError("Invalid content for node "+this.name);return new WP(this,this.computeAttrs(t),e,bP.setFrom(n))},dF.prototype.createAndFill=function(t,e,n){if(t=this.computeAttrs(t),e=vP.from(e),e.size){var r=this.contentMatch.fillBefore(e);if(!r)return null;e=r.append(e)}var o=this.contentMatch.matchFragment(e).fillBefore(vP.empty,!0);return o?new WP(this,t,e.append(o),bP.setFrom(n)):null},dF.prototype.validContent=function(t){var e=this.contentMatch.matchFragment(t);if(!e||!e.validEnd)return!1;for(var n=0;n<t.childCount;n++)if(!this.allowsMarks(t.child(n).marks))return!1;return!0},dF.prototype.allowsMarkType=function(t){return null==this.markSet||this.markSet.indexOf(t)>-1},dF.prototype.allowsMarks=function(t){if(null==this.markSet)return!0;for(var e=0;e<t.length;e++)if(!this.allowsMarkType(t[e].type))return!1;return!0},dF.prototype.allowedMarks=function(t){if(null==this.markSet)return t;for(var e,n=0;n<t.length;n++)this.allowsMarkType(t[n].type)?e&&e.push(t[n]):e||(e=t.slice(0,n));return e?e.length?e:bP.empty:t},dF.compile=function(t,e){var n=Object.create(null);t.forEach((function(t,r){return n[t]=new dF(t,e,r)}));var r=e.spec.topNode||"doc";if(!n[r])throw new RangeError("Schema is missing its top node type ('"+r+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(var o in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n},Object.defineProperties(dF.prototype,mF);var vF=function(t){this.hasDefault=Object.prototype.hasOwnProperty.call(t,"default"),this.default=t.default},gF={isRequired:{configurable:!0}};gF.isRequired.get=function(){return!this.hasDefault},Object.defineProperties(vF.prototype,gF);var yF=function(t,e,n,r){this.name=t,this.schema=n,this.spec=r,this.attrs=fF(r.attrs),this.rank=e,this.excluded=null;var o=lF(this.attrs);this.instance=o&&new bP(this,o)};yF.prototype.create=function(t){return!t&&this.instance?this.instance:new bP(this,uF(this.attrs,t))},yF.compile=function(t,e){var n=Object.create(null),r=0;return t.forEach((function(t,o){return n[t]=new yF(t,r++,e,o)})),n},yF.prototype.removeFromSet=function(t){for(var e=0;e<t.length;e++)if(t[e].type==this)return t.slice(0,e).concat(t.slice(e+1));return t},yF.prototype.isInSet=function(t){for(var e=0;e<t.length;e++)if(t[e].type==this)return t[e]},yF.prototype.excludes=function(t){return this.excluded.indexOf(t)>-1};var wF=function(t){for(var e in this.spec={},t)this.spec[e]=t[e];this.spec.nodes=c.from(t.nodes),this.spec.marks=c.from(t.marks),this.nodes=dF.compile(this.spec.nodes,this),this.marks=yF.compile(this.spec.marks,this);var n=Object.create(null);for(var r in this.nodes){if(r in this.marks)throw new RangeError(r+" can not be both a node and a mark");var o=this.nodes[r],i=o.spec.content||"",s=o.spec.marks;o.contentMatch=n[i]||(n[i]=GP.parse(i,this.nodes)),o.inlineContent=o.contentMatch.inlineContent,o.markSet="_"==s?null:s?xF(this,s.split(" ")):""!=s&&o.inlineContent?null:[]}for(var a in this.marks){var h=this.marks[a],p=h.spec.excludes;h.excluded=null==p?[h]:""==p?[]:xF(this,p.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached=Object.create(null),this.cached.wrappings=Object.create(null)};function xF(t,e){for(var n=[],r=0;r<e.length;r++){var o=e[r],i=t.marks[o],s=i;if(i)n.push(i);else for(var a in t.marks){var c=t.marks[a];("_"==o||c.spec.group&&c.spec.group.split(" ").indexOf(o)>-1)&&n.push(s=c)}if(!s)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return n}wF.prototype.node=function(t,e,n,r){if("string"==typeof t)t=this.nodeType(t);else{if(!(t instanceof dF))throw new RangeError("Invalid node type: "+t);if(t.schema!=this)throw new RangeError("Node type from different schema used ("+t.name+")")}return t.createChecked(e,n,r)},wF.prototype.text=function(t,e){var n=this.nodes.text;return new KP(n,n.defaultAttrs,t,bP.setFrom(e))},wF.prototype.mark=function(t,e){return"string"==typeof t&&(t=this.marks[t]),t.create(e)},wF.prototype.nodeFromJSON=function(t){return WP.fromJSON(this,t)},wF.prototype.markFromJSON=function(t){return bP.fromJSON(this,t)},wF.prototype.nodeType=function(t){var e=this.nodes[t];if(!e)throw new RangeError("Unknown node type: "+t);return e};var bF=function(t,e){var n=this;this.schema=t,this.rules=e,this.tags=[],this.styles=[],e.forEach((function(t){t.tag?n.tags.push(t):t.style&&n.styles.push(t)})),this.normalizeLists=!this.tags.some((function(e){if(!/^(ul|ol)\b/.test(e.tag)||!e.node)return!1;var n=t.nodes[e.node];return n.contentMatch.matchType(n)}))};bF.prototype.parse=function(t,e){void 0===e&&(e={});var n=new AF(this,e,!1);return n.addAll(t,null,e.from,e.to),n.finish()},bF.prototype.parseSlice=function(t,e){void 0===e&&(e={});var n=new AF(this,e,!0);return n.addAll(t,null,e.from,e.to),SP.maxOpen(n.finish())},bF.prototype.matchTag=function(t,e){for(var n=0;n<this.tags.length;n++){var r=this.tags[n];if(zF(t,r.tag)&&(void 0===r.namespace||t.namespaceURI==r.namespace)&&(!r.context||e.matchesContext(r.context))){if(r.getAttrs){var o=r.getAttrs(t);if(!1===o)continue;r.attrs=o}return r}}},bF.prototype.matchStyle=function(t,e,n){for(var r=0;r<this.styles.length;r++){var o=this.styles[r];if(!(0!=o.style.indexOf(t)||o.context&&!n.matchesContext(o.context)||o.style.length>t.length&&(61!=o.style.charCodeAt(t.length)||o.style.slice(t.length+1)!=e))){if(o.getAttrs){var i=o.getAttrs(e);if(!1===i)continue;o.attrs=i}return o}}},bF.schemaRules=function(t){var e=[];function n(t){for(var n=null==t.priority?50:t.priority,r=0;r<e.length;r++){var o=e[r],i=null==o.priority?50:o.priority;if(i<n)break}e.splice(r,0,t)}var r=function(e){var r=t.marks[e].spec.parseDOM;r&&r.forEach((function(t){n(t=PF(t)),t.mark=e}))};for(var o in t.marks)r(o);var i=function(e){var r=t.nodes[s].spec.parseDOM;r&&r.forEach((function(t){n(t=PF(t)),t.node=s}))};for(var s in t.nodes)i();return e},bF.fromSchema=function(t){return t.cached.domParser||(t.cached.domParser=new bF(t,bF.schemaRules(t)))};var kF={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},SF={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},OF={ol:!0,ul:!0},CF=1,MF=2,NF=4;function TF(t){return(t?CF:0)|("full"===t?MF:0)}var EF=function(t,e,n,r,o,i,s){this.type=t,this.attrs=e,this.solid=o,this.match=i||(s&NF?null:t.contentMatch),this.options=s,this.content=[],this.marks=n,this.activeMarks=bP.none,this.pendingMarks=r};EF.prototype.findWrapping=function(t){if(!this.match){if(!this.type)return[];var e=this.type.contentMatch.fillBefore(vP.from(t));if(!e){var n,r=this.type.contentMatch;return(n=r.findWrapping(t.type))?(this.match=r,n):null}this.match=this.type.contentMatch.matchFragment(e)}return this.match.findWrapping(t.type)},EF.prototype.finish=function(t){if(!(this.options&CF)){var e,n=this.content[this.content.length-1];n&&n.isText&&(e=/[ \t\r\n\u000c]+$/.exec(n.text))&&(n.text.length==e[0].length?this.content.pop():this.content[this.content.length-1]=n.withText(n.text.slice(0,n.text.length-e[0].length)))}var r=vP.from(this.content);return!t&&this.match&&(r=r.append(this.match.fillBefore(vP.empty,!0))),this.type?this.type.create(this.attrs,r,this.marks):r},EF.prototype.applyPending=function(t){for(var e=0,n=this.pendingMarks;e<n.length;e++){var r=n[e];(this.type?this.type.allowsMarkType(r.type):FF(r.type,t))&&!r.isInSet(this.activeMarks)&&(this.activeMarks=r.addToSet(this.activeMarks),this.pendingMarks=r.removeFromSet(this.pendingMarks))}};var AF=function(t,e,n){this.parser=t,this.options=e,this.isOpen=n;var r,o=e.topNode,i=TF(e.preserveWhitespace)|(n?NF:0);r=o?new EF(o.type,o.attrs,bP.none,bP.none,!0,e.topMatch||o.type.contentMatch,i):new EF(n?null:t.schema.topNodeType,null,bP.none,bP.none,!0,null,i),this.nodes=[r],this.open=0,this.find=e.findPositions,this.needsBlock=!1},DF={top:{configurable:!0},currentPos:{configurable:!0}};function RF(t){for(var e=t.firstChild,n=null;e;e=e.nextSibling){var r=1==e.nodeType?e.nodeName.toLowerCase():null;r&&OF.hasOwnProperty(r)&&n?(n.appendChild(e),e=n):"li"==r?n=e:r&&(n=null)}}function zF(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function IF(t){var e,n=/\s*([\w-]+)\s*:\s*([^;]+)/g,r=[];while(e=n.exec(t))r.push(e[1],e[2].trim());return r}function PF(t){var e={};for(var n in t)e[n]=t[n];return e}function FF(t,e){var n=e.schema.nodes,r=function(r){var o=n[r];if(o.allowsMarkType(t)){var i=[],s=function(t){i.push(t);for(var n=0;n<t.edgeCount;n++){var r=t.edge(n),o=r.type,a=r.next;if(o==e)return!0;if(i.indexOf(a)<0&&s(a))return!0}};return s(o.contentMatch)?{v:!0}:void 0}};for(var o in n){var i=r(o);if(i)return i.v}}DF.top.get=function(){return this.nodes[this.open]},AF.prototype.addDOM=function(t){if(3==t.nodeType)this.addTextNode(t);else if(1==t.nodeType){var e=t.getAttribute("style"),n=e?this.readStyles(IF(e)):null,r=this.top;if(null!=n)for(var o=0;o<n.length;o++)this.addPendingMark(n[o]);if(this.addElement(t),null!=n)for(var i=0;i<n.length;i++)this.removePendingMark(n[i],r)}},AF.prototype.addTextNode=function(t){var e=t.nodeValue,n=this.top;if((n.type?n.type.inlineContent:n.content.length&&n.content[0].isInline)||/[^ \t\r\n\u000c]/.test(e)){if(n.options&CF)n.options&MF||(e=e.replace(/\r?\n|\r/g," "));else if(e=e.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(e)&&this.open==this.nodes.length-1){var r=n.content[n.content.length-1],o=t.previousSibling;(!r||o&&"BR"==o.nodeName||r.isText&&/[ \t\r\n\u000c]$/.test(r.text))&&(e=e.slice(1))}e&&this.insertNode(this.parser.schema.text(e)),this.findInText(t)}else this.findInside(t)},AF.prototype.addElement=function(t){var e=t.nodeName.toLowerCase();OF.hasOwnProperty(e)&&this.normalizeLists&&RF(t);var n=this.options.ruleFromNode&&this.options.ruleFromNode(t)||this.parser.matchTag(t,this);if(n?n.ignore:SF.hasOwnProperty(e))this.findInside(t);else if(!n||n.skip||n.closeParent){n&&n.closeParent?this.open=Math.max(0,this.open-1):n&&n.skip.nodeType&&(t=n.skip);var r,o=this.top,i=this.needsBlock;if(kF.hasOwnProperty(e))r=!0,o.type||(this.needsBlock=!0);else if(!t.firstChild)return void this.leafFallback(t);this.addAll(t),r&&this.sync(o),this.needsBlock=i}else this.addElementByRule(t,n)},AF.prototype.leafFallback=function(t){"BR"==t.nodeName&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(t.ownerDocument.createTextNode("\n"))},AF.prototype.readStyles=function(t){for(var e=bP.none,n=0;n<t.length;n+=2){var r=this.parser.matchStyle(t[n],t[n+1],this);if(r){if(r.ignore)return null;e=this.parser.schema.marks[r.mark].create(r.attrs).addToSet(e)}}return e},AF.prototype.addElementByRule=function(t,e){var n,r,o,i,s=this;e.node?(r=this.parser.schema.nodes[e.node],r.isLeaf?this.insertNode(r.create(e.attrs))||this.leafFallback(t):n=this.enter(r,e.attrs,e.preserveWhitespace)):(o=this.parser.schema.marks[e.mark],i=o.create(e.attrs),this.addPendingMark(i));var a=this.top;if(r&&r.isLeaf)this.findInside(t);else if(e.getContent)this.findInside(t),e.getContent(t,this.parser.schema).forEach((function(t){return s.insertNode(t)}));else{var c=e.contentElement;"string"==typeof c?c=t.querySelector(c):"function"==typeof c&&(c=c(t)),c||(c=t),this.findAround(t,c,!0),this.addAll(c,n)}n&&(this.sync(a),this.open--),i&&this.removePendingMark(i,a)},AF.prototype.addAll=function(t,e,n,r){for(var o=n||0,i=n?t.childNodes[n]:t.firstChild,s=null==r?null:t.childNodes[r];i!=s;i=i.nextSibling,++o)this.findAtPoint(t,o),this.addDOM(i),e&&kF.hasOwnProperty(i.nodeName.toLowerCase())&&this.sync(e);this.findAtPoint(t,o)},AF.prototype.findPlace=function(t){for(var e,n,r=this.open;r>=0;r--){var o=this.nodes[r],i=o.findWrapping(t);if(i&&(!e||e.length>i.length)&&(e=i,n=o,!i.length))break;if(o.solid)break}if(!e)return!1;this.sync(n);for(var s=0;s<e.length;s++)this.enterInner(e[s],null,!1);return!0},AF.prototype.insertNode=function(t){if(t.isInline&&this.needsBlock&&!this.top.type){var e=this.textblockFromContext();e&&this.enterInner(e)}if(this.findPlace(t)){this.closeExtra();var n=this.top;n.applyPending(t.type),n.match&&(n.match=n.match.matchType(t.type));for(var r=n.activeMarks,o=0;o<t.marks.length;o++)n.type&&!n.type.allowsMarkType(t.marks[o].type)||(r=t.marks[o].addToSet(r));return n.content.push(t.mark(r)),!0}return!1},AF.prototype.enter=function(t,e,n){var r=this.findPlace(t.create(e));return r&&this.enterInner(t,e,!0,n),r},AF.prototype.enterInner=function(t,e,n,r){this.closeExtra();var o=this.top;o.applyPending(t),o.match=o.match&&o.match.matchType(t,e);var i=null==r?o.options&~NF:TF(r);o.options&NF&&0==o.content.length&&(i|=NF),this.nodes.push(new EF(t,e,o.activeMarks,o.pendingMarks,n,null,i)),this.open++},AF.prototype.closeExtra=function(t){var e=this.nodes.length-1;if(e>this.open){for(;e>this.open;e--)this.nodes[e-1].content.push(this.nodes[e].finish(t));this.nodes.length=this.open+1}},AF.prototype.finish=function(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)},AF.prototype.sync=function(t){for(var e=this.open;e>=0;e--)if(this.nodes[e]==t)return void(this.open=e)},DF.currentPos.get=function(){this.closeExtra();for(var t=0,e=this.open;e>=0;e--){for(var n=this.nodes[e].content,r=n.length-1;r>=0;r--)t+=n[r].nodeSize;e&&t++}return t},AF.prototype.findAtPoint=function(t,e){if(this.find)for(var n=0;n<this.find.length;n++)this.find[n].node==t&&this.find[n].offset==e&&(this.find[n].pos=this.currentPos)},AF.prototype.findInside=function(t){if(this.find)for(var e=0;e<this.find.length;e++)null==this.find[e].pos&&1==t.nodeType&&t.contains(this.find[e].node)&&(this.find[e].pos=this.currentPos)},AF.prototype.findAround=function(t,e,n){if(t!=e&&this.find)for(var r=0;r<this.find.length;r++)if(null==this.find[r].pos&&1==t.nodeType&&t.contains(this.find[r].node)){var o=e.compareDocumentPosition(this.find[r].node);o&(n?2:4)&&(this.find[r].pos=this.currentPos)}},AF.prototype.findInText=function(t){if(this.find)for(var e=0;e<this.find.length;e++)this.find[e].node==t&&(this.find[e].pos=this.currentPos-(t.nodeValue.length-this.find[e].offset))},AF.prototype.matchesContext=function(t){var e=this;if(t.indexOf("|")>-1)return t.split(/\s*\|\s*/).some(this.matchesContext,this);var n=t.split("/"),r=this.options.context,o=!this.isOpen&&(!r||r.parent.type==this.nodes[0].type),i=-(r?r.depth+1:0)+(o?0:1),s=function(t,a){for(;t>=0;t--){var c=n[t];if(""==c){if(t==n.length-1||0==t)continue;for(;a>=i;a--)if(s(t-1,a))return!0;return!1}var h=a>0||0==a&&o?e.nodes[a].type:r&&a>=i?r.node(a-i).type:null;if(!h||h.name!=c&&-1==h.groups.indexOf(c))return!1;a--}return!0};return s(n.length-1,this.open)},AF.prototype.textblockFromContext=function(){var t=this.options.context;if(t)for(var e=t.depth;e>=0;e--){var n=t.node(e).contentMatchAt(t.indexAfter(e)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(var r in this.parser.schema.nodes){var o=this.parser.schema.nodes[r];if(o.isTextblock&&o.defaultAttrs)return o}},AF.prototype.addPendingMark=function(t){this.top.pendingMarks=t.addToSet(this.top.pendingMarks)},AF.prototype.removePendingMark=function(t,e){for(var n=this.open;n>=0;n--){var r=this.nodes[n],o=r.pendingMarks.lastIndexOf(t);if(o>-1?r.pendingMarks=t.removeFromSet(r.pendingMarks):r.activeMarks=t.removeFromSet(r.activeMarks),r==e)break}},Object.defineProperties(AF.prototype,DF);var BF=function(t,e){this.nodes=t||{},this.marks=e||{}};function $F(t){var e={};for(var n in t){var r=t[n].spec.toDOM;r&&(e[n]=r)}return e}function _F(t){return t.document||window.document}BF.prototype.serializeFragment=function(t,e,n){var r=this;void 0===e&&(e={}),n||(n=_F(e).createDocumentFragment());var o=n,i=null;return t.forEach((function(t){if(i||t.marks.length){i||(i=[]);var n=0,s=0;while(n<i.length&&s<t.marks.length){var a=t.marks[s];if(r.marks[a.type.name]){if(!a.eq(i[n])||!1===a.type.spec.spanning)break;n+=2,s++}else s++}while(n<i.length)o=i.pop(),i.pop();while(s<t.marks.length){var c=t.marks[s++],h=r.serializeMark(c,t.isInline,e);h&&(i.push(c,o),o.appendChild(h.dom),o=h.contentDOM||h.dom)}}o.appendChild(r.serializeNode(t,e))})),n},BF.prototype.serializeNode=function(t,e){void 0===e&&(e={});var n=BF.renderSpec(_F(e),this.nodes[t.type.name](t)),r=n.dom,o=n.contentDOM;if(o){if(t.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");e.onContent?e.onContent(t,o,e):this.serializeFragment(t.content,e,o)}return r},BF.prototype.serializeNodeAndMarks=function(t,e){void 0===e&&(e={});for(var n=this.serializeNode(t,e),r=t.marks.length-1;r>=0;r--){var o=this.serializeMark(t.marks[r],t.isInline,e);o&&((o.contentDOM||o.dom).appendChild(n),n=o.dom)}return n},BF.prototype.serializeMark=function(t,e,n){void 0===n&&(n={});var r=this.marks[t.type.name];return r&&BF.renderSpec(_F(n),r(t,e))},BF.renderSpec=function(t,e,n){if(void 0===n&&(n=null),"string"==typeof e)return{dom:t.createTextNode(e)};if(null!=e.nodeType)return{dom:e};var r=e[0],o=r.indexOf(" ");o>0&&(n=r.slice(0,o),r=r.slice(o+1));var i=null,s=n?t.createElementNS(n,r):t.createElement(r),a=e[1],c=1;if(a&&"object"==typeof a&&null==a.nodeType&&!Array.isArray(a))for(var h in c=2,a)if(null!=a[h]){var p=h.indexOf(" ");p>0?s.setAttributeNS(h.slice(0,p),h.slice(p+1),a[h]):s.setAttribute(h,a[h])}for(var l=c;l<e.length;l++){var u=e[l];if(0===u){if(l<e.length-1||l>c)throw new RangeError("Content hole must be the only child of its parent node");return{dom:s,contentDOM:s}}var f=BF.renderSpec(t,u,n),d=f.dom,m=f.contentDOM;if(s.appendChild(d),m){if(i)throw new RangeError("Multiple content holes");i=m}}return{dom:s,contentDOM:i}},BF.fromSchema=function(t){return t.cached.domSerializer||(t.cached.domSerializer=new BF(this.nodesFromSchema(t),this.marksFromSchema(t)))},BF.nodesFromSchema=function(t){var e=$F(t.nodes);return e.text||(e.text=function(t){return t.text}),e},BF.marksFromSchema=function(t){return $F(t.marks)};var jF=65535,JF=Math.pow(2,16);function LF(t,e){return t+e*JF}function VF(t){return t&jF}function qF(t){return(t-(t&jF))/JF}var WF=function(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=null),this.pos=t,this.deleted=e,this.recover=n},HF=function(t,e){void 0===e&&(e=!1),this.ranges=t,this.inverted=e};HF.prototype.recover=function(t){var e=0,n=VF(t);if(!this.inverted)for(var r=0;r<n;r++)e+=this.ranges[3*r+2]-this.ranges[3*r+1];return this.ranges[3*n]+e+qF(t)},HF.prototype.mapResult=function(t,e){return void 0===e&&(e=1),this._map(t,e,!1)},HF.prototype.map=function(t,e){return void 0===e&&(e=1),this._map(t,e,!0)},HF.prototype._map=function(t,e,n){for(var r=0,o=this.inverted?2:1,i=this.inverted?1:2,s=0;s<this.ranges.length;s+=3){var a=this.ranges[s]-(this.inverted?r:0);if(a>t)break;var c=this.ranges[s+o],h=this.ranges[s+i],p=a+c;if(t<=p){var l=c?t==a?-1:t==p?1:e:e,u=a+r+(l<0?0:h);if(n)return u;var f=t==(e<0?a:p)?null:LF(s/3,t-a);return new WF(u,e<0?t!=a:t!=p,f)}r+=h-c}return n?t+r:new WF(t+r)},HF.prototype.touches=function(t,e){for(var n=0,r=VF(e),o=this.inverted?2:1,i=this.inverted?1:2,s=0;s<this.ranges.length;s+=3){var a=this.ranges[s]-(this.inverted?n:0);if(a>t)break;var c=this.ranges[s+o],h=a+c;if(t<=h&&s==3*r)return!0;n+=this.ranges[s+i]-c}return!1},HF.prototype.forEach=function(t){for(var e=this.inverted?2:1,n=this.inverted?1:2,r=0,o=0;r<this.ranges.length;r+=3){var i=this.ranges[r],s=i-(this.inverted?o:0),a=i+(this.inverted?0:o),c=this.ranges[r+e],h=this.ranges[r+n];t(s,s+c,a,a+h),o+=h-c}},HF.prototype.invert=function(){return new HF(this.ranges,!this.inverted)},HF.prototype.toString=function(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)},HF.offset=function(t){return 0==t?HF.empty:new HF(t<0?[0,-t,0]:[0,0,t])},HF.empty=new HF([]);var KF=function(t,e,n,r){this.maps=t||[],this.from=n||0,this.to=null==r?this.maps.length:r,this.mirror=e};function UF(t){var e=Error.call(this,t);return e.__proto__=UF.prototype,e}KF.prototype.slice=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=this.maps.length),new KF(this.maps,this.mirror,t,e)},KF.prototype.copy=function(){return new KF(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)},KF.prototype.appendMap=function(t,e){this.to=this.maps.push(t),null!=e&&this.setMirror(this.maps.length-1,e)},KF.prototype.appendMapping=function(t){for(var e=0,n=this.maps.length;e<t.maps.length;e++){var r=t.getMirror(e);this.appendMap(t.maps[e],null!=r&&r<e?n+r:null)}},KF.prototype.getMirror=function(t){if(this.mirror)for(var e=0;e<this.mirror.length;e++)if(this.mirror[e]==t)return this.mirror[e+(e%2?-1:1)]},KF.prototype.setMirror=function(t,e){this.mirror||(this.mirror=[]),this.mirror.push(t,e)},KF.prototype.appendMappingInverted=function(t){for(var e=t.maps.length-1,n=this.maps.length+t.maps.length;e>=0;e--){var r=t.getMirror(e);this.appendMap(t.maps[e].invert(),null!=r&&r>e?n-r-1:null)}},KF.prototype.invert=function(){var t=new KF;return t.appendMappingInverted(this),t},KF.prototype.map=function(t,e){if(void 0===e&&(e=1),this.mirror)return this._map(t,e,!0);for(var n=this.from;n<this.to;n++)t=this.maps[n].map(t,e);return t},KF.prototype.mapResult=function(t,e){return void 0===e&&(e=1),this._map(t,e,!1)},KF.prototype._map=function(t,e,n){for(var r=!1,o=this.from;o<this.to;o++){var i=this.maps[o],s=i.mapResult(t,e);if(null!=s.recover){var a=this.getMirror(o);if(null!=a&&a>o&&a<this.to){o=a,t=this.maps[a].recover(s.recover);continue}}s.deleted&&(r=!0),t=s.pos}return n?t:new WF(t,r)},UF.prototype=Object.create(Error.prototype),UF.prototype.constructor=UF,UF.prototype.name="TransformError";var GF=function(t){this.doc=t,this.steps=[],this.docs=[],this.mapping=new KF},XF={before:{configurable:!0},docChanged:{configurable:!0}};function YF(){throw new Error("Override me")}XF.before.get=function(){return this.docs.length?this.docs[0]:this.doc},GF.prototype.step=function(t){var e=this.maybeStep(t);if(e.failed)throw new UF(e.failed);return this},GF.prototype.maybeStep=function(t){var e=t.apply(this.doc);return e.failed||this.addStep(t,e.doc),e},XF.docChanged.get=function(){return this.steps.length>0},GF.prototype.addStep=function(t,e){this.docs.push(this.doc),this.steps.push(t),this.mapping.appendMap(t.getMap()),this.doc=e},Object.defineProperties(GF.prototype,XF);var ZF=Object.create(null),QF=function(){};QF.prototype.apply=function(t){return YF()},QF.prototype.getMap=function(){return HF.empty},QF.prototype.invert=function(t){return YF()},QF.prototype.map=function(t){return YF()},QF.prototype.merge=function(t){return null},QF.prototype.toJSON=function(){return YF()},QF.fromJSON=function(t,e){if(!e||!e.stepType)throw new RangeError("Invalid input for Step.fromJSON");var n=ZF[e.stepType];if(!n)throw new RangeError("No step type "+e.stepType+" defined");return n.fromJSON(t,e)},QF.jsonID=function(t,e){if(t in ZF)throw new RangeError("Duplicate use of step JSON ID "+t);return ZF[t]=e,e.prototype.jsonID=t,e};var tB=function(t,e){this.doc=t,this.failed=e};tB.ok=function(t){return new tB(t,null)},tB.fail=function(t){return new tB(null,t)},tB.fromReplace=function(t,e,n,r){try{return tB.ok(t.replace(e,n,r))}catch(o){if(o instanceof kP)return tB.fail(o.message);throw o}};var eB=function(t){function e(e,n,r,o){t.call(this),this.from=e,this.to=n,this.slice=r,this.structure=!!o}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(t){return this.structure&&rB(t,this.from,this.to)?tB.fail("Structure replace would overwrite content"):tB.fromReplace(t,this.from,this.to,this.slice)},e.prototype.getMap=function(){return new HF([this.from,this.to-this.from,this.slice.size])},e.prototype.invert=function(t){return new e(this.from,this.from+this.slice.size,t.slice(this.from,this.to))},e.prototype.map=function(t){var n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return n.deleted&&r.deleted?null:new e(n.pos,Math.max(n.pos,r.pos),this.slice)},e.prototype.merge=function(t){if(!(t instanceof e)||t.structure||this.structure)return null;if(this.from+this.slice.size!=t.from||this.slice.openEnd||t.slice.openStart){if(t.to!=this.from||this.slice.openStart||t.slice.openEnd)return null;var n=this.slice.size+t.slice.size==0?SP.empty:new SP(t.slice.content.append(this.slice.content),t.slice.openStart,this.slice.openEnd);return new e(t.from,this.to,n,this.structure)}var r=this.slice.size+t.slice.size==0?SP.empty:new SP(this.slice.content.append(t.slice.content),this.slice.openStart,t.slice.openEnd);return new e(this.from,this.to+(t.to-t.from),r,this.structure)},e.prototype.toJSON=function(){var t={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t},e.fromJSON=function(t,n){if("number"!=typeof n.from||"number"!=typeof n.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new e(n.from,n.to,SP.fromJSON(t,n.slice),!!n.structure)},e}(QF);QF.jsonID("replace",eB);var nB=function(t){function e(e,n,r,o,i,s,a){t.call(this),this.from=e,this.to=n,this.gapFrom=r,this.gapTo=o,this.slice=i,this.insert=s,this.structure=!!a}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(t){if(this.structure&&(rB(t,this.from,this.gapFrom)||rB(t,this.gapTo,this.to)))return tB.fail("Structure gap-replace would overwrite content");var e=t.slice(this.gapFrom,this.gapTo);if(e.openStart||e.openEnd)return tB.fail("Gap is not a flat range");var n=this.slice.insertAt(this.insert,e.content);return n?tB.fromReplace(t,this.from,this.to,n):tB.fail("Content does not fit in gap")},e.prototype.getMap=function(){return new HF([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])},e.prototype.invert=function(t){var n=this.gapTo-this.gapFrom;return new e(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)},e.prototype.map=function(t){var n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1),o=t.map(this.gapFrom,-1),i=t.map(this.gapTo,1);return n.deleted&&r.deleted||o<n.pos||i>r.pos?null:new e(n.pos,r.pos,o,i,this.slice,this.insert,this.structure)},e.prototype.toJSON=function(){var t={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t},e.fromJSON=function(t,n){if("number"!=typeof n.from||"number"!=typeof n.to||"number"!=typeof n.gapFrom||"number"!=typeof n.gapTo||"number"!=typeof n.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new e(n.from,n.to,n.gapFrom,n.gapTo,SP.fromJSON(t,n.slice),n.insert,!!n.structure)},e}(QF);function rB(t,e,n){var r=t.resolve(e),o=n-e,i=r.depth;while(o>0&&i>0&&r.indexAfter(i)==r.node(i).childCount)i--,o--;if(o>0){var s=r.node(i).maybeChild(r.indexAfter(i));while(o>0){if(!s||s.isLeaf)return!0;s=s.firstChild,o--}}return!1}function oB(t,e,n){var r=t.resolve(e),o=r.index();return r.parent.canReplaceWith(o,o+1,n)}function iB(t,e,n){var r=t.resolve(e);if(r.parent.canReplaceWith(r.index(),r.index(),n))return e;if(0==r.parentOffset)for(var o=r.depth-1;o>=0;o--){var i=r.index(o);if(r.node(o).canReplaceWith(i,i,n))return r.before(o+1);if(i>0)return null}if(r.parentOffset==r.parent.content.size)for(var s=r.depth-1;s>=0;s--){var a=r.indexAfter(s);if(r.node(s).canReplaceWith(a,a,n))return r.after(s+1);if(a<r.node(s).childCount)return null}}function sB(t,e,n){for(var r=[],o=0;o<t.childCount;o++){var i=t.child(o);i.content.size&&(i=i.copy(sB(i.content,e,i))),i.isInline&&(i=e(i,n,o)),r.push(i)}return vP.fromArray(r)}QF.jsonID("replaceAround",nB),GF.prototype.lift=function(t,e){for(var n=t.$from,r=t.$to,o=t.depth,i=n.before(o+1),s=r.after(o+1),a=i,c=s,h=vP.empty,p=0,l=o,u=!1;l>e;l--)u||n.index(l)>0?(u=!0,h=vP.from(n.node(l).copy(h)),p++):a--;for(var f=vP.empty,d=0,m=o,v=!1;m>e;m--)v||r.after(m+1)<r.end(m)?(v=!0,f=vP.from(r.node(m).copy(f)),d++):c++;return this.step(new nB(a,c,i,s,new SP(h.append(f),p,d),h.size-p,!0))},GF.prototype.wrap=function(t,e){for(var n=vP.empty,r=e.length-1;r>=0;r--)n=vP.from(e[r].type.create(e[r].attrs,n));var o=t.start,i=t.end;return this.step(new nB(o,i,o,i,new SP(n,0,0),e.length,!0))},GF.prototype.setBlockType=function(t,e,n,r){var o=this;if(void 0===e&&(e=t),!n.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");var i=this.steps.length;return this.doc.nodesBetween(t,e,(function(t,e){if(t.isTextblock&&!t.hasMarkup(n,r)&&oB(o.doc,o.mapping.slice(i).map(e),n)){o.clearIncompatible(o.mapping.slice(i).map(e,1),n);var s=o.mapping.slice(i),a=s.map(e,1),c=s.map(e+t.nodeSize,1);return o.step(new nB(a,c,a+1,c-1,new SP(vP.from(n.create(r,null,t.marks)),0,0),1,!0)),!1}})),this},GF.prototype.setNodeMarkup=function(t,e,n,r){var o=this.doc.nodeAt(t);if(!o)throw new RangeError("No node at given position");e||(e=o.type);var i=e.create(n,null,r||o.marks);if(o.isLeaf)return this.replaceWith(t,t+o.nodeSize,i);if(!e.validContent(o.content))throw new RangeError("Invalid content for node type "+e.name);return this.step(new nB(t,t+o.nodeSize,t+1,t+o.nodeSize-1,new SP(vP.from(i),0,0),1,!0))},GF.prototype.split=function(t,e,n){void 0===e&&(e=1);for(var r=this.doc.resolve(t),o=vP.empty,i=vP.empty,s=r.depth,a=r.depth-e,c=e-1;s>a;s--,c--){o=vP.from(r.node(s).copy(o));var h=n&&n[c];i=vP.from(h?h.type.create(h.attrs,i):r.node(s).copy(i))}return this.step(new eB(t,t,new SP(o.append(i),e,e),!0))},GF.prototype.join=function(t,e){void 0===e&&(e=1);var n=new eB(t-e,t+e,SP.empty,!0);return this.step(n)};var aB=function(t){function e(e,n,r){t.call(this),this.from=e,this.to=n,this.mark=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(t){var e=this,n=t.slice(this.from,this.to),r=t.resolve(this.from),o=r.node(r.sharedDepth(this.to)),i=new SP(sB(n.content,(function(t,n){return t.isAtom&&n.type.allowsMarkType(e.mark.type)?t.mark(e.mark.addToSet(t.marks)):t}),o),n.openStart,n.openEnd);return tB.fromReplace(t,this.from,this.to,i)},e.prototype.invert=function(){return new cB(this.from,this.to,this.mark)},e.prototype.map=function(t){var n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new e(n.pos,r.pos,this.mark)},e.prototype.merge=function(t){if(t instanceof e&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from)return new e(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark)},e.prototype.toJSON=function(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},e.fromJSON=function(t,n){if("number"!=typeof n.from||"number"!=typeof n.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new e(n.from,n.to,t.markFromJSON(n.mark))},e}(QF);QF.jsonID("addMark",aB);var cB=function(t){function e(e,n,r){t.call(this),this.from=e,this.to=n,this.mark=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(t){var e=this,n=t.slice(this.from,this.to),r=new SP(sB(n.content,(function(t){return t.mark(e.mark.removeFromSet(t.marks))})),n.openStart,n.openEnd);return tB.fromReplace(t,this.from,this.to,r)},e.prototype.invert=function(){return new aB(this.from,this.to,this.mark)},e.prototype.map=function(t){var n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new e(n.pos,r.pos,this.mark)},e.prototype.merge=function(t){if(t instanceof e&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from)return new e(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark)},e.prototype.toJSON=function(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},e.fromJSON=function(t,n){if("number"!=typeof n.from||"number"!=typeof n.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new e(n.from,n.to,t.markFromJSON(n.mark))},e}(QF);function hB(t,e,n,r){if(void 0===n&&(n=e),void 0===r&&(r=SP.empty),e==n&&!r.size)return null;var o=t.resolve(e),i=t.resolve(n);return pB(o,i,r)?new eB(e,n,r):new lB(o,i,r).fit()}function pB(t,e,n){return!n.openStart&&!n.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),n.content)}QF.jsonID("removeMark",cB),GF.prototype.addMark=function(t,e,n){var r=this,o=[],i=[],s=null,a=null;return this.doc.nodesBetween(t,e,(function(r,c,h){if(r.isInline){var p=r.marks;if(!n.isInSet(p)&&h.type.allowsMarkType(n.type)){for(var l=Math.max(c,t),u=Math.min(c+r.nodeSize,e),f=n.addToSet(p),d=0;d<p.length;d++)p[d].isInSet(f)||(s&&s.to==l&&s.mark.eq(p[d])?s.to=u:o.push(s=new cB(l,u,p[d])));a&&a.to==l?a.to=u:i.push(a=new aB(l,u,n))}}})),o.forEach((function(t){return r.step(t)})),i.forEach((function(t){return r.step(t)})),this},GF.prototype.removeMark=function(t,e,n){var r=this;void 0===n&&(n=null);var o=[],i=0;return this.doc.nodesBetween(t,e,(function(r,s){if(r.isInline){i++;var a=null;if(n instanceof yF){var c,h=r.marks;while(c=n.isInSet(h))(a||(a=[])).push(c),h=c.removeFromSet(h)}else n?n.isInSet(r.marks)&&(a=[n]):a=r.marks;if(a&&a.length)for(var p=Math.min(s+r.nodeSize,e),l=0;l<a.length;l++){for(var u=a[l],f=void 0,d=0;d<o.length;d++){var m=o[d];m.step==i-1&&u.eq(o[d].style)&&(f=m)}f?(f.to=p,f.step=i):o.push({style:u,from:Math.max(s,t),to:p,step:i})}}})),o.forEach((function(t){return r.step(new cB(t.from,t.to,t.style))})),this},GF.prototype.clearIncompatible=function(t,e,n){void 0===n&&(n=e.contentMatch);for(var r=this.doc.nodeAt(t),o=[],i=t+1,s=0;s<r.childCount;s++){var a=r.child(s),c=i+a.nodeSize,h=n.matchType(a.type,a.attrs);if(h){n=h;for(var p=0;p<a.marks.length;p++)e.allowsMarkType(a.marks[p].type)||this.step(new cB(i,c,a.marks[p]))}else o.push(new eB(i,c,SP.empty));i=c}if(!n.validEnd){var l=n.fillBefore(vP.empty,!0);this.replace(i,i,new SP(l,0,0))}for(var u=o.length-1;u>=0;u--)this.step(o[u]);return this},GF.prototype.replace=function(t,e,n){void 0===e&&(e=t),void 0===n&&(n=SP.empty);var r=hB(this.doc,t,e,n);return r&&this.step(r),this},GF.prototype.replaceWith=function(t,e,n){return this.replace(t,e,new SP(vP.from(n),0,0))},GF.prototype.delete=function(t,e){return this.replace(t,e,SP.empty)},GF.prototype.insert=function(t,e){return this.replaceWith(t,t,e)};var lB=function(t,e,n){this.$to=e,this.$from=t,this.unplaced=n,this.frontier=[];for(var r=0;r<=t.depth;r++){var o=t.node(r);this.frontier.push({type:o.type,match:o.contentMatchAt(t.indexAfter(r))})}this.placed=vP.empty;for(var i=t.depth;i>0;i--)this.placed=vP.from(t.node(i).copy(this.placed))},uB={depth:{configurable:!0}};function fB(t,e,n){return 0==e?t.cutByIndex(n):t.replaceChild(0,t.firstChild.copy(fB(t.firstChild.content,e-1,n)))}function dB(t,e,n){return 0==e?t.append(n):t.replaceChild(t.childCount-1,t.lastChild.copy(dB(t.lastChild.content,e-1,n)))}function mB(t,e){for(var n=0;n<e;n++)t=t.firstChild.content;return t}function vB(t,e,n){if(e<=0)return t;var r=t.content;return e>1&&(r=r.replaceChild(0,vB(r.firstChild,e-1,1==r.childCount?n-1:0))),e>0&&(r=t.type.contentMatch.fillBefore(r).append(r),n<=0&&(r=r.append(t.type.contentMatch.matchFragment(r).fillBefore(vP.empty,!0)))),t.copy(r)}function gB(t,e,n,r,o){var i=t.node(e),s=o?t.indexAfter(e):t.index(e);if(s==i.childCount&&!n.compatibleContent(i.type))return null;var a=r.fillBefore(i.content,!0,s);return a&&!yB(n,i.content,s)?a:null}function yB(t,e,n){for(var r=n;r<e.childCount;r++)if(!t.allowsMarks(e.child(r).marks))return!0;return!1}function wB(t,e,n,r,o){if(e<n){var i=t.firstChild;t=t.replaceChild(0,i.copy(wB(i.content,e+1,n,r,i)))}if(e>r){var s=o.contentMatchAt(0),a=s.fillBefore(t).append(t);t=a.append(s.matchFragment(a).fillBefore(vP.empty,!0))}return t}function xB(t,e){for(var n=[],r=Math.min(t.depth,e.depth),o=r;o>=0;o--){var i=t.start(o);if(i<t.pos-(t.depth-o)||e.end(o)>e.pos+(e.depth-o)||t.node(o).type.spec.isolating||e.node(o).type.spec.isolating)break;i==e.start(o)&&n.push(o)}return n}uB.depth.get=function(){return this.frontier.length-1},lB.prototype.fit=function(){while(this.unplaced.size){var t=this.findFittable();t?this.placeNodes(t):this.openMore()||this.dropNode()}var e=this.mustMoveInline(),n=this.placed.size-this.depth-this.$from.depth,r=this.$from,o=this.close(e<0?this.$to:r.doc.resolve(e));if(!o)return null;var i=this.placed,s=r.depth,a=o.depth;while(s&&a&&1==i.childCount)i=i.firstChild.content,s--,a--;var c=new SP(i,s,a);return e>-1?new nB(r.pos,e,this.$to.pos,this.$to.end(),c,n):c.size||r.pos!=this.$to.pos?new eB(r.pos,o.pos,c):void 0},lB.prototype.findFittable=function(){for(var t=1;t<=2;t++)for(var e=this.unplaced.openStart;e>=0;e--){var n=void 0,r=void 0;e?(r=mB(this.unplaced.content,e-1).firstChild,n=r.content):n=this.unplaced.content;for(var o=n.firstChild,i=this.depth;i>=0;i--){var s=this.frontier[i],a=s.type,c=s.match,h=void 0,p=void 0;if(1==t&&(o?c.matchType(o.type)||(p=c.fillBefore(vP.from(o),!1)):a.compatibleContent(r.type)))return{sliceDepth:e,frontierDepth:i,parent:r,inject:p};if(2==t&&o&&(h=c.findWrapping(o.type)))return{sliceDepth:e,frontierDepth:i,parent:r,wrap:h};if(r&&c.matchType(r.type))break}}},lB.prototype.openMore=function(){var t=this.unplaced,e=t.content,n=t.openStart,r=t.openEnd,o=mB(e,n);return!(!o.childCount||o.firstChild.isLeaf)&&(this.unplaced=new SP(e,n+1,Math.max(r,o.size+n>=e.size-r?n+1:0)),!0)},lB.prototype.dropNode=function(){var t=this.unplaced,e=t.content,n=t.openStart,r=t.openEnd,o=mB(e,n);if(o.childCount<=1&&n>0){var i=e.size-n<=n+o.size;this.unplaced=new SP(fB(e,n-1,1),n-1,i?n-1:r)}else this.unplaced=new SP(fB(e,n,1),n,r)},lB.prototype.placeNodes=function(t){var e=t.sliceDepth,n=t.frontierDepth,r=t.parent,o=t.inject,i=t.wrap;while(this.depth>n)this.closeFrontierNode();if(i)for(var s=0;s<i.length;s++)this.openFrontierNode(i[s]);var a=this.unplaced,c=r?r.content:a.content,h=a.openStart-e,p=0,l=[],u=this.frontier[n],f=u.match,d=u.type;if(o){for(var m=0;m<o.childCount;m++)l.push(o.child(m));f=f.matchFragment(o)}var v=c.size+e-(a.content.size-a.openEnd);while(p<c.childCount){var g=c.child(p),y=f.matchType(g.type);if(!y)break;p++,(p>1||0==h||g.content.size)&&(f=y,l.push(vB(g.mark(d.allowedMarks(g.marks)),1==p?h:0,p==c.childCount?v:-1)))}var w=p==c.childCount;w||(v=-1),this.placed=dB(this.placed,n,vP.from(l)),this.frontier[n].match=f,w&&v<0&&r&&r.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(var x=0,b=c;x<v;x++){var k=b.lastChild;this.frontier.push({type:k.type,match:k.contentMatchAt(k.childCount)}),b=k.content}this.unplaced=w?0==e?SP.empty:new SP(fB(a.content,e-1,1),e-1,v<0?a.openEnd:e-1):new SP(fB(a.content,e,p),a.openStart,a.openEnd)},lB.prototype.mustMoveInline=function(){if(!this.$to.parent.isTextblock||this.$to.end()==this.$to.pos)return-1;var t,e=this.frontier[this.depth];if(!e.type.isTextblock||!gB(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;var n=this.$to,r=n.depth,o=this.$to.after(r);while(r>1&&o==this.$to.end(--r))++o;return o},lB.prototype.findCloseLevel=function(t){t:for(var e=Math.min(this.depth,t.depth);e>=0;e--){var n=this.frontier[e],r=n.match,o=n.type,i=e<t.depth&&t.end(e+1)==t.pos+(t.depth-(e+1)),s=gB(t,e,o,r,i);if(s){for(var a=e-1;a>=0;a--){var c=this.frontier[a],h=c.match,p=c.type,l=gB(t,a,p,h,!0);if(!l||l.childCount)continue t}return{depth:e,fit:s,move:i?t.doc.resolve(t.after(e+1)):t}}}},lB.prototype.close=function(t){var e=this.findCloseLevel(t);if(!e)return null;while(this.depth>e.depth)this.closeFrontierNode();e.fit.childCount&&(this.placed=dB(this.placed,e.depth,e.fit)),t=e.move;for(var n=e.depth+1;n<=t.depth;n++){var r=t.node(n),o=r.type.contentMatch.fillBefore(r.content,!0,t.index(n));this.openFrontierNode(r.type,r.attrs,o)}return t},lB.prototype.openFrontierNode=function(t,e,n){var r=this.frontier[this.depth];r.match=r.match.matchType(t),this.placed=dB(this.placed,this.depth,vP.from(t.create(e,n))),this.frontier.push({type:t,match:t.contentMatch})},lB.prototype.closeFrontierNode=function(){var t=this.frontier.pop(),e=t.match.fillBefore(vP.empty,!0);e.childCount&&(this.placed=dB(this.placed,this.frontier.length,e))},Object.defineProperties(lB.prototype,uB),GF.prototype.replaceRange=function(t,e,n){if(!n.size)return this.deleteRange(t,e);var r=this.doc.resolve(t),o=this.doc.resolve(e);if(pB(r,o,n))return this.step(new eB(t,e,n));var i=xB(r,this.doc.resolve(e));0==i[i.length-1]&&i.pop();var s=-(r.depth+1);i.unshift(s);for(var a=r.depth,c=r.pos-1;a>0;a--,c--){var h=r.node(a).type.spec;if(h.defining||h.isolating)break;i.indexOf(a)>-1?s=a:r.before(a)==c&&i.splice(1,0,-a)}for(var p=i.indexOf(s),l=[],u=n.openStart,f=n.content,d=0;;d++){var m=f.firstChild;if(l.push(m),d==n.openStart)break;f=m.content}u>0&&l[u-1].type.spec.defining&&r.node(p).type!=l[u-1].type?u-=1:u>=2&&l[u-1].isTextblock&&l[u-2].type.spec.defining&&r.node(p).type!=l[u-2].type&&(u-=2);for(var v=n.openStart;v>=0;v--){var g=(v+u+1)%(n.openStart+1),y=l[g];if(y)for(var w=0;w<i.length;w++){var x=i[(w+p)%i.length],b=!0;x<0&&(b=!1,x=-x);var k=r.node(x-1),S=r.index(x-1);if(k.canReplaceWith(S,S,y.type,y.marks))return this.replace(r.before(x),b?o.after(x):e,new SP(wB(n.content,0,n.openStart,g),g,n.openEnd))}}for(var O=this.steps.length,C=i.length-1;C>=0;C--){if(this.replace(t,e,n),this.steps.length>O)break;var M=i[C];M<0||(t=r.before(M),e=o.after(M))}return this},GF.prototype.replaceRangeWith=function(t,e,n){if(!n.isInline&&t==e&&this.doc.resolve(t).parent.content.size){var r=iB(this.doc,t,n.type);null!=r&&(t=e=r)}return this.replaceRange(t,e,new SP(vP.from(n),0,0))},GF.prototype.deleteRange=function(t,e){for(var n=this.doc.resolve(t),r=this.doc.resolve(e),o=xB(n,r),i=0;i<o.length;i++){var s=o[i],a=i==o.length-1;if(a&&0==s||n.node(s).type.contentMatch.validEnd)return this.delete(n.start(s),r.end(s));if(s>0&&(a||n.node(s-1).canReplace(n.index(s-1),r.indexAfter(s-1))))return this.delete(n.before(s),r.after(s))}for(var c=1;c<=n.depth&&c<=r.depth;c++)if(t-n.start(c)==n.depth-c&&e>n.end(c)&&r.end(c)-e!=r.depth-c)return this.delete(n.before(c),e);return this.delete(t,e)};new ll("collab");var bB=200,kB=function(){};kB.prototype.append=function(t){return t.length?(t=kB.from(t),!this.length&&t||t.length<bB&&this.leafAppend(t)||this.length<bB&&t.leafPrepend(this)||this.appendInner(t)):this},kB.prototype.prepend=function(t){return t.length?kB.from(t).append(this):this},kB.prototype.appendInner=function(t){return new OB(this,t)},kB.prototype.slice=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=this.length),t>=e?kB.empty:this.sliceInner(Math.max(0,t),Math.min(this.length,e))},kB.prototype.get=function(t){if(!(t<0||t>=this.length))return this.getInner(t)},kB.prototype.forEach=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=this.length),e<=n?this.forEachInner(t,e,n,0):this.forEachInvertedInner(t,e,n,0)},kB.prototype.map=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=this.length);var r=[];return this.forEach((function(e,n){return r.push(t(e,n))}),e,n),r},kB.from=function(t){return t instanceof kB?t:t&&t.length?new SB(t):kB.empty};var SB=function(t){function e(e){t.call(this),this.values=e}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(t,n){return 0==t&&n==this.length?this:new e(this.values.slice(t,n))},e.prototype.getInner=function(t){return this.values[t]},e.prototype.forEachInner=function(t,e,n,r){for(var o=e;o<n;o++)if(!1===t(this.values[o],r+o))return!1},e.prototype.forEachInvertedInner=function(t,e,n,r){for(var o=e-1;o>=n;o--)if(!1===t(this.values[o],r+o))return!1},e.prototype.leafAppend=function(t){if(this.length+t.length<=bB)return new e(this.values.concat(t.flatten()))},e.prototype.leafPrepend=function(t){if(this.length+t.length<=bB)return new e(t.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(e.prototype,n),e}(kB);kB.empty=new SB([]);var OB=function(t){function e(e,n){t.call(this),this.left=e,this.right=n,this.length=e.length+n.length,this.depth=Math.max(e.depth,n.depth)+1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(t){return t<this.left.length?this.left.get(t):this.right.get(t-this.left.length)},e.prototype.forEachInner=function(t,e,n,r){var o=this.left.length;return!(e<o&&!1===this.left.forEachInner(t,e,Math.min(n,o),r))&&(!(n>o&&!1===this.right.forEachInner(t,Math.max(e-o,0),Math.min(this.length,n)-o,r+o))&&void 0)},e.prototype.forEachInvertedInner=function(t,e,n,r){var o=this.left.length;return!(e>o&&!1===this.right.forEachInvertedInner(t,e-o,Math.max(n,o)-o,r+o))&&(!(n<o&&!1===this.left.forEachInvertedInner(t,Math.min(e,o),n,r))&&void 0)},e.prototype.sliceInner=function(t,e){if(0==t&&e==this.length)return this;var n=this.left.length;return e<=n?this.left.slice(t,e):t>=n?this.right.slice(t-n,e-n):this.left.slice(t,n).append(this.right.slice(0,e-n))},e.prototype.leafAppend=function(t){var n=this.right.leafAppend(t);if(n)return new e(this.left,n)},e.prototype.leafPrepend=function(t){var n=this.left.leafPrepend(t);if(n)return new e(n,this.right)},e.prototype.appendInner=function(t){return this.left.depth>=Math.max(this.right.depth,t.depth)+1?new e(this.left,new e(this.right,t)):new e(this,t)},e}(kB),CB=kB,MB=CB,NB=500,TB=function(t,e){this.items=t,this.eventCount=e};function EB(t,e){var n;return t.forEach((function(t,r){if(t.selection&&0==e--)return n=r,!1})),t.slice(n)}TB.prototype.popEvent=function(t,e){var n=this;if(0==this.eventCount)return null;for(var r,o,i=this.items.length;;i--){var s=this.items.get(i-1);if(s.selection){--i;break}}e&&(r=this.remapping(i,this.items.length),o=r.maps.length);var a,c,h=t.tr,p=[],l=[];return this.items.forEach((function(t,e){if(!t.step)return r||(r=n.remapping(i,e+1),o=r.maps.length),o--,void l.push(t);if(r){l.push(new AB(t.map));var s,u=t.step.map(r.slice(o));u&&h.maybeStep(u).doc&&(s=h.mapping.maps[h.mapping.maps.length-1],p.push(new AB(s,null,null,p.length+l.length))),o--,s&&r.appendMap(s,o)}else h.maybeStep(t.step);return t.selection?(a=r?t.selection.map(r.slice(o)):t.selection,c=new TB(n.items.slice(0,i).append(l.reverse().concat(p)),n.eventCount-1),!1):void 0}),this.items.length,0),{remaining:c,transform:h,selection:a}},TB.prototype.addTransform=function(t,e,n,r){for(var o=[],i=this.eventCount,s=this.items,a=!r&&s.length?s.get(s.length-1):null,c=0;c<t.steps.length;c++){var h=t.steps[c].invert(t.docs[c]),p=new AB(t.mapping.maps[c],h,e),l=void 0;(l=a&&a.merge(p))&&(p=l,c?o.pop():s=s.slice(0,s.length-1)),o.push(p),e&&(i++,e=null),r||(a=p)}var u=i-n.depth;return u>RB&&(s=EB(s,u),i-=u),new TB(s.append(o),i)},TB.prototype.remapping=function(t,e){var n=new mn;return this.items.forEach((function(e,r){var o=null!=e.mirrorOffset&&r-e.mirrorOffset>=t?n.maps.length-e.mirrorOffset:null;n.appendMap(e.map,o)}),t,e),n},TB.prototype.addMaps=function(t){return 0==this.eventCount?this:new TB(this.items.append(t.map((function(t){return new AB(t)}))),this.eventCount)},TB.prototype.rebased=function(t,e){if(!this.eventCount)return this;var n=[],r=Math.max(0,this.items.length-e),o=t.mapping,i=t.steps.length,s=this.eventCount;this.items.forEach((function(t){t.selection&&s--}),r);var a=e;this.items.forEach((function(e){var r=o.getMirror(--a);if(null!=r){i=Math.min(i,r);var c=o.maps[r];if(e.step){var h=t.steps[r].invert(t.docs[r]),p=e.selection&&e.selection.map(o.slice(a+1,r));p&&s++,n.push(new AB(c,h,p))}else n.push(new AB(c))}}),r);for(var c=[],h=e;h<i;h++)c.push(new AB(o.maps[h]));var p=this.items.slice(0,r).append(c).append(n),l=new TB(p,s);return l.emptyItemCount()>NB&&(l=l.compress(this.items.length-n.length)),l},TB.prototype.emptyItemCount=function(){var t=0;return this.items.forEach((function(e){e.step||t++})),t},TB.prototype.compress=function(t){void 0===t&&(t=this.items.length);var e=this.remapping(0,t),n=e.maps.length,r=[],o=0;return this.items.forEach((function(i,s){if(s>=t)r.push(i),i.selection&&o++;else if(i.step){var a=i.step.map(e.slice(n)),c=a&&a.getMap();if(n--,c&&e.appendMap(c,n),a){var h=i.selection&&i.selection.map(e.slice(n));h&&o++;var p,l=new AB(c.invert(),a,h),u=r.length-1;(p=r.length&&r[u].merge(l))?r[u]=p:r.push(l)}}else i.map&&n--}),this.items.length,0),new TB(MB.from(r.reverse()),o)},TB.empty=new TB(MB.empty,0);var AB=function(t,e,n,r){this.map=t,this.step=e,this.selection=n,this.mirrorOffset=r};AB.prototype.merge=function(t){if(this.step&&t.step&&!t.selection){var e=t.step.merge(this.step);if(e)return new AB(e.getMap().invert(),e,this.selection)}};var DB=function(t,e,n,r){this.done=t,this.undone=e,this.prevRanges=n,this.prevTime=r},RB=20;function zB(t,e,n,r){var o,i=n.getMeta(JB);if(i)return i.historyState;n.getMeta(LB)&&(t=new DB(t.done,t.undone,null,0));var s=n.getMeta("appendedTransaction");if(0==n.steps.length)return t;if(s&&s.getMeta(JB))return s.getMeta(JB).redo?new DB(t.done.addTransform(n,null,r,jB(e)),t.undone,PB(n.mapping.maps[n.steps.length-1]),t.prevTime):new DB(t.done,t.undone.addTransform(n,null,r,jB(e)),null,t.prevTime);if(!1===n.getMeta("addToHistory")||s&&!1===s.getMeta("addToHistory"))return(o=n.getMeta("rebased"))?new DB(t.done.rebased(n,o),t.undone.rebased(n,o),FB(t.prevRanges,n.mapping),t.prevTime):new DB(t.done.addMaps(n.mapping.maps),t.undone.addMaps(n.mapping.maps),FB(t.prevRanges,n.mapping),t.prevTime);var a=0==t.prevTime||!s&&(t.prevTime<(n.time||0)-r.newGroupDelay||!IB(n,t.prevRanges)),c=s?FB(t.prevRanges,n.mapping):PB(n.mapping.maps[n.steps.length-1]);return new DB(t.done.addTransform(n,a?e.selection.getBookmark():null,r,jB(e)),TB.empty,c,n.time)}function IB(t,e){if(!e)return!1;if(!t.docChanged)return!0;var n=!1;return t.mapping.maps[0].forEach((function(t,r){for(var o=0;o<e.length;o+=2)t<=e[o+1]&&r>=e[o]&&(n=!0)})),n}function PB(t){var e=[];return t.forEach((function(t,n,r,o){return e.push(r,o)})),e}function FB(t,e){if(!t)return null;for(var n=[],r=0;r<t.length;r+=2){var o=e.map(t[r],1),i=e.map(t[r+1],-1);o<=i&&n.push(o,i)}return n}function BB(t,e,n,r){var o=jB(e),i=JB.get(e).spec.config,s=(r?t.undone:t.done).popEvent(e,o);if(s){var a=s.selection.resolve(s.transform.doc),c=(r?t.done:t.undone).addTransform(s.transform,e.selection.getBookmark(),i,o),h=new DB(r?c:s.remaining,r?s.remaining:c,null,0);n(s.transform.setSelection(a).setMeta(JB,{redo:r,historyState:h}).scrollIntoView())}}var $B=!1,_B=null;function jB(t){var e=t.plugins;if(_B!=e){$B=!1,_B=e;for(var n=0;n<e.length;n++)if(e[n].spec.historyPreserveItems){$B=!0;break}}return $B}var JB=new ll("history"),LB=new ll("closeHistory");function VB(t){return t={depth:t&&t.depth||100,newGroupDelay:t&&t.newGroupDelay||500},new cl({key:JB,state:{init:function(){return new DB(TB.empty,TB.empty,null,0)},apply:function(e,n,r){return zB(n,r,e,t)}},config:t})}function qB(t,e){var n=JB.getState(t);return!(!n||0==n.done.eventCount)&&(e&&BB(n,t,e,!1),!0)}function WB(t,e){var n=JB.getState(t);return!(!n||0==n.undone.eventCount)&&(e&&BB(n,t,e,!0),!0)}function HB(t){var e=JB.getState(t);return e?e.done.eventCount:0}function KB(t){var e=JB.getState(t);return e?e.undone.eventCount:0}
/*!
    * tiptap-extensions v1.35.1
    * (c) 2021 berdosis GbR (limited liability)
    * @license MIT
    */class UB extends Sk{get name(){return"blockquote"}get schema(){return{content:"block*",group:"block",defining:!0,draggable:!1,parseDOM:[{tag:"blockquote"}],toDOM:()=>["blockquote",0]}}commands({type:t}){return()=>fk(t)}keys({type:t}){return{"Ctrl->":fk(t)}}inputRules({type:t}){return[Kb(/^\s*>\s$/,t)]}}class GB extends Sk{get name(){return"bullet_list"}get schema(){return{content:"list_item+",group:"block",parseDOM:[{tag:"ul"}],toDOM:()=>["ul",0]}}commands({type:t,schema:e}){return()=>uk(t,e.nodes.list_item)}keys({type:t,schema:e}){return{"Shift-Ctrl-8":uk(t,e.nodes.list_item)}}inputRules({type:t}){return[Kb(/^\s*([-+*])\s$/,t)]}}class XB extends Sk{get name(){return"code_block"}get schema(){return{content:"text*",marks:"",group:"block",code:!0,defining:!0,draggable:!1,parseDOM:[{tag:"pre",preserveWhitespace:"full"}],toDOM:()=>["pre",["code",0]]}}commands({type:t,schema:e}){return()=>pk(t,e.nodes.paragraph)}keys({type:t}){return{"Shift-Ctrl-\\":Eb(t)}}inputRules({type:t}){return[Ub(/^```$/,t)]}}class YB extends Sk{get name(){return"hard_break"}get schema(){return{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM:()=>["br"]}}commands({type:t}){return()=>Rb(bb,(e,n)=>(n(e.tr.replaceSelectionWith(t.create()).scrollIntoView()),!0))}keys({type:t}){const e=Rb(bb,(e,n)=>(n(e.tr.replaceSelectionWith(t.create()).scrollIntoView()),!0));return{"Mod-Enter":e,"Shift-Enter":e}}}class ZB extends Sk{get name(){return"heading"}get defaultOptions(){return{levels:[1,2,3,4,5,6]}}get schema(){return{attrs:{level:{default:1}},content:"inline*",group:"block",defining:!0,draggable:!1,parseDOM:this.options.levels.map(t=>({tag:"h"+t,attrs:{level:t}})),toDOM:t=>["h"+t.attrs.level,0]}}commands({type:t,schema:e}){return n=>pk(t,e.nodes.paragraph,n)}keys({type:t}){return this.options.levels.reduce((e,n)=>({...e,["Shift-Ctrl-"+n]:Eb(t,{level:n})}),{})}inputRules({type:t}){return this.options.levels.map(e=>Ub(new RegExp(`^(#{1,${e}})\\s$`),t,()=>({level:e})))}}class QB extends Sk{get name(){return"horizontal_rule"}get schema(){return{group:"block",parseDOM:[{tag:"hr"}],toDOM:()=>["hr"]}}commands({type:t}){return()=>(e,n)=>n(e.tr.replaceSelectionWith(t.create()))}inputRules({type:t}){return[ok(/^(?:---|___\s|\*\*\*\s)$/,t)]}}const t$=/!\[(.+|:?)]\((\S+)(?:(?:\s+)["'](\S+)["'])?\)/;class e$ extends Sk{get name(){return"image"}get schema(){return{inline:!0,attrs:{src:{},alt:{default:null},title:{default:null}},group:"inline",draggable:!0,parseDOM:[{tag:"img[src]",getAttrs:t=>({src:t.getAttribute("src"),title:t.getAttribute("title"),alt:t.getAttribute("alt")})}],toDOM:t=>["img",t.attrs]}}commands({type:t}){return e=>(n,r)=>{const{selection:o}=n,i=o.$cursor?o.$cursor.pos:o.$to.pos,s=t.create(e),a=n.tr.insert(i,s);r(a)}}inputRules({type:t}){return[ok(t$,t,t=>{const[,e,n,r]=t;return{src:n,alt:e,title:r}})]}get plugins(){return[new wr({props:{handleDOMEvents:{drop(t,e){const n=e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files.length;if(!n)return;const r=Array.from(e.dataTransfer.files).filter(t=>/image/i.test(t.type));if(0===r.length)return;e.preventDefault();const{schema:o}=t.state,i=t.posAtCoords({left:e.clientX,top:e.clientY});r.forEach(e=>{const n=new FileReader;n.onload=e=>{const n=o.nodes.image.create({src:e.target.result}),r=t.state.tr.insert(i.pos,n);t.dispatch(r)},n.readAsDataURL(e)})}}}})]}}class n$ extends Sk{get name(){return"list_item"}get schema(){return{content:"paragraph block*",defining:!0,draggable:!1,parseDOM:[{tag:"li"}],toDOM:()=>["li",0]}}keys({type:t}){return{Enter:jb(t),Tab:qb(t),"Shift-Tab":Jb(t)}}}class r$ extends Sk{get name(){return"ordered_list"}get schema(){return{attrs:{order:{default:1}},content:"list_item+",group:"block",parseDOM:[{tag:"ol",getAttrs:t=>({order:t.hasAttribute("start")?+t.getAttribute("start"):1})}],toDOM:t=>1===t.attrs.order?["ol",0]:["ol",{start:t.attrs.order},0]}}commands({type:t,schema:e}){return()=>uk(t,e.nodes.list_item)}keys({type:t,schema:e}){return{"Shift-Ctrl-9":uk(t,e.nodes.list_item)}}inputRules({type:t}){return[Kb(/^(\d+)\.\s$/,t,t=>({order:+t[1]}),(t,e)=>e.childCount+e.attrs.order===+t[1])]}}var o$=Rz({tableGroup:"block",cellContent:"block+",cellAttributes:{background:{default:null,getFromDOM(t){return t.style.backgroundColor||null},setDOMAttr(t,e){if(t){const n={style:`${e.style||""}background-color: ${t};`};Object.assign(e,n)}}}}});class i$ extends Sk{get name(){return"table"}get defaultOptions(){return{resizable:!1}}get schema(){return o$.table}commands({schema:t}){return{createTable:({rowsCount:e,colsCount:n,withHeaderRow:r})=>(o,i)=>{const s=o.tr.selection.anchor+1,a=oy(t,e,n,r),c=o.tr.replaceSelectionWith(a).scrollIntoView(),h=c.doc.resolve(s);c.setSelection(UR.near(h)),i(c)},addColumnBefore:()=>CI,addColumnAfter:()=>MI,deleteColumn:()=>TI,addRowBefore:()=>DI,addRowAfter:()=>RI,deleteRow:()=>II,deleteTable:()=>GI,toggleCellMerge:()=>(t,e)=>{BI(t,e)||$I(t,e)},mergeCells:()=>BI,splitCell:()=>$I,toggleHeaderColumn:()=>WI,toggleHeaderRow:()=>qI,toggleHeaderCell:()=>HI,setCellAttr:({name:t,value:e})=>jI(t,e),fixTables:()=>bI}}keys(){return{Tab:UI(1),"Shift-Tab":UI(-1)}}get plugins(){return[...this.options.resizable?[QI()]:[],fP()]}}class s$ extends Sk{get name(){return"table_header"}get schema(){return o$.table_header}}class a$ extends Sk{get name(){return"table_cell"}get schema(){return o$.table_cell}}class c$ extends Sk{get name(){return"table_row"}get schema(){return o$.table_row}}class h$ extends Sk{get name(){return"todo_item"}get defaultOptions(){return{nested:!1}}get view(){return{props:["node","updateAttrs","view"],methods:{onChange(){this.updateAttrs({done:!this.node.attrs.done})}},template:'\n        <li :data-type="node.type.name" :data-done="node.attrs.done.toString()" data-drag-handle>\n          <span class="todo-checkbox" contenteditable="false" @click="onChange"></span>\n          <div class="todo-content" ref="content" :contenteditable="view.editable.toString()"></div>\n        </li>\n      '}}get schema(){return{attrs:{done:{default:!1}},draggable:!0,content:this.options.nested?"(paragraph|todo_list)+":"paragraph+",toDOM:t=>{const{done:e}=t.attrs;return["li",{"data-type":this.name,"data-done":e.toString()},["span",{class:"todo-checkbox",contenteditable:"false"}],["div",{class:"todo-content"},0]]},parseDOM:[{priority:51,tag:`[data-type="${this.name}"]`,getAttrs:t=>({done:"true"===t.getAttribute("data-done")})}]}}keys({type:t}){return{Enter:hk(t),Tab:this.options.nested?qb(t):()=>{},"Shift-Tab":Jb(t)}}}class p$ extends Sk{get name(){return"todo_list"}get schema(){return{group:"block",content:"todo_item+",toDOM:()=>["ul",{"data-type":this.name},0],parseDOM:[{priority:51,tag:`[data-type="${this.name}"]`}]}}commands({type:t,schema:e}){return()=>uk(t,e.nodes.todo_item)}inputRules({type:t}){return[Kb(/^\s*(\[ \])\s$/,t)]}}class l$ extends bk{get name(){return"bold"}get schema(){return{parseDOM:[{tag:"strong"},{tag:"b",getAttrs:t=>"normal"!==t.style.fontWeight&&null},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}],toDOM:()=>["strong",0]}}keys({type:t}){return{"Mod-b":Db(t)}}commands({type:t}){return()=>Db(t)}inputRules({type:t}){return[rk(/(?:\*\*|__)([^*_]+)(?:\*\*|__)$/,t)]}pasteRules({type:t}){return[sk(/(?:\*\*|__)([^*_]+)(?:\*\*|__)/g,t)]}}class u$ extends bk{get name(){return"code"}get schema(){return{excludes:"_",parseDOM:[{tag:"code"}],toDOM:()=>["code",0]}}keys({type:t}){return{"Mod-`":Db(t)}}commands({type:t}){return()=>Db(t)}inputRules({type:t}){return[rk(/(?:`)([^`]+)(?:`)$/,t)]}pasteRules({type:t}){return[sk(/(?:`)([^`]+)(?:`)/g,t)]}}class f$ extends bk{get name(){return"italic"}get schema(){return{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"}],toDOM:()=>["em",0]}}keys({type:t}){return{"Mod-i":Db(t)}}commands({type:t}){return()=>Db(t)}inputRules({type:t}){return[rk(/(?:^|[^_])(_([^_]+)_)$/,t),rk(/(?:^|[^*])(\*([^*]+)\*)$/,t)]}pasteRules({type:t}){return[sk(/_([^_]+)_/g,t),sk(/\*([^*]+)\*/g,t)]}}class d$ extends bk{get name(){return"link"}get defaultOptions(){return{openOnClick:!0,target:null}}get schema(){return{attrs:{href:{default:null},target:{default:null}},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs:t=>({href:t.getAttribute("href"),target:t.getAttribute("target")})}],toDOM:t=>["a",{...t.attrs,rel:"noopener noreferrer nofollow",target:t.attrs.target||this.options.target},0]}}commands({type:t}){return e=>e.href?dk(t,e):ak(t)}pasteRules({type:t}){return[ik(/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-zA-Z]{2,}\b([-a-zA-Z0-9@:%_+.~#?&//=,()!]*)/gi,t,t=>({href:t}))]}get plugins(){return this.options.openOnClick?[new wr({props:{handleClick:(t,e,n)=>{const{schema:r}=t.state,o=py(t.state,r.marks.link);o.href&&n.target instanceof HTMLAnchorElement&&(n.stopPropagation(),window.open(o.href,o.target))}}})]:[]}}class m$ extends bk{get name(){return"strike"}get schema(){return{parseDOM:[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",getAttrs:t=>"line-through"===t}],toDOM:()=>["s",0]}}keys({type:t}){return{"Mod-d":Db(t)}}commands({type:t}){return()=>Db(t)}inputRules({type:t}){return[rk(/~([^~]+)~$/,t)]}pasteRules({type:t}){return[sk(/~([^~]+)~/g,t)]}}class v$ extends bk{get name(){return"underline"}get schema(){return{parseDOM:[{tag:"u"},{style:"text-decoration",getAttrs:t=>"underline"===t}],toDOM:()=>["u",0]}}keys({type:t}){return{"Mod-u":Db(t)}}commands({type:t}){return()=>Db(t)}}class g$ extends yk{get name(){return"history"}get defaultOptions(){return{depth:"",newGroupDelay:""}}keys(){const t={"Mod-z":qB,"Mod-y":WB,"Shift-Mod-z":WB,"Mod-":qB,"Shift-Mod-":WB};return t}get plugins(){return[VB({depth:this.options.depth,newGroupDelay:this.options.newGroupDelay})]}commands(){return{undo:()=>qB,redo:()=>WB,undoDepth:()=>HB,redoDepth:()=>KB}}}n("d81d");function y$(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function w$(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function x$(t,e,n){return e&&w$(t.prototype,e),n&&w$(t,n),t}n("131a");function b$(t,e){return b$=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},b$(t,e)}function k$(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&b$(t,e)}n("4ae1"),n("3410");function S$(t){return S$=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},S$(t)}n("25f0");function O$(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function C$(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function M$(t,e){return!e||"object"!==Object(i["a"])(e)&&"function"!==typeof e?C$(t):e}function N$(t){var e=O$();return function(){var n,r=S$(t);if(e){var o=S$(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return M$(this,n)}}var T$=function(t){k$(n,t);var e=N$(n);function n(){return y$(this,n),e.apply(this,arguments)}return x$(n,[{key:"commands",value:function(t){var e=t.type;return function(t){return Db(e,t)}}},{key:"name",get:function(){return"alignment"}},{key:"defaultOptions",get:function(){return{textAlign:["left","center","right"]}}},{key:"schema",get:function(){return{attrs:{textAlign:{default:"left"}},content:"inline*",group:"block",defining:!0,draggable:!1,parseDOM:this.options.textAlign.map((function(t){return{tag:'div[style="text-align:'.concat(t,'"]'),attrs:{textAlign:t}}})),toDOM:function(t){return["div",{style:"text-align:".concat(t.attrs.textAlign)},0]}}}}]),n}(bk),E$=function(t){k$(n,t);var e=N$(n);function n(){return y$(this,n),e.apply(this,arguments)}return x$(n,[{key:"commands",value:function(t){var e=t.type;return function(t){return Db(e,t)}}},{key:"name",get:function(){return"textcolor"}},{key:"defaultOptions",get:function(){return{color:["red"]}}},{key:"schema",get:function(){return{attrs:{color:{default:"rgba(0,0,0,1)"}},parseDOM:this.options.color.map((function(t){return{tag:'span[style="color:'.concat(t,'"]'),attrs:{color:t}}})),toDOM:function(t){return["span",{style:"color:".concat(t.attrs.color)},0]}}}}]),n}(bk),A$=function(t){k$(n,t);var e=N$(n);function n(){return y$(this,n),e.apply(this,arguments)}return x$(n,[{key:"keys",value:function(t){var e=t.type;return{"Mod-b":Db(e)}}},{key:"commands",value:function(t){var e=t.type;return function(){return Db(e)}}},{key:"inputRules",value:function(t){var e=t.type;return[rk(/(?:\*\*|__)([^*_]+)(?:\*\*|__)$/,e)]}},{key:"pasteRules",value:function(t){var e=t.type;return[sk(/(?:\*\*|__)([^*_]+)(?:\*\*|__)/g,e)]}},{key:"name",get:function(){return"superscript"}},{key:"schema",get:function(){return{parseDOM:[{tag:"sup"}],toDOM:function(){return["sup",0]}}}}]),n}(bk),D$=n("e21f").default,R$={components:{EditorContent:Ek,EditorFloatingMenu:Jk,EditorMenuBar:Rk,EditorMenuBubble:$k,"color-picker":D$,BoldIcon:function(){return n.e("devise-icons").then(n.bind(null,"3048"))},ItalicIcon:function(){return n.e("devise-icons").then(n.bind(null,"766f"))},UnderlineIcon:function(){return n.e("devise-icons").then(n.bind(null,"4327"))},MinusIcon:function(){return n.e("devise-icons").then(n.bind(null,"f329"))},ImageIcon:function(){return n.e("devise-icons").then(n.bind(null,"fab7"))},CodeIcon:function(){return n.e("devise-icons").then(n.bind(null,"6c67"))},ListIcon:function(){return n.e("devise-icons").then(n.bind(null,"4d0e"))},MenuIcon:function(){return n.e("devise-icons").then(n.bind(null,"83e1"))},CornerUpLeftIcon:function(){return n.e("devise-icons").then(n.bind(null,"ecf7"))},CornerUpRightIcon:function(){return n.e("devise-icons").then(n.bind(null,"4a15"))},AlignLeftIcon:function(){return n.e("devise-icons").then(n.bind(null,"658f"))},AlignCenterIcon:function(){return n.e("devise-icons").then(n.bind(null,"4d22"))},AlignRightIcon:function(){return n.e("devise-icons").then(n.bind(null,"d08a"))},TypeIcon:function(){return n.e("devise-icons").then(n.bind(null,"a9a6"))},StrikeIcon:function(){return n.e("devise-icons").then(n.bind(null,"7be5"))},TableIcon:function(){return n.e("devise-icons").then(n.bind(null,"c98e"))},DeleteTableIcon:function(){return n.e("devise-icons").then(n.bind(null,"5983"))},AddColAfterIcon:function(){return n.e("devise-icons").then(n.bind(null,"0ee8"))},AddColBeforeIcon:function(){return n.e("devise-icons").then(n.bind(null,"dbeb"))},DeleteColIcon:function(){return n.e("devise-icons").then(n.bind(null,"fd2c"))},AddRowAfterIcon:function(){return n.e("devise-icons").then(n.bind(null,"2ee3"))},AddRowBeforeIcon:function(){return n.e("devise-icons").then(n.bind(null,"60f7"))},DeleteRowIcon:function(){return n.e("devise-icons").then(n.bind(null,"7ca6"))},CombineCellsIcon:function(){return n.e("devise-icons").then(n.bind(null,"c5f0"))},LinkIcon:function(){return n.e("devise-icons").then(n.bind(null,"ad75"))}},props:{value:{type:String,default:""}},data:function(){return{editor:new Tk({extensions:[new UB,new GB,new XB,new A$,new YB,new ZB({levels:[1,2,3]}),new QB,new n$,new r$,new h$,new p$,new d$,new l$,new u$,new e$,new f$,new m$,new v$,new g$,new i$({resizable:!0}),new s$,new a$,new c$,new T$,new E$],onUpdate:this.update,autoFocus:!1}),imageToManage:null,showSource:!1,currentCommand:null,showTextColorPicker:!1,textColor:"#000000",linkUrl:null,linkTarget:"_self",linkMenuIsActive:!1}},computed:{localValue:{get:function(){return this.value},set:function(t){this.$emit("input",t),this.$emit("change",t)}}},mounted:function(){var t=this;"undefined"!==typeof this.value?setTimeout((function(){t.editor.setContent(t.value)}),1e3):console.warn("Devise: The initial value for the WYSIWYG field was undefined. Consider wrapping it in a v-if until the model is resolved.")},beforeDestroy:function(){this.editor.destroy()},methods:{launchMediaManager:function(t){this.currentCommand=t,window.deviseSettings.$bus.$emit("devise-launch-media-manager",{callback:this.mediaSelected})},mediaSelected:function(t){"object"===Object(i["a"])(t)?this.currentCommand({src:t.images.media.custom}):this.currentCommand({src:t})},update:function(t){this.localValue=t.getHTML()},updateSource:function(t){this.updateContent(t.target.value)},updateContent:function(t){this.editor.setContent(t)},applyTextColor:function(t){var e=this.textColor.rgba,n=e.r,r=e.g,o=e.b,i=e.a;t.textcolor({color:"rgba(".concat(n,",").concat(r,",").concat(o,",").concat(i,")")}),this.showTextColorPicker=!1},showLinkMenu:function(t){var e=this;this.linkUrl=t.href,this.linkMenuIsActive=!0,this.$nextTick((function(){e.$refs.linkInput.focus()}))},hideLinkMenu:function(){this.linkUrl=null,this.linkMenuIsActive=!1},setLinkUrl:function(t,e,n){t({href:e,target:n}),this.hideLinkMenu()}}},z$=R$,I$=n("2877"),P$=Object(I$["a"])(z$,r,o,!1,null,null,null);e["default"]=P$.exports},3410:function(t,e,n){var r=n("23e7"),o=n("d039"),i=n("7b0b"),s=n("e163"),a=n("e177"),c=o((function(){s(1)}));r({target:"Object",stat:!0,forced:c,sham:!a},{getPrototypeOf:function(t){return s(i(t))}})},"3ce4":function(t,e,n){"use strict";var r=n("e2be"),o=n("073e");e.highlight=s,e.highlightAuto=a,e.registerLanguage=c,e.listLanguages=h,e.registerAlias=p,l.prototype.addText=d,l.prototype.addKeyword=u,l.prototype.addSublanguage=f,l.prototype.openNode=m,l.prototype.closeNode=v,l.prototype.closeAllNodes=y,l.prototype.finalize=y,l.prototype.toHTML=g;var i="hljs-";function s(t,e,n){var s,a=r.configure({}),c=n||{},h=c.prefix;if("string"!==typeof t)throw o("Expected `string` for name, got `%s`",t);if(!r.getLanguage(t))throw o("Unknown language: `%s` is not registered",t);if("string"!==typeof e)throw o("Expected `string` for value, got `%s`",e);if(null!==h&&void 0!==h||(h=i),r.configure({__emitter:l,classPrefix:h}),s=r.highlight(e,{language:t,ignoreIllegals:!0}),r.configure(a||{}),s.errorRaised)throw s.errorRaised;return{relevance:s.relevance,language:s.language,value:s.emitter.rootNode.children}}function a(t,e){var n,a,c,h,p=e||{},l=p.subset||r.listLanguages(),u=p.prefix,f=l.length,d=-1;if(null!==u&&void 0!==u||(u=i),"string"!==typeof t)throw o("Expected `string` for value, got `%s`",t);a={relevance:0,language:null,value:[]},n={relevance:0,language:null,value:[]};while(++d<f)h=l[d],r.getLanguage(h)&&(c=s(h,t,e),c.language=h,c.relevance>a.relevance&&(a=c),c.relevance>n.relevance&&(a=n,n=c));return a.language&&(n.secondBest=a),n}function c(t,e){r.registerLanguage(t,e)}function h(){return r.listLanguages()}function p(t,e){var n,o=t;for(n in e&&(o={},o[t]=e),o)r.registerAliases(o[n],{languageName:n})}function l(t){this.options=t,this.rootNode={children:[]},this.stack=[this.rootNode]}function u(t,e){this.openNode(e),this.addText(t),this.closeNode()}function f(t,e){var n=this.stack,r=n[n.length-1],o=t.rootNode.children,i=e?{type:"element",tagName:"span",properties:{className:[e]},children:o}:o;r.children=r.children.concat(i)}function d(t){var e,n,r=this.stack;""!==t&&(e=r[r.length-1],n=e.children[e.children.length-1],n&&"text"===n.type?n.value+=t:e.children.push({type:"text",value:t}))}function m(t){var e=this.stack,n=this.options.classPrefix+t,r=e[e.length-1],o={type:"element",tagName:"span",properties:{className:[n]},children:[]};r.children.push(o),e.push(o)}function v(){this.stack.pop()}function g(){return""}function y(){}},"4ae1":function(t,e,n){var r=n("23e7"),o=n("d066"),i=n("1c0b"),s=n("825a"),a=n("861d"),c=n("7c73"),h=n("0538"),p=n("d039"),l=o("Reflect","construct"),u=p((function(){function t(){}return!(l((function(){}),[],t)instanceof t)})),f=!p((function(){l((function(){}))})),d=u||f;r({target:"Reflect",stat:!0,forced:d,sham:d},{construct:function(t,e){i(t),s(e);var n=arguments.length<3?t:i(arguments[2]);if(f&&!u)return l(t,e,n);if(t==n){switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3])}var r=[null];return r.push.apply(r,e),new(h.apply(t,r))}var o=n.prototype,p=c(a(o)?o:Object.prototype),d=Function.apply.call(t,p,e);return a(d)?d:p}})},"5dbe":function(t,e,n){(function(){var e;function n(){console.log(o.apply(null,arguments))}function r(t,e){return o.apply(null,[t].concat(e))}function o(t){for(var e,n,r,o,i=1,s=[].slice.call(arguments),a=0,c=t.length,h="",p=!1,l=!1,u=function(){return s[i++]},f=function(){var n="";while(/\d/.test(t[a]))n+=t[a++],e=t[a];return n.length>0?parseInt(n):null};a<c;++a)if(e=t[a],p)switch(p=!1,"."==e?(l=!1,e=t[++a]):"0"==e&&"."==t[a+1]?(l=!0,a+=2,e=t[a]):l=!0,o=f(),e){case"b":h+=parseInt(u(),10).toString(2);break;case"c":n=u(),h+="string"===typeof n||n instanceof String?n:String.fromCharCode(parseInt(n,10));break;case"d":h+=parseInt(u(),10);break;case"f":r=String(parseFloat(u()).toFixed(o||6)),h+=l?r:r.replace(/^0/,"");break;case"j":h+=JSON.stringify(u());break;case"o":h+="0"+parseInt(u(),10).toString(8);break;case"s":h+=u();break;case"x":h+="0x"+parseInt(u(),10).toString(16);break;case"X":h+="0x"+parseInt(u(),10).toString(16).toUpperCase();break;default:h+=e;break}else"%"===e?p=!0:h+=e;return h}e=t.exports=o,e.format=o,e.vsprintf=r,"undefined"!==typeof console&&"function"===typeof console.log&&(e.printf=n)})()},bc75:function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("field-editor",{attrs:{options:t.options,"show-editor":t.showEditor},on:{toggleShowEditor:t.toggleEditor,cancel:t.cancel,resetvalue:t.resetValue,change:t.update},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}},[n("template",{slot:"preview"},[null===t.value.text||""===t.value.text?n("span",{staticClass:"dvs-italic"},[t._v("Currently No Value")]):t._e(),n("div",{domProps:{innerHTML:t._s(t.clipString(t.value.text,200,!1))}})]),n("template",{slot:"editor"},[n("wysiwyg",{ref:"editor",staticStyle:{"min-height":"300px"},model:{value:t.text,callback:function(e){t.text=e},expression:"text"}})],1)],2)],1)},o=[],i=(n("d3b7"),n("29ec")),s=n("a7b1"),a={name:"WysiwygEditor",components:{FieldEditor:function(){return Promise.all([n.e("devise-editors~devise-media~devise-slices"),n.e("devise-editors")]).then(n.bind(null,"41b8"))},Wysiwyg:function(){return Promise.resolve().then(n.bind(null,"2969"))}},mixins:[i["a"],s["a"]],props:{value:{type:Object,required:!0},options:{type:Object,required:!0},namekey:{type:String,required:!0}},data:function(){return{localValue:{},originalValue:null,showEditor:!1}},computed:{text:{get:function(){return this.value.text},set:function(t){var e=Object.assign(this.value,{text:t});this.$emit("input",e),this.$emit("change",e)}}},mounted:function(){this.originalValue=Object.assign({},this.value),this.localValue=this.value},methods:{toggleEditor:function(){this.showEditor=!this.showEditor},cancel:function(){this.text=this.originalValue.text,this.enabled=this.originalValue.enabled},resetValue:function(){this.enabled=!1,this.$refs.editor.empty()}}},c=a,h=n("2877"),p=Object(h["a"])(c,r,o,!1,null,null,null);e["default"]=p.exports},e2be:function(t,e){function n(t){return t instanceof Map?t.clear=t.delete=t.set=function(){throw new Error("map is read-only")}:t instanceof Set&&(t.add=t.clear=t.delete=function(){throw new Error("set is read-only")}),Object.freeze(t),Object.getOwnPropertyNames(t).forEach((function(e){var r=t[e];"object"!=typeof r||Object.isFrozen(r)||n(r)})),t}var r=n,o=n;r.default=o;class i{constructor(t){void 0===t.data&&(t.data={}),this.data=t.data,this.isMatchIgnored=!1}ignoreMatch(){this.isMatchIgnored=!0}}function s(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")}function a(t,...e){const n=Object.create(null);for(const r in t)n[r]=t[r];return e.forEach((function(t){for(const e in t)n[e]=t[e]})),n}const c="</span>",h=t=>!!t.kind;class p{constructor(t,e){this.buffer="",this.classPrefix=e.classPrefix,t.walk(this)}addText(t){this.buffer+=s(t)}openNode(t){if(!h(t))return;let e=t.kind;t.sublanguage||(e=`${this.classPrefix}${e}`),this.span(e)}closeNode(t){h(t)&&(this.buffer+=c)}value(){return this.buffer}span(t){this.buffer+=`<span class="${t}">`}}class l{constructor(){this.rootNode={children:[]},this.stack=[this.rootNode]}get top(){return this.stack[this.stack.length-1]}get root(){return this.rootNode}add(t){this.top.children.push(t)}openNode(t){const e={kind:t,children:[]};this.add(e),this.stack.push(e)}closeNode(){if(this.stack.length>1)return this.stack.pop()}closeAllNodes(){while(this.closeNode());}toJSON(){return JSON.stringify(this.rootNode,null,4)}walk(t){return this.constructor._walk(t,this.rootNode)}static _walk(t,e){return"string"===typeof e?t.addText(e):e.children&&(t.openNode(e),e.children.forEach(e=>this._walk(t,e)),t.closeNode(e)),t}static _collapse(t){"string"!==typeof t&&t.children&&(t.children.every(t=>"string"===typeof t)?t.children=[t.children.join("")]:t.children.forEach(t=>{l._collapse(t)}))}}class u extends l{constructor(t){super(),this.options=t}addKeyword(t,e){""!==t&&(this.openNode(e),this.addText(t),this.closeNode())}addText(t){""!==t&&this.add(t)}addSublanguage(t,e){const n=t.root;n.kind=e,n.sublanguage=!0,this.add(n)}toHTML(){const t=new p(this,this.options);return t.value()}finalize(){return!0}}function f(t){return new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"m")}function d(t){return t?"string"===typeof t?t:t.source:null}function m(...t){const e=t.map(t=>d(t)).join("");return e}function v(...t){const e="("+t.map(t=>d(t)).join("|")+")";return e}function g(t){return new RegExp(t.toString()+"|").exec("").length-1}function y(t,e){const n=t&&t.exec(e);return n&&0===n.index}const w=/\[(?:[^\\\]]|\\.)*\]|\(\??|\\([1-9][0-9]*)|\\./;function x(t,e="|"){let n=0;return t.map(t=>{n+=1;const e=n;let r=d(t),o="";while(r.length>0){const t=w.exec(r);if(!t){o+=r;break}o+=r.substring(0,t.index),r=r.substring(t.index+t[0].length),"\\"===t[0][0]&&t[1]?o+="\\"+String(Number(t[1])+e):(o+=t[0],"("===t[0]&&n++)}return o}).map(t=>`(${t})`).join(e)}const b=/\b\B/,k="[a-zA-Z]\\w*",S="[a-zA-Z_]\\w*",O="\\b\\d+(\\.\\d+)?",C="(-?)(\\b0[xX][a-fA-F0-9]+|(\\b\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)",M="\\b(0b[01]+)",N="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|-|-=|/=|/|:|;|<<|<<=|<=|<|===|==|=|>>>=|>>=|>=|>>>|>>|>|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~",T=(t={})=>{const e=/^#![ ]*\//;return t.binary&&(t.begin=m(e,/.*\b/,t.binary,/\b.*/)),a({className:"meta",begin:e,end:/$/,relevance:0,"on:begin":(t,e)=>{0!==t.index&&e.ignoreMatch()}},t)},E={begin:"\\\\[\\s\\S]",relevance:0},A={className:"string",begin:"'",end:"'",illegal:"\\n",contains:[E]},D={className:"string",begin:'"',end:'"',illegal:"\\n",contains:[E]},R={begin:/\b(a|an|the|are|I'm|isn't|don't|doesn't|won't|but|just|should|pretty|simply|enough|gonna|going|wtf|so|such|will|you|your|they|like|more)\b/},z=function(t,e,n={}){const r=a({className:"comment",begin:t,end:e,contains:[]},n);return r.contains.push(R),r.contains.push({className:"doctag",begin:"(?:TODO|FIXME|NOTE|BUG|OPTIMIZE|HACK|XXX):",relevance:0}),r},I=z("//","$"),P=z("/\\*","\\*/"),F=z("#","$"),B={className:"number",begin:O,relevance:0},$={className:"number",begin:C,relevance:0},_={className:"number",begin:M,relevance:0},j={className:"number",begin:O+"(%|em|ex|ch|rem|vw|vh|vmin|vmax|cm|mm|in|pt|pc|px|deg|grad|rad|turn|s|ms|Hz|kHz|dpi|dpcm|dppx)?",relevance:0},J={begin:/(?=\/[^/\n]*\/)/,contains:[{className:"regexp",begin:/\//,end:/\/[gimuy]*/,illegal:/\n/,contains:[E,{begin:/\[/,end:/\]/,relevance:0,contains:[E]}]}]},L={className:"title",begin:k,relevance:0},V={className:"title",begin:S,relevance:0},q={begin:"\\.\\s*"+S,relevance:0},W=function(t){return Object.assign(t,{"on:begin":(t,e)=>{e.data._beginMatch=t[1]},"on:end":(t,e)=>{e.data._beginMatch!==t[1]&&e.ignoreMatch()}})};var H=Object.freeze({__proto__:null,MATCH_NOTHING_RE:b,IDENT_RE:k,UNDERSCORE_IDENT_RE:S,NUMBER_RE:O,C_NUMBER_RE:C,BINARY_NUMBER_RE:M,RE_STARTERS_RE:N,SHEBANG:T,BACKSLASH_ESCAPE:E,APOS_STRING_MODE:A,QUOTE_STRING_MODE:D,PHRASAL_WORDS_MODE:R,COMMENT:z,C_LINE_COMMENT_MODE:I,C_BLOCK_COMMENT_MODE:P,HASH_COMMENT_MODE:F,NUMBER_MODE:B,C_NUMBER_MODE:$,BINARY_NUMBER_MODE:_,CSS_NUMBER_MODE:j,REGEXP_MODE:J,TITLE_MODE:L,UNDERSCORE_TITLE_MODE:V,METHOD_GUARD:q,END_SAME_AS_BEGIN:W});function K(t,e){const n=t.input[t.index-1];"."===n&&e.ignoreMatch()}function U(t,e){e&&t.beginKeywords&&(t.begin="\\b("+t.beginKeywords.split(" ").join("|")+")(?!\\.)(?=\\b|\\s)",t.__beforeBegin=K,t.keywords=t.keywords||t.beginKeywords,delete t.beginKeywords,void 0===t.relevance&&(t.relevance=0))}function G(t,e){Array.isArray(t.illegal)&&(t.illegal=v(...t.illegal))}function X(t,e){if(t.match){if(t.begin||t.end)throw new Error("begin & end are not supported with match");t.begin=t.match,delete t.match}}function Y(t,e){void 0===t.relevance&&(t.relevance=1)}const Z=["of","and","for","in","not","or","if","then","parent","list","value"],Q="keyword";function tt(t,e,n=Q){const r={};return"string"===typeof t?o(n,t.split(" ")):Array.isArray(t)?o(n,t):Object.keys(t).forEach((function(n){Object.assign(r,tt(t[n],e,n))})),r;function o(t,n){e&&(n=n.map(t=>t.toLowerCase())),n.forEach((function(e){const n=e.split("|");r[n[0]]=[t,et(n[0],n[1])]}))}}function et(t,e){return e?Number(e):nt(t)?0:1}function nt(t){return Z.includes(t.toLowerCase())}function rt(t,{plugins:e}){function n(e,n){return new RegExp(d(e),"m"+(t.case_insensitive?"i":"")+(n?"g":""))}class r{constructor(){this.matchIndexes={},this.regexes=[],this.matchAt=1,this.position=0}addRule(t,e){e.position=this.position++,this.matchIndexes[this.matchAt]=e,this.regexes.push([e,t]),this.matchAt+=g(t)+1}compile(){0===this.regexes.length&&(this.exec=()=>null);const t=this.regexes.map(t=>t[1]);this.matcherRe=n(x(t),!0),this.lastIndex=0}exec(t){this.matcherRe.lastIndex=this.lastIndex;const e=this.matcherRe.exec(t);if(!e)return null;const n=e.findIndex((t,e)=>e>0&&void 0!==t),r=this.matchIndexes[n];return e.splice(0,n),Object.assign(e,r)}}class o{constructor(){this.rules=[],this.multiRegexes=[],this.count=0,this.lastIndex=0,this.regexIndex=0}getMatcher(t){if(this.multiRegexes[t])return this.multiRegexes[t];const e=new r;return this.rules.slice(t).forEach(([t,n])=>e.addRule(t,n)),e.compile(),this.multiRegexes[t]=e,e}resumingScanAtSamePosition(){return 0!==this.regexIndex}considerAll(){this.regexIndex=0}addRule(t,e){this.rules.push([t,e]),"begin"===e.type&&this.count++}exec(t){const e=this.getMatcher(this.regexIndex);e.lastIndex=this.lastIndex;let n=e.exec(t);if(this.resumingScanAtSamePosition())if(n&&n.index===this.lastIndex);else{const e=this.getMatcher(0);e.lastIndex=this.lastIndex+1,n=e.exec(t)}return n&&(this.regexIndex+=n.position+1,this.regexIndex===this.count&&this.considerAll()),n}}function i(t){const e=new o;return t.contains.forEach(t=>e.addRule(t.begin,{rule:t,type:"begin"})),t.terminatorEnd&&e.addRule(t.terminatorEnd,{type:"end"}),t.illegal&&e.addRule(t.illegal,{type:"illegal"}),e}function s(e,r){const o=e;if(e.isCompiled)return o;[X].forEach(t=>t(e,r)),t.compilerExtensions.forEach(t=>t(e,r)),e.__beforeBegin=null,[U,G,Y].forEach(t=>t(e,r)),e.isCompiled=!0;let a=null;if("object"===typeof e.keywords&&(a=e.keywords.$pattern,delete e.keywords.$pattern),e.keywords&&(e.keywords=tt(e.keywords,t.case_insensitive)),e.lexemes&&a)throw new Error("ERR: Prefer `keywords.$pattern` to `mode.lexemes`, BOTH are not allowed. (see mode reference) ");return a=a||e.lexemes||/\w+/,o.keywordPatternRe=n(a,!0),r&&(e.begin||(e.begin=/\B|\b/),o.beginRe=n(e.begin),e.endSameAsBegin&&(e.end=e.begin),e.end||e.endsWithParent||(e.end=/\B|\b/),e.end&&(o.endRe=n(e.end)),o.terminatorEnd=d(e.end)||"",e.endsWithParent&&r.terminatorEnd&&(o.terminatorEnd+=(e.end?"|":"")+r.terminatorEnd)),e.illegal&&(o.illegalRe=n(e.illegal)),e.contains||(e.contains=[]),e.contains=[].concat(...e.contains.map((function(t){return it("self"===t?e:t)}))),e.contains.forEach((function(t){s(t,o)})),e.starts&&s(e.starts,r),o.matcher=i(o),o}if(t.compilerExtensions||(t.compilerExtensions=[]),t.contains&&t.contains.includes("self"))throw new Error("ERR: contains `self` is not supported at the top-level of a language.  See documentation.");return t.classNameAliases=a(t.classNameAliases||{}),s(t)}function ot(t){return!!t&&(t.endsWithParent||ot(t.starts))}function it(t){return t.variants&&!t.cachedVariants&&(t.cachedVariants=t.variants.map((function(e){return a(t,{variants:null},e)}))),t.cachedVariants?t.cachedVariants:ot(t)?a(t,{starts:t.starts?a(t.starts):null}):Object.isFrozen(t)?a(t):t}var st="10.7.2";function at(t){return Boolean(t||""===t)}function ct(t){const e={props:["language","code","autodetect"],data:function(){return{detectedLanguage:"",unknownLanguage:!1}},computed:{className(){return this.unknownLanguage?"":"hljs "+this.detectedLanguage},highlighted(){if(!this.autoDetect&&!t.getLanguage(this.language))return console.warn(`The language "${this.language}" you specified could not be found.`),this.unknownLanguage=!0,s(this.code);let e={};return this.autoDetect?(e=t.highlightAuto(this.code),this.detectedLanguage=e.language):(e=t.highlight(this.language,this.code,this.ignoreIllegals),this.detectedLanguage=this.language),e.value},autoDetect(){return!this.language||at(this.autodetect)},ignoreIllegals(){return!0}},render(t){return t("pre",{},[t("code",{class:this.className,domProps:{innerHTML:this.highlighted}})])}},n={install(t){t.component("highlightjs",e)}};return{Component:e,VuePlugin:n}}const ht={"after:highlightElement":({el:t,result:e,text:n})=>{const r=lt(t);if(!r.length)return;const o=document.createElement("div");o.innerHTML=e.value,e.value=ut(r,lt(o),n)}};function pt(t){return t.nodeName.toLowerCase()}function lt(t){const e=[];return function t(n,r){for(let o=n.firstChild;o;o=o.nextSibling)3===o.nodeType?r+=o.nodeValue.length:1===o.nodeType&&(e.push({event:"start",offset:r,node:o}),r=t(o,r),pt(o).match(/br|hr|img|input/)||e.push({event:"stop",offset:r,node:o}));return r}(t,0),e}function ut(t,e,n){let r=0,o="";const i=[];function a(){return t.length&&e.length?t[0].offset!==e[0].offset?t[0].offset<e[0].offset?t:e:"start"===e[0].event?t:e:t.length?t:e}function c(t){function e(t){return" "+t.nodeName+'="'+s(t.value)+'"'}o+="<"+pt(t)+[].map.call(t.attributes,e).join("")+">"}function h(t){o+="</"+pt(t)+">"}function p(t){("start"===t.event?c:h)(t.node)}while(t.length||e.length){let e=a();if(o+=s(n.substring(r,e[0].offset)),r=e[0].offset,e===t){i.reverse().forEach(h);do{p(e.splice(0,1)[0]),e=a()}while(e===t&&e.length&&e[0].offset===r);i.reverse().forEach(c)}else"start"===e[0].event?i.push(e[0].node):i.pop(),p(e.splice(0,1)[0])}return o+s(n.substr(r))}const ft={},dt=t=>{console.error(t)},mt=(t,...e)=>{console.log("WARN: "+t,...e)},vt=(t,e)=>{ft[`${t}/${e}`]||(console.log(`Deprecated as of ${t}. ${e}`),ft[`${t}/${e}`]=!0)},gt=s,yt=a,wt=Symbol("nomatch"),xt=function(t){const e=Object.create(null),n=Object.create(null),o=[];let s=!0;const a=/(^(<[^>]+>|\t|)+|\n)/gm,c="Could not find the language '{}', did you forget to load/include a language module?",h={disableAutodetect:!0,name:"Plain text",contains:[]};let p={noHighlightRe:/^(no-?highlight)$/i,languageDetectRe:/\blang(?:uage)?-([\w-]+)\b/i,classPrefix:"hljs-",tabReplace:null,useBR:!1,languages:null,__emitter:u};function l(t){return p.noHighlightRe.test(t)}function d(t){let e=t.className+" ";e+=t.parentNode?t.parentNode.className:"";const n=p.languageDetectRe.exec(e);if(n){const e=F(n[1]);return e||(mt(c.replace("{}",n[1])),mt("Falling back to no-highlight mode for this block.",t)),e?n[1]:"no-highlight"}return e.split(/\s+/).find(t=>l(t)||F(t))}function m(t,e,n,r){let o="",i="";"object"===typeof e?(o=t,n=e.ignoreIllegals,i=e.language,r=void 0):(vt("10.7.0","highlight(lang, code, ...args) has been deprecated."),vt("10.7.0","Please use highlight(code, options) instead.\nhttps://github.com/highlightjs/highlight.js/issues/2277"),i=t,o=e);const s={code:o,language:i};J("before:highlight",s);const a=s.result?s.result:v(s.language,s.code,n,r);return a.code=s.code,J("after:highlight",a),a}function v(t,n,r,a){function h(t,e){const n=M.case_insensitive?e[0].toLowerCase():e[0];return Object.prototype.hasOwnProperty.call(t.keywords,n)&&t.keywords[n]}function l(){if(!E.keywords)return void D.addText(R);let t=0;E.keywordPatternRe.lastIndex=0;let e=E.keywordPatternRe.exec(R),n="";while(e){n+=R.substring(t,e.index);const r=h(E,e);if(r){const[t,o]=r;if(D.addText(n),n="",z+=o,t.startsWith("_"))n+=e[0];else{const n=M.classNameAliases[t]||t;D.addKeyword(e[0],n)}}else n+=e[0];t=E.keywordPatternRe.lastIndex,e=E.keywordPatternRe.exec(R)}n+=R.substr(t),D.addText(n)}function u(){if(""===R)return;let t=null;if("string"===typeof E.subLanguage){if(!e[E.subLanguage])return void D.addText(R);t=v(E.subLanguage,R,!0,A[E.subLanguage]),A[E.subLanguage]=t.top}else t=w(R,E.subLanguage.length?E.subLanguage:null);E.relevance>0&&(z+=t.relevance),D.addSublanguage(t.emitter,t.language)}function d(){null!=E.subLanguage?u():l(),R=""}function m(t){return t.className&&D.openNode(M.classNameAliases[t.className]||t.className),E=Object.create(t,{parent:{value:E}}),E}function g(t,e,n){let r=y(t.endRe,n);if(r){if(t["on:end"]){const n=new i(t);t["on:end"](e,n),n.isMatchIgnored&&(r=!1)}if(r){while(t.endsParent&&t.parent)t=t.parent;return t}}if(t.endsWithParent)return g(t.parent,e,n)}function x(t){return 0===E.matcher.regexIndex?(R+=t[0],1):(B=!0,0)}function b(t){const e=t[0],n=t.rule,r=new i(n),o=[n.__beforeBegin,n["on:begin"]];for(const i of o)if(i&&(i(t,r),r.isMatchIgnored))return x(e);return n&&n.endSameAsBegin&&(n.endRe=f(e)),n.skip?R+=e:(n.excludeBegin&&(R+=e),d(),n.returnBegin||n.excludeBegin||(R=e)),m(n),n.returnBegin?0:e.length}function k(t){const e=t[0],r=n.substr(t.index),o=g(E,t,r);if(!o)return wt;const i=E;i.skip?R+=e:(i.returnEnd||i.excludeEnd||(R+=e),d(),i.excludeEnd&&(R=e));do{E.className&&D.closeNode(),E.skip||E.subLanguage||(z+=E.relevance),E=E.parent}while(E!==o.parent);return o.starts&&(o.endSameAsBegin&&(o.starts.endRe=o.endRe),m(o.starts)),i.returnEnd?0:e.length}function S(){const t=[];for(let e=E;e!==M;e=e.parent)e.className&&t.unshift(e.className);t.forEach(t=>D.openNode(t))}let O={};function C(e,o){const i=o&&o[0];if(R+=e,null==i)return d(),0;if("begin"===O.type&&"end"===o.type&&O.index===o.index&&""===i){if(R+=n.slice(o.index,o.index+1),!s){const e=new Error("0 width match regex");throw e.languageName=t,e.badRule=O.rule,e}return 1}if(O=o,"begin"===o.type)return b(o);if("illegal"===o.type&&!r){const t=new Error('Illegal lexeme "'+i+'" for mode "'+(E.className||"<unnamed>")+'"');throw t.mode=E,t}if("end"===o.type){const t=k(o);if(t!==wt)return t}if("illegal"===o.type&&""===i)return 1;if(P>1e5&&P>3*o.index){const t=new Error("potential infinite loop, way more iterations than matches");throw t}return R+=i,i.length}const M=F(t);if(!M)throw dt(c.replace("{}",t)),new Error('Unknown language: "'+t+'"');const N=rt(M,{plugins:o});let T="",E=a||N;const A={},D=new p.__emitter(p);S();let R="",z=0,I=0,P=0,B=!1;try{for(E.matcher.considerAll();;){P++,B?B=!1:E.matcher.considerAll(),E.matcher.lastIndex=I;const t=E.matcher.exec(n);if(!t)break;const e=n.substring(I,t.index),r=C(e,t);I=t.index+r}return C(n.substr(I)),D.closeAllNodes(),D.finalize(),T=D.toHTML(),{relevance:Math.floor(z),value:T,language:t,illegal:!1,emitter:D,top:E}}catch($){if($.message&&$.message.includes("Illegal"))return{illegal:!0,illegalBy:{msg:$.message,context:n.slice(I-100,I+100),mode:$.mode},sofar:T,relevance:0,value:gt(n),emitter:D};if(s)return{illegal:!1,relevance:0,value:gt(n),emitter:D,language:t,top:E,errorRaised:$};throw $}}function g(t){const e={relevance:0,emitter:new p.__emitter(p),value:gt(t),illegal:!1,top:h};return e.emitter.addText(t),e}function w(t,n){n=n||p.languages||Object.keys(e);const r=g(t),o=n.filter(F).filter($).map(e=>v(e,t,!1));o.unshift(r);const i=o.sort((t,e)=>{if(t.relevance!==e.relevance)return e.relevance-t.relevance;if(t.language&&e.language){if(F(t.language).supersetOf===e.language)return 1;if(F(e.language).supersetOf===t.language)return-1}return 0}),[s,a]=i,c=s;return c.second_best=a,c}function x(t){return p.tabReplace||p.useBR?t.replace(a,t=>"\n"===t?p.useBR?"<br>":t:p.tabReplace?t.replace(/\t/g,p.tabReplace):t):t}function b(t,e,r){const o=e?n[e]:r;t.classList.add("hljs"),o&&t.classList.add(o)}const k={"before:highlightElement":({el:t})=>{p.useBR&&(t.innerHTML=t.innerHTML.replace(/\n/g,"").replace(/<br[ /]*>/g,"\n"))},"after:highlightElement":({result:t})=>{p.useBR&&(t.value=t.value.replace(/\n/g,"<br>"))}},S=/^(<[^>]+>|\t)+/gm,O={"after:highlightElement":({result:t})=>{p.tabReplace&&(t.value=t.value.replace(S,t=>t.replace(/\t/g,p.tabReplace)))}};function C(t){let e=null;const n=d(t);if(l(n))return;J("before:highlightElement",{el:t,language:n}),e=t;const r=e.textContent,o=n?m(r,{language:n,ignoreIllegals:!0}):w(r);J("after:highlightElement",{el:t,result:o,text:r}),t.innerHTML=o.value,b(t,n,o.language),t.result={language:o.language,re:o.relevance,relavance:o.relevance},o.second_best&&(t.second_best={language:o.second_best.language,re:o.second_best.relevance,relavance:o.second_best.relevance})}function M(t){t.useBR&&(vt("10.3.0","'useBR' will be removed entirely in v11.0"),vt("10.3.0","Please see https://github.com/highlightjs/highlight.js/issues/2559")),p=yt(p,t)}const N=()=>{if(N.called)return;N.called=!0,vt("10.6.0","initHighlighting() is deprecated.  Use highlightAll() instead.");const t=document.querySelectorAll("pre code");t.forEach(C)};function T(){vt("10.6.0","initHighlightingOnLoad() is deprecated.  Use highlightAll() instead."),E=!0}let E=!1;function A(){if("loading"===document.readyState)return void(E=!0);const t=document.querySelectorAll("pre code");t.forEach(C)}function D(){E&&A()}function R(n,r){let o=null;try{o=r(t)}catch(i){if(dt("Language definition for '{}' could not be registered.".replace("{}",n)),!s)throw i;dt(i),o=h}o.name||(o.name=n),e[n]=o,o.rawDefinition=r.bind(null,t),o.aliases&&B(o.aliases,{languageName:n})}function z(t){delete e[t];for(const e of Object.keys(n))n[e]===t&&delete n[e]}function I(){return Object.keys(e)}function P(t){vt("10.4.0","requireLanguage will be removed entirely in v11."),vt("10.4.0","Please see https://github.com/highlightjs/highlight.js/pull/2844");const e=F(t);if(e)return e;const n=new Error("The '{}' language is required, but not loaded.".replace("{}",t));throw n}function F(t){return t=(t||"").toLowerCase(),e[t]||e[n[t]]}function B(t,{languageName:e}){"string"===typeof t&&(t=[t]),t.forEach(t=>{n[t.toLowerCase()]=e})}function $(t){const e=F(t);return e&&!e.disableAutodetect}function _(t){t["before:highlightBlock"]&&!t["before:highlightElement"]&&(t["before:highlightElement"]=e=>{t["before:highlightBlock"](Object.assign({block:e.el},e))}),t["after:highlightBlock"]&&!t["after:highlightElement"]&&(t["after:highlightElement"]=e=>{t["after:highlightBlock"](Object.assign({block:e.el},e))})}function j(t){_(t),o.push(t)}function J(t,e){const n=t;o.forEach((function(t){t[n]&&t[n](e)}))}function L(t){return vt("10.2.0","fixMarkup will be removed entirely in v11.0"),vt("10.2.0","Please see https://github.com/highlightjs/highlight.js/issues/2534"),x(t)}function V(t){return vt("10.7.0","highlightBlock will be removed entirely in v12.0"),vt("10.7.0","Please use highlightElement now."),C(t)}"undefined"!==typeof window&&window.addEventListener&&window.addEventListener("DOMContentLoaded",D,!1),Object.assign(t,{highlight:m,highlightAuto:w,highlightAll:A,fixMarkup:L,highlightElement:C,highlightBlock:V,configure:M,initHighlighting:N,initHighlightingOnLoad:T,registerLanguage:R,unregisterLanguage:z,listLanguages:I,getLanguage:F,registerAliases:B,requireLanguage:P,autoDetection:$,inherit:yt,addPlugin:j,vuePlugin:ct(t).VuePlugin}),t.debugMode=function(){s=!1},t.safeMode=function(){s=!0},t.versionString=st;for(const i in H)"object"===typeof H[i]&&r(H[i]);return Object.assign(t,H),t.addPlugin(k),t.addPlugin(ht),t.addPlugin(O),t};var bt=xt({});t.exports=bt}}]);
//# sourceMappingURL=devise-wysiwyg.2e30b471.js.map